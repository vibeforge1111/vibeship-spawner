# Collaboration - Svelte/SvelteKit
# How this skill works with other skills

version: 1.0.0
skill_id: svelte-kit

prerequisites:
  required: []

  recommended:
    - skill: frontend
      reason: "General frontend patterns and principles"
      what_to_know:
        - "Component architecture"
        - "State management concepts"
        - "DOM and event handling"

    - skill: typescript-advanced
      reason: "Type-safe Svelte development"
      what_to_know:
        - "Generics"
        - "Type inference"
        - "Module types"

  knowledge:
    - "HTML, CSS, JavaScript fundamentals"
    - "Component-based architecture"
    - "HTTP and form submissions"
    - "npm/package management"

delegation_triggers:
  - trigger: "user needs complex state management"
    delegate_to: frontend
    context: "Complex state patterns beyond stores"

  - trigger: "user needs API backend"
    delegate_to: backend
    context: "API design for SvelteKit endpoints"

  - trigger: "user needs database integration"
    delegate_to: postgres-wizard
    context: "Database queries in +server.ts or +page.server.ts"

  - trigger: "user needs authentication system"
    delegate_to: authentication-oauth
    context: "Auth patterns with SvelteKit hooks"

  - trigger: "user needs deployment"
    delegate_to: devops
    context: "SvelteKit adapter configuration"

receives_context_from:
  - skill: tailwind-ui
    receives:
      - "Design tokens and utility classes"
      - "Component styling patterns"

  - skill: firebase
    receives:
      - "Client-side Firebase integration"
      - "Authentication patterns"

  - skill: postgres-wizard
    receives:
      - "Database query patterns"
      - "Schema for typed queries"

provides_context_to:
  - skill: testing
    provides:
      - "Component structure for testing"
      - "Page routes for E2E tests"

  - skill: devops
    provides:
      - "Adapter requirements (node, vercel, etc.)"
      - "Build configuration"

  - skill: backend
    provides:
      - "API endpoint requirements"
      - "Data shapes for load functions"

escalation_paths:
  - situation: "Need server-side rendering optimization"
    escalate_to: performance-profiling
    context: "SSR performance, streaming"

  - situation: "Complex form workflows"
    escalate_to: frontend
    context: "Multi-step forms, complex validation"

  - situation: "Real-time features needed"
    escalate_to: websockets
    context: "WebSocket integration with SvelteKit"

workflow_integration:
  typical_sequence:
    1:
      step: "Create SvelteKit project"
      skills: [svelte-kit]
      output: "npm create svelte@latest with TypeScript"

    2:
      step: "Set up routing structure"
      skills: [svelte-kit]
      output: "Route files in src/routes/"

    3:
      step: "Build components"
      skills: [svelte-kit, tailwind-ui]
      output: "Styled reusable components in $lib"

    4:
      step: "Implement data loading"
      skills: [svelte-kit, backend]
      output: "Load functions with typed data"

    5:
      step: "Add form handling"
      skills: [svelte-kit]
      output: "Form actions with validation"

    6:
      step: "Write tests"
      skills: [testing]
      output: "Playwright E2E tests"

    7:
      step: "Deploy"
      skills: [devops]
      output: "Adapter configured, deployed"

  decision_points:
    - question: "Svelte 4 or Svelte 5?"
      guidance: |
        Svelte 5 (recommended for new projects):
        - Runes for explicit reactivity
        - Better TypeScript support
        - More predictable behavior
        - Future-proof

        Svelte 4:
        - Stable, battle-tested
        - More learning resources
        - Some libraries not yet updated

    - question: "+page.ts vs +page.server.ts?"
      guidance: |
        +page.server.ts (server-only):
        - Database queries
        - Sensitive data
        - Secrets/API keys
        - Auth checks

        +page.ts (universal):
        - Public API calls
        - Data transformation
        - Client-side cache

        Both:
        - Data loaded on server for SSR
        - +page.ts also runs on client navigation

    - question: "Stores vs Context vs Props?"
      guidance: |
        Props:
        - Parent to child communication
        - Explicit data flow
        - Most common

        Context:
        - Subtree-wide state
        - Avoid prop drilling
        - Theme, user, config

        Stores:
        - Global state
        - Cross-component sharing
        - Singleton services

        Svelte 5 $state:
        - Component-local reactivity
        - Can be exported from .svelte.ts

collaboration_patterns:
  with_tailwind:
    when: "Styling SvelteKit applications"
    approach: |
      Tailwind CSS with SvelteKit:

      # Install
      npx svelte-add@latest tailwindcss

      # Or manual setup:
      npm install -D tailwindcss postcss autoprefixer
      npx tailwindcss init -p

      # tailwind.config.js
      export default {
        content: ['./src/**/*.{html,js,svelte,ts}'],
        theme: { extend: {} },
        plugins: []
      };

      # src/app.css
      @tailwind base;
      @tailwind components;
      @tailwind utilities;

      # src/routes/+layout.svelte
      <script>
        import '../app.css';
      </script>

      <slot />

      # In components
      <button class="bg-blue-500 hover:bg-blue-700 text-white
                     font-bold py-2 px-4 rounded">
        Click me
      </button>

  with_prisma:
    when: "Database integration with Prisma"
    approach: |
      Prisma with SvelteKit:

      # Install
      npm install prisma @prisma/client
      npx prisma init

      # src/lib/server/db.ts (server-only!)
      import { PrismaClient } from '@prisma/client';

      const globalForPrisma = globalThis as unknown as {
        prisma: PrismaClient | undefined;
      };

      export const prisma =
        globalForPrisma.prisma ?? new PrismaClient();

      if (process.env.NODE_ENV !== 'production') {
        globalForPrisma.prisma = prisma;
      }

      # +page.server.ts (use in server load)
      import { prisma } from '$lib/server/db';
      import type { PageServerLoad } from './$types';

      export const load: PageServerLoad = async () => {
        const users = await prisma.user.findMany();
        return { users };
      };

      # Never import from $lib/server in client code!

  with_auth:
    when: "Adding authentication"
    approach: |
      Auth pattern with SvelteKit:

      # src/hooks.server.ts
      import type { Handle } from '@sveltejs/kit';
      import { prisma } from '$lib/server/db';

      export const handle: Handle = async ({ event, resolve }) => {
        const sessionId = event.cookies.get('session');

        if (sessionId) {
          const session = await prisma.session.findUnique({
            where: { id: sessionId },
            include: { user: true }
          });

          if (session) {
            event.locals.user = session.user;
          }
        }

        return resolve(event);
      };

      # src/app.d.ts
      declare global {
        namespace App {
          interface Locals {
            user: User | null;
          }
        }
      }

      # +layout.server.ts (provide user to all pages)
      import type { LayoutServerLoad } from './$types';

      export const load: LayoutServerLoad = async ({ locals }) => {
        return { user: locals.user };
      };

      # Protected route: +page.server.ts
      import { redirect } from '@sveltejs/kit';
      import type { PageServerLoad } from './$types';

      export const load: PageServerLoad = async ({ locals }) => {
        if (!locals.user) {
          throw redirect(303, '/login');
        }
        return { user: locals.user };
      };

platform_integration:
  adapters:
    setup: |
      # SvelteKit Adapters

      # Node.js (self-hosted)
      npm install @sveltejs/adapter-node
      // svelte.config.js
      import adapter from '@sveltejs/adapter-node';

      # Vercel
      npm install @sveltejs/adapter-vercel
      import adapter from '@sveltejs/adapter-vercel';

      # Netlify
      npm install @sveltejs/adapter-netlify
      import adapter from '@sveltejs/adapter-netlify';

      # Static (SSG)
      npm install @sveltejs/adapter-static
      import adapter from '@sveltejs/adapter-static';
      // Add to all routes:
      export const prerender = true;

      # Cloudflare Workers/Pages
      npm install @sveltejs/adapter-cloudflare
      import adapter from '@sveltejs/adapter-cloudflare';
    considerations:
      - "Choose adapter based on deployment target"
      - "Static adapter requires all routes prerenderable"
      - "Some adapters have platform-specific features"

  testing:
    setup: |
      # Testing SvelteKit

      # Playwright (E2E) - included by default
      npm run test

      # playwright.config.ts
      export default {
        webServer: {
          command: 'npm run build && npm run preview',
          port: 4173
        },
        testDir: 'tests'
      };

      # tests/home.test.ts
      import { test, expect } from '@playwright/test';

      test('home page loads', async ({ page }) => {
        await page.goto('/');
        await expect(page).toHaveTitle('My App');
      });

      # Component testing with Vitest
      npm install -D vitest @testing-library/svelte

      // vite.config.ts
      import { sveltekit } from '@sveltejs/kit/vite';
      import { defineConfig } from 'vitest/config';

      export default defineConfig({
        plugins: [sveltekit()],
        test: {
          include: ['src/**/*.{test,spec}.{js,ts}']
        }
      });

      // Counter.test.ts
      import { render, screen } from '@testing-library/svelte';
      import Counter from './Counter.svelte';

      test('shows initial count', () => {
        render(Counter, { props: { count: 5 } });
        expect(screen.getByText('5')).toBeInTheDocument();
      });
    considerations:
      - "Playwright for E2E (default)"
      - "Vitest for unit/component tests"
      - "Test server load functions separately"

ecosystem:
  primary_tools:
    - "SvelteKit CLI (npm create svelte)"
    - "Svelte DevTools (browser extension)"
    - "Svelte for VS Code (extension)"
    - "svelte-check (type checking)"

  libraries:
    - name: svelte-headlessui
      use_when: "Accessible UI components"
    - name: sveltekit-superforms
      use_when: "Enhanced form handling"
    - name: lucia
      use_when: "Authentication library"
    - name: paraglide-js
      use_when: "i18n/localization"

  alternatives:
    - name: Next.js
      use_when: "Larger ecosystem, more resources"
      avoid_when: "Want simpler DX, smaller bundles"

    - name: Nuxt
      use_when: "Vue ecosystem preference"
      avoid_when: "Want compile-time optimization"

    - name: Astro
      use_when: "Content-heavy sites, islands architecture"
      avoid_when: "Full SPA with complex state"

  deprecated:
    - "Sapper (predecessor to SvelteKit)"
    - "svelte-routing (use SvelteKit)"
