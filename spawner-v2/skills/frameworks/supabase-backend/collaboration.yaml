id: supabase-backend-collaboration
skill: supabase-backend
version: 1.0.0

# ============================================================================
# RECEIVES FROM (Who delegates TO this skill)
# ============================================================================
receives_from:
  - skill: backend
    context: "Backend needs Supabase"
    receives:
      - "Data model requirements"
      - "API needs"
      - "Security requirements"
    provides: "Supabase implementation"

  - skill: nextjs-app-router
    context: "Next.js needs database"
    receives:
      - "Data requirements"
      - "Server action needs"
      - "RLS requirements"
    provides: "Database layer"

  - skill: sveltekit
    context: "SvelteKit needs database"
    receives:
      - "Data requirements"
      - "Form action needs"
      - "RLS requirements"
    provides: "Database layer"

  - skill: product-strategy
    context: "Product needs data layer"
    receives:
      - "Feature requirements"
      - "Data model"
      - "Security needs"
    provides: "Supabase backend"

# ============================================================================
# DELEGATION TRIGGERS
# ============================================================================
delegation_triggers:
  - trigger: "auth|login|session|user"
    delegate_to: nextjs-supabase-auth
    pattern: sequential
    context: "Database needs auth integration"
    handoff_data:
      - "User schema"
      - "Session requirements"
      - "RLS policies"
    receive: "Auth integration"

  - trigger: "type|typescript|types|generation"
    delegate_to: typescript-strict
    pattern: parallel
    context: "Database needs type generation"
    handoff_data:
      - "Schema"
      - "Type config"
      - "Supabase CLI"
    receive: "Type definitions"

  - trigger: "payments|stripe|billing"
    delegate_to: stripe-integration
    pattern: sequential
    context: "Database needs payment sync"
    handoff_data:
      - "Customer schema"
      - "Subscription schema"
      - "Webhook handlers"
    receive: "Payment integration"

  - trigger: "security|audit|penetration"
    delegate_to: security
    pattern: parallel
    context: "Database needs security review"
    handoff_data:
      - "RLS policies"
      - "Access patterns"
      - "Sensitive data"
    receive: "Security review"

# ============================================================================
# FEEDBACK LOOPS
# ============================================================================
feedback_loops:
  receives_feedback_from:
    - skill: nextjs-supabase-auth
      signal: "Auth requirements"
      action: "Adjust user schema"

    - skill: nextjs-app-router
      signal: "Query patterns"
      action: "Optimize indexes"

    - skill: security
      signal: "Security findings"
      action: "Strengthen RLS"

  sends_feedback_to:
    - skill: nextjs-app-router
      signal: "Database schema"
      action: "Generate types"

    - skill: backend
      signal: "Data model"
      action: "Align API design"

    - skill: product-strategy
      signal: "Data constraints"
      action: "Adjust features"

# ============================================================================
# CROSS-DOMAIN INSIGHTS
# ============================================================================
cross_domain_insights:
  - domain: Database Security
    insight: |
      DB security experts know access:
      - Deny by default
      - Principle of least privilege
      - Audit everything
      - Test policies thoroughly
      RLS follows security principles.
    applies_when: "Designing RLS policies"

  - domain: Data Modeling
    insight: |
      Data modelers know structure:
      - Normalize for integrity
      - Denormalize for speed
      - Indexes for queries
      - Constraints for safety
      Schema design follows data principles.
    applies_when: "Designing database schema"

# ============================================================================
# COMMON COMBINATIONS
# ============================================================================
common_combinations:
  - name: Supabase Auth Stack
    skills:
      - supabase-backend
      - nextjs-supabase-auth
      - nextjs-app-router
    workflow: |
      1. Schema design (supabase-backend)
      2. Auth setup (nextjs-supabase-auth)
      3. RLS policies (supabase-backend)
      4. Integration (nextjs-app-router)

  - name: Supabase Full Stack
    skills:
      - supabase-backend
      - nextjs-app-router
      - stripe-integration
      - typescript-strict
    workflow: |
      1. Schema design (supabase-backend)
      2. Type generation (typescript-strict)
      3. Payment schema (stripe-integration)
      4. App integration (nextjs-app-router)
