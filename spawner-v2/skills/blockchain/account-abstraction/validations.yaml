# Validations - Account Abstraction
version: 1.0.0
skill_id: account-abstraction

validations:
  - id: banned-opcodes
    name: Banned opcodes in validation
    severity: error
    type: regex
    pattern:
      - '_validateSignature.*\{[^}]*(block\.|tx\.|gasleft)'
    message: "Validation cannot use banned opcodes (block.*, tx.*, etc.)"
    fix_action: "Remove time-dependent or gas-dependent logic from validation"
    applies_to:
      - "*.sol"

  - id: no-replay-protection
    name: Missing nonce validation
    severity: error
    type: regex
    pattern:
      - '_validateSignature(?!.*nonce)'
    message: "UserOperation validation must check nonces"
    fix_action: "Nonces are handled by EntryPoint, ensure getNonce() is correct"
    applies_to:
      - "*.sol"

best_practices:
  account_security:
    recommendation: |
      Smart Account Checklist:
      [ ] Proper signature validation
      [ ] Nonce handling via EntryPoint
      [ ] Execute only from EntryPoint
      [ ] Support batch operations
      [ ] Handle token callbacks (ERC721/1155)
      [ ] Upgrade mechanism if needed
