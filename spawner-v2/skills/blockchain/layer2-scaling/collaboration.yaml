id: layer2-scaling
skill: Layer 2 Scaling
version: "1.0"

receives_context_from:
  - skill: evm-deep-dive
    receives:
      - Gas optimization requirements
      - Storage patterns
      - Assembly optimizations
    provides:
      - L2-specific gas considerations
      - Calldata optimization strategies
      - L1 data posting costs

  - skill: blockchain-defi
    receives:
      - DeFi protocol requirements
      - Liquidity needs
      - Cross-chain considerations
    provides:
      - L2 deployment recommendations
      - Bridge integration patterns
      - Finality considerations

  - skill: cross-chain
    receives:
      - Multi-chain requirements
      - Bridge specifications
      - Message passing needs
    provides:
      - L2-to-L2 communication
      - Canonical bridge integration
      - Fast bridge alternatives

  - skill: devops
    receives:
      - Deployment requirements
      - Monitoring needs
      - Infrastructure specs
    provides:
      - L2 node setup
      - Sequencer monitoring
      - Multi-chain CI/CD

delegation_triggers:
  - pattern: "gas.*optim|assembly|bytecode"
    delegate_to: evm-deep-dive
    context: "Low-level optimization for L2"

  - pattern: "cross.*chain|bridge|messaging"
    delegate_to: cross-chain
    context: "Cross-chain bridging infrastructure"

  - pattern: "defi|amm|lending|yield"
    delegate_to: blockchain-defi
    context: "DeFi protocol on L2"

  - pattern: "deploy|infrastructure|monitoring"
    delegate_to: devops
    context: "L2 infrastructure setup"

  - pattern: "solana|non.*evm"
    delegate_to: solana-development
    context: "Non-EVM chain required"

common_combinations:
  - name: L2 DeFi Deployment
    skills:
      - layer2-scaling
      - blockchain-defi
      - evm-deep-dive
    workflow: |
      1. Choose optimal L2 for use case (layer2-scaling)
      2. Design DeFi protocol (blockchain-defi)
      3. Optimize for L2 gas model (evm-deep-dive)

  - name: Multi-L2 Application
    skills:
      - layer2-scaling
      - cross-chain
      - frontend
    workflow: |
      1. Design L2 deployment strategy (layer2-scaling)
      2. Implement cross-L2 messaging (cross-chain)
      3. Build chain-abstracted UI (frontend)

  - name: L2 Infrastructure
    skills:
      - layer2-scaling
      - devops
      - backend
    workflow: |
      1. Select L2 and understand requirements (layer2-scaling)
      2. Set up nodes and indexers (devops)
      3. Build backend services (backend)

cross_domain_insights:
  - domain: Distributed Systems
    insight: L2s are essentially distributed databases with consensus
    application: Apply database replication patterns to L2 state

  - domain: CDN Architecture
    insight: L2s are like CDN edge nodes for Ethereum
    application: Cache aggressively, sync lazily

  - domain: Payment Networks
    insight: Similar to card network settlement
    application: Design for eventual consistency like payment rails

  - domain: Telecom
    insight: Sequencer model mirrors telecom switching
    application: Apply telecom reliability patterns

  - domain: Aviation
    insight: Redundancy and fallback systems
    application: Always have L1 escape hatch

ecosystem_alternatives:
  optimistic_rollups:
    - name: Optimism
      when: OP Stack ecosystem, Superchain
      tradeoff: Smaller developer ecosystem than Arbitrum
    - name: Arbitrum One
      when: Largest TVL, most dApps
      tradeoff: More complex architecture
    - name: Base
      when: Coinbase integration, retail access
      tradeoff: More centralized

  zk_rollups:
    - name: zkSync Era
      when: ZK-native dApps, account abstraction
      tradeoff: Different EVM behavior
    - name: Polygon zkEVM
      when: Type 2 zkEVM, Polygon ecosystem
      tradeoff: Still maturing
    - name: Scroll
      when: Most EVM-equivalent ZK
      tradeoff: Newer, less battle-tested

  bridging:
    - name: Canonical bridges
      when: Maximum security, can wait 7 days
      tradeoff: Slow withdrawals
    - name: Across Protocol
      when: Fast, low fees
      tradeoff: Liquidity dependent
    - name: LayerZero
      when: Custom messaging, many chains
      tradeoff: More complex setup

feedback_loops:
  - from: evm-deep-dive
    incorporates:
      - Gas optimization techniques
      - Storage patterns
      - Assembly improvements
    into: L2-specific optimizations

  - from: cross-chain
    incorporates:
      - Bridge performance data
      - Failure modes
      - Security considerations
    into: Multi-L2 architecture

  - from: devops
    incorporates:
      - Operational issues
      - Monitoring insights
      - Incident learnings
    into: Resilience patterns

prerequisites:
  required_skills:
    - Ethereum/EVM basics
    - Solidity development
    - Understanding of rollup concepts

  recommended_tools:
    - Foundry (supports L2 forking)
    - L2 RPC endpoints (Alchemy, QuickNode)
    - Bridge interfaces (Across, Hop)
    - Block explorers (Etherscan L2 variants)

  environment_setup: |
    # Set up L2 RPC endpoints
    export OPTIMISM_RPC="https://mainnet.optimism.io"
    export ARBITRUM_RPC="https://arb1.arbitrum.io/rpc"
    export BASE_RPC="https://mainnet.base.org"

    # Foundry with L2 support
    foundryup

    # Configure for L2 testing
    # foundry.toml
    [profile.optimism]
    fork_url = "${OPTIMISM_RPC}"

    [profile.arbitrum]
    fork_url = "${ARBITRUM_RPC}"

    # Run tests on specific L2
    forge test --profile optimism
