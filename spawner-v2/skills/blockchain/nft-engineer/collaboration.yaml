id: nft-engineer
skill: NFT Engineer
version: "1.0"

receives_context_from:
  - skill: generative-art
    receives:
      - Generated artwork files (PNG, SVG, etc.)
      - Trait combination data (JSON)
      - Rarity distribution spreadsheet
      - Layer structure and ordering
      - Color palette definitions
    provides:
      - Metadata JSON structure requirements
      - File naming conventions (0.json, 1.json, etc.)
      - Image size and format specifications
      - IPFS upload instructions
      - OpenSea metadata schema requirements
    handoff_checklist:
      - "All artwork generated and exported"
      - "Trait combinations mapped to token IDs"
      - "Rarity percentages calculated"
      - "Files named correctly for tokenId mapping"

  - skill: smart-contract-auditor
    receives:
      - Audit findings report
      - Severity classifications
      - Recommended fixes
      - Gas optimization suggestions
    provides:
      - NFT contract source code
      - Test suite and coverage report
      - Deployment configuration
      - External dependencies list
    handoff_checklist:
      - "Contract compiles without warnings"
      - "Test coverage > 80%"
      - "All external calls documented"
      - "Access control verified"

  - skill: web3-gaming
    receives:
      - In-game item requirements
      - Equipment stats and bonuses
      - Crafting/upgrade mechanics
      - Cross-game interoperability needs
    provides:
      - NFT contract with game-compatible interfaces
      - On-chain attribute storage patterns
      - Burnable/composable token mechanics
      - Holder verification methods
    handoff_checklist:
      - "Game attribute structure defined"
      - "Upgrade paths specified"
      - "Cross-contract interaction patterns agreed"

  - skill: frontend
    receives:
      - Mint page wireframes
      - Wallet connection requirements
      - Gallery display specifications
      - Mobile responsiveness needs
    provides:
      - Contract ABIs
      - Minting function signatures
      - Price and supply constants
      - Metadata endpoint URLs
      - Error message mappings
    handoff_checklist:
      - "Contract deployed to testnet"
      - "ABI exported and shared"
      - "Metadata accessible via IPFS gateway"
      - "Error handling documented"

  - skill: tokenomics-design
    receives:
      - Token utility specifications
      - Staking reward structures
      - Burn mechanics design
      - Holder benefit tiers
    provides:
      - NFT holder verification functions
      - Staking integration points
      - Burn function implementation
      - On-chain trait access methods
    handoff_checklist:
      - "Utility mechanics finalized"
      - "Reward calculation formulas agreed"
      - "Integration interfaces defined"

  - skill: solana-development
    receives:
      - Solana-specific collection requirements
      - Metaplex constraints and options
      - Cross-chain strategy (if applicable)
    provides:
      - EVM NFT patterns for reference
      - Metadata structure standards
      - Royalty configuration approach
    handoff_checklist:
      - "Chain-specific requirements documented"
      - "Metadata format agreed upon"

provides_context_to:
  - skill: smart-contract-auditor
    provides:
      - Complete contract source code
      - Deployment scripts
      - Test files with coverage
      - Known limitations and trade-offs
      - Third-party dependencies with versions
    expects_back:
      - Security finding report
      - Risk severity classifications
      - Code fix recommendations
      - Gas optimization suggestions

  - skill: frontend
    provides:
      - Contract address (per network)
      - Full ABI JSON
      - Mint function parameters
      - Custom error definitions
      - Event signatures for listeners
      - Metadata structure examples
    expects_back:
      - Integrated mint page
      - Wallet connection flow
      - Error handling UI
      - Transaction status feedback

  - skill: backend
    provides:
      - IPFS/Arweave upload requirements
      - Metadata generation scripts
      - Pinning service recommendations
      - API endpoints needed (if any)
    expects_back:
      - Metadata hosting setup
      - Allowlist management API
      - Holder verification endpoint

delegation_triggers:
  - pattern: "audit|security review|vulnerability scan"
    delegate_to: smart-contract-auditor
    context: |
      NFT contract ready for security review. Key areas to focus:
      - Reentrancy in mint functions
      - Access control on admin functions
      - Merkle proof verification
      - Withdrawal function safety
    priority: critical

  - pattern: "generative|generate art|trait layers|rarity"
    delegate_to: generative-art
    context: |
      Need artwork generation for NFT collection. Requirements:
      - Final image format and resolution
      - Trait layer structure
      - Rarity distribution
      - Output format compatible with IPFS upload
    priority: high

  - pattern: "game|in-game|equipment|play-to-earn"
    delegate_to: web3-gaming
    context: |
      NFT integration with gaming mechanics. Topics:
      - On-chain vs off-chain attributes
      - Equipment/item mechanics
      - Cross-game interoperability
      - Upgrade and evolution patterns
    priority: high

  - pattern: "mint page|connect wallet|gallery|dapp frontend"
    delegate_to: frontend
    context: |
      Frontend development for NFT minting. Deliverables needed:
      - Contract ABI and address
      - Mint function parameters
      - Error message mappings
      - Metadata endpoint URLs
    priority: medium

  - pattern: "gas optimiz|storage layout|assembly|yul"
    delegate_to: evm-deep-dive
    context: |
      Deep optimization needed for NFT contract. Focus areas:
      - Storage packing for traits
      - Batch mint gas reduction
      - Assembly optimizations
      - Bytecode size reduction
    priority: medium

  - pattern: "solana|metaplex|candy machine|magic eden"
    delegate_to: solana-development
    context: |
      Solana NFT implementation required. Handoff includes:
      - Collection concept and structure
      - Metadata standards
      - Royalty requirements
      - Marketplace integration needs
    priority: high

  - pattern: "subgraph|indexing|the graph|event tracking"
    delegate_to: onchain-analytics
    context: |
      NFT event indexing needed. Events to track:
      - Transfer events for ownership
      - Mint events for provenance
      - Metadata update events
      - Royalty configuration changes
    priority: low

  - pattern: "staking|token utility|holder rewards|burning"
    delegate_to: tokenomics-design
    context: |
      NFT utility design needed. Integration points:
      - Holder verification
      - Staking mechanics
      - Burn-to-earn patterns
      - Reward distribution
    priority: medium

common_combinations:
  - name: Full PFP Collection Launch
    skills:
      - generative-art
      - nft-engineer
      - frontend
      - smart-contract-auditor
    workflow: |
      1. generative-art: Create artwork and trait system
         Output: Image files, trait data, rarity distribution

      2. nft-engineer: Build smart contract and metadata
         Output: Deployed contract, IPFS metadata, ABIs

      3. smart-contract-auditor: Security review
         Output: Audit report, fixes verified

      4. frontend: Build mint page and gallery
         Output: Live minting dApp

  - name: Gaming NFT Collection
    skills:
      - nft-engineer
      - web3-gaming
      - backend
      - frontend
    workflow: |
      1. web3-gaming: Define in-game mechanics and attributes
         Output: Attribute schema, upgrade paths

      2. nft-engineer: Implement game-compatible NFT contract
         Output: Contract with on-chain attributes

      3. backend: Build game server integration
         Output: Holder verification API, attribute sync

      4. frontend: Build game UI with NFT integration
         Output: Connected game interface

  - name: On-Chain Art Collection
    skills:
      - nft-engineer
      - evm-deep-dive
      - frontend
    workflow: |
      1. nft-engineer: Design on-chain SVG generation
         Output: Base contract with tokenURI logic

      2. evm-deep-dive: Optimize for gas and contract size
         Output: Optimized contract under 24KB

      3. frontend: Build interactive viewer
         Output: Art viewing and mint interface

  - name: Utility NFT with Tokenomics
    skills:
      - tokenomics-design
      - nft-engineer
      - backend
      - frontend
    workflow: |
      1. tokenomics-design: Design holder benefits and staking
         Output: Utility specification, reward math

      2. nft-engineer: Implement NFT with utility hooks
         Output: Contract with staking interface

      3. backend: Build reward distribution system
         Output: Staking API, reward calculation

      4. frontend: Build staking dashboard
         Output: Holder utility interface

cross_domain_insights:
  - domain: Digital Art Markets
    insight: Provenance and artist story matter more than technical features
    application: Focus on clear ownership history, artist verification, and creation narrative
    learned_from: "Saw technically inferior collections outsell optimized ones by 10x because of artist reputation"

  - domain: Collectibles Industry
    insight: Artificial scarcity without utility eventually collapses
    application: Build utility before emphasizing rarity; give holders reasons to keep holding
    learned_from: "Watched 10k PFP floor crash 95% when utility never materialized"

  - domain: Gaming Industry
    insight: Pay-to-win destroys communities faster than it generates revenue
    application: Design NFTs as cosmetic or convenience, not power advantages
    learned_from: "Game integration where NFT weapons were OP killed player retention in 2 weeks"

  - domain: Fashion/Luxury
    insight: Exclusivity works only when paired with aspiration
    application: Make holding desirable through community and access, not just scarcity
    learned_from: "Allowlist drama destroyed more communities than it built"

  - domain: Ticketing/Events
    insight: NFTs excel at proof-of-attendance and access control
    application: POAPs and token-gated experiences have clearer utility than speculative art
    learned_from: "POAP collections have stronger communities than most PFP projects"

ecosystem_alternatives:
  contract_base:
    - name: OpenZeppelin ERC721
      when: Maximum compatibility, well-audited, standard implementation
      tradeoff: Higher gas for batch mints (~80k per token)
      gas_per_mint: "~80,000"

    - name: ERC721A (Azuki)
      when: Collections over 5k, batch minting expected
      tradeoff: Non-standard enumeration, slightly complex ownership tracking
      gas_per_mint: "~52,000 first, ~4,000 additional"

    - name: ERC721Psi
      when: Very large collections, even lower gas than 721A
      tradeoff: Even more non-standard, less battle-tested
      gas_per_mint: "~46,000 first, ~2,000 additional"

    - name: Solmate ERC721
      when: Maximum gas optimization, experienced developers
      tradeoff: Fewer safety checks, requires more careful usage
      gas_per_mint: "~50,000"

  storage:
    - name: IPFS + Pinata
      when: Standard NFT hosting, good tooling, reasonable cost
      tradeoff: Requires ongoing pinning subscription
      cost: "$20-100/month depending on storage"

    - name: IPFS + nft.storage
      when: Free hosting with IPFS + Filecoin backing
      tradeoff: Less control, dependent on Protocol Labs
      cost: "Free up to limits"

    - name: Arweave
      when: Permanent storage, one-time payment, no maintenance
      tradeoff: Higher upfront cost (~$5 per MB)
      cost: "One-time, ~$5/MB"

    - name: On-chain (base64/SVG)
      when: Small data, maximum decentralization, generative art
      tradeoff: Very high gas costs, contract size limits
      cost: "Gas-dependent, can be $10k+ for complex art"

  royalty_approach:
    - name: ERC-2981 Only
      when: Compliance is nice-to-have, accept voluntary enforcement
      tradeoff: Many marketplaces ignore, royalties not guaranteed
      enforcement: "~50% of sales"

    - name: ERC-2981 + Operator Filter
      when: Want to block known bypass contracts
      tradeoff: Arms race with marketplaces, may limit liquidity
      enforcement: "~70% of sales"

    - name: Holder Utility Focus
      when: Build value through holding rather than royalties
      tradeoff: Requires ongoing development of utility
      enforcement: "N/A - different model"

prerequisites:
  required_skills:
    - Solidity fundamentals (functions, modifiers, events)
    - ERC-721/1155 standard understanding
    - Basic cryptography (hashing, merkle trees)
    - IPFS/decentralized storage concepts
    - Ethers.js or viem for testing

  recommended_tools:
    - Foundry (forge, cast, anvil)
    - VS Code with Solidity extension
    - Pinata or nft.storage account
    - OpenSea testnet access
    - Etherscan API key

  environment_setup: |
    # 1. Install Foundry
    curl -L https://foundry.paradigm.xyz | bash
    foundryup

    # 2. Create new project
    forge init my-nft-project
    cd my-nft-project

    # 3. Install dependencies
    forge install OpenZeppelin/openzeppelin-contracts
    forge install chiru-labs/ERC721A
    forge install ProjectOpenSea/operator-filter-registry

    # 4. Configure remappings (foundry.toml or remappings.txt)
    echo '@openzeppelin/=lib/openzeppelin-contracts/' >> remappings.txt
    echo 'erc721a/=lib/ERC721A/' >> remappings.txt
    echo 'operator-filter-registry/=lib/operator-filter-registry/' >> remappings.txt

    # 5. Create .env for deployment
    echo 'PRIVATE_KEY=your_key_here' > .env
    echo 'ETHERSCAN_API_KEY=your_key_here' >> .env
    echo 'RPC_URL=https://eth-mainnet.g.alchemy.com/v2/your_key' >> .env

    # 6. Verify setup
    forge build

feedback_loops:
  - from: smart-contract-auditor
    incorporates:
      - Vulnerability findings and severity
      - Best practice recommendations
      - Gas optimization opportunities
      - Code quality improvements
    into: |
      Contract implementation improvements, test additions,
      and documentation updates. Critical findings block deployment.

  - from: frontend
    incorporates:
      - UX friction points during minting
      - Error message clarity needs
      - Mobile wallet compatibility issues
      - Loading state requirements
    into: |
      Contract interface design, error definitions,
      and event emission patterns for better frontend integration.

  - from: generative-art
    incorporates:
      - Art file format and size constraints
      - Trait distribution requirements
      - Layer ordering dependencies
      - Animation/video format needs
    into: |
      Metadata structure design, IPFS upload workflows,
      and reveal mechanics that accommodate art generation timeline.

  - from: web3-gaming
    incorporates:
      - In-game attribute requirements
      - Cross-contract interaction patterns
      - Upgrade and evolution mechanics
      - Performance requirements for gaming
    into: |
      On-chain attribute storage patterns, burn/compose mechanics,
      and gas-efficient reads for game integration.

session_handoff:
  when_complete:
    - "Contract deployed to mainnet and verified"
    - "Metadata uploaded and pinned to IPFS"
    - "Mint function tested end-to-end"
    - "Withdrawal tested and owner set correctly"
    - "Frontend integration completed"

  when_blocked:
    - "Audit findings unresolved"
    - "Metadata not yet generated"
    - "Frontend not ready for integration"
    - "Gas costs exceed budget"

  document_for_next_session:
    - Contract addresses (per network)
    - IPFS CIDs for metadata
    - Merkle roots for allowlists
    - Current mint status and supply
    - Any open issues or concerns
