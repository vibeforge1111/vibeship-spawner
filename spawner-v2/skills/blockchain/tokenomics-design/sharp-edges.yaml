id: tokenomics-design
skill: Tokenomics Design
version: "1.0"

sharp_edges:
  - id: securities-classification
    severity: CRITICAL
    title: Token May Be Classified as Security
    description: Howey test implications can make tokens securities
    symptoms:
      - SEC enforcement action
      - Exchange delistings
      - Legal liability for founders
    detection_pattern: "invest|profit|return|dividend"
    solution: |
      Howey Test - Investment Contract:
      1. Investment of money
      2. In a common enterprise
      3. With expectation of profits
      4. Derived from efforts of others

      Risk Reduction:
      - Emphasize utility over investment
      - Decentralize before token launch
      - No promises of returns or appreciation
      - Governance, not profit sharing
      - Utility discounts, not dividends

      Documentation:
      - Clear utility purpose
      - No investment language in marketing
      - Legal opinion before launch
    references:
      - https://www.sec.gov/corpfin/framework-investment-contract-analysis-digital-assets

  - id: high-fdv-low-float
    severity: CRITICAL
    title: High FDV with Low Float Creates Dump Risk
    description: Large locked supply will eventually unlock and sell
    symptoms:
      - Price crashes at unlock events
      - Retail holders diluted
      - Token never recovers to ATH
    detection_pattern: "fdv|fully.*diluted|circulation"
    solution: |
      Calculate Unlock Impact:

      Current State:
      - Float: 100M tokens ($100M market cap)
      - FDV: 1B tokens ($1B FDV)
      - Ratio: 10x

      At Full Unlock (worst case):
      - If all new supply sells
      - Price impact: -90% (10x dilution)

      Mitigation:
      1. Gradual unlocks (not cliff dumps)
      2. Lock-up extensions for large holders
      3. Staking incentives for unlocked tokens
      4. Communicate unlock schedule clearly

      Healthy Ratio: FDV < 3x Market Cap
    references:
      - https://tokenunlocks.app/

  - id: emission-exceeds-demand
    severity: CRITICAL
    title: Token Emissions Exceed Buy Pressure
    description: More tokens emitted than market can absorb
    symptoms:
      - Constant price decline
      - Decreasing TVL despite emissions
      - Death spiral
    detection_pattern: "emission|inflation|reward.*rate"
    solution: |
      Emission Sustainability Check:

      Weekly Emissions: 1,000,000 tokens
      Token Price: $1
      Weekly Emission Value: $1,000,000

      Required Weekly Buy Pressure:
      - Protocol Revenue: $200,000
      - New Investment: $500,000
      - Organic Demand: $300,000
      - Total: $1,000,000 minimum

      If buy pressure < emissions:
      - Price declines
      - APY drops in dollar terms
      - Farmers leave
      - TVL drops
      - Repeat (death spiral)

      Solution:
      - Emission = f(protocol revenue)
      - Dynamic rate reduction
      - Burn mechanisms
    references:
      - https://tokenterminal.com/

  - id: vesting-cliff-dump
    severity: HIGH
    title: Large Cliff Unlock Causes Dump
    description: Significant supply unlocking on single date
    symptoms:
      - Sharp price decline on unlock date
      - Predictable selling opportunity
      - Community loses trust
    detection_pattern: "cliff|unlock.*date|vesting"
    solution: |
      Problematic:
      - 25% unlock after 1 year cliff
      - All investors unlock same date
      - Predictable dump

      Better:
      - Staggered cliffs (3, 6, 9, 12 months)
      - Different unlock dates per round
      - Linear vest after cliff (no lump sum)
      - Weekly/monthly unlocks, not quarterly

      Code Example:
      function vestedAmount(address beneficiary) public view returns (uint256) {
          uint256 elapsed = block.timestamp - vestingStart;
          if (elapsed < CLIFF) return 0;

          // Weekly unlocks after cliff
          uint256 weeksVested = (elapsed - CLIFF) / 1 weeks;
          uint256 totalWeeks = (VESTING_DURATION - CLIFF) / 1 weeks;

          return allocation[beneficiary] * weeksVested / totalWeeks;
      }
    references:
      - https://docs.openzeppelin.com/contracts/4.x/api/token/erc20#VestingWallet

  - id: governance-attack
    severity: HIGH
    title: Governance Token Can Be Gamed
    description: Flash loans or whale accumulation for malicious proposals
    symptoms:
      - Treasury drained via governance
      - Protocol parameters manipulated
      - Minority holders overruled
    detection_pattern: "governance|vote|proposal|quorum"
    solution: |
      Governance Safeguards:

      1. Snapshot Voting
      - Voting power from past block
      - Prevents flash loan attacks

      2. Time Locks
      - Proposal delay: 2-7 days
      - Execution delay: 24-48 hours
      - Allows community response

      3. Vote Escrow (veToken)
      - Must lock tokens to vote
      - Longer lock = more power
      - Can't quickly accumulate

      4. Multi-sig Override
      - Security council can veto
      - Emergency actions without vote

      5. Quorum Requirements
      - Minimum participation
      - Supermajority for critical changes
    references:
      - https://blog.openzeppelin.com/governor-voting

  - id: liquidity-mining-exhaustion
    severity: HIGH
    title: Liquidity Mining Incentives Run Out
    description: Emissions end, LPs leave, liquidity collapses
    symptoms:
      - TVL cliff when incentives end
      - Slippage increases dramatically
      - Protocol becomes unusable
    detection_pattern: "liquidity.*mining|lp.*reward|farming"
    solution: |
      Liquidity Sustainability:

      Phase 1: Bootstrap (Month 1-6)
      - High emissions: 500K tokens/month
      - Goal: Attract initial liquidity

      Phase 2: Transition (Month 7-12)
      - Reduce emissions: 250K/month
      - Introduce POL (protocol-owned liquidity)
      - Start fee sharing to LPs

      Phase 3: Sustainable (Year 2+)
      - Minimal emissions: 50K/month
      - POL provides base liquidity
      - Trading fees incentivize remaining LPs

      Never go from high to zero emissions.
      Always have a sustainability plan.
    references:
      - https://olympusdao.medium.com/

  - id: airdrop-dump
    severity: HIGH
    title: Airdrop Recipients Immediately Dump
    description: Free tokens sold instantly, price collapses
    symptoms:
      - Price drops 50%+ at airdrop claim
      - Farmers claim and sell
      - Real users get worse price
    detection_pattern: "airdrop|claim|distribution"
    solution: |
      Anti-Dump Airdrop Design:

      1. Vested Airdrop
      - 10% immediate
      - 90% over 6-12 months

      2. Lock Boost
      - Claim now: 100 tokens
      - Lock 3 months: 150 tokens
      - Lock 6 months: 200 tokens

      3. Usage Requirements
      - Must use protocol to claim
      - Partial claim per transaction
      - Ongoing engagement rewards

      4. Smaller Allocations
      - Cap per address
      - Wider distribution
      - Reduces whale dumps
    references:
      - https://dune.com/queries/airdrop-analysis

  - id: token-velocity-problem
    severity: MEDIUM
    title: High Token Velocity Reduces Value
    description: Tokens immediately sold after receiving, no holding
    symptoms:
      - Buy pressure doesn't sustain price
      - Constant sell pressure from users
      - Token acts as pass-through
    detection_pattern: "velocity|hold|stake|utility"
    solution: |
      Reduce Velocity:

      1. Staking Requirements
      - Lock to access features
      - Higher lock = better rates

      2. Fee Discounts
      - Pay in token: 50% off
      - Hold threshold for discount

      3. Time-Weighted Benefits
      - Longer hold = more rewards
      - Loyalty multipliers

      4. Utility Sinks
      - Burn for premium features
      - Consume for upgrades

      Equation:
      Token Value = Transaction Volume / Velocity
      Lower velocity = higher value
    references:
      - https://multicoin.capital/2017/12/velocity-of-tokens/

  - id: whale-concentration
    severity: MEDIUM
    title: Token Concentrated in Few Addresses
    description: Top holders control majority of supply
    symptoms:
      - Single wallet can crash price
      - Governance centralized
      - Retail hesitant to buy
    detection_pattern: "distribution|holder|whale|concentration"
    solution: |
      Healthy Distribution Targets:

      Top 10 holders: < 40% of supply
      Top 100 holders: < 70% of supply
      Gini coefficient: < 0.8

      Achieving Distribution:
      1. Broad airdrop (many small recipients)
      2. Cap per-address allocations
      3. Community sale with limits
      4. Liquidity mining (gradual distribution)

      Monitoring:
      - Track concentration metrics
      - Etherscan/Solscan holder analysis
      - Dune dashboard for distribution
    references:
      - https://dune.com/queries/token-distribution

  - id: oracle-manipulation
    severity: MEDIUM
    title: Token Price Oracle Can Be Manipulated
    description: Low liquidity tokens vulnerable to price manipulation
    symptoms:
      - Flash loan attacks on DeFi integrations
      - Incorrect liquidations
      - Arbitrage exploits
    detection_pattern: "oracle|price.*feed|twap"
    solution: |
      Oracle Security:

      1. Use TWAP (Time-Weighted Average Price)
      - 30 minute minimum window
      - Resists single-block manipulation

      2. Multiple Sources
      - Aggregate Chainlink, Uniswap, etc.
      - Median or weighted average

      3. Liquidity Requirements
      - Minimum liquidity depth
      - Circuit breakers on low liquidity

      4. Price Deviation Checks
      - Compare to external sources
      - Pause on large deviations

      Code:
      require(
          deviation(oraclePrice, backupPrice) < 5%,
          "Price deviation too high"
      );
    references:
      - https://docs.chain.link/data-feeds/using-data-feeds

  - id: token-utility-forcing
    severity: MEDIUM
    title: Forced Token Utility Creates Friction
    description: Requiring token for everything annoys users
    symptoms:
      - Users leave for competitors
      - Complaints about token requirement
      - Lower adoption than tokenless alternatives
    detection_pattern: "required|must.*hold|token.*gate"
    solution: |
      Good Utility:
      - Discounts for using token (not requirements)
      - Governance participation (optional)
      - Premium features (with free tier)
      - Staking rewards (opt-in)

      Bad Utility:
      - Token required for basic access
      - Can't use without buying token
      - Artificial friction

      Rule: Users should be able to use the
      protocol without tokens, but benefit
      from holding tokens.
    references:
      - https://www.placeholder.vc/blog/tokens
