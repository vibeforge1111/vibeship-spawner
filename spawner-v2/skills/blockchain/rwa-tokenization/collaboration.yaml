# Collaboration - RWA Tokenization
# How this skill works with other specialists

id: rwa-tokenization
version: "1.0.0"

# What this skill exclusively owns
owns:
  - Security token architecture (ERC-3643, ERC-1400)
  - Transfer restriction implementation
  - Compliance module design
  - On-chain identity verification
  - Investor qualification logic
  - Holding period enforcement
  - Dividend/distribution automation
  - Transfer agent integration patterns
  - Cap table management on-chain
  - Corporate actions (splits, mergers, redemptions)

# What this skill explicitly does NOT own
delegates:
  - Smart contract security auditing -> smart-contract-auditor
  - DeFi liquidity mechanics -> blockchain-defi
  - Token launch and distribution strategy -> token-launch
  - Legal document drafting -> securities-law
  - Generic Solidity patterns -> solidity-patterns
  - Infrastructure and deployment -> devops

# Inbound handoffs - when other skills delegate to us
receives_from:
  - skill: smart-contract-auditor
    when: "Audit findings relate to compliance logic"
    receives:
      - Audit findings specific to compliance modules
      - Access control vulnerabilities in token
      - Identity verification bypass vectors
      - Recommendations for compliance improvements
    provides_back:
      - Remediation implementation
      - Compliance-aware fixes
      - Updated contracts for re-audit
    handoff_protocol: |
      When receiving audit findings:
      1. Review each finding in context of regulatory requirements
      2. Prioritize by regulatory risk, not just technical severity
      3. Implement fixes that maintain compliance
      4. Document rationale for compliance-related decisions
      5. Request re-audit of affected modules

  - skill: blockchain-defi
    when: "Building compliant liquidity for RWA tokens"
    receives:
      - Proposed AMM or liquidity pool design
      - DeFi integration architecture
      - Yield strategy proposals
    provides_back:
      - Compliance requirements for the integration
      - Transfer restriction compatibility assessment
      - Permissioned pool recommendations
      - KYC gate requirements
    handoff_protocol: |
      DeFi integrations for RWAs must maintain compliance:
      1. Assess proposed design against transfer restrictions
      2. Identify where compliance checks are needed
      3. Recommend permissioned alternatives if needed
      4. Design KYC gates for liquidity providers
      5. Ensure no anonymous participation possible

  - skill: token-launch
    when: "Launching a security token offering"
    receives:
      - Distribution plan
      - Investor list and qualifications
      - Marketing and go-to-market strategy
      - Exchange/ATS listing plans
    provides_back:
      - Technical readiness assessment
      - Compliance verification status
      - Transfer agent integration status
      - Identity registry population
    handoff_protocol: |
      Before launch approval:
      1. Verify all investors are whitelisted
      2. Confirm transfer agent is connected
      3. Test all compliance modules
      4. Verify holding period logic
      5. Confirm oracle feeds are live
      6. Document any launch blockers

  - skill: solidity-patterns
    when: "Implementing generic contract patterns in RWA context"
    receives:
      - Proposed design patterns
      - Gas optimization suggestions
      - Upgrade patterns
    provides_back:
      - Compliance implications of patterns
      - RWA-specific modifications needed
      - Regulatory constraints on optimizations
    handoff_protocol: |
      Generic patterns need RWA adaptation:
      1. Review pattern for compliance impact
      2. Identify regulatory constraints
      3. Modify pattern to maintain compliance
      4. Document why modifications were necessary

  - skill: devops
    when: "Deploying or operating RWA token infrastructure"
    receives:
      - Deployment pipeline designs
      - Monitoring and alerting proposals
      - Infrastructure architecture
    provides_back:
      - Compliance-critical monitoring requirements
      - Audit trail requirements
      - Required alerts (oracle staleness, etc.)
      - Multi-sig ceremony requirements
    handoff_protocol: |
      RWA infrastructure has unique requirements:
      1. Audit trail must be complete and immutable
      2. Oracle health must be monitored
      3. Compliance module status tracked
      4. Multi-sig ceremonies documented
      5. Key management meets regulatory standards

# Outbound handoffs - when we delegate to other skills
provides_context_to:
  - skill: smart-contract-auditor
    when: "Contracts ready for security review"
    provides:
      - Complete contract source code
      - Compliance requirements documentation
      - Expected behavior for edge cases
      - Known attack vectors to check
      - Regulatory context for findings
    expects_back:
      - Security audit report
      - Severity-rated findings
      - Remediation recommendations
      - Confirmation of compliance module security
    handoff_trigger: "smart contract audit|security audit|code review"
    handoff_message: |
      RWA token contracts ready for audit. Key focus areas:
      - Compliance module bypass vulnerabilities
      - Identity verification edge cases
      - Oracle manipulation risks
      - Forced transfer access control
      - Dividend calculation precision
      Regulatory context: These are registered securities.
      Any vulnerability could have legal implications.

  - skill: blockchain-defi
    when: "Building compliant secondary market liquidity"
    provides:
      - Token contract address and interfaces
      - Transfer restriction requirements
      - Compliance module interfaces
      - Investor qualification requirements
    expects_back:
      - Compliant liquidity pool design
      - KYC-gated AMM implementation
      - Permissioned trading venue
    handoff_trigger: "liquidity pool|AMM|DEX listing|DeFi integration"
    handoff_message: |
      RWA tokens cannot use permissionless DeFi.
      Need compliant liquidity solutions:
      - Permissioned AMM pools only
      - KYC verification for all LPs
      - Transfer restrictions must be honored
      - Consider ATS registration requirements
      Standard DEX listing is NOT an option.

  - skill: token-launch
    when: "Ready to distribute security tokens"
    provides:
      - Token contract deployment details
      - Compliance module configuration
      - Transfer agent integration status
      - Identity registry with verified investors
    expects_back:
      - Distribution execution plan
      - Investor communication strategy
      - Exchange/ATS coordination
    handoff_trigger: "token launch|go to market|distribution"
    handoff_message: |
      Security token ready for distribution.
      Prerequisites completed:
      - Transfer agent integrated
      - Compliance modules active
      - Identity registry populated
      Critical: Holding period starts at distribution.
      Secondary trading venue must be compliant (ATS).

  - skill: securities-law
    when: "Legal structure questions arise"
    provides:
      - Proposed token architecture
      - Technical capabilities and constraints
      - Compliance module design
      - Transfer restriction implementation
    expects_back:
      - Legal structure recommendations
      - Exemption strategy (Reg D, S, A+)
      - Required legal documents
      - Regulatory filing requirements
    handoff_trigger: "legal structure|securities law|offering document"
    handoff_message: |
      Need legal structure for RWA token.
      Technical architecture can support:
      - Transfer restrictions by holding period
      - Investor qualification verification
      - Jurisdiction-based rules
      - Investor count limits
      Need guidance on exemption choice and documentation.

  - skill: cap-table-management
    when: "Managing equity records on-chain"
    provides:
      - Token holder registry
      - Transaction history
      - Corporate action capabilities
    expects_back:
      - Cap table reconciliation
      - Corporate action implementation
      - Shareholder communication
    handoff_trigger: "cap table|shareholder registry|equity management"
    handoff_message: |
      On-chain cap table needs reconciliation with legal records.
      Token supports:
      - Forced transfers (for corrections)
      - Dividend distribution
      - Corporate actions (splits, conversions)
      Transfer agent is the legal source of truth.

# Collaboration patterns for common workflows
collaboration_workflows:
  - name: "RWA Token Full Build"
    description: "Complete lifecycle from design to launch"
    steps:
      - step: 1
        skill: rwa-tokenization
        action: "Design token architecture and compliance modules"
        output: "Contract specifications and compliance requirements"

      - step: 2
        skill: solidity-patterns
        action: "Implement base patterns (upgradeable, access control)"
        output: "Base contract implementations"

      - step: 3
        skill: rwa-tokenization
        action: "Implement compliance logic and identity integration"
        output: "Complete token and compliance contracts"

      - step: 4
        skill: smart-contract-auditor
        action: "Security audit with compliance focus"
        output: "Audit report and remediation list"

      - step: 5
        skill: rwa-tokenization
        action: "Implement audit remediations"
        output: "Audited contracts"

      - step: 6
        skill: devops
        action: "Deploy contracts with proper ceremony"
        output: "Deployed and verified contracts"

      - step: 7
        skill: token-launch
        action: "Execute distribution strategy"
        output: "Tokens distributed to verified investors"

  - name: "Compliant Secondary Market"
    description: "Building liquidity for RWA tokens"
    steps:
      - step: 1
        skill: rwa-tokenization
        action: "Define compliance requirements for liquidity"
        output: "Compliance specs for liquidity venue"

      - step: 2
        skill: blockchain-defi
        action: "Design permissioned AMM with KYC gates"
        output: "Compliant pool architecture"

      - step: 3
        skill: rwa-tokenization
        action: "Review and approve compliance integration"
        output: "Compliance approval"

      - step: 4
        skill: smart-contract-auditor
        action: "Audit pool contracts"
        output: "Audit report"

      - step: 5
        skill: token-launch
        action: "Launch liquidity venue"
        output: "Active secondary market"

  - name: "Corporate Action Execution"
    description: "Handling dividends, splits, mergers"
    steps:
      - step: 1
        skill: cap-table-management
        action: "Define corporate action parameters"
        output: "Action specifications"

      - step: 2
        skill: rwa-tokenization
        action: "Implement on-chain corporate action"
        output: "Action contracts or transactions"

      - step: 3
        skill: rwa-tokenization
        action: "Execute with transfer agent coordination"
        output: "Completed corporate action"

# Conflict resolution
conflict_resolution:
  - conflict: "DeFi skill proposes permissionless pool"
    resolution: |
      RWA-tokenization takes precedence on compliance.
      Permissionless is NOT an option for securities.
      Redirect to permissioned alternatives.

  - conflict: "Token-launch wants to skip investor verification"
    resolution: |
      RWA-tokenization blocks until all investors verified.
      No exceptions - this is a legal requirement.
      Provide guidance on fast-tracking verification.

  - conflict: "DevOps proposes single-key deployment"
    resolution: |
      RWA-tokenization requires multi-sig for production.
      Explain regulatory and custody requirements.
      Provide multi-sig ceremony documentation.

  - conflict: "Solidity-patterns suggests gas optimization that skips checks"
    resolution: |
      Compliance checks are non-negotiable.
      Work with solidity-patterns to find compliant optimizations.
      Consider L2 for gas reduction instead of fewer checks.

# Shared vocabulary
shared_vocabulary:
  terms:
    - term: "Compliance Module"
      definition: "Smart contract that enforces transfer restrictions"
      used_by:
        - rwa-tokenization
        - smart-contract-auditor

    - term: "Identity Registry"
      definition: "On-chain registry of verified investor identities"
      used_by:
        - rwa-tokenization
        - token-launch

    - term: "Holding Period"
      definition: "Mandatory time before securities can be resold"
      used_by:
        - rwa-tokenization
        - securities-law

    - term: "Transfer Agent"
      definition: "Registered entity maintaining official shareholder records"
      used_by:
        - rwa-tokenization
        - cap-table-management

    - term: "Forced Transfer"
      definition: "Transfer executed without holder consent (court order, etc.)"
      used_by:
        - rwa-tokenization
        - smart-contract-auditor

# Escalation paths
escalation:
  - scenario: "Regulatory uncertainty about token structure"
    escalate_to: securities-law
    reason: "Legal expertise required for exemption analysis"

  - scenario: "Critical security vulnerability in compliance module"
    escalate_to: smart-contract-auditor
    reason: "Immediate security review required"
    urgency: critical

  - scenario: "Oracle failure affecting asset valuation"
    escalate_to: devops
    reason: "Infrastructure issue requiring immediate response"
    urgency: high
