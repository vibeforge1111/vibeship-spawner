id: blockchain-privacy
skill: Blockchain Privacy
version: "1.0"

receives_from:
  - skill: smart-contract-auditor
    receives:
      - Security vulnerabilities in privacy contracts
      - Circuit constraint issues
      - Cryptographic weakness identification
      - Audit findings and recommendations
    provides:
      - Privacy protocol design context
      - ZK circuit architecture explanation
      - Threat model for privacy systems
      - Expected security properties

  - skill: layer2-scaling
    receives:
      - L2 deployment requirements
      - Gas optimization constraints
      - Cross-L2 messaging patterns
      - Finality considerations
    provides:
      - Privacy-preserving L2 patterns
      - ZK rollup integration guidance
      - Proof aggregation strategies
      - L2-specific privacy considerations

  - skill: evm-deep-dive
    receives:
      - Gas optimization techniques
      - Storage layout recommendations
      - Assembly patterns for verification
      - Bytecode-level optimizations
    provides:
      - Verifier contract requirements
      - Merkle tree storage patterns
      - Commitment storage optimization
      - Nullifier set efficiency

  - skill: blockchain-defi
    receives:
      - DeFi protocol requirements
      - Liquidity pool designs
      - AMM integration needs
      - Yield strategy patterns
    provides:
      - Private DeFi transaction patterns
      - Shielded pool designs
      - Confidential swap mechanisms
      - Privacy-preserving yield strategies

  - skill: gdpr-privacy
    receives:
      - Regulatory compliance requirements
      - Data protection obligations
      - Audit trail needs
      - Jurisdictional considerations
    provides:
      - Technical privacy mechanisms
      - Cryptographic compliance tools
      - View key disclosure patterns
      - Selective transparency options

  - skill: frontend
    receives:
      - UI/UX requirements
      - Wallet integration patterns
      - User onboarding needs
      - Error handling approaches
    provides:
      - Client-side proof generation
      - Privacy-aware wallet integration
      - Stealth address scanning UI
      - Anonymity set visualization

delegation_triggers:
  - pattern: "audit|vulnerability|security.*review"
    delegate_to: smart-contract-auditor
    context: "Security audit of privacy implementation"

  - pattern: "layer.?2|rollup|optimism|arbitrum|zksync"
    delegate_to: layer2-scaling
    context: "Privacy deployment on L2"

  - pattern: "gas.*optim|assembly|verifier.*gas"
    delegate_to: evm-deep-dive
    context: "Optimize verifier contract gas costs"

  - pattern: "defi|swap|amm|lending|yield"
    delegate_to: blockchain-defi
    context: "Privacy in DeFi protocols"

  - pattern: "compliance|regulation|gdpr|legal"
    delegate_to: gdpr-privacy
    context: "Regulatory compliance for privacy protocol"

  - pattern: "frontend|ui|wallet|metamask"
    delegate_to: frontend
    context: "Privacy-aware frontend development"

common_combinations:
  - name: Private DeFi Application
    skills:
      - blockchain-privacy
      - blockchain-defi
      - evm-deep-dive
    workflow: |
      1. Design privacy primitives (blockchain-privacy)
      2. Integrate with DeFi protocols (blockchain-defi)
      3. Optimize for gas efficiency (evm-deep-dive)
      4. Security audit (smart-contract-auditor)

  - name: Privacy L2 Deployment
    skills:
      - blockchain-privacy
      - layer2-scaling
      - frontend
    workflow: |
      1. Design privacy protocol (blockchain-privacy)
      2. Deploy to L2 for cost efficiency (layer2-scaling)
      3. Build privacy-aware UI (frontend)
      4. Implement relayer network (backend)

  - name: Compliant Privacy System
    skills:
      - blockchain-privacy
      - gdpr-privacy
      - smart-contract-auditor
    workflow: |
      1. Design privacy with compliance hooks (blockchain-privacy)
      2. Implement regulatory requirements (gdpr-privacy)
      3. Security and compliance audit (smart-contract-auditor)
      4. Document compliance mechanisms

  - name: Stealth Payment System
    skills:
      - blockchain-privacy
      - frontend
      - evm-deep-dive
    workflow: |
      1. Implement EIP-5564 stealth addresses (blockchain-privacy)
      2. Optimize registry gas costs (evm-deep-dive)
      3. Build scanning and receiving UI (frontend)
      4. Integrate with wallets

cross_domain_insights:
  - domain: Cryptography Research
    insight: Zero-knowledge proofs from academic cryptography are now practical
    application: Apply cutting-edge ZK constructions (Halo2, Nova) for better privacy

  - domain: Traditional Finance
    insight: Banks have used confidential transactions for decades
    application: Apply similar compartmentalization and need-to-know principles

  - domain: Tor Network
    insight: Onion routing provides unlinkability through layered encryption
    application: Design multi-hop privacy with similar unlinkability guarantees

  - domain: Signal Protocol
    insight: Forward secrecy prevents future key compromise from exposing past messages
    application: Implement forward secrecy in on-chain key exchanges

  - domain: Voting Systems
    insight: Electronic voting requires privacy AND verifiability
    application: Use similar techniques for private governance participation

  - domain: Healthcare
    insight: HIPAA requires audit trails even for private data
    application: Implement optional disclosure mechanisms for compliance

ecosystem_alternatives:
  zk_frameworks:
    - name: Circom + SnarkJS
      when: Groth16 proofs, small circuits, browser-compatible
      tradeoff: Trusted setup required, limited expressiveness
    - name: Noir
      when: Developer-friendly ZK DSL, Aztec ecosystem
      tradeoff: Newer, smaller community
    - name: Halo2
      when: No trusted setup, recursive proofs, Zcash/Scroll ecosystem
      tradeoff: Steeper learning curve
    - name: Cairo
      when: StarkWare/Starknet deployment, STARK proofs
      tradeoff: Different execution model

  privacy_approaches:
    - name: Mixer (Tornado-style)
      when: Simple privacy for fixed denominations
      tradeoff: Regulatory risk, limited functionality
    - name: Shielded Pool (Zcash-style)
      when: Variable amounts, internal transfers
      tradeoff: More complex, larger anonymity set needed
    - name: Stealth Addresses
      when: Receiving privacy without mixer
      tradeoff: Doesn't hide amounts or sender
    - name: Confidential Transactions
      when: Hide amounts, not participants
      tradeoff: Computational overhead, complex proofs

  deployment_targets:
    - name: Ethereum L1
      when: Maximum security and decentralization
      tradeoff: High gas costs for ZK verification
    - name: zkSync/Scroll
      when: Native ZK environment, low costs
      tradeoff: Smaller ecosystem
    - name: Aztec Connect
      when: Full privacy solution
      tradeoff: Centralized sequencer
    - name: Secret Network
      when: Private smart contract execution
      tradeoff: Different VM, smaller ecosystem

feedback_loops:
  - from: smart-contract-auditor
    incorporates:
      - Vulnerability patterns found in audits
      - Common circuit mistakes
      - Proof verification edge cases
    into: Security patterns and anti-patterns

  - from: layer2-scaling
    incorporates:
      - L2-specific gas costs
      - Proof aggregation benefits
      - Cross-L2 privacy challenges
    into: Deployment recommendations

  - from: blockchain-defi
    incorporates:
      - DeFi integration patterns
      - Liquidity considerations
      - AMM privacy challenges
    into: Private DeFi patterns

  - from: frontend
    incorporates:
      - UX challenges with privacy
      - Proof generation performance
      - User education needs
    into: Client-side implementation guidance

prerequisites:
  required_skills:
    - Cryptography fundamentals (hashing, signatures, commitments)
    - Solidity development
    - Understanding of Merkle trees
    - Basic understanding of ZK proofs

  recommended_tools:
    - Circom compiler and snarkjs
    - Foundry for contract testing
    - Proof-of-concept circuits
    - Local Ethereum node for testing

  environment_setup: |
    # Install Circom
    curl --proto '=https' --tlsv1.2 https://sh.rustup.rs -sSf | sh
    git clone https://github.com/iden3/circom.git
    cd circom && cargo build --release
    cargo install --path circom

    # Install snarkjs
    npm install -g snarkjs

    # Download Powers of Tau (for trusted setup)
    wget https://hermez.s3-eu-west-1.amazonaws.com/powersOfTau28_hez_final_20.ptau

    # Install Foundry
    curl -L https://foundry.paradigm.xyz | bash
    foundryup

    # Project structure
    mkdir -p circuits contracts test scripts

    # Initialize
    npm init -y
    npm install circomlib snarkjs ethers

    # Test circuit compilation
    circom circuits/test.circom --r1cs --wasm --sym -o build/

handoff_protocol:
  outbound:
    - to: smart-contract-auditor
      trigger: "Security audit needed for privacy implementation"
      provides:
        - Circuit architecture documentation
        - Threat model
        - Expected security properties
        - Known limitations
      expects_back:
        - Vulnerability report
        - Risk assessment
        - Recommendations

    - to: layer2-scaling
      trigger: "Need to deploy privacy solution on L2"
      provides:
        - Proof verification requirements
        - State storage patterns
        - Cross-L2 messaging needs
      expects_back:
        - L2 deployment strategy
        - Gas optimization for proofs
        - Sequencer considerations

    - to: frontend
      trigger: "Need privacy-aware UI"
      provides:
        - Client-side proof generation patterns
        - Wallet integration requirements
        - Privacy UX guidelines
      expects_back:
        - UI components for privacy flows
        - Proof generation integration
        - User education materials

  inbound:
    - from: blockchain-defi
      trigger: "Adding privacy to DeFi protocol"
      expects:
        - DeFi protocol requirements
        - Liquidity constraints
        - Trading patterns to protect
      provides:
        - Privacy mechanism design
        - Integration approach
        - Trade-off analysis

    - from: frontend
      trigger: "Client-side privacy implementation"
      expects:
        - UX requirements
        - Performance constraints
        - Browser compatibility needs
      provides:
        - Proof generation patterns
        - WASM integration
        - Privacy state management
