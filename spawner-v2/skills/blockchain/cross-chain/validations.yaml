# Validations - Cross-Chain
# Automated checks for bridge and cross-chain issues

version: 1.0.0
skill_id: cross-chain

validations:
  - id: no-finality-check
    name: No finality confirmation check
    severity: error
    type: regex
    pattern:
      - 'processMessage(?!.*confirmations|.*finality)'
    message: "Cross-chain messages must wait for source chain finality"
    fix_action: "Add block confirmation requirements before processing"
    applies_to:
      - "*.sol"

  - id: single-relayer
    name: Single relayer without decentralization
    severity: error
    type: regex
    pattern:
      - 'onlyRelayer(?!.*multisig|.*threshold)'
    message: "Bridges should use decentralized relayer set or multi-sig"
    fix_action: "Implement threshold signatures or use established bridge"
    applies_to:
      - "*.sol"

  - id: no-message-dedup
    name: No message deduplication
    severity: error
    type: regex
    pattern:
      - 'function.*receive.*Message(?!.*processed|.*nonce)'
    message: "Must prevent replay of cross-chain messages"
    fix_action: "Track processed message IDs or nonces"
    applies_to:
      - "*.sol"

  - id: no-pause-function
    name: Bridge without pause capability
    severity: warning
    type: regex
    pattern:
      - 'contract.*Bridge(?!.*Pausable|.*pause)'
    message: "Bridges should have emergency pause functionality"
    fix_action: "Inherit Pausable and add pause controls"
    applies_to:
      - "*.sol"

  - id: hardcoded-gas
    name: Hardcoded gas limits for destination
    severity: warning
    type: regex
    pattern:
      - 'gasLimit\s*[=:]\s*\d+(?!.*configurable)'
    message: "Gas limits should be configurable per chain/message type"
    fix_action: "Make gas limits adjustable or estimate dynamically"
    applies_to:
      - "*.sol"

code_smells:
  - id: no-rate-limit
    name: No rate limiting on bridge
    description: "Large rapid transfers may indicate exploit"
    pattern: null
    suggestion: "Implement rate limiting and alerts for large transfers"

best_practices:
  bridge_security:
    recommendation: |
      Bridge Security Checklist:

      [ ] Wait for source chain finality
      [ ] Decentralized verification (multi-sig, DVN)
      [ ] Message deduplication (nonces/IDs)
      [ ] Rate limiting for large transfers
      [ ] Emergency pause functionality
      [ ] Monitoring and alerts
      [ ] Upgrade safety (timelock)
      [ ] Sufficient gas for destination
      [ ] Address format validation
      [ ] Reentrancy protection
