# Context Window Management Validations

validations:
  - id: no-token-counting
    name: No Token Counting
    severity: warning
    type: regex
    pattern: 'messages\.push|context\s*\+|prompt\s*\+'
    negative_pattern: 'token|Token|tiktoken|count|length'
    message: "Building context without token counting. May exceed model limits."
    fix_action: "Count tokens before sending, implement budget allocation"
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.py"

  - id: naive-truncation
    name: Naive Message Truncation
    severity: warning
    type: regex
    pattern: 'slice\s*\(\s*-?\d+\s*\)|messages\.shift|messages\.splice'
    negative_pattern: 'summarize|importance|priority'
    message: "Truncating messages without summarization. Critical context may be lost."
    fix_action: "Summarize old messages instead of simply removing them"
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.py"

  - id: hardcoded-token-limit
    name: Hardcoded Token Limit
    severity: info
    type: regex
    pattern: 'max.*=\s*\d{4,}|limit.*=\s*\d{4,}'
    message: "Hardcoded token limit. Consider making configurable per model."
    fix_action: "Use model-specific limits from configuration"
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.py"

  - id: no-context-strategy
    name: No Context Management Strategy
    severity: warning
    type: regex
    pattern: 'ChatCompletion|messages\.create|complete\('
    negative_pattern: 'context|strategy|summarize|trim|budget'
    message: "LLM calls without context management strategy."
    fix_action: "Implement context management: budgets, summarization, or RAG"
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.py"
