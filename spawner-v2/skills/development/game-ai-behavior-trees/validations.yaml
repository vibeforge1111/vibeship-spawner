# Game AI Behavior Trees Validations

validations:
  - id: bt-sync-llm
    name: Synchronous LLM in Behavior Tree
    severity: critical
    type: regex
    pattern: 'tick\\([^)]*\\)[^}]*llm\\.complete(?!_async)|tick\\([^)]*\\)[^}]*await.*llm'
    message: "Synchronous LLM call in tick(). Will block behavior tree execution."
    fix_action: "Use async LLM with RUNNING state, or read cached decision from blackboard"
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.gd"
      - "*.cs"

  - id: bt-no-exit-cleanup
    name: BT Node Without Cleanup
    severity: high
    type: regex
    pattern: 'on_enter|OnEnter|Enter'
    negative_pattern: 'on_exit|OnExit|Exit|cleanup|Cleanup'
    message: "BT node has on_enter but no on_exit. State may not be cleaned up."
    fix_action: "Add on_exit to reset any state set in on_enter"
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.gd"
      - "*.cs"

  - id: bt-string-blackboard
    name: String-Based Blackboard Keys
    severity: warning
    type: regex
    pattern: 'blackboard\\.set\\s*\\(\\s*["\']|GetValue\\s*\\(\\s*["\']|SetValue\\s*\\(\\s*["\']'
    message: "String-based blackboard access. Typos cause silent failures."
    fix_action: "Use typed blackboard properties or constants for keys"
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.gd"
      - "*.cs"

  - id: bt-no-fallback
    name: Selector Without Fallback
    severity: warning
    type: regex
    pattern: 'Selector|selector'
    negative_pattern: 'fallback|Fallback|default|Default|always.*succeed'
    message: "Selector may have no fallback if all children fail."
    fix_action: "Add a fallback leaf node that always succeeds with default behavior"
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.gd"
      - "*.yaml"

  - id: bt-llm-every-tick
    name: LLM Query Every Tick
    severity: warning
    type: regex
    pattern: 'tick\\([^}]*llm|update\\([^}]*llm'
    negative_pattern: 'cooldown|Cooldown|cache|Cache|throttle|timer'
    message: "LLM may be queried every tick. Add cooldown/caching."
    fix_action: "Add cooldown timer, only query LLM every 5-30 seconds"
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.gd"
      - "*.cs"

  - id: bt-deep-nesting
    name: Deep Tree Nesting
    severity: info
    type: regex
    pattern: '\\s{16,}[\\[\\-]|\\t{4,}[\\[\\-]'
    message: "Deep nesting detected. Consider using subtrees for modularity."
    fix_action: "Extract deeply nested sections into reusable subtrees"
    applies_to:
      - "*.yaml"
      - "*.json"
