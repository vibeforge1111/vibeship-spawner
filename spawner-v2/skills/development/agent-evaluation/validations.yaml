# Agent Evaluation Validations

validations:
  - id: single-run-test
    name: Single Run Test for Stochastic Agent
    severity: high
    type: regex
    pattern: 'expect\([^)]*\)\.to|assert\([^)]*\)|should\.'
    negative_pattern: 'forEach|map|for.*of|repeat|times|runs'
    message: "Single assertion without repeated runs. LLM agents need statistical evaluation."
    fix_action: "Run test multiple times and use statistical thresholds"
    applies_to:
      - "*.test.ts"
      - "*.test.js"
      - "*.spec.ts"
      - "*.spec.js"

  - id: exact-string-match
    name: Exact String Match on LLM Output
    severity: medium
    type: regex
    pattern: 'expect\([^)]*output[^)]*\)\.toBe\(["\'][^"\']+["\']\)|expect\([^)]*response[^)]*\)\.toEqual\(["\']'
    message: "Exact string matching on LLM output. Will fail with minor wording changes."
    fix_action: "Use semantic comparison or behavior detection"
    applies_to:
      - "*.test.ts"
      - "*.test.js"
      - "*.spec.ts"
      - "*.spec.js"

  - id: no-timeout-in-test
    name: Agent Test Without Timeout
    severity: medium
    type: regex
    pattern: 'it\s*\([^)]+,\s*async|test\s*\([^)]+,\s*async'
    negative_pattern: 'timeout|jest\.setTimeout|this\.timeout'
    message: "Async agent test without timeout configuration."
    fix_action: "Add timeout: it('test', async () => {...}, 30000)"
    applies_to:
      - "*.test.ts"
      - "*.test.js"
      - "*.spec.ts"
      - "*.spec.js"

  - id: no-adversarial-tests
    name: Missing Adversarial Test Cases
    severity: medium
    type: regex
    pattern: 'describe\s*\(["\'].*agent'
    negative_pattern: 'adversarial|attack|inject|malicious|edge.?case'
    message: "Agent test suite without adversarial test cases."
    fix_action: "Add adversarial tests for prompt injection, boundary cases"
    applies_to:
      - "*.test.ts"
      - "*.test.js"
      - "*.spec.ts"
      - "*.spec.js"

  - id: no-baseline-comparison
    name: Test Without Baseline Comparison
    severity: low
    type: regex
    pattern: 'expect\([^)]*score|accuracy|passRate'
    negative_pattern: 'baseline|previous|threshold|minimum'
    message: "Metric assertion without baseline comparison."
    fix_action: "Compare against established baseline for regression detection"
    applies_to:
      - "*.test.ts"
      - "*.test.js"
      - "*.spec.ts"
      - "*.spec.js"

  - id: mock-llm-only
    name: Tests Using Only Mocked LLM
    severity: medium
    type: regex
    pattern: 'mock.*LLM|jest\.mock.*anthropic|jest\.mock.*openai'
    negative_pattern: 'integration|e2e|real.*model'
    message: "Agent tests only use mocked LLM. Need some real model tests."
    fix_action: "Add integration tests with real model for realistic behavior"
    applies_to:
      - "*.test.ts"
      - "*.test.js"
      - "*.spec.ts"
      - "*.spec.js"

  - id: no-latency-tests
    name: Missing Latency Requirements
    severity: low
    type: regex
    pattern: 'agent.*test|test.*agent'
    negative_pattern: 'latency|duration|time|performance|p95|p99'
    message: "Agent tests without latency requirements."
    fix_action: "Add latency assertions for production readiness"
    applies_to:
      - "*.test.ts"
      - "*.test.js"
      - "*.spec.ts"
      - "*.spec.js"

  - id: no-cost-tracking
    name: Missing Token/Cost Tracking in Tests
    severity: low
    type: regex
    pattern: 'agent.*test|test.*agent'
    negative_pattern: 'token|cost|usage|budget'
    message: "Agent tests without token/cost tracking."
    fix_action: "Track token usage to catch cost regressions"
    applies_to:
      - "*.test.ts"
      - "*.test.js"
      - "*.spec.ts"
      - "*.spec.js"

  - id: no-behavioral-contract
    name: Missing Behavioral Assertions
    severity: medium
    type: regex
    pattern: 'agent.*test|test.*agent'
    negative_pattern: 'behavior|contract|should.*not|must.*not|never'
    message: "Agent tests without behavioral contract assertions."
    fix_action: "Add assertions for what agent should and should not do"
    applies_to:
      - "*.test.ts"
      - "*.test.js"
      - "*.spec.ts"
      - "*.spec.js"

  - id: hardcoded-expected-output
    name: Hardcoded Expected Output
    severity: low
    type: regex
    pattern: 'expectedOutput\s*[:=]\s*["\'][^"\']{100,}["\']'
    message: "Long hardcoded expected output. Consider semantic evaluation."
    fix_action: "Use semantic comparison or key fact extraction"
    applies_to:
      - "*.test.ts"
      - "*.test.js"
      - "*.spec.ts"
      - "*.spec.js"
