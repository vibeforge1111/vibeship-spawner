# Python Craftsman Validations
# Automated checks for Python code quality

validations:
  - id: any-type-usage
    name: Any Type Usage
    severity: warning
    type: regex
    pattern:
      - ': Any[^a-zA-Z]'
      - '-> Any[^a-zA-Z]'
      - 'Any\]'
    message: "Using Any type defeats type safety. Consider specific types or TypeVar."
    fix_action: "Replace with concrete type, Union, or TypeVar for generics"
    applies_to:
      - "**/*.py"

  - id: bare-except
    name: Bare Exception Handler
    severity: error
    type: regex
    pattern:
      - 'except:'
      - 'except Exception:'
    message: "Bare except catches too much (KeyboardInterrupt, SystemExit). Be specific."
    fix_action: "Catch specific exceptions: except ValueError, TypeError:"
    applies_to:
      - "**/*.py"

  - id: blocking-in-async
    name: Blocking Call in Async
    severity: error
    type: regex
    pattern:
      - 'async def.*\n.*requests\.'
      - 'async def.*\n.*time\.sleep'
      - 'async def.*\n.*open\('
    message: "Blocking call in async function will freeze event loop."
    fix_action: "Use httpx instead of requests, asyncio.sleep instead of time.sleep"
    applies_to:
      - "**/*.py"

  - id: mutable-default-arg
    name: Mutable Default Argument
    severity: error
    type: regex
    pattern:
      - 'def.*=\s*\[\]'
      - 'def.*=\s*\{\}'
      - 'def.*=\s*set\(\)'
    message: "Mutable default argument is shared between calls. Use None and create inside."
    fix_action: "Use = None, then create in function body with: if arg is None: arg = []"
    applies_to:
      - "**/*.py"

  - id: pydantic-v1-config
    name: Pydantic V1 Config Style
    severity: warning
    type: regex
    pattern:
      - 'class Config:'
      - 'orm_mode\s*='
      - '@validator\('
    message: "Pydantic V1 style detected. V2 uses model_config, from_attributes, @field_validator."
    fix_action: "Migrate to Pydantic V2: ConfigDict, from_attributes=True, @field_validator"
    applies_to:
      - "**/*.py"

  - id: type-ignore-abuse
    name: Excessive Type Ignore
    severity: info
    type: regex
    pattern:
      - 'type:\s*ignore(?!\[)'
    message: "Blanket type: ignore hides real issues. Use specific ignore codes."
    fix_action: "Use specific codes: type: ignore[arg-type] or fix the underlying issue"
    applies_to:
      - "**/*.py"

  - id: unpinned-dependency
    name: Unpinned Dependency
    severity: warning
    type: regex
    pattern:
      - '^[a-zA-Z][a-zA-Z0-9_-]*$'
      - '^[a-zA-Z][a-zA-Z0-9_-]*\s*$'
    message: "Unpinned dependency will cause inconsistent builds."
    fix_action: "Pin with version range: package>=1.0.0,<2.0.0"
    applies_to:
      - "**/requirements*.txt"

  - id: missing-return-type
    name: Missing Return Type Annotation
    severity: info
    type: regex
    pattern:
      - 'def [a-z_]+\([^)]*\):'
      - 'async def [a-z_]+\([^)]*\):'
    message: "Function missing return type annotation. Add -> Type."
    fix_action: "Add return type: def func() -> ReturnType:"
    applies_to:
      - "**/*.py"

  - id: print-statement
    name: Print Statement in Production
    severity: warning
    type: regex
    pattern:
      - 'print\('
    message: "Print statements in production code. Use logging instead."
    fix_action: "Replace with logger.info(), logger.debug(), or logger.error()"
    applies_to:
      - "**/src/**/*.py"
      - "!**/tests/**"

  - id: star-import
    name: Star Import
    severity: warning
    type: regex
    pattern:
      - 'from .* import \*'
    message: "Star imports pollute namespace and hide dependencies."
    fix_action: "Import specific names: from module import Class, function"
    applies_to:
      - "**/*.py"

  - id: no-slots
    name: Dataclass Without Slots
    severity: info
    type: regex
    pattern:
      - '@dataclass[^(]'
      - '@dataclass\(\)$'
      - '@dataclass\([^s]*\)$'
    message: "Dataclass without slots uses more memory. Consider slots=True."
    fix_action: "Add slots=True: @dataclass(slots=True)"
    applies_to:
      - "**/*.py"

  - id: relative-import-outside-package
    name: Relative Import Issues
    severity: warning
    type: regex
    pattern:
      - '^from \.\.\. import'
    message: "Deep relative imports are confusing. Use absolute imports or restructure."
    fix_action: "Use absolute imports or restructure package to reduce nesting"
    applies_to:
      - "**/*.py"
