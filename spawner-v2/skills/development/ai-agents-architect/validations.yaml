# AI Agents Architect Validations
# Automated checks for agent patterns

validations:
  - id: no-iteration-limit
    name: No Iteration Limit
    severity: error
    type: regex
    pattern:
      - 'while\s+True'
      - 'while\s+1'
      - 'agent\.run\([^)]*\)(?!.*max)'
      - 'loop(?!.*limit|.*max)'
    message: "Agent loop without iteration limit can run forever."
    fix_action: "Add max_iterations or loop limit"
    applies_to:
      - "**/*.py"
      - "**/*.ts"
      - "**/*.js"

  - id: silent-tool-error
    name: Silent Tool Error Handling
    severity: error
    type: regex
    pattern:
      - 'except.*pass'
      - 'except.*continue'
      - 'catch\s*\([^)]*\)\s*\{\s*\}'
      - 'catch.*return\s+None'
    message: "Tool errors caught silently - agent won't know about failures."
    fix_action: "Return error message to agent for recovery"
    applies_to:
      - "**/*.py"
      - "**/*.ts"
      - "**/*.js"

  - id: short-tool-description
    name: Short Tool Description
    severity: warning
    type: regex
    pattern:
      - 'description\s*[=:]\s*["\'][^"\']{1,30}["\']'
      - 'tool_description\s*[=:]\s*["\'][^"\']{1,30}["\']'
    message: "Tool description may be too short for agent to understand."
    fix_action: "Add detailed description with when to use and examples"
    applies_to:
      - "**/*.py"
      - "**/*.ts"
      - "**/*.js"

  - id: memory-append-all
    name: Memory Append All
    severity: warning
    type: regex
    pattern:
      - 'memory\.append'
      - 'add_to_memory\([^)]+\)'
      - 'history\s*\+=|history\.extend'
      - 'messages\.append(?!.*filter)'
    message: "Appending to memory without filtering may cause context overflow."
    fix_action: "Filter or summarize before adding to memory"
    applies_to:
      - "**/*.py"
      - "**/*.ts"
      - "**/*.js"

  - id: no-timeout
    name: No Agent Timeout
    severity: warning
    type: regex
    pattern:
      - 'agent\.run\([^)]*\)(?!.*timeout)'
      - 'execute\([^)]*\)(?!.*timeout)'
      - 'invoke\([^)]*\)(?!.*timeout)'
    message: "Agent execution without timeout can hang indefinitely."
    fix_action: "Add timeout parameter to agent execution"
    applies_to:
      - "**/*.py"
      - "**/*.ts"
      - "**/*.js"

  - id: no-tracing
    name: No Agent Tracing
    severity: info
    type: regex
    pattern:
      - 'agent\.run\([^)]*\)(?!.*trace|.*callback|.*verbose)'
      - 'AgentExecutor\([^)]*\)(?!.*callbacks)'
    message: "Agent running without tracing - hard to debug failures."
    fix_action: "Add tracing callbacks or verbose mode"
    applies_to:
      - "**/*.py"
      - "**/*.ts"
      - "**/*.js"

  - id: brittle-parsing
    name: Brittle Output Parsing
    severity: warning
    type: regex
    pattern:
      - 'output\.split'
      - 're\.match\([^)]*output'
      - 'parse\([^)]*text'
      - 'eval\(output'
    message: "Fragile parsing of agent output may break on format changes."
    fix_action: "Use structured output (JSON mode) or robust parsing"
    applies_to:
      - "**/*.py"
      - "**/*.ts"
      - "**/*.js"

  - id: too-many-tools
    name: Too Many Tools
    severity: info
    type: regex
    pattern:
      - 'tools\s*=\s*\[[^\]]{500,}\]'
      - 'len\(tools\)\s*>\s*15'
      - 'tools\s*=\s*\[(?:[^,\]]+,){15,}'
    message: "Agent has many tools - may cause confusion and slow responses."
    fix_action: "Curate 5-10 tools per agent or use tool selection layer"
    applies_to:
      - "**/*.py"
      - "**/*.ts"
      - "**/*.js"

  - id: no-cost-limit
    name: No Cost Limit
    severity: warning
    type: regex
    pattern:
      - 'agent\.run(?!.*cost|.*budget)'
      - 'max_tokens\s*=\s*None'
    message: "Agent without cost limits can consume excessive API credits."
    fix_action: "Add token or cost limits to agent execution"
    applies_to:
      - "**/*.py"
      - "**/*.ts"
      - "**/*.js"
