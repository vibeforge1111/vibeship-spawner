id: infrastructure-as-code-collaboration
skill: infrastructure-as-code
version: 1.0.0

# ============================================================================
# RECEIVES FROM (Who delegates TO this skill)
# ============================================================================
receives_from:
  - skill: backend
    context: "Backend needs infrastructure for new service"
    receives:
      - "Resource requirements (compute, database, storage)"
      - "Networking needs (VPC, load balancer)"
      - "Environment specifications"
    provides: "Terraform/Pulumi configuration for required resources"

  - skill: devops
    context: "DevOps needs infrastructure automation"
    receives:
      - "Architecture diagrams"
      - "Scaling requirements"
      - "Compliance constraints"
    provides: "IaC modules and deployment pipelines"

  - skill: cybersecurity
    context: "Security needs infrastructure hardening"
    receives:
      - "Security requirements"
      - "Compliance standards (SOC2, HIPAA)"
      - "Network segmentation needs"
    provides: "Secure infrastructure configuration with audit trails"

  - skill: product-management
    context: "New product needs cloud resources"
    receives:
      - "Feature requirements"
      - "Budget constraints"
      - "Timeline expectations"
    provides: "Cost-optimized infrastructure plan"

# ============================================================================
# DELEGATION TRIGGERS
# ============================================================================
delegation_triggers:
  - trigger: "kubernetes|helm|containers|pods"
    delegate_to: devops
    pattern: parallel
    context: "Infrastructure provisioned, need container orchestration"
    handoff_data:
      - "VPC and subnet configuration"
      - "IAM roles for EKS/GKE"
      - "Security groups"
    receive: "Kubernetes cluster configuration"

  - trigger: "security audit|iam review|compliance|penetration"
    delegate_to: cybersecurity
    pattern: sequential
    context: "Infrastructure needs security review"
    handoff_data:
      - "Current IAM policies"
      - "Network configuration"
      - "Encryption settings"
    receive: "Security recommendations and remediations"

  - trigger: "api|application|service deployment"
    delegate_to: backend
    pattern: parallel
    context: "Infrastructure ready, deploy applications"
    handoff_data:
      - "Resource endpoints"
      - "Connection strings"
      - "Environment variables"
    receive: "Deployed applications"

  - trigger: "monitoring|alerting|dashboards|observability"
    delegate_to: observability-sre
    pattern: parallel
    context: "Infrastructure needs monitoring"
    handoff_data:
      - "Resource list and types"
      - "Critical metrics"
      - "SLOs and SLIs"
    receive: "Monitoring and alerting configuration"

  - trigger: "database|rds|postgres|mysql"
    delegate_to: database-schema-design
    pattern: sequential
    context: "Database provisioned, need schema design"
    handoff_data:
      - "Database endpoint"
      - "Instance specifications"
      - "Backup configuration"
    receive: "Schema and migration files"

# ============================================================================
# FEEDBACK LOOPS
# ============================================================================
feedback_loops:
  receives_feedback_from:
    - skill: devops
      signal: "Resource scaling issues or bottlenecks"
      action: "Adjust resource sizes or add auto-scaling"

    - skill: cybersecurity
      signal: "Security vulnerabilities in infrastructure"
      action: "Update security groups, IAM policies, encryption"

    - skill: backend
      signal: "Infrastructure not meeting application needs"
      action: "Provision additional resources or reconfigure"

    - skill: observability-sre
      signal: "Infrastructure metrics showing problems"
      action: "Scale resources or fix configuration issues"

  sends_feedback_to:
    - skill: devops
      signal: "Infrastructure changes affecting deployments"
      action: "Update deployment configurations"

    - skill: backend
      signal: "Resource endpoint changes"
      action: "Update application configuration"

    - skill: product-management
      signal: "Infrastructure cost implications"
      action: "Adjust budget or requirements"

# ============================================================================
# CROSS-DOMAIN INSIGHTS
# ============================================================================
cross_domain_insights:
  - domain: Distributed Systems
    insight: |
      Distributed systems engineers understand:
      - Multi-region deployments need careful state management
      - Network partitions will happen - design for them
      - Data gravity matters - compute near storage
      - Latency between regions affects architecture
      Infrastructure design is distributed systems design.
    applies_when: "Designing multi-region or global infrastructure"

  - domain: Site Reliability Engineering
    insight: |
      SREs know:
      - Toil is the enemy - automate everything
      - Error budgets guide risk-taking
      - Incident response starts with good infrastructure
      - Observability must be built in, not bolted on
      Infrastructure is the foundation of reliability.
    applies_when: "Building production-grade infrastructure"

  - domain: FinOps
    insight: |
      FinOps practitioners know:
      - Unused resources are wasted money
      - Reserved capacity vs on-demand has huge cost implications
      - Tagging is essential for cost allocation
      - Right-sizing saves more than spot instances
      Infrastructure decisions are financial decisions.
    applies_when: "Optimizing infrastructure costs"

  - domain: Compliance
    insight: |
      Compliance officers know:
      - Audit trails are mandatory, not optional
      - Data residency affects resource placement
      - Encryption at rest and in transit is baseline
      - Access controls must be demonstrable
      Infrastructure configuration is compliance evidence.
    applies_when: "Building for regulated industries"

# ============================================================================
# COMMON COMBINATIONS
# ============================================================================
common_combinations:
  - name: Full Cloud Environment
    skills:
      - infrastructure-as-code
      - devops
      - cybersecurity
    workflow: |
      1. Infrastructure design (infrastructure-as-code)
      2. Security review (cybersecurity)
      3. Kubernetes/container setup (devops)
      4. Monitoring integration (observability-sre)

  - name: Database Infrastructure
    skills:
      - infrastructure-as-code
      - database-schema-design
      - backend
    workflow: |
      1. RDS/database provisioning (infrastructure-as-code)
      2. Schema design and migrations (database-schema-design)
      3. Application integration (backend)

  - name: Secure Production Environment
    skills:
      - infrastructure-as-code
      - cybersecurity
      - observability-sre
    workflow: |
      1. Secure infrastructure design (infrastructure-as-code)
      2. Security hardening and review (cybersecurity)
      3. Security monitoring (observability-sre)

  - name: Multi-Environment Setup
    skills:
      - infrastructure-as-code
      - devops
    workflow: |
      1. Environment structure (infrastructure-as-code)
      2. CI/CD pipeline (devops)
      3. Promotion process (devops)

# ============================================================================
# ECOSYSTEM
# ============================================================================
ecosystem:
  primary_tools:
    - "Terraform - Industry standard IaC with HCL"
    - "Pulumi - IaC with general-purpose languages"
    - "CloudFormation - AWS-native IaC"
    - "Terragrunt - Terraform wrapper for DRY code"
    - "Checkov/tfsec - Security scanning for IaC"

  alternatives:
    - name: Terraform
      use_when: "Multi-cloud, large ecosystem, mature tooling needed"
      avoid_when: "Need programming language features, complex logic"

    - name: Pulumi
      use_when: "Team knows TypeScript/Python, need loops/conditions, testing"
      avoid_when: "Team expects HCL, need broad module ecosystem"

    - name: CloudFormation
      use_when: "AWS-only, need native AWS integration, Stack Sets"
      avoid_when: "Multi-cloud, need faster iteration, complex modules"

    - name: CDK
      use_when: "AWS-only with CloudFormation, want TypeScript/Python"
      avoid_when: "Need multi-cloud, want infrastructure abstraction"

    - name: Crossplane
      use_when: "Kubernetes-native infrastructure, GitOps workflows"
      avoid_when: "Not using Kubernetes, need broad provider support"

  state_backends:
    - name: S3 + DynamoDB
      use_when: "AWS, need locking, cost-effective"
      setup: "Bucket + table with LockID hash key"

    - name: Terraform Cloud
      use_when: "Need UI, collaboration, Sentinel policies"
      setup: "Create workspace, configure API token"

    - name: GCS
      use_when: "GCP-native, built-in locking"
      setup: "Bucket with versioning enabled"

    - name: Azure Blob
      use_when: "Azure-native, supports locking"
      setup: "Storage account + container"
