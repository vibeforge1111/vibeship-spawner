# Validations - Accessibility
# Automated checks for common accessibility issues

version: 1.0.0
skill_id: accessibility

validations:
  # Critical - Major barriers
  - id: missing-alt-text
    name: Image without alt attribute
    severity: error
    type: regex
    pattern:
      - '<img(?![^>]*alt=)[^>]*>'
    message: "Image missing alt attribute - add alt text or alt=\"\" for decorative"
    fix_action: "Add alt=\"Description of image\" or alt=\"\" for decorative images"
    applies_to:
      - "*.html"
      - "*.jsx"
      - "*.tsx"
      - "*.vue"

  - id: empty-link
    name: Link with no accessible name
    severity: error
    type: regex
    pattern:
      - '<a[^>]*>(\s*|<img[^>]*>)\s*</a>'
    message: "Link has no accessible name - add text or aria-label"
    fix_action: "Add link text or aria-label=\"Description\""
    applies_to:
      - "*.html"
      - "*.jsx"
      - "*.tsx"

  - id: empty-button
    name: Button with no accessible name
    severity: error
    type: regex
    pattern:
      - '<button[^>]*>(\s*|<(svg|img|i)[^>]*>)\s*</button>'
    message: "Button has no accessible name - add text or aria-label"
    fix_action: "Add button text or aria-label=\"Action description\""
    applies_to:
      - "*.html"
      - "*.jsx"
      - "*.tsx"

  - id: onclick-without-role
    name: Click handler on non-interactive element
    severity: error
    type: regex
    pattern:
      - '<(div|span)[^>]*onclick=(?![^>]*role=)'
    message: "Click handler on div/span without role - use button or add role=\"button\""
    fix_action: "Use <button> or add role=\"button\" tabindex=\"0\" onKeyDown"
    applies_to:
      - "*.html"
      - "*.jsx"
      - "*.tsx"

  - id: positive-tabindex
    name: Positive tabindex value
    severity: warning
    type: regex
    pattern:
      - 'tabindex="[1-9][0-9]*"'
      - 'tabIndex=\{[1-9][0-9]*\}'
    message: "Positive tabindex creates unpredictable focus order"
    fix_action: "Use tabindex=\"0\" or tabindex=\"-1\", fix order in DOM"
    applies_to:
      - "*.html"
      - "*.jsx"
      - "*.tsx"

  - id: no-focus-outline
    name: Focus outline removed without replacement
    severity: warning
    type: regex
    pattern:
      - ':focus\s*\{[^}]*outline:\s*(none|0)[^}]*\}'
      - 'outline:\s*(none|0)'
    message: "Focus outline removed - provide visible focus indicator"
    fix_action: "Use :focus-visible with custom outline or box-shadow"
    applies_to:
      - "*.css"
      - "*.scss"

  - id: auto-refresh
    name: Auto-refresh or redirect
    severity: warning
    type: regex
    pattern:
      - '<meta[^>]*http-equiv="refresh"'
      - 'window\.location[^;]*setTimeout'
      - 'setTimeout[^}]*window\.location'
    message: "Auto-refresh/redirect may disorient users"
    fix_action: "Provide user control to pause, stop, or extend time limit"
    applies_to:
      - "*.html"
      - "*.js"
      - "*.jsx"

  - id: missing-form-label
    name: Form input without label
    severity: error
    type: regex
    pattern:
      - '<input(?![^>]*id="[^"]+")[^>]*>'
      - '<input[^>]*id="([^"]+)"(?!.*<label[^>]*for="\1")'
    message: "Form input missing associated label"
    fix_action: "Add <label for=\"inputId\"> or wrap in <label>"
    applies_to:
      - "*.html"
      - "*.jsx"
      - "*.tsx"

  - id: missing-lang
    name: HTML element without lang attribute
    severity: warning
    type: regex
    pattern:
      - '<html(?![^>]*lang=)'
    message: "Page missing language declaration"
    fix_action: "Add lang=\"en\" (or appropriate code) to <html>"
    applies_to:
      - "*.html"

  - id: autoplay-media
    name: Media with autoplay
    severity: info
    type: regex
    pattern:
      - '<(video|audio)[^>]*autoplay(?![^>]*muted)'
    message: "Autoplay media can be disruptive - ensure muted or user-controlled"
    fix_action: "Add muted attribute or provide play/pause controls"
    applies_to:
      - "*.html"
      - "*.jsx"
      - "*.tsx"

  - id: aria-role-conflict
    name: ARIA role conflicts with implicit role
    severity: warning
    type: regex
    pattern:
      - '<button[^>]*role="link"'
      - '<a[^>]*role="button"'
      - '<input[^>]*role="'
    message: "ARIA role conflicts with element's implicit role"
    fix_action: "Use appropriate HTML element instead of overriding role"
    applies_to:
      - "*.html"
      - "*.jsx"
      - "*.tsx"

  - id: aria-hidden-focus
    name: Focusable element with aria-hidden
    severity: error
    type: regex
    pattern:
      - 'aria-hidden="true"[^>]*(?:tabindex="0"|<button|<a |<input)'
      - '<(button|a|input)[^>]*aria-hidden="true"'
    message: "Focusable element has aria-hidden - creates confusing experience"
    fix_action: "Remove aria-hidden or make element non-focusable"
    applies_to:
      - "*.html"
      - "*.jsx"
      - "*.tsx"

code_smells:
  - id: div-button
    name: Div with button-like behavior
    description: "Custom buttons made with divs lose native accessibility"
    pattern: '<div[^>]+click|onClick'
    suggestion: "Use <button type=\"button\"> for better accessibility"

  - id: excessive-aria
    name: Too much ARIA on semantic elements
    description: "Adding unnecessary ARIA to semantic HTML"
    pattern: '<button[^>]+role="button"'
    suggestion: "Native elements have implicit roles - ARIA is redundant"

  - id: placeholder-as-label
    name: Placeholder used as only label
    description: "Placeholder text disappears on input, shouldn't be only label"
    pattern: '<input[^>]+placeholder="[^"]+"(?![^>]*aria-label)'
    suggestion: "Add visible <label> or aria-label in addition to placeholder"

best_practices:
  semantic_structure:
    recommendation: |
      Use semantic HTML for document structure:

      <header>
        <nav aria-label="Main">
          <ul>
            <li><a href="/">Home</a></li>
          </ul>
        </nav>
      </header>

      <main>
        <article>
          <h1>Page Title</h1>
          <section aria-labelledby="section-heading">
            <h2 id="section-heading">Section</h2>
          </section>
        </article>
      </main>

      <aside aria-label="Related content">
        <!-- Sidebar -->
      </aside>

      <footer>
        <!-- Footer content -->
      </footer>

  heading_hierarchy:
    recommendation: |
      Use headings in order - don't skip levels:

      <h1>Page Title</h1>
        <h2>Main Section</h2>
          <h3>Subsection</h3>
          <h3>Subsection</h3>
        <h2>Another Section</h2>

      Every page should have exactly one <h1>
      Don't use headings for visual sizing - use CSS

  testing_workflow:
    recommendation: |
      Accessibility testing checklist:

      1. Automated (catches ~30%):
         - Run axe-core or Lighthouse
         - Fix reported issues

      2. Keyboard (manual):
         - Tab through entire page
         - Verify focus is visible
         - Verify all interactions work

      3. Screen reader (manual):
         - Test with NVDA (Windows) or VoiceOver (Mac)
         - Navigate by headings, landmarks, links
         - Verify form labels announced

      4. Visual:
         - Check color contrast (4.5:1 minimum)
         - Zoom to 200% - is content usable?
         - Test with Windows High Contrast Mode
