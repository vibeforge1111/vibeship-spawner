# Code Review Validations
# Automated checks to catch common code review anti-patterns

validations:
  - id: review-todo-without-ticket
    name: TODO Without Ticket Reference
    severity: warning
    type: regex
    pattern:
      - '//\\s*TODO(?!.*JIRA|.*#\\d+|.*[A-Z]+-\\d+)'
      - '//\\s*FIXME(?!.*JIRA|.*#\\d+|.*[A-Z]+-\\d+)'
      - '//\\s*HACK(?!.*JIRA|.*#\\d+|.*[A-Z]+-\\d+)'
    message: "TODO/FIXME without ticket reference. Add tracking ticket."
    fix_action: "Add ticket reference: // TODO: JIRA-123 - description"
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.tsx"
      - "*.jsx"

  - id: review-commented-code
    name: Commented Out Code
    severity: warning
    type: regex
    pattern:
      - '//\\s*(const|let|var|function|class|if|for|while|return)\\s+\\w+'
      - '/\\*[\\s\\S]*?(function|class|const|let|var)[\\s\\S]*?\\*/'
    message: "Commented out code should be removed, not committed."
    fix_action: "Delete commented code. Use git history for recovery."
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.tsx"
      - "*.jsx"

  - id: review-console-log
    name: Console Log in Production Code
    severity: warning
    type: regex
    pattern:
      - 'console\\.log\\('
      - 'console\\.debug\\('
      - 'console\\.info\\('
    message: "Console statements should not be in production code."
    fix_action: "Remove or replace with proper logging"
    applies_to:
      - "src/**/*.ts"
      - "src/**/*.js"
      - "src/**/*.tsx"
      - "src/**/*.jsx"

  - id: review-debugger
    name: Debugger Statement
    severity: error
    type: regex
    pattern:
      - 'debugger;'
      - 'debugger$'
    message: "Debugger statement must be removed before merge."
    fix_action: "Remove debugger statement"
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.tsx"
      - "*.jsx"

  - id: review-any-type
    name: TypeScript 'any' Type
    severity: warning
    type: regex
    pattern:
      - ':\\s*any\\b'
      - 'as\\s+any\\b'
      - '<any>'
    message: "Avoid 'any' type. Use specific types or 'unknown'."
    fix_action: "Replace with specific type or 'unknown'"
    applies_to:
      - "*.ts"
      - "*.tsx"

  - id: review-hardcoded-secret
    name: Hardcoded Secret
    severity: error
    type: regex
    pattern:
      - "password\\\\s*=\\\\s*[\"'][^\"']{8,}[\"']"
      - "secret\\\\s*=\\\\s*[\"'][^\"']{8,}[\"']"
      - "apiKey\\\\s*=\\\\s*[\"'][^\"']{16,}[\"']"
      - "api_key\\\\s*=\\\\s*[\"'][^\"']{16,}[\"']"
      - 'AKIA[A-Z0-9]{16}'
    message: "Possible hardcoded secret. Use environment variables."
    fix_action: "Move to environment variable: process.env.SECRET_NAME"
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.tsx"
      - "*.jsx"
      - "*.json"

  - id: review-large-file
    name: Large File
    severity: warning
    type: file_size
    max_lines: 500
    message: "File exceeds 500 lines. Consider splitting into modules."
    fix_action: "Split into smaller, focused modules"
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.tsx"
      - "*.jsx"

  - id: review-deep-nesting
    name: Deep Nesting
    severity: warning
    type: regex
    pattern:
      - '\\{[^}]*\\{[^}]*\\{[^}]*\\{[^}]*\\{'
    message: "Deep nesting detected. Consider early returns or extraction."
    fix_action: "Use early returns or extract nested logic to functions"
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.tsx"
      - "*.jsx"

  - id: review-magic-number
    name: Magic Number
    severity: warning
    type: regex
    pattern:
      - '[^\\d\\.](86400|3600|60000|1000|100|50)(?!\\d)'
    message: "Magic number detected. Use named constant for clarity."
    fix_action: "Define constant: const SECONDS_PER_DAY = 86400"
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.tsx"
      - "*.jsx"

  - id: review-empty-catch
    name: Empty Catch Block
    severity: error
    type: regex
    pattern:
      - 'catch\\s*\\([^)]*\\)\\s*\\{\\s*\\}'
      - 'catch\\s*\\{\\s*\\}'
    message: "Empty catch block swallows errors. Handle or rethrow."
    fix_action: "Log the error or rethrow: catch (e) { logger.error(e); throw e; }"
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.tsx"
      - "*.jsx"

  - id: review-eslint-disable
    name: ESLint Disable Without Explanation
    severity: warning
    type: regex
    pattern:
      - 'eslint-disable(?!.*--.*)'
      - 'eslint-disable-next-line(?!.*--.*)'
      - '@ts-ignore(?!.*--.*)'
      - '@ts-expect-error(?!.*--.*)'
    message: "Lint disable without explanation. Add reason comment."
    fix_action: "Add reason: // eslint-disable-next-line -- reason here"
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.tsx"
      - "*.jsx"

  - id: review-force-cast
    name: Force Type Cast
    severity: warning
    type: regex
    pattern:
      - 'as\\s+[A-Z][a-zA-Z]+(?!\\s*\\|)'
      - '!\\.'
      - '!\\['
    message: "Force cast may hide type errors. Validate or use type guard."
    fix_action: "Add runtime validation or use type guard function"
    applies_to:
      - "*.ts"
      - "*.tsx"

  - id: review-deprecated-api
    name: Deprecated API Usage
    severity: warning
    type: regex
    pattern:
      - '@deprecated'
      - 'componentWillMount'
      - 'componentWillReceiveProps'
      - 'UNSAFE_'
    message: "Deprecated API detected. Update to current API."
    fix_action: "Replace with current API equivalent"
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.tsx"
      - "*.jsx"

  - id: review-long-function
    name: Long Function
    severity: warning
    type: regex
    pattern:
      - '(function|=>)\\s*\\{[\\s\\S]{2000,}?\\}'
    message: "Function exceeds recommended length. Consider splitting."
    fix_action: "Extract logic into smaller, focused functions"
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.tsx"
      - "*.jsx"
