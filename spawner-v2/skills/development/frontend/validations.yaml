# Frontend Engineering Validations
# Automated checks to catch common frontend mistakes

validations:
  - id: frontend-hydration-hazard
    name: Hydration Mismatch Risk
    severity: warning
    type: regex
    pattern:
      - 'return[^;]*Date\.now\(\)'
      - 'return[^;]*Math\.random\(\)'
      - '(?<!typeof\s)window\.\w+(?![^}]*useEffect)'
      - '(?<!typeof\s)localStorage\.\w+(?![^}]*useEffect)'
    message: "Using Date.now(), Math.random(), window, or localStorage in render causes hydration mismatch."
    fix_action: "Move to useEffect or guard with typeof window !== 'undefined'"
    applies_to:
      - "*.tsx"
      - "*.jsx"

  - id: frontend-useeffect-fetch
    name: Data Fetching in useEffect
    severity: warning
    type: regex
    pattern:
      - 'useEffect\s*\([^)]*\{[^}]*fetch\s*\('
      - 'useEffect\s*\([^)]*\{[^}]*axios\s*\.'
    message: "Fetching data in useEffect can cause waterfalls, race conditions, and memory leaks."
    fix_action: "Use React Query, SWR, or framework data loaders instead"
    applies_to:
      - "*.tsx"
      - "*.jsx"

  - id: frontend-missing-cleanup
    name: Effect Without Cleanup
    severity: warning
    type: regex
    pattern:
      - 'useEffect\s*\([^)]*addEventListener[^)]*\)(?![^}]*removeEventListener)'
      - 'useEffect\s*\([^)]*setInterval[^)]*\)(?![^}]*clearInterval)'
      - 'useEffect\s*\([^)]*setTimeout[^)]*\)(?![^}]*clearTimeout)'
    message: "Event listener, interval, or timeout without cleanup will cause memory leaks."
    fix_action: "Return a cleanup function: return () => removeEventListener/clearInterval/clearTimeout"
    applies_to:
      - "*.tsx"
      - "*.jsx"

  - id: frontend-div-onclick
    name: Non-semantic Interactive Element
    severity: error
    type: regex
    pattern:
      - '<div[^>]*onClick'
      - '<span[^>]*onClick'
      - '<div[^>]*onKeyDown'
    message: "Using div/span with click handler is not accessible. Screen readers and keyboards won't work."
    fix_action: "Use <button> for clickable elements, or add role='button' tabIndex={0} and keyboard handlers"
    applies_to:
      - "*.tsx"
      - "*.jsx"

  - id: frontend-img-no-alt
    name: Image Without Alt Text
    severity: error
    type: regex
    pattern:
      - '<img[^>]*(?!alt)[^>]*/?>'
    message: "Image without alt attribute is not accessible. Screen readers can't describe it."
    fix_action: "Add alt='description' for meaningful images, or alt='' role='presentation' for decorative"
    applies_to:
      - "*.tsx"
      - "*.jsx"

  - id: frontend-input-no-label
    name: Input Without Label
    severity: warning
    type: regex
    pattern:
      - '<input[^>]*(?!id=|aria-label)[^>]*/?>'
    message: "Input without associated label is not accessible."
    fix_action: "Wrap in <label> or add aria-label/aria-labelledby"
    applies_to:
      - "*.tsx"
      - "*.jsx"

  - id: frontend-barrel-import
    name: Barrel Import of Large Library
    severity: warning
    type: regex
    pattern:
      - "import\\s+\\w+\\s+from\\s+['\"]lodash['\"]"
      - "import\\s+\\{[^}]+\\}\\s+from\\s+['\"]lodash['\"]"
      - "import\\s+\\w+\\s+from\\s+['\"]moment['\"]"
      - "import\\s+\\{[^}]+\\}\\s+from\\s+['\"]antd['\"]"
    message: "Importing from barrel file ships entire library. Use specific imports."
    fix_action: "Import from lodash/debounce instead of lodash. Use tree-shakeable alternatives."
    applies_to:
      - "*.ts"
      - "*.tsx"
      - "*.js"
      - "*.jsx"

  - id: frontend-important-css
    name: CSS !important Usage
    severity: warning
    type: regex
    pattern:
      - '!important'
    message: "Using !important indicates specificity problems. Will be hard to override later."
    fix_action: "Fix the specificity issue at the source. Use CSS Modules, Tailwind, or flatten selectors."
    applies_to:
      - "*.css"
      - "*.scss"

  - id: frontend-inline-style-object
    name: Inline Style Object in JSX
    severity: warning
    type: regex
    pattern:
      - 'style=\{\s*\{[^}]+\}\s*\}'
    message: "Inline style objects create new references every render, breaking memo optimization."
    fix_action: "Move style object outside component or use useMemo"
    applies_to:
      - "*.tsx"
      - "*.jsx"

  - id: frontend-index-as-key
    name: Array Index as React Key
    severity: warning
    type: regex
    pattern:
      - '\.map\s*\([^)]*,\s*\w*\s*\)[^}]*key=\{\s*\w+\s*\}'
      - 'key=\{index\}'
      - 'key=\{i\}'
    message: "Using array index as key can cause bugs when items are reordered or filtered."
    fix_action: "Use unique, stable IDs from your data as keys"
    applies_to:
      - "*.tsx"
      - "*.jsx"

  - id: frontend-boolean-state-soup
    name: Multiple Boolean States for Single Concept
    severity: warning
    type: regex
    pattern:
      - 'useState\s*<\s*boolean\s*>\s*\([^)]*\)[^;]*useState\s*<\s*boolean\s*>\s*\([^)]*\)[^;]*useState'
      - 'isLoading.*isError.*isSuccess'
    message: "Multiple boolean flags for mutually exclusive states. Can have invalid combinations."
    fix_action: "Use discriminated union: type State = { status: 'idle' } | { status: 'loading' } | ..."
    applies_to:
      - "*.tsx"
      - "*.ts"

  - id: frontend-img-no-dimensions
    name: Image Without Dimensions
    severity: warning
    type: regex
    pattern:
      - '<img[^>]*src=[^>]*(?!width|height|aspectRatio)[^>]*/>'
    message: "Image without dimensions causes layout shift (CLS) when it loads."
    fix_action: "Add width and height attributes, or use aspectRatio style"
    applies_to:
      - "*.tsx"
      - "*.jsx"

  - id: frontend-100vh
    name: Using 100vh on Mobile
    severity: warning
    type: regex
    pattern:
      - 'height:\s*100vh'
      - 'min-height:\s*100vh'
    message: "100vh includes mobile address bar, causing content to be cut off on iOS Safari."
    fix_action: "Use 100dvh (dynamic viewport height) or min-height: 100svh"
    applies_to:
      - "*.css"
      - "*.scss"
      - "*.tsx"
      - "*.jsx"
