# Procedural Generation Validations

validations:
  - id: pcg-unseeded-random
    name: Unseeded Random Generator
    severity: critical
    type: regex
    pattern: 'Math\.random\(\)|random\(\)|Random\(\)|rand\(\)'
    negative_pattern: 'seed|Seed|seeded|Seeded|rng\.next|RandomState'
    message: "Unseeded random detected. Levels won't be reproducible."
    fix_action: "Use a seeded random number generator (e.g., mulberry32, xorshift)"
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.cs"
      - "*.gd"
      - "*.py"

  - id: pcg-no-validation
    name: PCG Without Validation
    severity: high
    type: regex
    pattern: 'generate.*Level|generate.*Dungeon|generate.*World|generateQuest'
    negative_pattern: 'validate|isValid|isPlayable|isCompletable|check|verify'
    message: "PCG function without validation. Generated content may be unplayable."
    fix_action: "Add validation to ensure generated content is completable/playable"
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.cs"
      - "*.gd"
      - "*.py"

  - id: pcg-no-fallback
    name: PCG Without Fallback
    severity: high
    type: regex
    pattern: 'generate.*Level|generate.*Map|generate.*Content'
    negative_pattern: 'fallback|default|backup|template|prebuilt'
    message: "PCG without fallback content. If generation fails, game breaks."
    fix_action: "Add fallback/default content when generation fails after max attempts"
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.cs"
      - "*.gd"
      - "*.py"

  - id: pcg-unbounded-loop
    name: Unbounded Generation Loop
    severity: high
    type: regex
    pattern: 'while\s*\(\s*(?:true|!collapsed|!done|!complete)'
    negative_pattern: 'maxAttempts|MAX_|limit|count.*<|iteration.*<'
    message: "Unbounded loop in generation. Can hang if constraints unsatisfiable."
    fix_action: "Add maximum iteration limit with fallback behavior"
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.cs"
      - "*.gd"
      - "*.py"

  - id: pcg-no-budget
    name: Entity Spawning Without Budget
    severity: warning
    type: regex
    pattern: 'spawn|populate|scatter|place'
    negative_pattern: 'budget|limit|max|count|capacity'
    message: "Entity placement without budget constraints. May cause performance issues."
    fix_action: "Implement budget system to cap entity counts"
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.cs"
      - "*.gd"

  - id: pcg-llm-sync-generation
    name: Synchronous LLM in PCG
    severity: warning
    type: regex
    pattern: 'await.*llm|llm\.complete\(|llm\.generate\('
    negative_pattern: 'loading|pregenerate|cache|async|Promise\.all'
    message: "Synchronous LLM call in PCG may cause long load times."
    fix_action: "Show loading UI or pregenerate content. LLM calls can take seconds."
    applies_to:
      - "*.ts"
      - "*.js"

  - id: pcg-no-seed-storage
    name: Generated Content Without Stored Seed
    severity: warning
    type: regex
    pattern: 'class.*Level|class.*Dungeon|class.*World|class.*Map'
    negative_pattern: 'seed|Seed'
    message: "Generated content class without seed storage. Can't reproduce this content."
    fix_action: "Store seed with generated content for reproducibility and debugging"
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.cs"

  - id: pcg-hardcoded-dimensions
    name: Hardcoded Generation Dimensions
    severity: info
    type: regex
    pattern: 'width\s*=\s*\d{2,}|height\s*=\s*\d{2,}|size\s*=\s*\d{2,}'
    message: "Hardcoded dimension values. Consider making configurable for different contexts."
    fix_action: "Pass dimensions as parameters or use configuration"
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.cs"
      - "*.gd"

  - id: pcg-wfc-no-contradiction-handling
    name: WFC Without Contradiction Handling
    severity: high
    type: regex
    pattern: 'WaveFunctionCollapse|wfc|collapse\s*\('
    negative_pattern: 'contradiction|retry|backtrack|fallback|attempt'
    message: "WFC implementation without contradiction handling. Can hang or crash."
    fix_action: "Add contradiction detection with retry or backtracking logic"
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.cs"
      - "*.gd"
      - "*.py"

  - id: pcg-llm-no-json-validation
    name: LLM JSON Output Without Validation
    severity: high
    type: regex
    pattern: 'JSON\.parse\(.*llm|JSON\.parse\(.*response|JSON\.parse\(.*completion'
    negative_pattern: 'try|catch|validate|schema|safeParse|Zod'
    message: "Parsing LLM JSON output without validation. LLM output is unreliable."
    fix_action: "Wrap in try-catch, validate against schema, have fallback"
    applies_to:
      - "*.ts"
      - "*.js"

  - id: pcg-uniform-distribution
    name: Uniform Random Placement
    severity: info
    type: regex
    pattern: 'random\(\)\s*\*\s*width|random\(\)\s*\*\s*height|Random\.Range'
    negative_pattern: 'poisson|blue.*noise|minDistance|distance.*check'
    message: "Uniform random placement creates clusters. Consider Poisson disk sampling."
    fix_action: "Use Poisson disk sampling for more natural-feeling distribution"
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.cs"
      - "*.gd"

  - id: pcg-no-version
    name: Generator Without Version
    severity: info
    type: regex
    pattern: 'class.*Generator|function.*generate'
    negative_pattern: 'version|VERSION|Version'
    message: "Generator without version. Seeds may break when logic changes."
    fix_action: "Version your generator. Store version with generated content."
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.cs"
