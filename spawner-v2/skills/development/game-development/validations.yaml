# Game Development Validations
# Automated checks to catch common game development mistakes

validations:
  - id: game-frame-dependent
    name: Frame-Dependent Movement
    severity: warning
    type: regex
    pattern: '\\.x\\s*\\+=\\s*\\d+(?!\\s*\\*)|\\.y\\s*\\+=\\s*\\d+(?!\\s*\\*)|position\\s*\\+=\\s*\\d+(?!\\s*\\*)|velocity\\s*=\\s*\\d+(?!\\s*\\*.*delta)'
    message: "Movement not multiplied by delta time. Will run at different speeds on different devices."
    fix_action: "Multiply by delta: this.x += speed * delta"
    applies_to:
      - "*.ts"
      - "*.js"

  - id: game-new-in-update
    name: Object Creation in Update Loop
    severity: warning
    type: regex
    pattern: 'update\\s*\\([^)]*\\)\\s*\\{[^}]*new\\s+[A-Z]|tick\\s*\\([^)]*\\)\\s*\\{[^}]*new\\s+[A-Z]'
    message: "Creating objects in update loop causes GC pauses. Use object pooling."
    fix_action: "Pre-allocate objects and use an object pool"
    applies_to:
      - "*.ts"
      - "*.js"

  - id: game-audio-fire-forget
    name: Audio Fire and Forget
    severity: warning
    type: regex
    pattern: 'new Audio\\(|Audio\\(\\)\\.play'
    message: "Creating new Audio objects. Use audio pooling for sound effects."
    fix_action: "Use an audio manager with pooled sounds"
    applies_to:
      - "*.ts"
      - "*.js"

  - id: game-boolean-state
    name: Boolean State Soup
    severity: warning
    type: regex
    pattern: 'is[A-Z]\\w+\\s*&&.*is[A-Z]\\w+\\s*&&.*is[A-Z]|if\\s*\\(\\s*!?is\\w+\\s*&&\\s*!?is\\w+\\s*&&'
    message: "Complex boolean state logic. Consider using a state machine."
    fix_action: "Implement state machine with explicit states and transitions"
    applies_to:
      - "*.ts"
      - "*.js"

  - id: game-hardcoded-keys
    name: Hardcoded Key Codes
    severity: warning
    type: regex
    pattern: "keyCode\\\\s*===\\\\s*\\\\d+|key\\\\s*===\\\\s*[\"'][A-Za-z][\"']|keyboard\\\\.isDown\\\\s*\\\\([\"']"
    message: "Hardcoded key bindings. Abstract input for rebinding support."
    fix_action: "Use input manager with action mapping"
    applies_to:
      - "*.ts"
      - "*.js"

  - id: game-sync-load
    name: Synchronous Asset Loading
    severity: warning
    type: regex
    pattern: 'loadSync\\(|\\.load\\s*\\([^)]*\\)\\s*;\\s*\\w+\\s*='
    message: "Synchronous asset loading blocks the main thread."
    fix_action: "Use async loading with progress callback"
    applies_to:
      - "*.ts"
      - "*.js"

  - id: game-global-state
    name: Global Game State Access
    severity: warning
    type: regex
    pattern: 'window\\.game\\.|global\\.game\\.|game\\.player\\.|game\\.enemies'
    message: "Direct global state access couples systems. Use events or dependency injection."
    fix_action: "Use event bus or pass dependencies explicitly"
    applies_to:
      - "*.ts"
      - "*.js"

  - id: game-no-delta
    name: Update Without Delta Parameter
    severity: warning
    type: regex
    pattern: 'update\\s*\\(\\s*\\)\\s*\\{|tick\\s*\\(\\s*\\)\\s*\\{'
    message: "Update function has no delta time parameter."
    fix_action: "Add delta parameter: update(delta) { ... }"
    applies_to:
      - "*.ts"
      - "*.js"

  - id: game-mouse-only
    name: Mouse-Only Input
    severity: warning
    type: regex
    pattern: "addEventListener\\s*\\(\\s*['\"]click['\"](?![\\s\\S]*touch)|addEventListener\\s*\\(\\s*['\"]mousedown['\"](?![\\s\\S]*touch)"
    message: "Mouse-only input. Consider touch support for mobile."
    fix_action: "Add touch event handlers or use Pointer Events API"
    applies_to:
      - "*.ts"
      - "*.js"

  - id: game-magic-numbers
    name: Magic Numbers in Game Logic
    severity: warning
    type: regex
    pattern: 'speed\\s*=\\s*\\d{2,}|gravity\\s*=\\s*\\d+|jumpForce\\s*=\\s*-?\\d+'
    message: "Magic numbers in game logic. Use named constants or config."
    fix_action: "Define constants: const PLAYER_SPEED = 300"
    applies_to:
      - "*.ts"
      - "*.js"

  - id: game-nested-loops
    name: Nested Entity Loops
    severity: warning
    type: regex
    pattern: 'entities\\.forEach.*entities\\.forEach|for.*entities.*for.*entities'
    message: "O(nÂ²) entity iteration. Use spatial partitioning for collision."
    fix_action: "Implement spatial grid or quadtree for efficient lookups"
    applies_to:
      - "*.ts"
      - "*.js"

  - id: game-missing-cleanup
    name: Missing Event Cleanup
    severity: warning
    type: regex
    pattern: 'addEventListener\\([^)]*\\)(?![\\s\\S]{0,200}removeEventListener)|\\.on\\([^)]*\\)(?![\\s\\S]{0,200}\\.off\\()'
    message: "Event listener without cleanup. Can cause memory leaks."
    fix_action: "Add cleanup in destroy/dispose method"
    applies_to:
      - "*.ts"
      - "*.js"

  - id: game-requestanimationframe
    name: Direct requestAnimationFrame
    severity: info
    type: regex
    pattern:
      - 'requestAnimationFrame\\s*\\('
    message: "Consider using game engine's built-in loop for delta time handling."
    fix_action: "Use engine's update loop if available"
    applies_to:
      - "*.ts"
      - "*.js"
