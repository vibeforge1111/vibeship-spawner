id: ci-cd-pipeline-collaboration
skill: ci-cd-pipeline
version: 1.0.0

# ============================================================================
# RECEIVES FROM (Who delegates TO this skill)
# ============================================================================
receives_from:
  - skill: backend
    context: "Backend needs automated testing and deployment"
    receives:
      - "Test commands"
      - "Build commands"
      - "Deployment targets"
      - "Environment requirements"
    provides: "Complete CI/CD workflow configuration"

  - skill: frontend
    context: "Frontend needs build and deploy automation"
    receives:
      - "Build configuration"
      - "Preview deployment needs"
      - "CDN deployment target"
    provides: "CI/CD workflow with preview environments"

  - skill: docker-containerization
    context: "Container image needs automated build and push"
    receives:
      - "Dockerfile location"
      - "Registry information"
      - "Build arguments"
    provides: "Multi-platform container build pipeline"

  - skill: kubernetes-deployment
    context: "Kubernetes manifests need automated deployment"
    receives:
      - "Manifests or Helm charts"
      - "Cluster information"
      - "Deployment strategy"
    provides: "GitOps or push-based deployment pipeline"

# ============================================================================
# DELEGATION TRIGGERS
# ============================================================================
delegation_triggers:
  - trigger: "docker|container|image build"
    delegate_to: docker-containerization
    pattern: sequential
    context: "Need container image before CI/CD can push it"
    handoff_data:
      - "Application source"
      - "Build requirements"
      - "Multi-platform needs"
    receive: "Dockerfile and build configuration"

  - trigger: "kubernetes|k8s|helm|deploy to cluster"
    delegate_to: kubernetes-deployment
    pattern: sequential
    context: "Need Kubernetes manifests for deployment target"
    handoff_data:
      - "Container image"
      - "Deployment requirements"
      - "Service configuration"
    receive: "Kubernetes manifests or Helm chart"

  - trigger: "terraform|infrastructure|provision"
    delegate_to: infrastructure-as-code
    pattern: sequential
    context: "Need infrastructure before deploying applications"
    handoff_data:
      - "Infrastructure requirements"
      - "Cloud provider"
      - "Environment specifications"
    receive: "Infrastructure configuration and outputs"

  - trigger: "security audit|workflow security|secrets"
    delegate_to: cybersecurity
    pattern: parallel
    context: "CI/CD workflow needs security review"
    handoff_data:
      - "Workflow files"
      - "Secrets usage"
      - "Permission configuration"
    receive: "Security recommendations and fixes"

  - trigger: "monitoring|observability|deployment metrics"
    delegate_to: observability-sre
    pattern: parallel
    context: "Deployment needs monitoring and alerting"
    handoff_data:
      - "Deployment events"
      - "Health check endpoints"
      - "SLO definitions"
    receive: "Deployment monitoring configuration"

# ============================================================================
# FEEDBACK LOOPS
# ============================================================================
feedback_loops:
  receives_feedback_from:
    - skill: cybersecurity
      signal: "Workflow security vulnerabilities found"
      action: "Fix permissions, pin actions, secure secrets handling"

    - skill: observability-sre
      signal: "Deployment failures or performance issues"
      action: "Add rollback automation, improve health checks"

    - skill: kubernetes-deployment
      signal: "Deployment configuration issues"
      action: "Fix manifest generation, adjust deployment strategy"

    - skill: docker-containerization
      signal: "Build failures or image issues"
      action: "Fix build cache, adjust build arguments"

  sends_feedback_to:
    - skill: backend
      signal: "Test failures or build issues in CI"
      action: "Fix code or test configuration"

    - skill: frontend
      signal: "Build failures or asset issues"
      action: "Fix build configuration or dependencies"

    - skill: infrastructure-as-code
      signal: "Deployment target configuration issues"
      action: "Update infrastructure configuration"

# ============================================================================
# CROSS-DOMAIN INSIGHTS
# ============================================================================
cross_domain_insights:
  - domain: Security Engineering
    insight: |
      Security engineers see CI/CD as highest-value target:
      - Pipelines have access to production secrets
      - Supply chain attacks target build systems first
      - Compromised pipeline = compromised application
      - GITHUB_TOKEN abuse enables repo takeover
      CI/CD security is application security.
    applies_when: "Designing secure CI/CD workflows"

  - domain: Site Reliability Engineering
    insight: |
      SREs understand deployment is the riskiest moment:
      - Most outages start with a deployment
      - Rollback speed determines incident duration
      - Canary and blue-green limit blast radius
      - Deployment metrics are leading indicators
      Fast, safe deployment is reliability engineering.
    applies_when: "Designing deployment strategies"

  - domain: Platform Engineering
    insight: |
      Platform engineers optimize for developer velocity:
      - Slow CI frustrates and is worked around
      - Flaky tests destroy CI credibility
      - Self-service matters more than features
      - Golden paths reduce cognitive load
      Good CI/CD is good developer experience.
    applies_when: "Optimizing CI/CD for teams"

  - domain: FinOps
    insight: |
      FinOps practitioners see CI/CD costs:
      - Build minutes are real money
      - Large artifacts mean storage costs
      - Parallel jobs mean more runner costs
      - Cache hits mean cost savings
      Efficient pipelines are cost-effective pipelines.
    applies_when: "Optimizing CI/CD costs"

# ============================================================================
# COMMON COMBINATIONS
# ============================================================================
common_combinations:
  - name: Full Application Pipeline
    skills:
      - ci-cd-pipeline
      - docker-containerization
      - kubernetes-deployment
    workflow: |
      1. Set up CI workflow for testing (ci-cd-pipeline)
      2. Add container build step (docker-containerization)
      3. Add Kubernetes deployment (kubernetes-deployment)
      4. Configure environment promotion

  - name: Secure Pipeline Setup
    skills:
      - ci-cd-pipeline
      - cybersecurity
      - observability-sre
    workflow: |
      1. Create CI/CD workflow (ci-cd-pipeline)
      2. Security hardening and review (cybersecurity)
      3. Add deployment monitoring (observability-sre)
      4. Document security controls

  - name: Multi-Environment Pipeline
    skills:
      - ci-cd-pipeline
      - infrastructure-as-code
      - observability-sre
    workflow: |
      1. Define environment infrastructure (infrastructure-as-code)
      2. Create promotion pipeline (ci-cd-pipeline)
      3. Add environment monitoring (observability-sre)
      4. Configure gates and approvals

  - name: Monorepo Pipeline
    skills:
      - ci-cd-pipeline
      - backend
      - frontend
    workflow: |
      1. Set up change detection (ci-cd-pipeline)
      2. Configure per-package builds (ci-cd-pipeline)
      3. Optimize caching and parallelization
      4. Add affected-only testing

# ============================================================================
# ECOSYSTEM
# ============================================================================
ecosystem:
  primary_tools:
    - "GitHub Actions - GitHub-native CI/CD"
    - "GitLab CI - GitLab-native CI/CD"
    - "CircleCI - Cloud-native CI/CD"
    - "Jenkins - Self-hosted, extensible CI/CD"
    - "ArgoCD - GitOps continuous delivery for Kubernetes"
    - "Flux - GitOps toolkit for Kubernetes"

  alternatives:
    - name: GitHub Actions
      use_when: "GitHub repos, tight GitHub integration, marketplace actions"
      avoid_when: "Non-GitHub repos, need self-hosted with full control"

    - name: GitLab CI
      use_when: "GitLab repos, need built-in registry and security scanning"
      avoid_when: "GitHub-only organization, prefer external tools"

    - name: CircleCI
      use_when: "Multi-platform, good Docker support, orbs ecosystem"
      avoid_when: "Budget constraints, prefer native git platform CI"

    - name: Jenkins
      use_when: "Full control, extensive plugins, on-premise requirements"
      avoid_when: "Want managed service, small team, avoid maintenance burden"

    - name: ArgoCD
      use_when: "GitOps, Kubernetes-native, pull-based deployment"
      avoid_when: "Not using Kubernetes, want push-based deploys"

    - name: Dagger
      use_when: "Programmable CI, local testing parity, container-native"
      avoid_when: "Simple workflows, team unfamiliar with CUE/Go"

  deployment_strategies:
    - name: Blue-Green
      use_when: "Zero downtime critical, instant rollback needed, sufficient resources"
      considerations: "Requires 2x infrastructure, data migration complexity"

    - name: Canary
      use_when: "Risk mitigation priority, gradual rollout, A/B testing"
      considerations: "Needs traffic splitting, monitoring for automatic rollback"

    - name: Rolling
      use_when: "Resource constrained, stateless apps, acceptable brief degradation"
      considerations: "Multiple versions run simultaneously, DB compatibility"

    - name: Recreate
      use_when: "Legacy apps, shared resources, development environments"
      considerations: "Causes downtime, simplest to implement"

  security_tools:
    - "StepSecurity Harden-Runner - Runtime security for GitHub Actions"
    - "Snyk - Dependency and container vulnerability scanning"
    - "Trivy - Container and IaC scanning"
    - "Gitleaks - Secret detection in code"
    - "zizmor - Static analysis for GitHub Actions"

