# MCP Deployment Validations

validations:
  - id: mcp-no-dockerfile
    name: Missing Dockerfile
    severity: warning
    type: regex
    pattern: 'setRequestHandler'
    negative_pattern: 'Dockerfile|docker-compose|container'
    message: "MCP server without containerization. Docker is recommended for production."
    fix_action: "Create Dockerfile for consistent deployment"
    applies_to:
      - "*.ts"
      - "*.js"

  - id: mcp-hardcoded-port
    name: Hardcoded Port
    severity: info
    type: regex
    pattern: 'listen\s*\(\s*\d{4}'
    message: "Hardcoded port. Use environment variable for flexibility."
    fix_action: "Use process.env.PORT || 3000"
    applies_to:
      - "*.ts"
      - "*.js"

  - id: mcp-no-health-check
    name: Missing Health Check
    severity: warning
    type: regex
    pattern: 'express\(\)|createServer|new Server'
    negative_pattern: '/health|healthcheck|readiness'
    message: "No health check endpoint. Required for container orchestration."
    fix_action: "Add GET /health endpoint that returns 200 when ready"
    applies_to:
      - "*.ts"
      - "*.js"

  - id: mcp-no-graceful-shutdown
    name: Missing Graceful Shutdown
    severity: warning
    type: regex
    pattern: 'listen\s*\(|createServer'
    negative_pattern: 'SIGTERM|SIGINT|graceful|shutdown'
    message: "No graceful shutdown handling. Connections may drop on restart."
    fix_action: "Handle SIGTERM/SIGINT for graceful connection draining"
    applies_to:
      - "*.ts"
      - "*.js"

  - id: mcp-secrets-in-dockerfile
    name: Secrets in Dockerfile
    severity: critical
    type: regex
    pattern: 'ENV\s+(?:API_KEY|SECRET|PASSWORD|TOKEN)\s*=|COPY.*\.env'
    message: "Secrets may be baked into container image. Security vulnerability."
    fix_action: "Use runtime environment variables or secret managers"
    applies_to:
      - "Dockerfile"
      - "*.dockerfile"

  - id: mcp-no-resource-limits
    name: Missing Resource Limits
    severity: info
    type: regex
    pattern: 'image:|container_name:'
    negative_pattern: 'mem_limit|memory|cpu|resources'
    message: "Container without resource limits. May consume unlimited resources."
    fix_action: "Set memory and CPU limits in docker-compose or Kubernetes"
    applies_to:
      - "docker-compose*.yml"
      - "docker-compose*.yaml"
