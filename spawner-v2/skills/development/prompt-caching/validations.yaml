# Prompt Caching Validations

validations:
  - id: cache-high-temperature
    name: Caching High Temperature Responses
    severity: warning
    type: regex
    pattern: 'cache.*temperature.*0\.[6-9]|temperature.*0\.[6-9].*cache'
    message: "Caching with high temperature. Responses are non-deterministic."
    fix_action: "Only cache responses with temperature <= 0.5"
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.py"

  - id: cache-no-ttl
    name: Cache Without TTL
    severity: warning
    type: regex
    pattern: 'cache\.set|setCache|\.set\s*\('
    negative_pattern: 'TTL|ttl|expire|EX|ex'
    message: "Cache without TTL. May serve stale data indefinitely."
    fix_action: "Set appropriate TTL based on data freshness requirements"
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.py"

  - id: cache-dynamic-prefix
    name: Dynamic Content in Cached Prefix
    severity: warning
    type: regex
    pattern: 'cache_control.*ephemeral.*\$\{|cache_control.*ephemeral.*Date|cache_control.*ephemeral.*time'
    message: "Dynamic content in cached prefix. Will cause cache misses."
    fix_action: "Move dynamic content outside of cache_control blocks"
    applies_to:
      - "*.ts"
      - "*.js"

  - id: cache-no-metrics
    name: No Cache Metrics
    severity: info
    type: regex
    pattern: 'cache\.get|getCached'
    negative_pattern: 'hit|miss|metric|log|count'
    message: "Cache without hit/miss tracking. Can't measure effectiveness."
    fix_action: "Add cache hit/miss metrics and logging"
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.py"
