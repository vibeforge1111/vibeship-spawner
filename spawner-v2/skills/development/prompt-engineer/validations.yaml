# Prompt Engineer Validations
# Automated checks for prompt engineering patterns

validations:
  - id: vague-instruction
    name: Vague Instruction
    severity: warning
    type: regex
    pattern:
      - 'be helpful'
      - 'do your best'
      - 'as needed'
      - 'when appropriate'
      - 'if necessary'
      - 'be concise(?!.*\d)'
    message: "Vague instruction may be interpreted inconsistently."
    fix_action: "Use specific, measurable criteria (e.g., '2-3 sentences')"
    applies_to:
      - "**/*.py"
      - "**/*.ts"
      - "**/*.js"
      - "**/*.md"

  - id: no-output-format
    name: No Output Format Specified
    severity: warning
    type: regex
    pattern:
      - 'json\.loads\((?!.*format|.*schema)'
      - 'parse.*response(?!.*format|.*schema)'
      - 'JSON\.parse\((?!.*format)'
    message: "Parsing output without format specification in prompt."
    fix_action: "Specify exact output format with schema or example"
    applies_to:
      - "**/*.py"
      - "**/*.ts"
      - "**/*.js"

  - id: prompt-injection-risk
    name: Prompt Injection Risk
    severity: error
    type: regex
    pattern:
      - 'prompt\s*\+\s*user_input'
      - 'f".*\{user'
      - 'f".*\{input'
      - '`.*\$\{user'
      - 'concat.*input'
    message: "Direct user input concatenation - prompt injection risk."
    fix_action: "Delimit user input clearly with tags, validate/sanitize"
    applies_to:
      - "**/*.py"
      - "**/*.ts"
      - "**/*.js"

  - id: no-negative-instructions
    name: No Negative Instructions
    severity: info
    type: regex
    pattern:
      - 'system.*prompt.*=(?!.*not|.*never|.*don\'t|.*avoid|.*do not)'
    message: "System prompt without negative instructions (don'ts)."
    fix_action: "Add explicit don'ts to prevent common failure modes"
    applies_to:
      - "**/*.py"
      - "**/*.ts"
      - "**/*.js"

  - id: hardcoded-prompt
    name: Hardcoded Prompt
    severity: info
    type: regex
    pattern:
      - 'prompt\s*=\s*["\'][^"\']{100,}["\']'
      - 'system_prompt\s*=\s*["\'][^"\']{100,}["\']'
    message: "Long hardcoded prompt - consider externalizing for management."
    fix_action: "Move prompts to separate files for version control"
    applies_to:
      - "**/*.py"
      - "**/*.ts"
      - "**/*.js"
    excludes:
      - "**/prompts/**"
      - "**/templates/**"

  - id: default-temperature
    name: Default Temperature for All Tasks
    severity: info
    type: regex
    pattern:
      - 'temperature\s*=\s*1\.0'
      - 'temperature\s*=\s*0(?!.*\d)'
    message: "Extreme or default temperature may not suit task type."
    fix_action: "Use 0-0.3 for factual, 0.5-0.7 balanced, 0.8-1.0 creative"
    applies_to:
      - "**/*.py"
      - "**/*.ts"
      - "**/*.js"

  - id: no-examples
    name: No Examples in Prompt
    severity: info
    type: regex
    pattern:
      - 'system.*prompt(?!.*example|.*e\.g\.|.*for instance)'
    message: "Prompt without examples - few-shot improves consistency."
    fix_action: "Add 2-5 diverse examples of expected behavior"
    applies_to:
      - "**/*.py"
      - "**/*.ts"
      - "**/*.js"

  - id: untested-prompt-change
    name: Untested Prompt Change
    severity: info
    type: regex
    pattern:
      - 'prompt\s*=|system_prompt\s*=(?!.*evaluate|.*test|.*benchmark)'
    message: "Prompt assignment without evaluation call nearby."
    fix_action: "Evaluate prompt changes with test set before deploying"
    applies_to:
      - "**/*.py"
      - "**/*.ts"
      - "**/*.js"
    excludes:
      - "**/test*"
      - "**/*_test.*"
      - "**/*.test.*"
      - "**/*.spec.*"

  - id: context-stuffing
    name: Context Stuffing
    severity: warning
    type: regex
    pattern:
      - 'context\s*=\s*all'
      - 'include.*everything'
      - 'full.*document'
      - '\.join\([^)]*all'
    message: "Including all context may dilute important information."
    fix_action: "Include only relevant context, use retrieval for large docs"
    applies_to:
      - "**/*.py"
      - "**/*.ts"
      - "**/*.js"
