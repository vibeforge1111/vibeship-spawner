# Code Reviewer Validations
# Automated checks for code quality patterns

validations:
  - id: todo-without-issue
    name: TODO Without Issue Reference
    severity: info
    type: regex
    pattern:
      - 'TODO(?!.*#[0-9]+|.*issue|.*JIRA)'
      - 'FIXME(?!.*#[0-9]+|.*issue)'
      - 'HACK(?!.*#[0-9]+|.*issue)'
    message: "TODO/FIXME without issue reference. May be forgotten."
    fix_action: "Link to issue: TODO(#123): description"
    applies_to:
      - "**/*.py"
      - "**/*.ts"
      - "**/*.js"

  - id: magic-number
    name: Magic Number in Code
    severity: info
    type: regex
    pattern:
      - 'if.*[=<>].*\b(100|1000|60|3600|86400)\b'
      - 'sleep\(\d{2,}\)'
      - 'limit.*=.*\d{2,}(?!.*#)'
    message: "Magic number without explanation. Consider named constant."
    fix_action: "Extract to constant: RETRY_TIMEOUT_SECONDS = 60"
    applies_to:
      - "**/*.py"
      - "**/*.ts"

  - id: god-class
    name: Class With Too Many Methods
    severity: warning
    type: regex
    pattern:
      - 'class.*:.*def.*def.*def.*def.*def.*def.*def.*def.*def.*def'
    message: "Class has many methods. May have too many responsibilities."
    fix_action: "Consider splitting into focused classes (Single Responsibility)"
    applies_to:
      - "**/*.py"

  - id: deep-nesting
    name: Deeply Nested Code
    severity: warning
    type: regex
    pattern:
      - 'if.*:\s+if.*:\s+if.*:\s+if'
      - 'for.*:\s+for.*:\s+for.*:'
    message: "Deep nesting makes code hard to follow."
    fix_action: "Use guard clauses, extract methods, or invert conditions"
    applies_to:
      - "**/*.py"
      - "**/*.ts"

  - id: catch-all-exception
    name: Catching All Exceptions
    severity: warning
    type: regex
    pattern:
      - 'except\s*:'
      - 'except Exception:'
      - 'catch\s*\(\s*\)'
      - 'catch\s*\(.*Error\s*\)'
    message: "Catching all exceptions hides bugs and unexpected errors."
    fix_action: "Catch specific exceptions: except ValueError, KeyError:"
    applies_to:
      - "**/*.py"
      - "**/*.ts"

  - id: commented-code
    name: Commented Out Code
    severity: info
    type: regex
    pattern:
      - '#\s*(def|class|if|for|while|return)\s'
      - '//\s*(function|const|let|var|if|for)\s'
    message: "Commented code clutters codebase. Delete or restore."
    fix_action: "Remove commented code. Use git history if needed later."
    applies_to:
      - "**/*.py"
      - "**/*.ts"
      - "**/*.js"

  - id: long-function
    name: Function Too Long
    severity: info
    type: regex
    pattern:
      - 'def.*:(\n.*){50,}'
      - 'function.*\{(\n.*){50,}'
    message: "Function is very long. May have multiple responsibilities."
    fix_action: "Extract logical chunks into well-named helper functions"
    applies_to:
      - "**/*.py"
      - "**/*.ts"

  - id: hardcoded-credentials
    name: Hardcoded Credentials
    severity: error
    type: regex
    pattern:
      - "password\\s*=\\s*[\"'][^\"']+[\"']"
      - "api_key\\s*=\\s*[\"'][^\"']+[\"']"
      - "secret\\s*=\\s*[\"'][^\"']+[\"']"
      - "token\\s*=\\s*[\"'][A-Za-z0-9]{20,}[\"']"
    message: "Hardcoded credentials. Security vulnerability."
    fix_action: "Use environment variables or secrets manager"
    applies_to:
      - "**/*.py"
      - "**/*.ts"
      - "**/*.js"

  - id: print-debugging
    name: Print Debugging Left In
    severity: warning
    type: regex
    pattern:
      - "print\\([\"']debug"
      - "console\\.log\\([\"']debug"
      - "print\\(f[\"'].*="
    message: "Debug print statement. Use proper logging instead."
    fix_action: "Use logger.debug() or remove before merge"
    applies_to:
      - "**/*.py"
      - "**/*.ts"

  - id: duplicate-code
    name: Duplicated Code Block
    severity: info
    type: regex
    pattern:
      - '(\b\w+\s*=\s*\w+\.\w+\(\).*\n){3,}'
    message: "Possible code duplication. Consider extracting common logic."
    fix_action: "Extract to function or use loop/map"
    applies_to:
      - "**/*.py"
      - "**/*.ts"

  - id: public-field-mutation
    name: Direct Mutation of Class State
    severity: info
    type: regex
    pattern:
      - 'self\.\w+\s*=.*(?!__init__|__new__)'
      - 'this\.\w+\s*=.*(?!constructor)'
    message: "Direct state mutation outside initializer. Consider encapsulation."
    fix_action: "Use setter methods or make field private"
    applies_to:
      - "**/*.py"
      - "**/*.ts"

  - id: missing-docstring
    name: Public Function Without Docstring
    severity: info
    type: regex
    pattern:
      - "def [^_].*\\):\\s*\\n\\s+[^\"']"
      - "async def [^_].*\\):\\s*\\n\\s+[^\"']"
    message: "Public function without docstring. Add description."
    fix_action: "Add docstring explaining purpose, params, and return"
    applies_to:
      - "**/*.py"
