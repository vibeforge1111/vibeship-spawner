id: prompt-engineering-creative-validations
skill: prompt-engineering-creative
version: 1.0.0

validations:
  # Critical: Security
  - id: no-user-input-concatenation
    name: User input must be sanitized before prompt
    severity: critical
    description: Direct user input in prompts enables injection attacks
    pattern:
      file_glob: "**/*.{ts,js,py}"
      match: "prompt.*`[^`]*\\$\\{.*user|prompt.*\\+.*user.*input|f\".*{user"
      exclude: "sanitize|escape|filter|validate|clean"
    message: "User input concatenated into prompt without sanitization. Add input validation."
    autofix: false

  - id: no-system-prompt-exposure
    name: System prompts should not be exposed
    severity: critical
    description: Exposing system prompts enables prompt extraction attacks
    pattern:
      file_glob: "**/*.{ts,js,py}"
      match: "console\\.log.*system.*prompt|print.*system.*prompt|response.*system"
      exclude: "debug.*false|production|process\\.env\\.NODE_ENV"
    message: "System prompt may be exposed in output. Remove or guard with debug flag."
    autofix: false

  # High: Quality
  - id: prompt-has-structure
    name: Image prompts should have structured elements
    severity: high
    description: Effective prompts include subject, style, and technical parameters
    pattern:
      file_glob: "**/*.{ts,js,py,yaml}"
      match: "(midjourney|dalle|flux|stable.diffusion).*prompt.*['\"][^'\"]{10,50}['\"]"
      exclude: "style|subject|lighting|camera|--ar|quality"
    message: "Short image prompt may lack structure. Include subject, style, and technical elements."
    autofix: false

  - id: no-vague-adjectives-alone
    name: Vague adjectives need specific qualifiers
    severity: medium
    description: Words like beautiful, amazing, cool need concrete descriptors
    pattern:
      file_glob: "**/*.{ts,js,py,yaml,md}"
      match: "prompt.*(beautiful|amazing|cool|nice|perfect|epic)['\",\\s]"
      exclude: "symmetrical|detailed|specific|style of|technique"
    message: "Vague adjective in prompt. Add specific visual descriptors."
    autofix: false

  - id: front-loaded-subject
    name: Primary subject should be near prompt start
    severity: medium
    description: Models weight earlier tokens more heavily
    pattern:
      file_glob: "**/*.{ts,js,py,yaml}"
      match: "prompt.*['\"][^'\"]{100,}(portrait|photo|image|shot) of"
    message: "Subject appears late in prompt. Consider front-loading important elements."
    autofix: false

  - id: model-specific-syntax
    name: Use model-appropriate prompt syntax
    severity: medium
    description: Different models use different prompt languages
    pattern:
      file_glob: "**/*.{ts,js,py}"
      match: "(dalle|openai).*::\\d|midjourney.*\\(\\w+:\\d\\.\\d\\)"
    message: "Prompt syntax may not match model. Midjourney uses ::weights, SD uses (word:weight)."
    autofix: false

  - id: negative-prompt-present
    name: Image generation should include negative prompts
    severity: medium
    description: Negative prompts prevent common artifacts
    pattern:
      file_glob: "**/*.{ts,js,py}"
      match: "(stable.diffusion|flux|comfy).*generate(?!.*negative)"
      exclude: "negative|--no|exclude"
    message: "Image generation without negative prompt. Add to prevent artifacts."
    autofix: false

  - id: prompt-length-reasonable
    name: Prompt length should be appropriate for model
    severity: low
    description: Very long prompts may be truncated or cause confusion
    pattern:
      file_glob: "**/*.{ts,js,py,yaml}"
      match: "prompt.*['\"][^'\"]{500,}['\"]"
    message: "Very long prompt detected. Consider if all elements are necessary."
    autofix: false

  - id: aspect-ratio-specified
    name: Specify aspect ratio for image generation
    severity: low
    description: Default aspect ratios may not suit content
    pattern:
      file_glob: "**/*.{ts,js,py}"
      match: "(midjourney|dalle|flux).*generate"
      exclude: "--ar|aspect|ratio|size|width.*height|dimension"
    message: "Image generation without aspect ratio. Specify for better composition."
    autofix: false

  - id: seed-documented
    name: Save seeds for reproducible results
    severity: low
    description: Seeds enable recreation of successful generations
    pattern:
      file_glob: "**/*.{ts,js,py}"
      match: "seed.*=.*random|Math\\.random.*seed"
      exclude: "log|save|store|document"
    message: "Random seed without logging. Save seed for reproducibility."
    autofix: false

  - id: temperature-appropriate
    name: Temperature setting matches use case
    severity: low
    description: High temperature for creativity, low for consistency
    pattern:
      file_glob: "**/*.{ts,js,py}"
      match: "temperature.*[01]\\.\\d"
      exclude: "comment|config|documented"
    message: "Temperature setting present. Verify it matches creativity/consistency needs."
    autofix: false

  - id: prompt-template-validated
    name: Prompt templates should validate variables
    severity: medium
    description: Missing variables cause malformed prompts
    pattern:
      file_glob: "**/*.{ts,js,py}"
      match: "template.*\\$\\{|`.*\\$\\{.*prompt"
      exclude: "validate|required|check|undefined|null"
    message: "Prompt template without variable validation. Check for missing values."
    autofix: false

# Pre-commit checks
pre_commit:
  - id: no-user-input-concatenation
  - id: no-system-prompt-exposure
  - id: prompt-has-structure

# CI/CD checks
ci_checks:
  - id: no-user-input-concatenation
  - id: no-system-prompt-exposure
  - id: model-specific-syntax
  - id: prompt-template-validated

# Quality gates for prompt work
prompt_quality_checks:
  - id: no-vague-adjectives-alone
  - id: front-loaded-subject
  - id: negative-prompt-present
  - id: aspect-ratio-specified
