id: ai-visual-effects-validations
skill: ai-visual-effects
version: 1.0.0

validations:
  # High: Quality Control
  - id: source-resolution-adequate
    name: Source resolution should be adequate for output
    severity: high
    description: Upscaling can't create missing information
    pattern:
      file_glob: "**/*.{ts,js,py}"
      match: "upscale.*(480|360|240|144)p"
      exclude: "test|sample|preview"
    message: "Upscaling very low resolution source. Quality will be limited."
    autofix: false

  - id: temporal-consistency-video
    name: Video processing should maintain temporal consistency
    severity: high
    description: Frame-by-frame processing causes flickering
    pattern:
      file_glob: "**/*.{ts,js,py}"
      match: "for.*frame|forEach.*frame|process.*image"
      exclude: "temporal|video|sequence|consistent|batch"
    message: "Processing frames individually. Use video-aware processing for temporal consistency."
    autofix: false

  - id: original-preserved
    name: Original files should be preserved
    severity: high
    description: Non-destructive workflow requires originals
    pattern:
      file_glob: "**/*.{ts,js,py}"
      match: "overwrite|replace.*original|delete.*source"
      exclude: "backup|copy|version|archive|preserve"
    message: "Operation may overwrite originals. Preserve source files before processing."
    autofix: false

  # Medium: Best Practices
  - id: upscaler-matches-content
    name: Upscaler model should match content type
    severity: medium
    description: Photo models on anime (or vice versa) produce poor results
    pattern:
      file_glob: "**/*.{ts,js,py,yaml}"
      match: "(anime|illustration).*esrgan|(photo|realistic).*waifu"
      exclude: "appropriate|match|detect|auto"
    message: "Upscaler may not match content type. Select appropriate model."
    autofix: false

  - id: color-matching-composite
    name: Composited elements should have color matching
    severity: medium
    description: Color mismatch destroys composite believability
    pattern:
      file_glob: "**/*.{ts,js,py}"
      match: "composite|merge|overlay.*ai.*footage"
      exclude: "color|grade|match|lut|correct"
    message: "Compositing without color matching. Add color correction step."
    autofix: false

  - id: edge-treatment-exists
    name: Composited elements should have edge treatment
    severity: medium
    description: Poor edges make composites obvious
    pattern:
      file_glob: "**/*.{ts,js,py}"
      match: "composite|alpha.*blend|mask"
      exclude: "edge|feather|blur|refine"
    message: "Compositing without edge treatment. Add edge refinement."
    autofix: false

  - id: grain-matching
    name: AI elements should match footage grain
    severity: medium
    description: Clean AI elements in grainy footage look fake
    pattern:
      file_glob: "**/*.{ts,js,py}"
      match: "composite.*ai.*video|merge.*generated"
      exclude: "grain|noise|texture|match"
    message: "Compositing AI into footage without grain matching. Add grain/noise."
    autofix: false

  - id: resolution-pipeline-planned
    name: Resolution should be consistent through pipeline
    severity: medium
    description: Unnecessary resolution changes lose quality
    pattern:
      file_glob: "**/*.{ts,js,py}"
      match: "upscale.*resize|scale.*upscale"
      exclude: "final|output|delivery"
    message: "Multiple resolution changes in pipeline. Plan resolution workflow."
    autofix: false

  # Low: Optimization
  - id: workflow-documented
    name: ComfyUI workflows should be documented
    severity: low
    description: Complex workflows need documentation for reuse
    pattern:
      file_glob: "**/*.json"
      match: "ComfyUI|workflow"
      exclude: "readme|doc|comment|note"
    message: "ComfyUI workflow may lack documentation. Add notes and README."
    autofix: false

  - id: intermediate-quality
    name: Intermediate exports should use high quality codec
    severity: low
    description: Lossy compression mid-workflow degrades quality
    pattern:
      file_glob: "**/*.{ts,js,py}"
      match: "export.*h264|encode.*mp4.*intermediate"
      exclude: "prores|dnxhd|lossless|high.*quality"
    message: "Intermediate export using lossy compression. Use ProRes/DNxHR."
    autofix: false

  - id: version-control
    name: VFX projects should have version control
    severity: low
    description: Version control enables iteration and recovery
    pattern:
      file_glob: "**/*.{ts,js,py}"
      match: "save.*project|export.*final"
      exclude: "version|v\\d|_v|backup"
    message: "Saving without versioning. Add version numbers to files."
    autofix: false

  - id: ab-comparison
    name: Processing should include quality comparison
    severity: low
    description: Easy to degrade quality without noticing
    pattern:
      file_glob: "**/*.{ts,js,py}"
      match: "process|enhance|upscale"
      exclude: "compare|original|before|quality.*check"
    message: "Processing without comparison step. Verify improvement vs original."
    autofix: false

# Pre-commit checks
pre_commit:
  - id: source-resolution-adequate
  - id: original-preserved
  - id: resolution-pipeline-planned

# CI/CD checks
ci_checks:
  - id: temporal-consistency-video
  - id: original-preserved
  - id: intermediate-quality

# Quality gates for VFX projects
vfx_quality_gates:
  - id: color-matching-composite
  - id: edge-treatment-exists
  - id: grain-matching
  - id: upscaler-matches-content
  - id: ab-comparison
