id: digital-humans-validations
skill: digital-humans
version: 1.0.0

validations:
  # Critical: Legal and Ethics
  - id: no-api-keys-hardcoded
    name: No API keys in code
    severity: critical
    description: Digital human API keys must use environment variables
    pattern:
      file_glob: "**/*.{ts,js,py,yaml,json}"
      match: "(HEYGEN_API|SYNTHESIA_API|DID_API|TAVUS_).*=.*['\"][^'\"]{20,}['\"]"
      exclude: "process\\.env|import\\.meta\\.env|os\\.environ|\\$\\{"
    message: "API key hardcoded. Use environment variables."
    autofix: false

  - id: consent-documentation
    name: Custom avatar requires consent documentation
    severity: critical
    description: Any custom avatar creation should reference consent documentation
    pattern:
      file_glob: "**/*.{ts,js,py}"
      match: "(create_avatar|clone|custom_avatar|upload.*face)"
      exclude: "consent|agreement|permission|authorized|licensed|stock"
    message: "Custom avatar creation without consent reference. Add consent documentation."
    autofix: false

  - id: disclosure-in-content
    name: AI avatar content needs disclosure
    severity: high
    description: Published avatar content should include AI disclosure
    pattern:
      file_glob: "**/*.{ts,js,py,yaml,md}"
      match: "(publish|upload|post).*(avatar|digital.human|synthesia|heygen)"
      exclude: "disclosure|ai.generated|synthetic|label"
    message: "Publishing avatar content without disclosure mention. Add AI disclosure."
    autofix: false

  # High: Quality Control
  - id: error-handling-generation
    name: Avatar generation needs error handling
    severity: high
    description: Digital human API calls should handle failures gracefully
    pattern:
      file_glob: "**/*.{ts,js,py}"
      match: "await.*(heygen|synthesia|did|tavus).*(generate|create|render)"
      exclude: "try|catch|error|Error|except|finally|\\.catch"
    message: "Avatar generation without error handling. Wrap in try/catch."
    autofix: false

  - id: script-length-check
    name: Check script length before generation
    severity: medium
    description: Long scripts should be validated before expensive generation
    pattern:
      file_glob: "**/*.{ts,js,py}"
      match: "generate.*(avatar|video|talking)"
      exclude: "length|duration|limit|validate|check"
    message: "Avatar generation without script length validation. Check duration before generating."
    autofix: false

  - id: resolution-specified
    name: Specify output resolution
    severity: medium
    description: Avatar video generation should specify resolution for predictable output
    pattern:
      file_glob: "**/*.{ts,js,py}"
      match: "(heygen|synthesia|did).*generate"
      exclude: "resolution|quality|1080|720|4K|size"
    message: "Avatar generation without resolution specification. Set output quality."
    autofix: false

  # Medium: Best Practices
  - id: cost-tracking-avatar
    name: Track avatar generation costs
    severity: medium
    description: Avatar API calls should log estimated costs
    pattern:
      file_glob: "**/*.{ts,js,py}"
      match: "(heygen|synthesia|did|tavus)\\.(generate|create|render)"
      exclude: "cost|minutes|duration|track|log|budget"
    message: "Avatar generation without cost tracking. Log duration for budget management."
    autofix: false

  - id: avatar-voice-matching
    name: Avatar and voice should be matched
    severity: medium
    description: Avatar appearance and voice should be compatible
    pattern:
      file_glob: "**/*.{ts,js,py,yaml}"
      match: "avatar.*voice|voice.*avatar"
      exclude: "match|compatible|appropriate|selected"
    message: "Avatar and voice pairing without matching consideration. Verify compatibility."
    autofix: false

  - id: language-support-check
    name: Verify language support before generation
    severity: medium
    description: Multi-language generation should verify language support
    pattern:
      file_glob: "**/*.{ts,js,py}"
      match: "language.*!=.*en|locale|translate.*avatar"
      exclude: "support|available|check|verify|list"
    message: "Non-English avatar generation without language support check."
    autofix: false

  - id: rate-limiting-avatar
    name: Batch avatar generation needs rate limiting
    severity: high
    description: Multiple avatar generations should respect rate limits
    pattern:
      file_glob: "**/*.{ts,js,py}"
      match: "Promise\\.all.*(avatar|heygen|synthesia)|for.*await.*(generate.*avatar)"
      exclude: "queue|limit|throttle|batch|concurrent|delay|sequential"
    message: "Batch avatar generation without rate limiting. Add concurrency control."
    autofix: false

  # Low: Optimization
  - id: script-optimization
    name: Script should be optimized for avatar delivery
    severity: low
    description: Scripts for avatars should be simplified and properly punctuated
    pattern:
      file_glob: "**/*.{ts,js,yaml,md}"
      match: 'script.*[:=].*"[^"]{500,}"'
      exclude: "simplified|reviewed|optimized"
    message: "Long script for avatar. Consider simplifying for better AI delivery."
    autofix: false

  - id: avatar-metadata-saved
    name: Save avatar generation metadata
    severity: low
    description: Avatar outputs should be saved with generation settings
    pattern:
      file_glob: "**/*.{ts,js,py}"
      match: "(save|download|store).*avatar.*\\.mp4|video"
      exclude: "metadata|settings|script|avatar_id|json"
    message: "Saving avatar video without metadata. Store settings for reference."
    autofix: false

  - id: background-specification
    name: Specify background for avatar
    severity: low
    description: Avatar generation should specify background for consistent branding
    pattern:
      file_glob: "**/*.{ts,js,py,yaml}"
      match: "(heygen|synthesia|did).*generate"
      exclude: "background|green.screen|transparent|setting"
    message: "Avatar generation without background specification. Set background for brand consistency."
    autofix: false

# Pre-commit checks
pre_commit:
  - id: no-api-keys-hardcoded
  - id: consent-documentation
  - id: error-handling-generation

# CI/CD checks
ci_checks:
  - id: no-api-keys-hardcoded
  - id: disclosure-in-content
  - id: rate-limiting-avatar
  - id: cost-tracking-avatar

# Quality gates for avatar projects
avatar_project_checks:
  - id: script-length-check
  - id: resolution-specified
  - id: avatar-voice-matching
  - id: language-support-check
