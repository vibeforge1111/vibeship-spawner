id: ai-audio-production-validations
skill: ai-audio-production
version: 1.0.0

validations:
  # Critical: Legal and Security
  - id: no-api-keys-hardcoded
    name: No API keys in code
    severity: critical
    description: Audio API keys must use environment variables
    pattern:
      file_glob: "**/*.{ts,js,py,yaml,json}"
      match: "(ELEVENLABS_API|SUNO_API|UDIO_|MURF_|PLAY_HT).*=.*['\"][^'\"]{20,}['\"]"
      exclude: "process\\.env|import\\.meta\\.env|os\\.environ|\\$\\{"
    message: "API key hardcoded. Use environment variables."
    autofix: false

  - id: voice-consent-check
    name: Voice cloning requires consent documentation
    severity: critical
    description: Any voice cloning should reference consent documentation
    pattern:
      file_glob: "**/*.{ts,js,py}"
      match: "(clone|voice_id|add_voice|instant_voice)"
      exclude: "consent|agreement|permission|authorized|licensed"
    message: "Voice cloning without consent reference. Add consent documentation."
    autofix: false

  - id: no-celebrity-voice-cloning
    name: No celebrity voice cloning
    severity: critical
    description: Cloning celebrity or public figure voices is prohibited
    pattern:
      file_glob: "**/*.{ts,js,py,yaml,json}"
      match: "clone.*(celebrity|famous|[A-Z][a-z]+ [A-Z][a-z]+.*(voice|clone))"
      exclude: "example of what NOT|avoid|don't"
    message: "Celebrity voice cloning attempt. This is illegal without explicit license."
    autofix: false

  # High: Quality Control
  - id: audio-output-normalization
    name: Audio output needs normalization
    severity: high
    description: AI audio should be normalized before delivery
    pattern:
      file_glob: "**/*.{ts,js,py}"
      match: "(elevenlabs|suno|udio).*generate|synthesize|text_to_speech"
      exclude: "normalize|lufs|loudness|master|process"
    message: "Audio generation without normalization step. Add LUFS normalization (-14 LUFS)."
    autofix: false

  - id: error-handling-audio-api
    name: Audio API calls need error handling
    severity: high
    description: AI audio API calls should handle failures gracefully
    pattern:
      file_glob: "**/*.{ts,js,py}"
      match: "await.*(elevenlabs|suno|generate.*audio|text_to_speech)"
      exclude: "try|catch|error|Error|except|finally|\\.catch"
    message: "Audio API call without error handling. Wrap in try/catch."
    autofix: false

  - id: voice-settings-explicit
    name: Voice settings should be explicit
    severity: medium
    description: ElevenLabs and similar should have explicit stability/similarity settings
    pattern:
      file_glob: "**/*.{ts,js,py}"
      match: "elevenlabs.*generate|text_to_speech"
      exclude: "stability|similarity|style|settings|voice_settings"
    message: "Voice generation without explicit settings. Set stability and similarity for consistency."
    autofix: false

  # Medium: Best Practices
  - id: cost-tracking-audio
    name: Track audio generation costs
    severity: medium
    description: Audio API calls should log character counts or generation costs
    pattern:
      file_glob: "**/*.{ts,js,py}"
      match: "(elevenlabs|suno|udio|murf)\\.(generate|synthesize|create)"
      exclude: "cost|chars|character|count|track|log|budget"
    message: "Audio generation without cost tracking. Log character counts for budget management."
    autofix: false

  - id: music-prompt-detail
    name: Music prompts need sufficient detail
    severity: medium
    description: AI music prompts should specify genre, tempo, mood, instruments
    pattern:
      file_glob: "**/*.{ts,js,yaml}"
      match: 'music.*prompt.*[:=].*["\''''][^"\'''']{1,50}["\'''']'
      exclude: "BPM|tempo|genre|instrument|mood|style"
    message: "Music prompt too vague. Include genre, tempo, mood, and instruments."
    autofix: false

  - id: audio-format-specification
    name: Specify audio output format
    severity: medium
    description: Audio generation should specify format (mp3, wav, etc.)
    pattern:
      file_glob: "**/*.{ts,js,py}"
      match: "generate.*audio|text_to_speech|synthesize"
      exclude: "format|mp3|wav|ogg|m4a|output_format"
    message: "Audio generation without format specification. Specify output format."
    autofix: false

  - id: rate-limiting-audio
    name: Batch audio needs rate limiting
    severity: high
    description: Multiple audio generations should respect rate limits
    pattern:
      file_glob: "**/*.{ts,js,py}"
      match: "Promise\\.all.*(audio|voice|speech)|for.*await.*(generate|synthesize)"
      exclude: "queue|limit|throttle|batch|PQueue|p-limit|concurrent|delay"
    message: "Batch audio generation without rate limiting. Add concurrency control."
    autofix: false

  # Low: Optimization
  - id: audio-metadata-saved
    name: Save audio generation metadata
    severity: low
    description: Audio outputs should be saved with generation settings
    pattern:
      file_glob: "**/*.{ts,js,py}"
      match: "(save|write|store).*\\.mp3|\\.wav|audio"
      exclude: "metadata|settings|prompt|voice_id|json"
    message: "Saving audio without metadata. Store settings for reproducibility."
    autofix: false

  - id: sample-rate-consistency
    name: Maintain consistent sample rates
    severity: low
    description: Audio files should use consistent sample rates for mixing
    pattern:
      file_glob: "**/*.{ts,js,py}"
      match: "sample_rate|sampleRate"
      exclude: "48000|44100|consistent|match"
    message: "Non-standard sample rate. Use 44100 or 48000 Hz for consistency."
    autofix: false

  - id: stereo-mono-consideration
    name: Consider stereo vs mono for use case
    severity: low
    description: Voice content often works better in mono, music in stereo
    pattern:
      file_glob: "**/*.{ts,js,py}"
      match: "text_to_speech|voice.*generate"
      exclude: "mono|stereo|channels"
    message: "Voice generation without channel specification. Consider mono for voice."
    autofix: false

# Pre-commit checks
pre_commit:
  - id: no-api-keys-hardcoded
  - id: voice-consent-check
  - id: no-celebrity-voice-cloning
  - id: error-handling-audio-api

# CI/CD checks
ci_checks:
  - id: no-api-keys-hardcoded
  - id: no-celebrity-voice-cloning
  - id: rate-limiting-audio
  - id: cost-tracking-audio

# Quality gates for audio projects
audio_project_checks:
  - id: audio-output-normalization
  - id: voice-settings-explicit
  - id: music-prompt-detail
  - id: audio-format-specification
