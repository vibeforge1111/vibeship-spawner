id: ai-workflow-automation-validations
skill: ai-workflow-automation
version: 1.0.0

validations:
  # Critical: Quality Gates
  - id: quality-gates-exist
    name: Workflows should have quality gates before auto-publish
    severity: critical
    description: Automation without quality gates amplifies errors
    pattern:
      file_glob: "**/*.{yaml,yml,json,js,ts,py}"
      match: "auto.*publish|publish.*auto|automated.*publish"
      exclude: "quality.*gate|validation|check|verify|approve"
    message: "Workflow may auto-publish without quality gates. Add validation checks before publication."
    autofix: false

  - id: cost-tracking-implemented
    name: AI workflows should track costs per request
    severity: critical
    description: Unmonitored costs can spiral out of control
    pattern:
      file_glob: "**/*.{yaml,yml,json,js,ts,py}"
      match: "openai|anthropic|claude|gpt-4|api.*key|ai.*generate"
      exclude: "cost|token.*count|usage|budget|track|log.*cost"
    message: "AI API usage detected without cost tracking. Implement per-request cost logging."
    autofix: false

  # High: Approval Workflows
  - id: approval-workflow-defined
    name: Content workflows should have defined approval process
    severity: high
    description: Automated content needs human oversight
    pattern:
      file_glob: "**/*.{yaml,yml,json,js,ts,py}"
      match: "workflow|pipeline|automation"
      exclude: "approval|review|human.*check|authorize"
    message: "Workflow may lack approval process. Define who approves what and when."
    autofix: false

  - id: backup-approver-exists
    name: Approval workflows should have backup approvers
    severity: high
    description: Single approver creates bottleneck
    pattern:
      file_glob: "**/*.{yaml,yml,json}"
      match: "approver|reviewer"
      exclude: "backup|delegate|alternate|fallback"
    message: "Approval workflow may lack backup approver. Add delegation for when primary unavailable."
    autofix: false

  - id: rate-limiting-implemented
    name: API calls should have rate limiting
    severity: high
    description: Prevents hitting API rate limits
    pattern:
      file_glob: "**/*.{js,ts,py}"
      match: "api\\..*\\(|fetch\\(|axios\\.|request\\("
      exclude: "rate.*limit|throttle|queue|delay|backoff"
    message: "API calls may lack rate limiting. Implement request throttling to prevent 429 errors."
    autofix: false

  - id: brand-compliance-check
    name: Generated content should check brand compliance
    severity: high
    description: Automated content must stay on-brand
    pattern:
      file_glob: "**/*.{yaml,yml,json,js,ts,py}"
      match: "generate.*content|ai.*content|llm.*generate"
      exclude: "brand.*check|brand.*term|voice.*check|compliance"
    message: "Content generation may lack brand compliance checks. Add brand term validation."
    autofix: false

  # Medium: Error Handling
  - id: retry-logic-exists
    name: API calls should have retry logic
    severity: medium
    description: Temporary failures should be retried
    pattern:
      file_glob: "**/*.{js,ts,py}"
      match: "api\\..*\\(|fetch\\(|axios\\."
      exclude: "retry|catch|try.*catch|error.*handler"
    message: "API calls may lack retry logic. Add exponential backoff for transient failures."
    autofix: false

  - id: error-logging-present
    name: Workflows should log errors with context
    severity: medium
    description: Errors need investigation and pattern analysis
    pattern:
      file_glob: "**/*.{js,ts,py}"
      match: "catch|error|exception"
      exclude: "log|console\\.error|logger|track"
    message: "Error handling may not log errors. Add structured logging for debugging."
    autofix: false

  - id: graceful-degradation
    name: Workflows should handle integration failures gracefully
    severity: medium
    description: One failure shouldn't break entire workflow
    pattern:
      file_glob: "**/*.{js,ts,py,yaml,yml}"
      match: "integration|api.*call|external.*service"
      exclude: "fallback|graceful|degrade|try.*catch|optional"
    message: "Integration may lack graceful degradation. Add fallback behavior for failures."
    autofix: false

  - id: timeout-configured
    name: API calls should have timeouts
    severity: medium
    description: Prevent hanging on slow/failed requests
    pattern:
      file_glob: "**/*.{js,ts,py}"
      match: "fetch\\(|axios\\.|request\\("
      exclude: "timeout|signal|abort"
    message: "API call may lack timeout. Add timeout to prevent hanging requests."
    autofix: false

  # Medium: Monitoring
  - id: workflow-monitoring
    name: Workflows should have health monitoring
    severity: medium
    description: Track success rate and performance
    pattern:
      file_glob: "**/*.{yaml,yml,json,js,ts,py}"
      match: "workflow|pipeline|automation"
      exclude: "monitor|metric|track|dashboard|alert"
    message: "Workflow may lack monitoring. Add success rate and performance tracking."
    autofix: false

  - id: cost-budget-limits
    name: AI workflows should have cost budget limits
    severity: medium
    description: Prevent runaway spending
    pattern:
      file_glob: "**/*.{yaml,yml,json,js,ts,py}"
      match: "openai|anthropic|gpt|claude"
      exclude: "budget|limit|max.*cost|threshold"
    message: "AI usage may lack budget limits. Set daily/monthly spending caps."
    autofix: false

  - id: performance-tracking
    name: Generated content should track performance metrics
    severity: medium
    description: Measure what works to improve over time
    pattern:
      file_glob: "**/*.{yaml,yml,json,js,ts,py}"
      match: "publish|post|send.*email|distribute"
      exclude: "track|analytics|metric|measure|performance"
    message: "Content publication may not track performance. Add analytics integration."
    autofix: false

  # Low: Quality of Life
  - id: workflow-documentation
    name: Workflows should be documented
    severity: low
    description: Team needs to understand how automation works
    pattern:
      file_glob: "**/*.{yaml,yml,json}"
      match: "workflow|pipeline"
      exclude: "description|comment|doc|readme"
    message: "Workflow may lack documentation. Add description of purpose and behavior."
    autofix: false

  - id: human-override-available
    name: Automation should allow manual override
    severity: low
    description: Humans need ability to intervene
    pattern:
      file_glob: "**/*.{yaml,yml,json,js,ts,py}"
      match: "auto.*publish|automated|pipeline"
      exclude: "manual|override|pause|stop|emergency"
    message: "Automation may lack manual override. Add ability to pause or intervene."
    autofix: false

  - id: channel-adaptation
    name: Multi-channel content should adapt per platform
    severity: low
    description: Same content everywhere feels spammy
    pattern:
      file_glob: "**/*.{yaml,yml,json,js,ts,py}"
      match: "publish.*to.*\\[|multi.*channel|cross.*post"
      exclude: "adapt|customize|format.*for|platform.*specific"
    message: "Multi-channel publishing may not adapt content. Customize for each platform."
    autofix: false

# Pre-commit checks
pre_commit:
  - id: quality-gates-exist
  - id: cost-tracking-implemented
  - id: approval-workflow-defined

# CI/CD checks
ci_checks:
  - id: quality-gates-exist
  - id: rate-limiting-implemented
  - id: retry-logic-exists
  - id: brand-compliance-check

# Production readiness gates
production_gates:
  - id: quality-gates-exist
  - id: cost-tracking-implemented
  - id: approval-workflow-defined
  - id: backup-approver-exists
  - id: rate-limiting-implemented
  - id: brand-compliance-check
  - id: workflow-monitoring
  - id: cost-budget-limits

# Workflow health checklist
workflow_health_checklist:
  quality_gates:
    - "Technical validation before generation"
    - "Output validation after generation"
    - "Brand compliance check"
    - "Platform compliance check"
    - "Human review for high-risk content"

  cost_control:
    - "Per-request cost logging"
    - "Real-time cost dashboard"
    - "Daily/monthly budget limits"
    - "Alerts at 50%, 80%, 100% of budget"
    - "Model selection optimized for cost"

  approval_workflow:
    - "Clear approval tiers (low/medium/high risk)"
    - "Backup approvers defined"
    - "SLA for approval turnaround"
    - "Auto-escalation if no response"
    - "Batch approval capability"

  error_handling:
    - "Retry logic with exponential backoff"
    - "Circuit breakers for repeated failures"
    - "Graceful degradation"
    - "Error logging with context"
    - "Alerts for critical failures"

  monitoring:
    - "Success rate tracking"
    - "Performance metrics (speed, quality)"
    - "Cost tracking and trends"
    - "Quality gate pass/fail rates"
    - "Dashboard for workflow health"

  brand_consistency:
    - "Brand term usage validation"
    - "Prohibited term blocking"
    - "Tone/voice checking"
    - "Regular brand compliance audits"
    - "Comparison to brand baseline"

  integration_resilience:
    - "Health checks before workflow starts"
    - "Fallback strategies for each integration"
    - "Timeout configuration"
    - "Integration-specific error handling"
    - "Dependency classification (critical/optional)"

  human_oversight:
    - "Sampling review process"
    - "Anomaly detection and alerts"
    - "Context awareness (news, crises)"
    - "Model version tracking"
    - "Regular calibration sessions"

# Content pipeline validation
content_pipeline_validation:
  input_stage:
    - "Required fields validation"
    - "Format validation"
    - "Budget check"
    - "Deduplication check"

  generation_stage:
    - "Prompt template versioned"
    - "Model selection appropriate"
    - "Token limits configured"
    - "Cost per request calculated"

  quality_stage:
    - "Length requirements met"
    - "Brand terms present"
    - "Prohibited terms absent"
    - "Readability score acceptable"
    - "CTA present and clear"

  approval_stage:
    - "Correct tier selected (auto/single/multi)"
    - "Reviewers notified"
    - "Deadline tracked"
    - "Escalation configured"

  distribution_stage:
    - "Platform-specific formatting"
    - "Publishing schedule respected"
    - "Deduplication across channels"
    - "Publication confirmed"
    - "Analytics tracking enabled"

  monitoring_stage:
    - "Performance metrics collected"
    - "Errors logged"
    - "Feedback captured"
    - "Continuous improvement loop"

# Cost optimization checks
cost_optimization:
  model_selection:
    - "Using cheapest model that meets quality bar"
    - "Not using GPT-4 where GPT-3.5 sufficient"
    - "Considering Claude-3-Haiku for speed+cost"

  prompt_optimization:
    - "Prompts are concise (no unnecessary examples)"
    - "Output length limited (max_tokens set appropriately)"
    - "Prompt caching used (if available)"

  caching_strategy:
    - "Common generations cached"
    - "Cache hit rate tracked"
    - "Cache invalidation strategy defined"

  failure_reduction:
    - "Input validation before API call"
    - "Retry only on transient errors"
    - "Failure patterns analyzed and fixed"

# Approval workflow validation
approval_workflow_validation:
  tier_configuration:
    - "Low-risk content defined"
    - "Medium-risk content defined"
    - "High-risk content defined"
    - "Auto-approval criteria clear"

  approver_setup:
    - "Primary approver for each tier"
    - "Backup approver for each tier"
    - "Escalation path defined"
    - "Emergency override process exists"

  sla_tracking:
    - "Turnaround time SLA set"
    - "SLA compliance tracked"
    - "Alerts for SLA violations"
    - "Bottlenecks identified and addressed"

  workflow_efficiency:
    - "Batch approval available"
    - "One-click approve/reject"
    - "Inline editing capability"
    - "Mobile-friendly review"

# Brand consistency validation
brand_consistency_validation:
  brand_voice_lock:
    - "Brand voice attributes documented"
    - "Good/bad examples provided"
    - "Prompt templates locked (version control)"
    - "Approval required for prompt changes"

  compliance_checks:
    - "Brand-specific terms list"
    - "Prohibited terms list"
    - "Tone indicators defined"
    - "Automated pattern matching"

  drift_detection:
    - "Monthly audit process"
    - "Comparison to golden examples"
    - "Edit rate tracked (indicator of drift)"
    - "Team calibration sessions"

  correction_process:
    - "Drift detection triggers investigation"
    - "Rollback capability exists"
    - "Prompt refinement process"
    - "Close monitoring after changes"

# Multi-channel distribution validation
multi_channel_validation:
  channel_adaptation:
    - "Platform-specific formatting"
    - "Tone adaptation per channel"
    - "Length optimization per platform"
    - "Media format per platform requirements"

  timing_strategy:
    - "Staggered publishing (not simultaneous)"
    - "Best times per platform"
    - "Frequency limits respected"
    - "No duplicate content same day"

  deduplication:
    - "Similarity checking across channels"
    - "Time window for deduplication"
    - "Exceptions documented (e.g., evergreen reposts)"

  testing:
    - "A/B testing per channel"
    - "Performance tracking per platform"
    - "Continuous optimization based on data"
