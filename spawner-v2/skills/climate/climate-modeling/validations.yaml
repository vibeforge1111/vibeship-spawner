validations:

  - id: single-model-projection
    name: Single Climate Model for Projections
    severity: warning
    type: regex
    pattern:
      - "load.*model.*=.*['\"][A-Z].*['\"].*ssp(?!.*ensemble|multi)"
      - "cmip6.*model\\s*=\\s*['\"][A-Z](?!.*for.*in)"
    message: "Use multi-model ensemble for projections, not single model."
    fix_action: "Load ensemble: models = ['CESM2', 'GFDL-ESM4', ...]; ensemble = load_ensemble(models)"
    applies_to:
      - "**/*.py"

  - id: no-bias-correction
    name: Raw Model Output for Impact Analysis
    severity: warning
    type: regex
    pattern:
      - "impact.*=.*model_data(?!.*bias|correct|adjust)"
      - "load_cmip.*\\.sel\\(.*\\)(?!.*bias_correct)"
    message: "Apply bias correction before using model data for impacts."
    fix_action: "Apply correction: corrected = quantile_mapping(model, obs)"
    applies_to:
      - "**/*.py"

  - id: scenario-as-prediction
    name: Scenario Presented as Prediction
    severity: info
    type: regex
    pattern:
      - "will\\s+be|will\\s+reach.*ssp(?!.*if|scenario|under)"
      - "future.*=.*(?!.*scenario|ssp.*:)"
    message: "SSP scenarios are 'what-if', not predictions. Use conditional language."
    fix_action: "Say 'Under SSP2-4.5...' not 'Temperature will be...'"
    applies_to:
      - "**/*.py"

  - id: no-calendar-check
    name: Combining Data Without Calendar Check
    severity: info
    type: regex
    pattern:
      - "concat.*model.*dim\\s*=\\s*['\"]model['\"](?!.*calendar)"
      - "merge.*cmip(?!.*convert_calendar)"
    message: "Check calendar compatibility before combining climate datasets."
    fix_action: "Check: ds.time.dt.calendar; convert if needed: ds.convert_calendar()"
    applies_to:
      - "**/*.py"

  - id: no-uncertainty-range
    name: Point Estimate Without Uncertainty Range
    severity: info
    type: regex
    pattern:
      - "print.*mean.*(?!.*range|std|p10|p90|uncertainty)"
      - "result\\s*=.*\\.mean\\(.*model.*\\)(?!.*std|quantile)"
    message: "Report uncertainty range, not just ensemble mean."
    fix_action: "Report range: f'{mean:.1f}Â°C (range: {p10:.1f} to {p90:.1f})'"
    applies_to:
      - "**/*.py"

  - id: hardcoded-baseline
    name: Hardcoded Baseline Period
    severity: info
    type: regex
    pattern:
      - "baseline.*=.*['\"](19|20)\\d{2}.*(?!.*config|param)"
      - "sel.*time=slice\\(['\"]19\\d{2}"
    message: "Make baseline period configurable for different applications."
    fix_action: "Accept parameter: baseline_period = ('1981', '2010')"
    applies_to:
      - "**/*.py"

  - id: annual-for-extremes
    name: Annual Mean for Extreme Event Analysis
    severity: warning
    type: regex
    pattern:
      - "annual.*mean.*extreme|extreme.*annual.*mean"
      - "groupby.*year.*mean.*heat|heat.*resample.*Y.*mean"
    message: "Use daily data for extreme event analysis, not annual means."
    fix_action: "Use daily: extremes = (daily_data > threshold).groupby('time.year').sum()"
    applies_to:
      - "**/*.py"

  - id: no-model-agreement
    name: Missing Model Agreement Assessment
    severity: info
    type: regex
    pattern:
      - "ensemble.*mean(?!.*agree|robust|sign)"
    message: "Assess model agreement on direction of change."
    fix_action: "Check: agreement = (ensemble > 0).mean(dim='model')"
    applies_to:
      - "**/*.py"

  - id: interpolate-precipitation
    name: Bilinear Interpolation of Precipitation
    severity: info
    type: regex
    pattern:
      - "interp.*precip.*bilinear|precip.*interp\\("
    message: "Use conservative remapping for precipitation to preserve totals."
    fix_action: "Use conservative: regridder = xe.Regridder(ds, target, 'conservative')"
    applies_to:
      - "**/*.py"
