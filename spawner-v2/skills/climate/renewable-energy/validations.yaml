validations:

  - id: stc-power-only
    name: Using STC Power Without Temperature Correction
    severity: warning
    type: regex
    pattern:
      - "power\\s*=.*rated_power\\s*\\*\\s*irradiance(?!.*temp)"
      - "p_stc\\s*\\*\\s*ghi(?!.*cell_temp|derate)"
    message: "Apply temperature derating to PV power calculations."
    fix_action: "Add: power *= (1 + temp_coeff * (cell_temp - 25))"
    applies_to:
      - "**/*.py"

  - id: single-year-wind
    name: Wind Resource From Single Year
    severity: warning
    type: regex
    pattern:
      - "wind.*=.*load.*20\\d{2}(?!.*20\\d{2}|range|multi)"
    message: "Use 10+ years of wind data for reliable resource assessment."
    fix_action: "Load multi-year: wind_data = load_data('2010-2023_wind.csv')"
    applies_to:
      - "**/*.py"

  - id: no-wake-model
    name: Wind Farm Without Wake Losses
    severity: warning
    type: regex
    pattern:
      - "farm_power\\s*=\\s*n_turbines\\s*\\*\\s*turbine_power(?!.*wake)"
      - "total.*=.*sum.*turbine(?!.*wake|deficit)"
    message: "Model wake losses for wind farms (10-20% typical)."
    fix_action: "Apply wake model: farm_power *= (1 - wake_loss_factor)"
    applies_to:
      - "**/*.py"

  - id: battery-100-efficiency
    name: Battery Assumed 100% Efficient
    severity: info
    type: regex
    pattern:
      - "energy_out\\s*=\\s*energy_in(?!.*eff)"
      - "storage.*charge.*discharge(?!.*loss|eff)"
    message: "Battery round-trip efficiency is 85-95%, not 100%."
    fix_action: "Apply efficiency: energy_out = energy_in * efficiency_rt"
    applies_to:
      - "**/*.py"

  - id: no-losses-pv
    name: PV System Without Loss Factors
    severity: info
    type: regex
    pattern:
      - "ac_power\\s*=\\s*dc_power(?!.*loss|derate|eff)"
      - "production\\s*=.*irradiance.*area(?!.*loss)"
    message: "Apply PV system losses (soiling, wiring, inverter, etc.)."
    fix_action: "Apply losses: ac_power = dc_power * (1 - total_losses)"
    applies_to:
      - "**/*.py"

  - id: hub-height-not-adjusted
    name: Wind Speed Not Extrapolated to Hub Height
    severity: warning
    type: regex
    pattern:
      - "wind_speed.*10m|10.*meter.*wind(?!.*extrap|hub|height)"
    message: "Extrapolate wind speed from measurement height to hub height."
    fix_action: "Use log law: v_hub = v_meas * log(hub_height/z0) / log(meas_height/z0)"
    applies_to:
      - "**/*.py"

  - id: capacity-factor-assumed
    name: Capacity Factor Assumed Not Calculated
    severity: info
    type: regex
    pattern:
      - "capacity_factor\\s*=\\s*0\\.\\d+(?!.*calculat|simulat)"
    message: "Calculate capacity factor from site-specific resource data."
    fix_action: "Simulate: cf = sum(hourly_power) / (rated_power * 8760)"
    applies_to:
      - "**/*.py"

  - id: no-curtailment
    name: Revenue Without Curtailment Consideration
    severity: info
    type: regex
    pattern:
      - "revenue\\s*=.*production\\s*\\*\\s*price(?!.*curtail)"
    message: "Consider curtailment risk in high renewable grids."
    fix_action: "Adjust: revenue = production * (1 - curtailment_rate) * price"
    applies_to:
      - "**/*.py"

  - id: fixed-inverter-efficiency
    name: Fixed Inverter Efficiency
    severity: info
    type: regex
    pattern:
      - "inverter_eff\\s*=\\s*0\\.9\\d(?!.*curve|loading)"
    message: "Inverter efficiency varies with loading. Use efficiency curve."
    fix_action: "Model curve: eff = f(loading) where loading = power / rated_power"
    applies_to:
      - "**/*.py"
