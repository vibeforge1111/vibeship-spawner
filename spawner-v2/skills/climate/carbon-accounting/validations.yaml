validations:

  - id: missing-scope-classification
    name: Emissions Without Scope Classification
    severity: error
    type: regex
    pattern:
      - "emissions\\s*=.*(?!scope_1|scope_2|scope_3|scope1|scope2|scope3)"
      - "co2e\\s*=.*(?!.*scope)"
    message: "All emissions must be classified by GHG Protocol scope (1, 2, or 3)."
    fix_action: "Add scope: emissions_scope1['source'] = value or use structured inventory."
    applies_to:
      - "**/*.py"

  - id: hardcoded-emission-factor
    name: Hardcoded Emission Factor Without Source
    severity: warning
    type: regex
    pattern:
      - "ef\\s*=\\s*\\d+\\.\\d+(?!.*source|epa|defra|ecoinvent)"
      - "emission_factor\\s*=\\s*\\d+(?!.*#)"
    message: "Document emission factor sources for audit trail."
    fix_action: "Add source: ef = 0.42  # EPA 2023, kg CO2/kWh, US average grid"
    applies_to:
      - "**/*.py"

  - id: missing-gwp
    name: CH4 or N2O Without GWP Conversion
    severity: warning
    type: regex
    pattern:
      - "ch4.*=.*(?!.*gwp|co2e|\\*\\s*2[78])"
      - "n2o.*=.*(?!.*gwp|co2e|\\*\\s*2[67])"
      - "methane.*=.*(?!.*convert|co2e)"
    message: "Convert CH4 and N2O to CO2e using GWP values."
    fix_action: "Apply GWP: co2e = co2 + ch4 * 27.9 + n2o * 273  # AR6 100-year"
    applies_to:
      - "**/*.py"

  - id: scope2-single-method
    name: Scope 2 Without Dual Reporting
    severity: warning
    type: regex
    pattern:
      - "scope_?2\\s*=(?!.*location|market)"
      - "electricity_emissions\\s*=(?!.*dual|both)"
    message: "GHG Protocol requires dual Scope 2 reporting (location and market-based)."
    fix_action: "Report both: scope2_location = mwh * grid_ef; scope2_market = mwh * contract_ef"
    applies_to:
      - "**/*.py"

  - id: rec-no-validation
    name: REC Applied Without Quality Check
    severity: warning
    type: regex
    pattern:
      - "rec.*applied|recs.*cover(?!.*valid|vintage|region)"
      - "market_based\\s*=\\s*0(?!.*verified|certified)"
    message: "Validate REC quality criteria before claiming zero market-based."
    fix_action: "Check: vintage matches year, region matches consumption, registry recognized."
    applies_to:
      - "**/*.py"

  - id: scope3-missing-categories
    name: Scope 3 With Limited Categories
    severity: info
    type: regex
    pattern:
      - "scope_?3\\s*=.*travel.*(?!.*purchased|goods|capital)"
      - "scope3.*=.*\\{.*\\}(?!.*screen|categor)"
    message: "Ensure all 15 Scope 3 categories are screened, not just easy ones."
    fix_action: "Screen all categories: purchased goods, capital goods, transport, waste, travel, commuting..."
    applies_to:
      - "**/*.py"

  - id: no-boundary-definition
    name: Emissions Without Organizational Boundary
    severity: warning
    type: regex
    pattern:
      - "inventory\\s*=.*(?!.*boundary|operational|equity|financial)"
      - "total_emissions\\s*=(?!.*consolidat)"
    message: "Define organizational boundary approach before calculating inventory."
    fix_action: "Define: boundary = 'operational_control' or 'equity_share' or 'financial_control'"
    applies_to:
      - "**/*.py"

  - id: baseline-no-recalculation-policy
    name: Baseline Without Recalculation Policy
    severity: info
    type: regex
    pattern:
      - "baseline\\s*=.*(?!.*recalc|adjust|policy)"
      - "base_year.*=.*20\\d{2}(?!.*trigger)"
    message: "Document baseline recalculation policy and triggers."
    fix_action: "Define policy: recalc if >5% change from M&A, methodology change, or error correction."
    applies_to:
      - "**/*.py"

  - id: intensity-metric-undefined
    name: Intensity Metric Without Normalization
    severity: info
    type: regex
    pattern:
      - "intensity\\s*=\\s*emissions(?!.*revenue|production|employee|sqft)"
      - "per_unit.*=(?!.*normali)"
    message: "Define intensity denominator clearly for comparability."
    fix_action: "Specify: intensity = emissions / revenue_million  # tCO2e per $M revenue"
    applies_to:
      - "**/*.py"

  - id: sbti-target-not-validated
    name: SBTi Target Without Pathway Validation
    severity: warning
    type: regex
    pattern:
      - "target.*=.*percent.*reduction(?!.*sbti|pathway|1\\.5|2)"
      - "reduction_target\\s*=\\s*0\\.\\d+(?!.*science|align)"
    message: "Validate that reduction targets align with SBTi-approved pathways."
    fix_action: "Validate: 1.5C requires 4.2% annual reduction; well-below 2C requires 2.5%."
    applies_to:
      - "**/*.py"

  - id: missing-uncertainty
    name: Emissions Reported Without Uncertainty
    severity: info
    type: regex
    pattern:
      - "print.*emissions.*(?!.*uncertainty|range|±)"
      - "report.*=.*total(?!.*uncertain|confidence)"
    message: "Report uncertainty ranges, especially for Scope 3 estimates."
    fix_action: "Add uncertainty: total = 50000 ± 15% (Scope 3 estimates based on spend data)."
    applies_to:
      - "**/*.py"

  - id: spend-based-no-deflator
    name: Spend-Based Scope 3 Without Inflation Adjustment
    severity: info
    type: regex
    pattern:
      - "spend.*\\*.*ef(?!.*deflat|real|adjust)"
      - "procurement.*emission(?!.*inflat)"
    message: "Adjust spend data for inflation when using economic emission factors."
    fix_action: "Deflate to base year: real_spend = nominal_spend / cpi_deflator"
    applies_to:
      - "**/*.py"
