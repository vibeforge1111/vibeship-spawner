id: risk-management-trading
skill: Risk Management for Trading
version: "1.0"

validations:
  - id: check-stop-loss-defined
    name: Stop Loss Required
    description: Every position must have a defined stop loss
    pattern: "position|entry|trade"
    file_glob: "**/*.{py,js,ts}"
    match: present
    context_pattern: "stop|stop_loss|exit"
    message: "Define stop loss for every position"
    severity: error
    autofix: false

  - id: check-position-size-calculation
    name: Position Size Calculation
    description: Position size should be calculated from risk parameters
    pattern: "position.*size|size.*position|quantity"
    file_glob: "**/*.{py,js,ts}"
    match: present
    context_pattern: "risk|account|stop"
    message: "Calculate position size from risk parameters, not arbitrary amounts"
    severity: error
    autofix: false

  - id: check-risk-percentage
    name: Risk Percentage Limits
    description: Risk per trade should be within safe bounds
    pattern: "risk.*[5-9]\\d*%|risk.*[1-9]\\d+%"
    file_glob: "**/*.{py,js,ts}"
    match: present
    message: "Risk per trade above 5% is dangerous - consider 1-2%"
    severity: warning
    autofix: false

  - id: check-leverage-limits
    name: Leverage Safety Check
    description: High leverage should be flagged
    pattern: "leverage.*[5-9]\\d*x|leverage.*[1-9]\\d+x|10x|20x|50x|100x"
    file_glob: "**/*.{py,js,ts}"
    match: present
    message: "High leverage (>5x) dramatically increases risk of ruin"
    severity: warning
    autofix: false

  - id: check-max-drawdown-limit
    name: Maximum Drawdown Limit
    description: Strategy should have defined max drawdown threshold
    pattern: "max.*drawdown|drawdown.*limit"
    file_glob: "**/*.{py,js,ts}"
    match: absent
    message: "Define maximum acceptable drawdown threshold"
    severity: warning
    autofix: false

  - id: check-correlation-analysis
    name: Correlation Analysis
    description: Multi-asset portfolios should analyze correlation
    pattern: "portfolio|multiple.*position|positions"
    file_glob: "**/*.{py,js,ts}"
    match: present
    context_pattern: "correlation|corr|covariance"
    message: "Analyze correlation for multi-asset portfolios"
    severity: info
    autofix: false

  - id: check-risk-of-ruin
    name: Risk of Ruin Calculation
    description: Systems should calculate probability of account destruction
    pattern: "backtest|system|strategy"
    file_glob: "**/*.{py,js,ts}"
    match: present
    context_pattern: "ruin|survive|survival"
    message: "Calculate risk of ruin before live trading"
    severity: info
    autofix: false

  - id: check-volatility-adjustment
    name: Volatility-Adjusted Sizing
    description: Position sizes should account for asset volatility
    pattern: "position.*size"
    file_glob: "**/*.{py,js,ts}"
    match: present
    context_pattern: "volatility|atr|vol"
    message: "Consider volatility-adjusted position sizing"
    severity: info
    autofix: false

  - id: check-slippage-modeling
    name: Slippage in Calculations
    description: Risk calculations should include slippage estimates
    pattern: "backtest|pnl|return"
    file_glob: "**/*.{py,js,ts}"
    match: present
    context_pattern: "slippage|execution.*cost"
    message: "Include slippage in risk calculations"
    severity: warning
    autofix: false

  - id: check-gap-risk
    name: Gap Risk Consideration
    description: Overnight positions should account for gap risk
    pattern: "overnight|hold.*position|swing"
    file_glob: "**/*.{py,js,ts}"
    match: present
    context_pattern: "gap|weekend|overnight.*risk"
    message: "Account for gap risk in overnight positions"
    severity: warning
    autofix: false

pre_commit:
  - id: risk-calc-test
    name: Risk Calculation Tests
    command: "python -m pytest tests/test_risk.py"
    description: Verify risk calculations are correct

  - id: position-size-test
    name: Position Sizing Tests
    command: "python -m pytest tests/test_position_sizing.py"
    description: Verify position sizing logic

ci_checks:
  - id: risk-limits-check
    name: Risk Limits Validation
    command: "python scripts/validate_risk_limits.py"
    description: Verify all risk limits are within safe bounds
    required: true

  - id: monte-carlo-test
    name: Monte Carlo Risk Analysis
    command: "python scripts/monte_carlo_risk.py"
    description: Run Monte Carlo simulation for risk assessment

  - id: correlation-analysis
    name: Portfolio Correlation Analysis
    command: "python scripts/correlation_analysis.py"
    description: Analyze portfolio correlation structure
