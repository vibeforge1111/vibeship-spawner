id: technical-analysis
skill: Technical Analysis
version: "1.0"

validations:
  - id: check-backtest-exists
    name: Backtest Validation Required
    description: Technical patterns should have statistical validation
    pattern: "pattern|setup|signal"
    file_glob: "**/*.{py,js,ts}"
    match: present
    context_pattern: "backtest|win_rate|expectancy"
    message: "Technical pattern should have backtest validation before live trading"
    severity: warning
    autofix: false

  - id: check-stop-loss-defined
    name: Stop Loss Required
    description: Every trade setup must have defined stop loss
    pattern: "entry|signal|position"
    file_glob: "**/*.{py,js,ts}"
    match: present
    context_pattern: "stop|stop_loss|risk"
    message: "Define stop loss for every trade setup"
    severity: error
    autofix: false

  - id: check-multiple-timeframes
    name: Multiple Timeframe Alignment
    description: Signals should check higher timeframe context
    pattern: "signal|entry"
    file_glob: "**/*.{py,js,ts}"
    match: present
    context_pattern: "timeframe|higher_tf|htf"
    message: "Consider higher timeframe alignment before signal generation"
    severity: warning
    autofix: false

  - id: check-volume-confirmation
    name: Volume Confirmation
    description: Breakouts and reversals should check volume
    pattern: "breakout|reversal|break"
    file_glob: "**/*.{py,js,ts}"
    match: present
    context_pattern: "volume|vol"
    message: "Consider volume confirmation for breakout/reversal signals"
    severity: info
    autofix: false

  - id: check-indicator-lag
    name: Indicator Lag Awareness
    description: Document indicator lag in signal generation
    pattern: "moving_average|MA|EMA|MACD"
    file_glob: "**/*.{py,js,ts}"
    match: present
    context_pattern: "lag|delay|late"
    message: "Document expected lag for lagging indicators"
    severity: info
    autofix: false

  - id: check-risk-reward
    name: Risk/Reward Calculation
    description: Calculate R:R for trade setups
    pattern: "target|take_profit|tp"
    file_glob: "**/*.{py,js,ts}"
    match: present
    context_pattern: "risk|reward|ratio|rr"
    message: "Calculate risk/reward ratio for trade setups"
    severity: warning
    autofix: false

  - id: check-sample-size
    name: Sufficient Sample Size
    description: Pattern validation needs adequate sample size
    pattern: "win_rate|success.*rate|probability"
    file_glob: "**/*.{py,js,ts}"
    match: present
    context_pattern: "sample|count|n\\s*=|trades"
    message: "Ensure sufficient sample size (30+ trades minimum)"
    severity: warning
    autofix: false

  - id: check-out-of-sample
    name: Out-of-Sample Testing
    description: Backtests should include out-of-sample period
    pattern: "backtest|backtesting"
    file_glob: "**/*.{py,js,ts}"
    match: present
    context_pattern: "out.*sample|oos|walk.*forward|train.*test"
    message: "Include out-of-sample testing to validate edge"
    severity: warning
    autofix: false

  - id: check-transaction-costs
    name: Transaction Costs Included
    description: Include fees and slippage in backtests
    pattern: "backtest|pnl|profit"
    file_glob: "**/*.{py,js,ts}"
    match: present
    context_pattern: "fee|commission|slippage|cost"
    message: "Include transaction costs in backtest calculations"
    severity: warning
    autofix: false

  - id: check-entry-invalidation
    name: Entry Invalidation Defined
    description: Define when a setup becomes invalid
    pattern: "setup|pattern|entry"
    file_glob: "**/*.{py,js,ts}"
    match: present
    context_pattern: "invalid|cancel|abort|expire"
    message: "Define invalidation conditions for trade setups"
    severity: info
    autofix: false

pre_commit:
  - id: indicator-test
    name: Indicator Calculation Test
    command: "python -m pytest tests/test_indicators.py"
    description: Verify indicator calculations are correct

  - id: signal-test
    name: Signal Generation Test
    command: "python -m pytest tests/test_signals.py"
    description: Verify signal generation logic

  - id: backtest-validate
    name: Backtest Validation
    command: "python scripts/validate_backtest.py"
    description: Check backtest methodology

ci_checks:
  - id: strategy-backtest
    name: Full Strategy Backtest
    command: "python scripts/run_backtest.py --validate"
    description: Run complete strategy backtest
    required: true

  - id: walk-forward
    name: Walk-Forward Analysis
    command: "python scripts/walk_forward.py"
    description: Run walk-forward optimization

  - id: cross-asset-test
    name: Cross-Asset Validation
    command: "python scripts/cross_asset_test.py"
    description: Test strategy across multiple assets
