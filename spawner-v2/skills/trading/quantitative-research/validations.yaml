id: quantitative-research
skill: Quantitative Research
version: "1.0"

validations:
  - id: check-train-test-split
    name: Train/Test Split Required
    description: Backtests must separate training and testing data
    pattern: "train|test|split|walk.*forward"
    file_glob: "**/*.{py,ipynb}"
    match: present
    context_pattern: "backtest|simulate|strategy"
    message: "Backtests require train/test split to avoid overfitting"
    severity: error
    autofix: false

  - id: check-transaction-costs
    name: Transaction Costs Included
    description: Backtests should include realistic transaction costs
    pattern: "backtest|simulate|return"
    file_glob: "**/*.{py,ipynb}"
    match: present
    context_pattern: "cost|slippage|commission|fee"
    message: "Include transaction costs in backtest - they often exceed alpha"
    severity: error
    autofix: false

  - id: check-sharpe-sanity
    name: Sharpe Ratio Sanity Check
    description: Sharpe ratios above 3 are almost certainly overfit
    pattern: "sharpe.*[4-9]\\.|sharpe.*[1-9]\\d"
    file_glob: "**/*.{py,ipynb}"
    match: present
    message: "Sharpe ratio appears unrealistically high - check for overfitting"
    severity: warning
    autofix: false

  - id: check-lookahead-shift
    name: Look-Ahead Bias Check
    description: Forward shifts on data indicate potential look-ahead bias
    pattern: "shift\\(-|\\[:-"
    file_glob: "**/*.{py,ipynb}"
    match: present
    message: "Negative shift detected - verify no look-ahead bias"
    severity: warning
    autofix: false

  - id: check-sample-size
    name: Minimum Sample Size
    description: Strategies need sufficient trades for statistical significance
    pattern: "n_trades|num_trades|trade_count"
    file_glob: "**/*.{py,ipynb}"
    match: absent
    message: "Track number of trades - need 30+ for statistical significance"
    severity: warning
    autofix: false

  - id: check-statistical-significance
    name: Statistical Significance Testing
    description: Results should include significance tests
    pattern: "t_stat|p_value|confidence|significance"
    file_glob: "**/*.{py,ipynb}"
    match: absent
    context_pattern: "backtest|strategy|alpha"
    message: "Include statistical significance testing for strategy validation"
    severity: warning
    autofix: false

  - id: check-out-of-sample
    name: Out-of-Sample Testing
    description: Strategies must be validated on out-of-sample data
    pattern: "out.*sample|oos|holdout|test.*set"
    file_glob: "**/*.{py,ipynb}"
    match: absent
    context_pattern: "backtest|validate|strategy"
    message: "Validate strategy on out-of-sample data before deployment"
    severity: warning
    autofix: false

  - id: check-survivorship-bias
    name: Survivorship Bias Awareness
    description: Strategy should account for delisted/dead assets
    pattern: "delist|survivor|dead.*asset|bankrupt"
    file_glob: "**/*.{py,ipynb}"
    match: absent
    context_pattern: "universe|constituent|index"
    message: "Consider survivorship bias if using historical universe data"
    severity: info
    autofix: false

  - id: check-regime-testing
    name: Multiple Regime Testing
    description: Strategies should be tested across market regimes
    pattern: "regime|bull|bear|volatility.*regime|market.*state"
    file_glob: "**/*.{py,ipynb}"
    match: absent
    context_pattern: "backtest|strategy|performance"
    message: "Test strategy across different market regimes (bull, bear, sideways)"
    severity: info
    autofix: false

  - id: check-parameter-count
    name: Parameter Complexity Check
    description: Too many parameters indicates potential overfitting
    pattern: "param|hyperparameter|tune|optimize"
    file_glob: "**/*.{py,ipynb}"
    match: present
    message: "Keep parameters minimal (< 5) to reduce overfitting risk"
    severity: info
    autofix: false

pre_commit:
  - id: backtest-validation
    name: Backtest Validation
    command: "python -m pytest tests/test_backtest.py -v"
    description: Verify backtest logic is correct

  - id: statistical-tests
    name: Statistical Significance Tests
    command: "python scripts/validate_significance.py"
    description: Check statistical significance of strategy results

  - id: data-quality-check
    name: Data Quality Audit
    command: "python scripts/audit_data_quality.py"
    description: Check for data errors and anomalies

ci_checks:
  - id: walk-forward-validation
    name: Walk-Forward Validation
    command: "python scripts/walk_forward_test.py"
    description: Run walk-forward analysis on all strategies
    required: true

  - id: sharpe-degradation-check
    name: Sharpe Degradation Analysis
    command: "python scripts/check_sharpe_degradation.py"
    description: Verify train vs test Sharpe ratio degradation is acceptable

  - id: transaction-cost-sensitivity
    name: Transaction Cost Sensitivity
    command: "python scripts/cost_sensitivity.py"
    description: Test strategy profitability under various cost assumptions

  - id: regime-robustness
    name: Regime Robustness Test
    command: "python scripts/regime_test.py"
    description: Test strategy across historical market regimes
