# Tech Debt Manager Validations
# Checks for patterns that indicate untracked or poorly managed technical debt

validations:
  - id: todo-without-issue
    name: TODO Without Issue Reference
    severity: info
    type: regex
    pattern:
      - "//\\s*TODO(?!.*#\\d|.*JIRA|.*ISSUE)"
      - "#\\s*TODO(?!.*#\\d|.*JIRA|.*ISSUE)"
    message: "TODO without issue reference is invisible debt. Link to tracking system."
    fix_action: "Add issue reference: // TODO(#123): Description"
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"
      - "**/*.py"

  - id: fixme-in-code
    name: FIXME Comment Found
    severity: warning
    type: regex
    pattern:
      - "//\\s*FIXME"
      - "#\\s*FIXME"
      - "/\\*\\s*FIXME"
    message: "FIXME indicates known problem. Either fix now or create tracked issue."
    fix_action: "Fix the issue or create ticket with context and remove FIXME"
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"
      - "**/*.py"

  - id: hack-comment
    name: HACK Comment Found
    severity: warning
    type: regex
    pattern:
      - "//\\s*HACK"
      - "#\\s*HACK"
      - "//\\s*XXX"
    message: "HACK/XXX indicates deliberate shortcut. Document context and create issue."
    fix_action: "Add explanation of why this hack exists and link to tracking issue"
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"
      - "**/*.py"

  - id: deprecated-usage
    name: Deprecated API Usage
    severity: info
    type: regex
    pattern:
      - "@deprecated"
      - "DEPRECATED"
      - "\\.deprecated\\("
    message: "Using deprecated API. Consider migrating to replacement."
    fix_action: "Check for recommended replacement and plan migration"
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"

  - id: temporary-solution
    name: Temporary Solution Marker
    severity: warning
    type: regex
    pattern:
      - "//\\s*[Tt]emp"
      - "//\\s*[Ww]orkaround"
      - "//\\s*[Pp]laceholder"
      - "//\\s*[Ss]tub"
    message: "Temporary solution found. Track when permanent solution is needed."
    fix_action: "Either implement permanent solution or document why temporary is acceptable"
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"

  - id: hardcoded-config
    name: Hardcoded Configuration Value
    severity: info
    type: regex
    pattern:
      - "localhost:\\d{4}"
      - "127\\.0\\.0\\.1"
      - "api\\..*\\.com"
      - "password.*=.*['\"]\\w+"
    message: "Hardcoded configuration is debt. Move to environment or config file."
    fix_action: "Extract to environment variable or configuration file"
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"
    exceptions:
      - "test"
      - "spec"
      - "mock"
      - "\\.env"

  - id: copy-paste-code
    name: Possible Copy-Paste Code
    severity: info
    type: regex
    pattern:
      - "// copied from"
      - "// same as"
      - "// duplicate of"
    message: "Copy-paste indicated. Consider extracting shared code."
    fix_action: "Extract common functionality to shared module"
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"

  - id: no-error-handling
    name: Missing Error Handling
    severity: warning
    type: regex
    pattern:
      - "catch\\s*\\([^)]*\\)\\s*\\{\\s*\\}"
      - "catch\\s*\\{\\s*\\}"
      - "\\.catch\\(\\(\\)\\s*=>\\s*\\{\\}\\)"
    message: "Empty catch block hides errors. This is hidden debt."
    fix_action: "Add proper error handling or at minimum logging"
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"

  - id: skipped-validation
    name: Validation Bypass
    severity: warning
    type: regex
    pattern:
      - "// skip validation"
      - "// no validation"
      - "// trust input"
      - "@ts-ignore"
      - "@ts-nocheck"
    message: "Skipped validation is security debt. Document why or add validation."
    fix_action: "Add proper validation or document why it's safe to skip"
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"

  - id: version-pinning-missing
    name: Unpinned Dependency Version
    severity: info
    type: regex
    pattern:
      - "\"\\*\""
      - "\"latest\""
      - "\"\\^\\d"
      - "\"~\\d"
    message: "Unpinned dependency can break unexpectedly. Pin to specific version."
    fix_action: "Pin to specific version: 1.2.3 instead of ^1.2.3"
    applies_to:
      - "**/package.json"
      - "**/requirements.txt"
    exceptions:
      - "devDependencies"

  - id: magic-number-debt
    name: Unexplained Magic Number
    severity: info
    type: regex
    pattern:
      - "===\\s*\\d{3,}[^;]*$"
      - "\\?\\s*\\d{3,}\\s*:"
      - "if\\s*\\(.*>\\s*\\d{3,}"
    message: "Magic number without explanation is maintenance debt. Add constant or comment."
    fix_action: "Extract to named constant: const MAX_RETRIES = 300"
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"

  - id: retry-without-backoff
    name: Retry Without Exponential Backoff
    severity: info
    type: regex
    pattern:
      - "retry.*\\d\\s*times"
      - "for.*retry"
      - "while.*retry"
    message: "Retry without backoff can cause cascading failures. Add exponential backoff."
    fix_action: "Add exponential backoff: delay = baseDelay * Math.pow(2, attempt)"
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"
    exceptions:
      - "backoff"
      - "exponential"

  - id: outdated-comment
    name: Potentially Outdated Comment
    severity: info
    type: regex
    pattern:
      - "// old:"
      - "// was:"
      - "// previously:"
      - "// before:"
    message: "Comment referencing old state may be outdated. Verify accuracy."
    fix_action: "Update or remove comment if no longer accurate"
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"

  - id: direct-database-query
    name: Raw SQL in Application Code
    severity: info
    type: regex
    pattern:
      - "query\\(['\"]SELECT"
      - "query\\(['\"]INSERT"
      - "query\\(['\"]UPDATE"
      - "query\\(['\"]DELETE"
    message: "Raw SQL scattered in code is maintenance debt. Consider repository pattern."
    fix_action: "Move queries to dedicated data access layer or use ORM"
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"
    exceptions:
      - "repository"
      - "dao"
      - "migration"

  - id: console-log-forgotten
    name: Console Log in Production Code
    severity: info
    type: regex
    pattern:
      - "console\\.log\\("
      - "console\\.debug\\("
      - "print\\("
    message: "Console/print statements suggest debug code left in. Use proper logging."
    fix_action: "Remove debug statements or replace with structured logging"
    applies_to:
      - "**/src/**/*.ts"
      - "**/src/**/*.tsx"
      - "**/src/**/*.js"
    exceptions:
      - "test"
      - "spec"
      - "cli"
