# Code Quality Validations
# Checks for code patterns that reduce readability and maintainability

validations:
  - id: single-letter-variable
    name: Single Letter Variable Name
    severity: warning
    type: regex
    pattern:
      - "const\\s+[a-z]\\s*="
      - "let\\s+[a-z]\\s*="
      - "var\\s+[a-z]\\s*="
    message: "Single-letter variable name provides no context. Use descriptive names."
    fix_action: "Rename to describe what the variable represents: 'u' → 'user', 'i' → 'index'"
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"
    exceptions:
      - "for\\s*\\(.*[ijk]\\s*=" # Loop counters i, j, k are OK
      - "\\(\\s*[a-z]\\s*\\)\\s*=>" # Single param arrow functions

  - id: unclear-boolean-name
    name: Boolean Without is/has/can Prefix
    severity: info
    type: regex
    pattern:
      - "const\\s+(?!is|has|can|should|will|did)[a-z]+\\s*=\\s*(?:true|false)"
      - "let\\s+(?!is|has|can|should|will|did)[a-z]+\\s*=\\s*(?:true|false)"
    message: "Boolean variable should read like a question. Use is/has/can prefix."
    fix_action: "Rename: 'active' → 'isActive', 'permission' → 'hasPermission'"
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"

  - id: deep-nesting
    name: Deeply Nested Code
    severity: warning
    type: regex
    pattern:
      - "\\{\\s*\\{\\s*\\{\\s*\\{"
      - "if\\s*\\([^)]+\\)\\s*\\{[^}]*if\\s*\\([^)]+\\)\\s*\\{[^}]*if\\s*\\([^)]+\\)\\s*\\{"
    message: "More than 3 levels of nesting. Consider guard clauses or extracting functions."
    fix_action: "Use early returns: if (!condition) return; instead of if (condition) { ... }"
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"

  - id: magic-number
    name: Magic Number
    severity: info
    type: regex
    pattern:
      - "===\\s*\\d{2,}(?!px|em|rem|%)"
      - "!==\\s*\\d{2,}(?!px|em|rem|%)"
      - "setTimeout\\([^,]+,\\s*\\d{4,}\\)"
      - "setInterval\\([^,]+,\\s*\\d{4,}\\)"
    message: "Magic number without explanation. Extract to named constant."
    fix_action: "Create constant: const THIRTY_DAYS_MS = 30 * 24 * 60 * 60 * 1000;"
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"

  - id: boolean-parameter
    name: Boolean Function Parameter
    severity: info
    type: regex
    pattern:
      - ",\\s*(?:true|false)\\s*[,)]"
    message: "Boolean parameter hides meaning. Consider named options object."
    fix_action: "Use options: doThing({ verbose: true }) instead of doThing(true)"
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"

  - id: generic-function-name
    name: Generic Function Name
    severity: warning
    type: regex
    pattern:
      - "function\\s+(?:process|handle|manage|do|execute|run)\\s*\\("
      - "const\\s+(?:process|handle|manage|do|execute|run)\\w*\\s*="
    message: "Generic function name provides no information. Use specific verbs."
    fix_action: "Be specific: 'processData' → 'validateOrderItems' or 'calculateTotals'"
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"

  - id: commented-out-code
    name: Commented Out Code
    severity: warning
    type: regex
    pattern:
      - "//\\s*(?:const|let|var|function|if|for|while|return)\\s+"
      - "//\\s*\\w+\\s*\\([^)]*\\);"
      - "/\\*[\\s\\S]*?(?:const|let|function)[\\s\\S]*?\\*/"
    message: "Commented-out code is clutter. Delete it - version control has the history."
    fix_action: "Delete commented code. If needed later, retrieve from git history."
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"

  - id: empty-function
    name: Empty Function Body
    severity: warning
    type: regex
    pattern:
      - "function\\s+\\w+\\s*\\([^)]*\\)\\s*\\{\\s*\\}"
      - "\\([^)]*\\)\\s*=>\\s*\\{\\s*\\}"
    message: "Empty function body. Add implementation or document why it's intentionally empty."
    fix_action: "Implement the function or add comment: '// Intentionally empty: placeholder for future'"
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"

  - id: long-function
    name: Function Exceeds 50 Lines
    severity: info
    type: regex
    pattern:
      - "function\\s+\\w+\\s*\\([^)]*\\)\\s*\\{[\\s\\S]{2000,}?\\}"
    message: "Long function (50+ lines). Consider extracting smaller, focused functions."
    fix_action: "Extract distinct responsibilities into separate functions."
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"

  - id: console-log-production
    name: Console.log in Production Code
    severity: warning
    type: regex
    pattern:
      - "console\\.log\\("
      - "console\\.debug\\("
      - "console\\.info\\("
    message: "Console statements in production code. Use proper logging or remove."
    fix_action: "Use structured logger: logger.info() or remove debug statements."
    applies_to:
      - "**/src/**/*.ts"
      - "**/src/**/*.tsx"
      - "**/src/**/*.js"
    exceptions:
      - "**/test/**"
      - "**/*.test.*"
      - "**/*.spec.*"

  - id: any-type
    name: TypeScript Any Type
    severity: warning
    type: regex
    pattern:
      - ":\\s*any(?:\\s|;|,|\\)|\\])"
      - "as\\s+any"
    message: "Using 'any' defeats TypeScript's type checking. Use specific types or 'unknown'."
    fix_action: "Define proper type, use 'unknown' if truly dynamic, or use type assertion."
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"

  - id: catch-and-ignore
    name: Catch Block Ignores Error
    severity: error
    type: regex
    pattern:
      - "catch\\s*\\([^)]*\\)\\s*\\{\\s*\\}"
      - "catch\\s*\\{\\s*\\}"
    message: "Empty catch block silently swallows errors. Handle or rethrow."
    fix_action: "Log the error, handle it, or rethrow. Never swallow silently."
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"

  - id: nested-ternary
    name: Nested Ternary Operator
    severity: warning
    type: regex
    pattern:
      - "\\?[^?:]*\\?[^?:]*:"
    message: "Nested ternary is hard to read. Use if/else or extract to function."
    fix_action: "Replace with if/else block or extract logic to named function."
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"

  - id: string-concatenation
    name: String Concatenation Instead of Template
    severity: info
    type: regex
    pattern:
      - "\\+\\s*['\"][^'\"]*['\"]\\s*\\+"
      - "['\"][^'\"]*['\"]\\s*\\+\\s*\\w+\\s*\\+\\s*['\"]"
    message: "String concatenation is harder to read. Use template literals."
    fix_action: "Use template: `Hello ${name}` instead of 'Hello ' + name"
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"

  - id: unnecessary-else
    name: Else After Return
    severity: info
    type: regex
    pattern:
      - "return[^;]*;\\s*\\}\\s*else\\s*\\{"
    message: "Else after return is unnecessary. Remove else block."
    fix_action: "Remove else: if (x) { return y; } doOther(); instead of else { doOther(); }"
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"

