# Code Quality Collaboration Patterns
# How code quality integrates with other foundational skills

collaboration:
  # Lead role - Code Quality drives these workflows
  leads:
    - workflow: code-review
      description: Reviewing code for quality, readability, and maintainability
      involves:
        - test-strategist: Assessing test coverage and quality
        - system-designer: Checking architectural compliance
        - debugging-master: Identifying code that will be hard to debug
      handoff_points:
        - to: test-strategist
          when: Code lacks tests or tests are poorly designed
          context_to_share: Which code paths need testing, complexity hotspots
        - to: refactoring-guide
          when: Code needs more than surface improvements
          context_to_share: Specific quality issues, suggested refactoring targets

    - workflow: code-standards
      description: Establishing and maintaining coding standards
      involves:
        - tech-debt-manager: Balancing standards with pragmatic debt
        - system-designer: Ensuring standards support architecture
      handoff_points:
        - to: tech-debt-manager
          when: Enforcing standards would create excessive churn
          context_to_share: Violations found, cost of enforcement vs acceptance

    - workflow: naming-conventions
      description: Establishing consistent naming patterns across codebase
      involves:
        - system-designer: Domain terminology alignment
        - technical-writer: Documentation consistency
      handoff_points:
        - to: technical-writer
          when: Terms need documentation for team alignment
          context_to_share: Agreed terminology, rationale for choices

  # Support role - Code Quality assists these workflows
  supports:
    - workflow: refactoring
      led_by: refactoring-guide
      contribution: Identifying quality issues to address during refactoring
      when_called: Refactoring planning, reviewing refactoring outcomes

    - workflow: debugging
      led_by: debugging-master
      contribution: Suggesting code clarity improvements that prevent future bugs
      when_called: Bug fixed, want to prevent similar issues

    - workflow: system-design
      led_by: system-designer
      contribution: Ensuring design decisions support code quality
      when_called: Design review, implementation pattern selection

    - workflow: onboarding
      led_by: technical-writer
      contribution: Code patterns and standards for new developers
      when_called: Creating onboarding materials, codebase documentation

  # Escalation patterns
  escalations:
    - situation: Quality issue requires significant refactoring
      escalate_to: refactoring-guide
      with_context: Quality issues found, suggested improvements
      reason: Needs refactoring strategy, not just quality advice

    - situation: Quality standards conflict with delivery timeline
      escalate_to: tech-debt-manager + decision-maker
      with_context: Standards at stake, technical debt implications
      reason: Need to decide acceptable debt vs quality trade-off

    - situation: Quality issue is really a design problem
      escalate_to: system-designer
      with_context: Code smell, suspected architectural root cause
      reason: Can't fix at code level, needs design change

    - situation: Quality issue caused production bug
      escalate_to: debugging-master
      with_context: Bug symptoms, code that enabled the bug
      reason: Need to understand full bug context first

  # Integration contracts
  contracts:
    with_refactoring_guide:
      code_quality_provides:
        - Specific code smells and locations
        - Severity assessment for each issue
        - Suggested improvements (high-level)
      refactoring_guide_provides:
        - Safe refactoring strategy
        - Step-by-step transformation plan
        - Testing requirements for refactoring
      interface_example: |
        # Code quality identifies issues:
        """
        FILE: src/orders/processor.ts

        ISSUES FOUND:
        1. God function (processOrder: 200 lines) - HIGH
        2. Deep nesting (5 levels) - MEDIUM
        3. Magic numbers (status codes) - LOW
        4. Mixed abstraction levels - MEDIUM

        SUGGESTED IMPROVEMENTS:
        - Extract validation, calculation, persistence
        - Use guard clauses to flatten nesting
        - Create OrderStatus enum
        """

        # Refactoring guide plans the transformation

    with_test_strategist:
      code_quality_provides:
        - Complexity hotspots needing tests
        - Code paths with insufficient coverage
        - Testability assessment
      test_strategist_provides:
        - Test coverage analysis
        - Test quality assessment
        - Testing strategy for complex code
      interface_example: |
        # Code quality identifies testability issues:
        """
        TESTABILITY CONCERNS:

        1. Hidden dependencies in OrderProcessor
           - Global config accessed directly
           - Database singleton imported
           → Needs dependency injection for testing

        2. Complex conditionals in calculateDiscount
           - 8 different paths
           - Only 3 tested
           → Needs comprehensive test matrix
        """

        # Test strategist designs test approach

    with_debugging_master:
      code_quality_provides:
        - Code patterns that hide bugs
        - Areas likely to cause debugging difficulty
        - Suggestions for debuggability improvements
      debugging_master_provides:
        - Actual bugs caused by quality issues
        - Debugging patterns to inform quality rules
        - Production context for quality priorities
      interface_example: |
        # After debugging, code quality learns:
        """
        BUG: Order total calculation wrong for 3% of orders

        ROOT CAUSE: Floating point arithmetic with money
        CODE PATTERN: price * quantity (both floats)

        PREVENTION:
        - New validation rule: money-as-float (ERROR)
        - Pattern: always use cents (integer arithmetic)
        """

        # Code quality adds to validation rules

    with_system_designer:
      code_quality_provides:
        - Implementation patterns that support architecture
        - Code organization recommendations
        - Interface design at code level
      system_designer_provides:
        - Architectural constraints for code
        - Component boundary definitions
        - Design patterns to apply
      interface_example: |
        # System designer defines component:
        """
        COMPONENT: PaymentService

        BOUNDARIES:
        - Owns: payment processing, refunds, receipts
        - Exposes: PaymentGateway interface
        - Depends: OrderService (via events), UserService (via ID)
        """

        # Code quality guides implementation:
        """
        IMPLEMENTATION GUIDANCE:

        - Interface should use domain types (not primitives)
        - Error handling: domain exceptions, not generic
        - Naming: payment domain vocabulary
        - Testing: interface contract tests required
        """

# Prerequisites for using this skill effectively
prerequisites:
  skills: []  # Foundational skill, no prerequisites
  knowledge:
    - Basic programming in any language
    - Understanding of functions and classes
    - Familiarity with version control
  tools:
    - Text editor with syntax highlighting
    - Linter (ESLint, Pylint, etc.)
    - Optional: Formatter (Prettier, Black)

# When to delegate to this skill
delegation_triggers:
  - phrase: "code quality"
    confidence: high
  - phrase: "clean code"
    confidence: high
  - phrase: "readability"
    confidence: high
  - phrase: "naming"
    confidence: high
  - phrase: "best practices"
    confidence: medium
  - phrase: "code review"
    confidence: high
  - phrase: "maintainable"
    confidence: high
  - phrase: "SOLID"
    confidence: high
  - phrase: "DRY"
    confidence: medium
  - phrase: "how should I name"
    confidence: high
  - phrase: "code smell"
    confidence: high

# Skill maturity indicators
maturity_levels:
  beginner:
    characteristics:
      - Uses meaningful variable names
      - Keeps functions reasonably short
      - Follows team conventions
    common_mistakes:
      - Over-abstracting simple code
      - Treating all guidelines as rules
      - Copy-pasting "best practices" without understanding

  intermediate:
    characteristics:
      - Applies SOLID pragmatically
      - Writes self-documenting code
      - Provides constructive code reviews
    common_mistakes:
      - Still sometimes over-engineers
      - May be too strict in reviews
      - Focuses on code over context

  advanced:
    characteristics:
      - Balances purity with pragmatism
      - Knows when to break rules
      - Improves team standards over time
    common_mistakes:
      - Assuming everyone sees the same trade-offs
      - Not documenting unconventional choices
      - Under-explaining to juniors

# Code review guidance
code_review:
  focus_areas:
    - name: Correctness
      priority: highest
      questions:
        - Does it do what it claims to do?
        - Are edge cases handled?
        - Are there obvious bugs?

    - name: Clarity
      priority: high
      questions:
        - Would I understand this in 6 months?
        - Are names descriptive?
        - Is the flow easy to follow?

    - name: Simplicity
      priority: high
      questions:
        - Is there a simpler way?
        - Is abstraction level appropriate?
        - Is anything over-engineered?

    - name: Testability
      priority: medium
      questions:
        - Is it testable?
        - Are tests included?
        - Do tests actually test the thing?

    - name: Consistency
      priority: low
      questions:
        - Does it follow team conventions?
        - Is style consistent with surroundings?
        - (Don't bike-shed on style)

  feedback_style: |
    Good code review feedback:
    - Questions over commands: "What if X happens?" vs "Handle X"
    - Explain the why: "This could cause Y because Z"
    - Acknowledge good work: "Nice handling of the edge case"
    - Prioritize: Distinguish blocking vs suggestions
    - Be kind: The author is not their code

