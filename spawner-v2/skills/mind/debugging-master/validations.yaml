# Debugging Master Validations
# Checks for code patterns that make debugging harder or indicate poor debugging practices

validations:
  - id: empty-catch-block
    name: Empty Catch Block
    severity: error
    type: regex
    pattern:
      - "catch\\s*\\([^)]*\\)\\s*\\{\\s*\\}"
      - "catch\\s*\\{\\s*\\}"
    message: "Empty catch block silently swallows errors. When something goes wrong, you'll have no idea what."
    fix_action: "Log the error, rethrow, or handle explicitly. Never swallow silently."
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"
      - "**/*.java"
      - "**/*.py"

  - id: catch-swallows-error
    name: Catch Block Ignores Error
    severity: warning
    type: regex
    pattern:
      - "catch\\s*\\(\\s*(?:e|err|error|ex|exception)\\s*\\)\\s*\\{[^}]*\\}(?!.*\\1)"
    message: "Catch block doesn't use the caught error. Log or rethrow it."
    fix_action: "At minimum, log the error with context for debugging."
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"

  - id: commented-debug-code
    name: Commented Debug Code Left Behind
    severity: warning
    type: regex
    pattern:
      - "//.*console\\.log"
      - "//.*print\\("
      - "//.*debugger"
      - "#.*print\\("
      - "#.*pdb"
    message: "Commented debug code left in file. Remove or make it proper logging."
    fix_action: "Remove debug code or convert to proper structured logging."
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"
      - "**/*.py"

  - id: debug-print-in-production
    name: Debug Print Statements
    severity: warning
    type: regex
    pattern:
      - "console\\.log\\(['\"]here"
      - "console\\.log\\(['\"]test"
      - "console\\.log\\(['\"]debug"
      - "console\\.log\\(['\"]>>>"
      - "print\\(['\"]here"
      - "print\\(['\"]test"
      - "print\\(['\"]debug"
    message: "Debug print statement likely left from debugging session."
    fix_action: "Remove debug prints or convert to proper logging."
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"
      - "**/*.py"

  - id: generic-error-message
    name: Generic Error Message
    severity: warning
    type: regex
    pattern:
      - "throw new Error\\(['\"]Error['\"]\\)"
      - "throw new Error\\(['\"]Something went wrong['\"]\\)"
      - "throw new Error\\(['\"]An error occurred['\"]\\)"
      - "raise Exception\\(['\"]Error['\"]\\)"
    message: "Generic error message provides no debugging information."
    fix_action: "Include specific context: what operation failed, why, with what inputs."
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"
      - "**/*.py"

  - id: error-without-context
    name: Error Logged Without Context
    severity: warning
    type: regex
    pattern:
      - "console\\.error\\(\\s*(?:e|err|error)\\s*\\)"
      - "logger\\.error\\(\\s*(?:e|err|error)\\s*\\)"
    message: "Error logged without context. Include what operation was attempted."
    fix_action: "Log: what was attempted, with what inputs, and the error."
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"

  - id: catch-log-rethrow
    name: Catch, Log, and Rethrow Unchanged
    severity: info
    type: regex
    pattern:
      - "catch.*\\{[^}]*(?:console|log).*throw\\s+(?:e|err|error)"
    message: "Catching, logging, and rethrowing adds noise without value."
    fix_action: "Either handle the error or let it propagate. Don't log at every level."
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"

  - id: no-correlation-id
    name: Async Operation Without Correlation
    severity: info
    type: regex
    pattern:
      - "async function.*\\{(?!.*(?:requestId|correlationId|traceId))"
    message: "Async operation without correlation ID. Hard to trace in logs."
    fix_action: "Pass correlation ID through async operations for log tracing."
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"

  - id: magic-number-condition
    name: Magic Number in Condition
    severity: warning
    type: regex
    pattern:
      - "if\\s*\\([^)]*(?:===?|!==?|[<>]=?)\\s*\\d{2,}[^\\d]"
      - "status\\s*(?:===?|!==?)\\s*\\d{3}"
    message: "Magic number in condition. When debugging, you won't know what 86400 means."
    fix_action: "Use named constants: SECONDS_PER_DAY = 86400"
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"

  - id: silent-fallback
    name: Silent Fallback to Default
    severity: warning
    type: regex
    pattern:
      - "\\|\\|\\s*\\[\\]"
      - "\\|\\|\\s*\\{\\}"
      - "\\|\\|\\s*['\"]['\"]"
      - "\\?\\..*\\|\\|"
    message: "Silent fallback hides errors. When data is missing, you want to know, not get empty defaults."
    fix_action: "Consider if missing data is actually an error that should be logged/thrown."
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"

  - id: todo-fix-comment
    name: TODO/FIXME Left in Code
    severity: info
    type: regex
    pattern:
      - "//\\s*TODO.*fix"
      - "//\\s*FIXME"
      - "//\\s*HACK"
      - "//\\s*XXX"
      - "#\\s*TODO.*fix"
      - "#\\s*FIXME"
    message: "TODO/FIXME comment indicates known issue. Track in issue tracker instead."
    fix_action: "Create issue ticket and reference it, or fix the issue."
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"
      - "**/*.py"

  - id: hardcoded-timeout
    name: Hardcoded Timeout Value
    severity: info
    type: regex
    pattern:
      - "setTimeout\\([^,]+,\\s*\\d{4,}\\)"
      - "timeout:\\s*\\d{4,}"
      - "delay:\\s*\\d{4,}"
    message: "Hardcoded timeout makes debugging timing issues difficult."
    fix_action: "Extract to named constant with comment explaining the value."
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"

  - id: unsafe-json-parse
    name: JSON Parse Without Try/Catch
    severity: warning
    type: regex
    pattern:
      - "JSON\\.parse\\([^)]+\\)(?![^;]*catch)"
    message: "JSON.parse can throw on invalid input. Unhandled, this becomes hard to debug."
    fix_action: "Wrap in try/catch with helpful error message about the source of the JSON."
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"

  - id: boolean-trap
    name: Boolean Parameter Without Name
    severity: info
    type: regex
    pattern:
      - "\\(\\s*(?:true|false)\\s*\\)"
      - ",\\s*(?:true|false)\\s*[,)]"
    message: "Boolean parameter without name. Debugging 'process(data, true, false)' is confusing."
    fix_action: "Use named parameters or options object: { strict: true, validate: false }"
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"
