# Decision Maker Validations
# Checks for code patterns that indicate undocumented decisions or decision anti-patterns

validations:
  - id: undocumented-technology-choice
    name: Technology Choice Without Comment
    severity: info
    type: regex
    pattern:
      - "new\\s+(?:Redis|Postgres|Mongo|Kafka|RabbitMQ|Elasticsearch)\\s*\\("
      - "createClient\\s*\\(\\s*\\{[^}]*\\}\\s*\\)"
      - "(?:prisma|drizzle|mongoose|sequelize)\\.\\$connect"
    message: "Technology initialization without documenting why this choice was made. Consider adding ADR or inline comment."
    fix_action: "Add comment explaining why this technology was chosen over alternatives, or link to ADR."
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"

  - id: magic-configuration
    name: Configuration Value Without Explanation
    severity: warning
    type: regex
    pattern:
      - "maxRetries:\\s*\\d+"
      - "timeout:\\s*\\d{4,}"
      - "poolSize:\\s*\\d+"
      - "batchSize:\\s*\\d+"
      - "limit:\\s*\\d{3,}"
    message: "Configuration value without explaining why this specific value was chosen."
    fix_action: "Add comment explaining the rationale: 'maxRetries: 3 // Balances reliability vs latency, based on P99 response times'"
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"
      - "**/*.yaml"
      - "**/*.yml"
      - "**/*.json"

  - id: todo-decision-needed
    name: Deferred Decision Marker
    severity: warning
    type: regex
    pattern:
      - "//\\s*TODO.*decide"
      - "//\\s*TODO.*choice"
      - "//\\s*FIXME.*which"
      - "//\\s*TBD"
      - "#\\s*TODO.*decide"
    message: "Decision explicitly deferred. Track in decision log with deadline."
    fix_action: "Either make the decision now, or document: what, deadline, default-if-not-decided."
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"
      - "**/*.py"

  - id: temporary-solution-permanent
    name: Temporary Solution Missing Deadline
    severity: warning
    type: regex
    pattern:
      - "//\\s*(?:temporary|temp|hack)(?!.*(?:until|by|deadline|date))"
      - "//\\s*(?:workaround|stopgap)(?!.*(?:until|by|deadline|date))"
      - "#\\s*(?:temporary|temp|hack)(?!.*(?:until|by|deadline|date))"
    message: "Temporary solution without expiration date. Will become permanent."
    fix_action: "Add deadline: '// TEMPORARY until 2024-Q2 - replace with proper caching layer'"
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"
      - "**/*.py"

  - id: hardcoded-decision
    name: Hardcoded Value That Should Be Configurable
    severity: info
    type: regex
    pattern:
      - "const\\s+(?:MAX|MIN|DEFAULT|LIMIT)_[A-Z_]+\\s*=\\s*\\d+"
      - "(?:maxConnections|poolSize|cacheSize)\\s*=\\s*\\d+"
    message: "Hardcoded limit that may need adjustment. Document why this value was chosen."
    fix_action: "Add comment with rationale or make configurable: 'const MAX_CONNECTIONS = 10; // Based on DB connection limits'"
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"

  - id: assumption-not-documented
    name: Assumption Without Documentation
    severity: info
    type: regex
    pattern:
      - "//\\s*(?:assume|assuming)"
      - "//\\s*(?:should be|must be|always)"
      - "#\\s*(?:assume|assuming)"
    message: "Assumption should be validated or documented as known constraint."
    fix_action: "Either add runtime validation or document in design doc/ADR why assumption is safe."
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"
      - "**/*.py"

  - id: commented-alternative
    name: Commented-Out Alternative Approach
    severity: info
    type: regex
    pattern:
      - "//\\s*Alternative:"
      - "//\\s*Could also"
      - "//\\s*Option \\d:"
      - "//\\s*or we could"
    message: "Alternative approach documented in code. Consider moving to ADR."
    fix_action: "If the alternative was considered, document in ADR. If obsolete, remove."
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"

  - id: breaking-change-undocumented
    name: Breaking Change Without Migration Note
    severity: warning
    type: regex
    pattern:
      - "//\\s*BREAKING"
      - "//\\s*breaking change"
      - "@deprecated(?!.*migration|alternative)"
    message: "Breaking change mentioned but migration path not documented."
    fix_action: "Document: what's breaking, who's affected, migration steps, timeline."
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"

  - id: revisit-marker
    name: Revisit Marker Without Trigger
    severity: info
    type: regex
    pattern:
      - "//\\s*TODO.*revisit(?!.*(?:if|when|at))"
      - "//\\s*(?:review|reconsider)\\s+later"
      - "#\\s*TODO.*revisit(?!.*(?:if|when|at))"
    message: "Revisit marker without specifying trigger condition."
    fix_action: "Add trigger: '// REVISIT when user count > 10k or latency > 500ms'"
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"
      - "**/*.py"

  - id: vendor-lock-in
    name: Vendor-Specific Code Without Abstraction
    severity: info
    type: regex
    pattern:
      - "import.*from\\s+['\"]@aws-sdk"
      - "import.*from\\s+['\"]@azure/"
      - "import.*from\\s+['\"]@google-cloud/"
      - "import.*from\\s+['\"]firebase"
    message: "Direct vendor SDK import. Document if vendor lock-in is an accepted trade-off."
    fix_action: "Either abstract behind interface for portability, or document in ADR why lock-in is acceptable."
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"

  - id: scale-assumption
    name: Scale Assumption Not Documented
    severity: info
    type: regex
    pattern:
      - "//\\s*(?:should|will)\\s+(?:scale|handle)"
      - "//\\s*(?:works for|up to)\\s+\\d+[kKmM]?"
      - "//\\s*(?:sufficient|enough)\\s+for"
    message: "Scale assumption stated but not validated or documented with limits."
    fix_action: "Document expected limits and what happens when exceeded."
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"

  - id: framework-choice-inline
    name: Framework Decision Discussed in Code
    severity: info
    type: regex
    pattern:
      - "//\\s*(?:chose|using|picked)\\s+(?:React|Vue|Next|Svelte|Angular)"
      - "//\\s*(?:instead of|over|rather than)\\s+(?:React|Vue|Next|Svelte|Angular)"
    message: "Framework decision discussed in code comments. Should be in ADR."
    fix_action: "Move rationale to docs/adr/NNNN-framework-choice.md for better discoverability."
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"

  - id: consensus-comment
    name: Team Consensus Referenced
    severity: info
    type: regex
    pattern:
      - "//\\s*(?:team|we)\\s+(?:decided|agreed)"
      - "//\\s*(?:per|as per)\\s+(?:discussion|meeting)"
    message: "Team decision referenced but not formally documented."
    fix_action: "Document in ADR with date, participants, and rationale so future team knows context."
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"

