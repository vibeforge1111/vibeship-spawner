# Refactoring Guide Validations
# Checks for patterns that indicate refactoring opportunities or risks

validations:
  - id: long-method
    name: Long Method (50+ Lines)
    severity: info
    type: regex
    pattern:
      - "function\\s+\\w+\\s*\\([^)]*\\)\\s*\\{[\\s\\S]{2000,}?\\}"
      - "\\w+\\s*=\\s*(?:async\\s*)?\\([^)]*\\)\\s*=>\\s*\\{[\\s\\S]{2000,}?\\}"
    message: "Long method is a code smell. Consider extracting smaller functions."
    fix_action: "Apply Extract Method refactoring. Each function should do one thing."
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"

  - id: long-parameter-list
    name: Long Parameter List
    severity: info
    type: regex
    pattern:
      - "function\\s+\\w+\\s*\\([^,]+,[^,]+,[^,]+,[^,]+,[^,]+,"
      - "\\w+\\s*=\\s*(?:async\\s*)?\\([^,]+,[^,]+,[^,]+,[^,]+,[^,]+,"
    message: "Many parameters (5+) is a code smell. Consider parameter object."
    fix_action: "Replace with options object: fn({ name, age, ... }) instead of fn(name, age, ...)"
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"

  - id: feature-envy
    name: Feature Envy Pattern
    severity: info
    type: regex
    pattern:
      - "\\w+\\.\\w+\\.\\w+\\.\\w+"
    message: "Deep property access suggests Feature Envy. Method might belong in different class."
    fix_action: "Consider Move Method refactoring. Method should be where data lives."
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"
    exceptions:
      - "this\\."
      - "process\\.env"
      - "window\\.location"

  - id: dead-code-function
    name: Unused Function Declaration
    severity: warning
    type: regex
    pattern:
      - "function\\s+unused\\w*\\s*\\("
      - "const\\s+unused\\w*\\s*=\\s*\\("
      - "//\\s*function\\s+\\w+\\s*\\("
    message: "Possibly unused code. Dead code should be deleted, not commented."
    fix_action: "Delete dead code. Git has the history if you ever need it."
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"

  - id: primitive-obsession-id
    name: Primitive Obsession - ID as String
    severity: info
    type: regex
    pattern:
      - "userId:\\s*string"
      - "orderId:\\s*string"
      - "productId:\\s*string"
      - "customerId:\\s*string"
    message: "IDs as bare strings lose type safety. Consider branded types."
    fix_action: "Use branded type: type UserId = string & { readonly brand: unique symbol }"
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"

  - id: data-clump
    name: Data Clump - Repeated Parameter Group
    severity: info
    type: regex
    pattern:
      - "street.*city.*zip"
      - "firstName.*lastName.*email"
      - "latitude.*longitude"
    message: "These parameters often appear together. Consider grouping into object."
    fix_action: "Extract class/type for grouped data: Address { street, city, zip }"
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"

  - id: switch-on-type
    name: Switch Statement on Type
    severity: info
    type: regex
    pattern:
      - "switch\\s*\\(\\s*\\w+\\.type\\s*\\)"
      - "switch\\s*\\(\\s*typeof\\s+"
      - "if\\s*\\([^)]*\\.type\\s*===.*\\).*else\\s+if\\s*\\([^)]*\\.type\\s*==="
    message: "Switch on type often indicates polymorphism opportunity."
    fix_action: "Consider Replace Conditional with Polymorphism refactoring."
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"

  - id: duplicate-conditional
    name: Duplicate Conditional Logic
    severity: info
    type: regex
    pattern:
      - "if\\s*\\([^)]+\\)[\\s\\S]*if\\s*\\(\\1\\)"
    message: "Same condition checked multiple times. Consider consolidating."
    fix_action: "Consolidate Conditional Expression refactoring."
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"

  - id: todo-refactor-comment
    name: Refactoring TODO Comment
    severity: info
    type: regex
    pattern:
      - "//\\s*TODO:?\\s*refactor"
      - "//\\s*FIXME:?\\s*refactor"
      - "//\\s*HACK"
      - "//\\s*XXX"
    message: "Refactoring TODO found. Consider addressing or creating a ticket."
    fix_action: "Either refactor now or create a tracked issue with context."
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"
      - "**/*.py"

  - id: commented-out-code-block
    name: Commented Out Code Block
    severity: warning
    type: regex
    pattern:
      - "/\\*[\\s\\S]*(?:function|class|const|let|var|import)[\\s\\S]*\\*/"
      - "^\\s*//.*(?:function|class|const|let).*;\\s*$"
    message: "Commented code is dead code. Delete it; use version control for history."
    fix_action: "Delete commented code. If needed, retrieve from git history."
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"

  - id: god-class
    name: God Class - Too Many Methods
    severity: info
    type: regex
    pattern:
      - "class\\s+\\w+[\\s\\S]{5000,}"
    message: "Very large class. May have too many responsibilities."
    fix_action: "Consider Extract Class refactoring. Each class should have one responsibility."
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"

  - id: speculative-generality
    name: Speculative Generality - Unused Abstraction
    severity: info
    type: regex
    pattern:
      - "interface\\s+I\\w+\\s*\\{[\\s\\S]{0,100}\\}"
      - "abstract\\s+class\\s+\\w+\\s*\\{[\\s\\S]{0,200}\\}"
    message: "Small interface or abstract class may be speculative. Verify it's used."
    fix_action: "If only one implementation exists, inline the abstraction."
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"

  - id: middleman-class
    name: Middle Man - Delegation Without Value
    severity: info
    type: regex
    pattern:
      - "return\\s+this\\.\\w+\\.\\w+\\("
      - "return\\s+this\\.delegate\\.\\w+\\("
    message: "Method just delegates to another object. Consider removing middle man."
    fix_action: "If class just delegates, consider Remove Middle Man refactoring."
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"

  - id: temporary-field
    name: Temporary Field Pattern
    severity: info
    type: regex
    pattern:
      - "this\\.temp\\w+\\s*="
      - "this\\._temp\\w*\\s*="
    message: "Temporary field suggests object is being used inconsistently."
    fix_action: "Consider Extract Class for the temporary state."
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"

  - id: refused-bequest
    name: Refused Bequest - Overriding to Throw
    severity: warning
    type: regex
    pattern:
      - "throw\\s+new\\s+(?:Error|NotImplementedError)\\(['\"].*not\\s+(?:supported|implemented)"
    message: "Throwing 'not implemented' in override suggests wrong inheritance."
    fix_action: "Consider Replace Inheritance with Delegation."
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"

  - id: inappropriate-intimacy
    name: Inappropriate Intimacy - Accessing Private Details
    severity: info
    type: regex
    pattern:
      - "\\[\\s*['\"]_\\w+['\"]\\s*\\]"
      - "\\.\\s*_private"
    message: "Accessing another object's private details breaks encapsulation."
    fix_action: "Move Method or add proper public interface."
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"

  - id: lazy-class
    name: Lazy Class - Too Small to Justify
    severity: info
    type: regex
    pattern:
      - "class\\s+\\w+\\s*\\{\\s*\\w+\\s*\\([^)]*\\)\\s*\\{[^}]{1,100}\\}\\s*\\}"
    message: "Very small class with only one method. May not justify its existence."
    fix_action: "Consider Inline Class refactoring if class doesn't pull its weight."
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
      - "**/*.jsx"
