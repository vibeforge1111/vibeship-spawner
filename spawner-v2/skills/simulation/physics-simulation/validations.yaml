validations:

  - id: euler-for-dynamics
    name: Forward Euler for Dynamics Simulation
    severity: warning
    type: regex
    pattern:
      - "y\\s*\\+=\\s*dt\\s*\\*\\s*f\\(|position\\s*\\+=\\s*velocity\\s*\\*\\s*dt(?!.*verlet)"
    message: "Forward Euler is unstable for oscillatory systems. Consider RK4 or Verlet."
    fix_action: "Use RK4 for general systems, Verlet for Hamiltonian systems"
    applies_to:
      - "**/*.py"

  - id: hardcoded-timestep
    name: Hardcoded Timestep Without Stability Check
    severity: info
    type: regex
    pattern:
      - "dt\\s*=\\s*0\\.\\d+\\s*(?!#.*stab)"
    message: "Timestep should be chosen based on system stability limits."
    fix_action: "Calculate dt from CFL condition or spring stability: dt < 2*sqrt(m/k)"
    applies_to:
      - "**/*.py"

  - id: no-damping-contact
    name: Contact Force Without Damping
    severity: info
    type: regex
    pattern:
      - "contact.*force.*=.*stiffness.*penetration(?!.*damp)"
      - "k\\s*\\*\\s*overlap(?!.*veloc)"
    message: "Contact forces without damping cause jitter. Add velocity-based damping."
    fix_action: "Add damping term: f = k*penetration + c*velocity_into_contact"
    applies_to:
      - "**/*.py"

  - id: float32-simulation
    name: Float32 for Large-Scale Simulation
    severity: info
    type: regex
    pattern:
      - "np\\.zeros.*float32.*position|dtype=np\\.float32.*coord"
    message: "Float32 loses precision at large coordinates. Consider float64."
    fix_action: "Use dtype=np.float64 for physics simulation state"
    applies_to:
      - "**/*.py"

  - id: no-substep-spring
    name: Stiff Spring Without Substepping
    severity: warning
    type: regex
    pattern:
      - "stiffness\\s*=\\s*[1-9]\\d{4,}(?!.*substep|sub_step)"
    message: "High stiffness may cause instability. Consider substepping."
    fix_action: "Substep or use implicit integration for stiff springs"
    applies_to:
      - "**/*.py"

  - id: matrix-inversion-loop
    name: Matrix Inversion Inside Loop
    severity: warning
    type: regex
    pattern:
      - "for.*:.*np\\.linalg\\.inv|while.*inv\\("
    message: "Matrix inversion inside loop is expensive. Precompute or use solve()."
    fix_action: "Use np.linalg.solve() or precompute inverse outside loop"
    applies_to:
      - "**/*.py"

  - id: unbounded-velocity
    name: Velocity Without Upper Bound
    severity: info
    type: regex
    pattern:
      - "velocity\\s*\\+=.*(?!.*clip|max|clamp)"
    message: "Unbounded velocity can cause tunneling. Consider velocity limits."
    fix_action: "Add velocity clamping: velocity = np.clip(velocity, -v_max, v_max)"
    applies_to:
      - "**/*.py"

  - id: non-normalized-direction
    name: Direction Vector Not Normalized
    severity: warning
    type: regex
    pattern:
      - "direction\\s*=\\s*\\w+\\s*-\\s*\\w+(?!.*norm|/.*norm)"
    message: "Direction vectors should be normalized before use."
    fix_action: "Normalize: direction = diff / np.linalg.norm(diff)"
    applies_to:
      - "**/*.py"
