# Collaboration - Error Handling
version: 1.0.0
skill_id: error-handling

prerequisites:
  required:
    - skill: typescript-strict
      reason: "Type-safe error handling"
      what_to_know:
        - "Discriminated unions"
        - "Type narrowing"

  recommended:
    - skill: observability
      reason: "Error logging and tracking"
      what_to_know:
        - "Structured logging"
        - "Error tracking services"

delegation_triggers:
  - trigger: "API error responses"
    delegate_to: api-design
    context: "Error response format"

  - trigger: "error logging"
    delegate_to: observability
    context: "Error tracking setup"

receives_context_from:
  - skill: api-design
    receives:
      - "Expected error format"
      - "Status code conventions"

  - skill: backend
    receives:
      - "Framework being used"
      - "Middleware patterns"

provides_context_to:
  - skill: api-design
    provides:
      - "Error class structure"
      - "Error codes"

  - skill: observability
    provides:
      - "What to log on errors"
      - "Error categorization"

collaboration_patterns:
  with_nextjs:
    when: "Next.js App Router"
    approach: |
      ## Error Handling in Next.js

      // app/error.tsx - Global error UI
      export default function Error({ error, reset }) {
        return (
          <div>
            <h2>Something went wrong</h2>
            <button onClick={reset}>Try again</button>
          </div>
        );
      }

      // app/global-error.tsx - Root layout errors
      export default function GlobalError({ error, reset }) {
        return (
          <html>
            <body>
              <h2>Something went wrong</h2>
              <button onClick={reset}>Try again</button>
            </body>
          </html>
        );
      }

      // app/not-found.tsx
      export default function NotFound() {
        return <div>Page not found</div>;
      }

  with_api_routes:
    when: "API error handling"
    approach: |
      ## API Error Response

      // lib/api-error.ts
      export class APIError extends Error {
        constructor(
          public code: string,
          message: string,
          public status: number = 400
        ) {
          super(message);
        }
      }

      // app/api/route.ts
      export async function GET() {
        try {
          const data = await getData();
          return Response.json(data);
        } catch (error) {
          if (error instanceof APIError) {
            return Response.json(
              { error: error.code, message: error.message },
              { status: error.status }
            );
          }
          return Response.json(
            { error: "INTERNAL_ERROR" },
            { status: 500 }
          );
        }
      }

ecosystem:
  error_tracking:
    - name: "Sentry"
      use_when: "Production error tracking"
    - name: "Bugsnag"
      use_when: "Alternative to Sentry"

  validation:
    - name: "zod"
      use_when: "Type-safe validation with error details"
    - name: "neverthrow"
      use_when: "Result type implementation"
