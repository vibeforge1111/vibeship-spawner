# Validations - Monorepo Management
version: 1.0.0
skill_id: monorepo-management

validations:
  - id: no-workspace-protocol
    name: Missing workspace protocol
    severity: info
    type: regex
    pattern:
      - '"@repo/.*":\s*"\^'
      - '"@monorepo/.*":\s*"\^'
    message: "Use workspace:* for internal packages"
    fix_action: "Replace version with workspace:*"
    applies_to:
      - "package.json"

  - id: missing-outputs
    name: Build task without outputs
    severity: warning
    type: regex
    pattern:
      - '"build":\s*\{[^}]*(?!"outputs")'
    message: "Build tasks should define outputs for caching"
    fix_action: "Add outputs array to task config"
    applies_to:
      - "turbo.json"

best_practices:
  structure:
    recommendation: |
      ## Recommended Structure

      monorepo/
        apps/
          web/           # Next.js frontend
          api/           # Backend API
          admin/         # Admin dashboard
        packages/
          ui/            # Shared UI components
          config-eslint/ # ESLint config
          config-ts/     # TypeScript config
          database/      # DB client + schema
          utils/         # Shared utilities
        tooling/
          scripts/       # Build scripts
        turbo.json
        pnpm-workspace.yaml
        package.json

  ci_optimization:
    recommendation: |
      ## CI Optimization

      # .github/workflows/ci.yml
      jobs:
        build:
          runs-on: ubuntu-latest
          steps:
            - uses: actions/checkout@v4
              with:
                fetch-depth: 2  # For affected detection

            - uses: pnpm/action-setup@v2

            - uses: actions/setup-node@v4
              with:
                cache: pnpm

            - run: pnpm install --frozen-lockfile

            - run: pnpm turbo build lint test
              env:
                TURBO_TOKEN: ${{ secrets.TURBO_TOKEN }}
                TURBO_TEAM: ${{ vars.TURBO_TEAM }}
