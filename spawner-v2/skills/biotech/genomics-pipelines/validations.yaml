validations:

  - id: dna-aligner-for-rna
    name: DNA Aligner Used for RNA-seq
    severity: critical
    type: regex
    pattern:
      - "bwa\\s+(mem|aln).*rna|rna.*bwa\\s+(mem|aln)"
      - "bowtie2?.*rna|rna.*bowtie2?"
      - "RNA.*bwa_mem|bwa_mem.*RNA"
    message: "Use splice-aware aligner (STAR, HISAT2) for RNA-seq, not BWA/Bowtie."
    fix_action: "Replace with: STAR --genomeDir index --readFilesIn reads.fq"
    applies_to:
      - "**/*.py"
      - "**/*.sh"
      - "**/*.nf"
      - "**/*.smk"

  - id: missing-read-groups
    name: Alignment Without Read Groups
    severity: high
    type: regex
    pattern:
      - "bwa\\s+mem(?![\\s\\S]{0,100}-R\\s+['\"]@RG)"
      - "bwa-mem2\\s+mem(?![\\s\\S]{0,100}-R\\s+['\"]@RG)"
    message: "Include read groups (-R '@RG\\tID:...') for GATK compatibility."
    fix_action: "Add: -R '@RG\\tID:sample\\tSM:sample\\tPL:ILLUMINA'"
    applies_to:
      - "**/*.py"
      - "**/*.sh"
      - "**/*.nf"

  - id: duplicate-marking-rnaseq
    name: Duplicate Marking on RNA-seq
    severity: warning
    type: regex
    pattern:
      - "MarkDuplicates.*rna|rna.*MarkDuplicates"
      - "mark.*dup.*RNA|RNA.*mark.*dup"
    message: "Consider skipping duplicate marking for RNA-seq unless using UMIs."
    applies_to:
      - "**/*.py"
      - "**/*.sh"
      - "**/*.nf"

  - id: hardcoded-genome-path
    name: Hardcoded Genome Reference Path
    severity: warning
    type: regex
    pattern:
      - "/home/[a-z]+/.*\\.fa[sta]?"
      - "/data/genomes/.*\\.fa[sta]?"
      - "C:\\\\.*\\.fa[sta]?"
    message: "Use config parameter for reference genome path, not hardcoded path."
    fix_action: "Move to params.reference or config variable"
    applies_to:
      - "**/*.py"
      - "**/*.sh"
      - "**/*.nf"
      - "**/*.smk"

  - id: missing-index-check
    name: Using Index Without Existence Check
    severity: info
    type: regex
    pattern:
      - "samtools\\s+view(?![\\s\\S]{0,200}index|bai)"
      - "\\$bam(?![\\s\\S]{0,50}\\.bai)"
    message: "Ensure BAM index exists before operations that require it."
    applies_to:
      - "**/*.py"
      - "**/*.sh"
      - "**/*.nf"

  - id: unstranded-rnaseq-default
    name: Defaulting to Unstranded for RNA-seq
    severity: info
    type: regex
    pattern:
      - "featureCounts.*-s\\s*0"
      - "--library-type\\s+unstranded"
      - "strandedness.*=.*'?none'?"
    message: "Most RNA-seq is stranded. Verify library type before defaulting to unstranded."
    applies_to:
      - "**/*.py"
      - "**/*.sh"
      - "**/*.nf"

  - id: no-multiqc-report
    name: Pipeline Without Quality Report
    severity: info
    type: regex
    pattern:
      - "workflow\\s*\\{[^}]*(?!multiqc)[^}]*\\}"
    message: "Consider adding MultiQC for unified quality reporting."
    applies_to:
      - "**/*.nf"
      - "**/*.smk"

  - id: missing-fastqc
    name: Processing FASTQ Without QC
    severity: warning
    type: regex
    pattern:
      - "(trim_galore|cutadapt|fastp)(?![\\s\\S]{0,500}fastqc)"
    message: "Run FastQC before and after trimming to verify quality."
    applies_to:
      - "**/*.py"
      - "**/*.sh"
      - "**/*.nf"

  - id: no-container-specification
    name: Nextflow Process Without Container
    severity: warning
    type: regex
    pattern:
      - "process\\s+\\w+\\s*\\{[^}]*(?!container)[^}]*\\}"
    message: "Specify container/conda for reproducibility."
    applies_to:
      - "**/*.nf"

  - id: shell-glob-in-channel
    name: Using Shell Glob Instead of Channel fromFilePairs
    severity: info
    type: regex
    pattern:
      - "Channel\\.from\\(.*\\*.*\\)"
      - "Channel\\.fromPath\\(.*_\\{1,2\\}.*\\)"
    message: "Use Channel.fromFilePairs() for paired-end reads."
    fix_action: "Channel.fromFilePairs('*_{1,2}.fastq.gz')"
    applies_to:
      - "**/*.nf"
