validations:

  - id: no-ph-check
    name: Cox Model Without PH Assumption Check
    severity: warning
    type: regex
    pattern:
      - "CoxPH.*fit(?![\\s\\S]{0,500}check_assumptions|schoenfeld)"
      - "coxph.*formula(?![\\s\\S]{0,500}cox\\.zph|proportional)"
    message: "Test proportional hazards assumption before interpreting Cox model."
    fix_action: "Add cph.check_assumptions() or cox.zph() in R"
    applies_to:
      - "**/*.py"
      - "**/*.R"
      - "**/*.ipynb"

  - id: no-multiplicity-adjustment
    name: Multiple Subgroups Without Adjustment
    severity: warning
    type: regex
    pattern:
      - "subgroup.*p.*<.*0\\.05(?![\\s\\S]{0,300}bonferroni|holm|multiplicity)"
      - "for.*subgroup.*in.*subgroups(?![\\s\\S]{0,500}adjust)"
    message: "Adjust for multiplicity when testing multiple subgroups."
    applies_to:
      - "**/*.py"
      - "**/*.R"
      - "**/*.ipynb"

  - id: no-censoring-check
    name: Survival Analysis Without Censoring Check
    severity: info
    type: regex
    pattern:
      - "KaplanMeier(?![\\s\\S]{0,500}censor|at_risk)"
      - "survfit(?![\\s\\S]{0,500}censor)"
    message: "Verify censoring is non-informative and report at-risk numbers."
    applies_to:
      - "**/*.py"
      - "**/*.R"
      - "**/*.ipynb"

  - id: hr-as-relative-risk
    name: Interpreting Hazard Ratio as Relative Risk
    severity: warning
    type: regex
    pattern:
      - "hazard.*ratio.*relative.*risk"
      - "HR.*=.*RR"
      - "risk.*reduction.*hazard"
    message: "Hazard ratio is not the same as relative risk. Don't conflate."
    applies_to:
      - "**/*.py"
      - "**/*.R"
      - "**/*.md"

  - id: missing-itm-for-crossover
    name: No Crossover Adjustment in Analysis
    severity: info
    type: regex
    pattern:
      - "crossover(?![\\s\\S]{0,500}RPSFT|IPCW|adjust)"
      - "switch.*treatment(?![\\s\\S]{0,500}sensitivity)"
    message: "Consider RPSFT or IPCW methods to adjust for treatment crossover."
    applies_to:
      - "**/*.py"
      - "**/*.R"

  - id: post-hoc-cutoff
    name: Post-Hoc Biomarker Cutoff Optimization
    severity: warning
    type: regex
    pattern:
      - "optimize.*cutoff.*biomarker"
      - "find.*best.*threshold"
      - "for.*cut.*in.*range.*p.*value"
    message: "Pre-specify biomarker cutoffs; post-hoc optimization invalidates inference."
    applies_to:
      - "**/*.py"
      - "**/*.R"
      - "**/*.ipynb"

  - id: immortal-time-risk
    name: Potential Immortal Time Bias
    severity: warning
    type: regex
    pattern:
      - "time.*from.*diagnosis.*treatment"
      - "survival.*drug.*exposure(?![\\s\\S]{0,300}landmark|time.*varying)"
    message: "Check for immortal time bias; use landmark or time-varying analysis."
    applies_to:
      - "**/*.py"
      - "**/*.R"
      - "**/*.ipynb"

  - id: no-os-safety-endpoint
    name: PFS Primary Without OS Safety
    severity: info
    type: regex
    pattern:
      - "primary.*endpoint.*PFS(?![\\s\\S]{0,500}OS.*safety)"
      - "progression.*free.*survival.*primary(?![\\s\\S]{0,500}overall.*survival)"
    message: "Per FDA 2024 guidance, pre-specify OS as safety endpoint when PFS is primary."
    applies_to:
      - "**/*.py"
      - "**/*.R"
      - "**/*.md"
