validations:

  - id: no-label-alignment
    name: NER Training Without Label Alignment
    severity: error
    type: regex
    pattern:
      - "TokenClassification(?!.*word_ids|.*align)"
      - "is_split_into_words\\s*=\\s*True(?!.*-100)"
    message: "BERT subword tokenization requires label alignment for NER."
    fix_action: "Implement tokenize_and_align_labels() with word_ids()"
    applies_to:
      - "**/*ner*.py"
      - "**/*train*.py"

  - id: entity-eval-wrong-metric
    name: NER Evaluation Without Entity-Level Metrics
    severity: warning
    type: regex
    pattern:
      - "accuracy_score.*ner|ner.*accuracy_score"
      - "f1_score(?!.*seqeval)"
    message: "Use seqeval for entity-level F1, not token-level accuracy."
    fix_action: "Use: from seqeval.metrics import classification_report, f1_score"
    applies_to:
      - "**/*eval*.py"
      - "**/*ner*.py"

  - id: relation-no-marking
    name: Relation Extraction Without Entity Markers
    severity: warning
    type: regex
    pattern:
      - "relation.*extract(?!.*\\[E1\\]|.*entity.*mark|.*special.*token)"
    message: "Mark entity spans with special tokens for relation extraction."
    fix_action: "Add entity markers: [E1] Apple [/E1] acquired [E2] Beats [/E2]"
    applies_to:
      - "**/*relation*.py"

  - id: no-negative-sampling
    name: Relation Training Without Negative Examples
    severity: warning
    type: regex
    pattern:
      - "relation.*train(?!.*no_relation|.*negative|.*none)"
    message: "Include 'no_relation' negative examples to avoid over-prediction."
    fix_action: "Add negative sampling with unrelated entity pairs"
    applies_to:
      - "**/*relation*.py"

  - id: bio-label-inconsistent
    name: Inconsistent BIO Labels
    severity: error
    type: regex
    pattern:
      - "I-\\w+(?<!B-\\w+)"
      - "'I-'(?!.*'B-')"
    message: "I- labels should only follow B- labels of the same type."
    fix_action: "Ensure BIO label consistency: B-PER followed by I-PER"
    applies_to:
      - "**/*.py"

  - id: spacy-model-not-loaded
    name: SpaCy Model Loading Issues
    severity: info
    type: regex
    pattern:
      - "spacy\\.load\\(['\"]en_core_web_\\w+['\"]\\)(?!.*try|.*except)"
    message: "Handle spacy model loading errors (model may not be installed)."
    fix_action: "Add try/except and python -m spacy download instruction"
    applies_to:
      - "**/*.py"

  - id: context-too-short
    name: Short Context for Document NLP
    severity: info
    type: regex
    pattern:
      - "max_length\\s*=\\s*\\d{1,2}\\b"
      - "max_seq_length\\s*=\\s*[1-2]\\d{2}\\b"
    message: "Short context may miss long-range dependencies. Consider Longformer for documents."
    fix_action: "Use max_length=512+ or Longformer for document-level tasks"
    applies_to:
      - "**/*.py"
