# Product Management Validations
# Automated checks to catch product specification and planning anti-patterns

validations:
  - id: pm-no-user-story
    name: Missing User Story Format
    severity: error
    type: regex
    pattern:
      - "##?\\s*Feature:\\s*\\w+(?!.{0,500}\\b(As a|As an)\\b)"
      - "##?\\s*Story:(?!.{0,200}\\b(As a|As an)\\b.{0,100}\\bI want\\b)"
    message: "Feature described without user story format. User stories connect features to user needs."
    fix_action: "Use format: 'As a [user type], I want [goal] so that [benefit]'"
    applies_to:
      - "*.md"
      - "*.txt"

  - id: pm-no-acceptance-criteria
    name: Missing Acceptance Criteria
    severity: error
    type: regex
    pattern:
      - "##?\\s*(Story|Feature|Epic):\\s*\\w+(?!.{0,800}\\b(Acceptance Criteria|AC:|Given|When|Then)\\b)"
    message: "Story lacks acceptance criteria. AC defines 'done' and prevents scope creep."
    fix_action: "Add acceptance criteria section with Given-When-Then scenarios or checklist of requirements"
    applies_to:
      - "*.md"
      - "*.txt"

  - id: pm-no-priority
    name: Missing Priority or Impact
    severity: warning
    type: regex
    pattern:
      - "##?\\s*(Story|Feature|Epic)(?!.{0,500}\\b(Priority|Impact|MoSCoW|Critical|High|Medium|Low)\\b)"
    message: "No priority level assigned. Prioritization is essential for roadmap planning."
    fix_action: "Add priority (Critical/High/Medium/Low) or impact/effort rating"
    applies_to:
      - "*.md"
      - "*.txt"

  - id: pm-scope-creep-language
    name: Scope Creep Language Detected
    severity: warning
    type: regex
    pattern:
      - "\\b(also|and also|while we're at it|might as well|plus)\\b"
      - "\\b(just add|simply|easy to|quick win)\\b.{0,50}\\b(feature|change)\\b"
    message: "Language suggesting scope creep. Adding features mid-sprint derails planning."
    fix_action: "Create separate story for additional scope. Protect current sprint commitment."
    applies_to:
      - "*.md"
      - "*.txt"

  - id: pm-no-success-metrics
    name: Missing Success Metrics
    severity: error
    type: regex
    pattern:
      - "##?\\s*(Epic|Feature|Initiative)(?!.{0,800}\\b(metric|KPI|measure|goal|target|success)\\b)"
    message: "Feature/epic without success metrics. Can't validate if solution solves the problem."
    fix_action: "Define measurable success criteria: conversion rate +X%, reduction in support tickets, etc."
    applies_to:
      - "*.md"
      - "*.txt"

  - id: pm-solution-before-problem
    name: Solution Before Problem Statement
    severity: warning
    type: regex
    pattern:
      - "##?\\s*(Feature|Story).{0,100}\\b(build|create|implement|add)\\b(?!.{0,500}\\b(Problem|Why|User need|Pain point)\\b)"
    message: "Solution described before problem. Start with user problem, not implementation."
    fix_action: "Add 'Problem' or 'User Need' section before describing solution"
    applies_to:
      - "*.md"
      - "*.txt"

  - id: pm-no-edge-cases
    name: Missing Edge Cases
    severity: warning
    type: regex
    pattern:
      - "##?\\s*Acceptance Criteria(?!.{0,500}\\b(edge case|error|failure|empty|null|zero|max|invalid)\\b)"
    message: "Acceptance criteria don't mention edge cases. Most bugs come from edge cases."
    fix_action: "Add edge cases: empty state, error handling, max limits, invalid input, network failure"
    applies_to:
      - "*.md"
      - "*.txt"

  - id: pm-vague-requirements
    name: Vague Requirements Language
    severity: error
    type: regex
    pattern:
      - "\\b(user-friendly|intuitive|easy to use|simple|clean|modern)\\b"
      - "\\b(fast|quick|responsive|performant)\\b(?!.{0,100}\\d+\\s*(ms|sec|MB))"
    message: "Vague, subjective requirements. Subjective terms are not testable."
    fix_action: "Use specific, measurable criteria: '<200ms load time', 'accessible (WCAG 2.1 AA)', '3 clicks max'"
    applies_to:
      - "*.md"
      - "*.txt"

  - id: pm-no-personas
    name: Missing User Persona
    severity: info
    type: regex
    pattern:
      - "\\b(user|customer)\\b(?!.{0,300}\\b(persona|segment|type|role|admin|creator|viewer)\\b)"
    message: "Generic 'user' without persona specificity. Different users have different needs."
    fix_action: "Specify user persona: 'admin user', 'free tier user', 'power user', etc."
    applies_to:
      - "*.md"
      - "*.txt"

  - id: pm-no-dependencies
    name: Missing Dependencies
    severity: warning
    type: regex
    pattern:
      - "##?\\s*(Epic|Feature|Story)(?!.{0,800}\\b(depends on|blocked by|requires|prerequisite|dependency)\\b)"
    message: "No dependencies mentioned. Untracked dependencies cause delays."
    fix_action: "Document dependencies: API endpoints, other features, infrastructure, third-party services"
    applies_to:
      - "*.md"
      - "*.txt"

  - id: pm-no-risks
    name: Missing Risk Assessment
    severity: info
    type: regex
    pattern:
      - "##?\\s*(Epic|Feature|Initiative)(?!.{0,1000}\\b(risk|assumption|uncertainty|unknown|question)\\b)"
    message: "No risks or assumptions documented. Unstated assumptions become costly surprises."
    fix_action: "Add 'Risks & Assumptions' section: technical unknowns, user behavior assumptions, dependencies"
    applies_to:
      - "*.md"
      - "*.txt"

  - id: pm-no-alternatives
    name: Missing Alternative Solutions
    severity: info
    type: regex
    pattern:
      - "##?\\s*Solution(?!.{0,500}\\b(alternative|option|considered|instead|vs)\\b)"
    message: "Only one solution considered. Best solutions emerge from comparing alternatives."
    fix_action: "Document 2-3 alternatives considered and why current approach was chosen"
    applies_to:
      - "*.md"
      - "*.txt"

  - id: pm-waterfall-language
    name: Waterfall Process Language
    severity: warning
    type: regex
    pattern:
      - "\\b(complete|finish|finalize)\\b.{0,50}\\b(before|then)\\b"
      - "\\b(Phase [123]|Stage [123])\\b.{0,100}\\b(must be done|complete before)\\b"
    message: "Sequential waterfall language detected. Agile favors iterative delivery with feedback loops."
    fix_action: "Break into iterative increments: MVP → iterate based on feedback → expand"
    applies_to:
      - "*.md"
      - "*.txt"
