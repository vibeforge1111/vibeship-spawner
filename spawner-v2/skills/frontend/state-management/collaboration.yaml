id: state-management-collaboration
skill: state-management
version: 1.0.0

# ============================================================================
# RECEIVES FROM (Who delegates TO this skill)
# ============================================================================
receives_from:
  - skill: frontend
    context: "Frontend needs state management solution"
    receives:
      - "Application architecture"
      - "Component structure"
      - "Data flow requirements"
    provides: "State management setup with store structure"

  - skill: react-patterns
    context: "React app needs global state"
    receives:
      - "Component hierarchy"
      - "Props drilling issues"
      - "State sharing requirements"
    provides: "Optimized state management integration"

  - skill: performance-optimization
    context: "Re-render performance issues"
    receives:
      - "Performance metrics"
      - "Re-render patterns"
      - "Component profiling data"
    provides: "Selector optimization and state structure improvements"

  - skill: testing-automation
    context: "Need to test stateful components"
    receives:
      - "Test requirements"
      - "Coverage goals"
      - "Integration test needs"
    provides: "Store mocking patterns and test utilities"

# ============================================================================
# DELEGATION TRIGGERS
# ============================================================================
delegation_triggers:
  - trigger: "server state|api caching|data fetching"
    delegate_to: backend
    pattern: parallel
    context: "Server state needs React Query/SWR, not client state"
    handoff_data:
      - "API endpoints"
      - "Caching requirements"
      - "Refetch strategies"
    receive: "React Query or SWR setup"

  - trigger: "form state|validation|form library"
    delegate_to: frontend
    pattern: parallel
    context: "Form state needs specialized library"
    handoff_data:
      - "Form requirements"
      - "Validation rules"
      - "Submit handling"
    receive: "React Hook Form or Formik setup"

  - trigger: "performance|slow|re-render|laggy"
    delegate_to: performance-optimization
    pattern: parallel
    context: "State causing performance issues"
    handoff_data:
      - "Current state structure"
      - "Selector patterns"
      - "Component tree"
    receive: "Optimization recommendations"

  - trigger: "test|testing|mock store"
    delegate_to: testing-automation
    pattern: sequential
    context: "Need to test stateful components"
    handoff_data:
      - "Store structure"
      - "Actions to test"
      - "Expected behaviors"
    receive: "Test patterns and mock setup"

  - trigger: "persist|localStorage|offline"
    delegate_to: frontend
    pattern: parallel
    context: "State persistence requirements"
    handoff_data:
      - "State to persist"
      - "Storage requirements"
      - "Rehydration needs"
    receive: "Persistence middleware configuration"

# ============================================================================
# FEEDBACK LOOPS
# ============================================================================
feedback_loops:
  receives_feedback_from:
    - skill: performance-optimization
      signal: "State causing unnecessary re-renders"
      action: "Review selector memoization, split stores, use shallow comparison"

    - skill: testing-automation
      signal: "State hard to test in isolation"
      action: "Refactor to dependency injection, add mock utilities"

    - skill: frontend
      signal: "State structure doesn't match UI needs"
      action: "Restructure state to align with component tree"

    - skill: backend
      signal: "State out of sync with server"
      action: "Add optimistic updates, implement proper invalidation"

  sends_feedback_to:
    - skill: frontend
      signal: "Too much state lifted to global"
      action: "Keep local state local, only globalize what's needed"

    - skill: performance-optimization
      signal: "State architecture optimized"
      action: "Look for other performance opportunities"

    - skill: testing-automation
      signal: "State testable with provided utilities"
      action: "Proceed with test implementation"

    - skill: backend
      signal: "Need better server state handling"
      action: "Consider React Query for server state"

# ============================================================================
# CROSS-DOMAIN INSIGHTS
# ============================================================================
cross_domain_insights:
  - domain: Performance Engineering
    insight: |
      Performance engineers know state is the #1 cause of React re-renders:
      - Every state change triggers reconciliation
      - Selectors create new references = new renders
      - Context changes re-render entire subtrees
      - Derived state recalculates on every access

      State structure determines performance ceiling.
    applies_when: "Debugging slow React applications"

  - domain: Software Architecture
    insight: |
      Architects see state as the source of truth:
      - Single source of truth prevents inconsistencies
      - Derived state should never be stored
      - State shape should mirror domain, not UI
      - Normalization reduces duplication

      Good state architecture makes bugs impossible.
    applies_when: "Designing state structure"

  - domain: Testing Engineering
    insight: |
      Test engineers need predictable state:
      - Pure reducers are trivially testable
      - Actions can be tested in isolation
      - State snapshots enable regression testing
      - DevTools enable state-based debugging

      Testable state = maintainable application.
    applies_when: "Setting up state for testability"

  - domain: DevOps/Reliability
    insight: |
      SREs care about state durability:
      - State persistence survives refreshes
      - State rehydration must handle migrations
      - State serialization enables debugging
      - State size affects bundle/memory

      State is runtime data with persistence concerns.
    applies_when: "Implementing state persistence"

# ============================================================================
# COMMON COMBINATIONS
# ============================================================================
common_combinations:
  - name: Full React App State
    skills:
      - state-management
      - frontend
      - testing-automation
    workflow: |
      1. Identify state requirements (state-management)
      2. Choose appropriate library (state-management)
      3. Design store structure (state-management)
      4. Implement components (frontend)
      5. Write state tests (testing-automation)
      6. Optimize selectors if needed

  - name: Performance-First State
    skills:
      - state-management
      - performance-optimization
      - react-patterns
    workflow: |
      1. Profile current re-renders (performance-optimization)
      2. Identify state bottlenecks (state-management)
      3. Implement selector memoization (state-management)
      4. Apply React patterns (react-patterns)
      5. Verify performance improvement

  - name: Server + Client State
    skills:
      - state-management
      - backend
      - caching-patterns
    workflow: |
      1. Separate server state from client state (state-management)
      2. Set up React Query/SWR for server state (backend)
      3. Set up Zustand/Redux for client state (state-management)
      4. Configure caching strategies (caching-patterns)
      5. Handle optimistic updates

  - name: Testable State Architecture
    skills:
      - state-management
      - testing-automation
      - code-architecture-review
    workflow: |
      1. Design testable state structure (state-management)
      2. Create store factories for tests (testing-automation)
      3. Review architecture (code-architecture-review)
      4. Implement unit tests for reducers
      5. Add integration tests for actions

# ============================================================================
# ECOSYSTEM
# ============================================================================
ecosystem:
  primary_tools:
    - "Zustand - Minimal, flexible state management"
    - "Redux Toolkit - Full-featured with DevTools"
    - "Jotai - Atomic state management"
    - "MobX - Observable-based reactive state"
    - "Recoil - Facebook's atomic state library"
    - "Valtio - Proxy-based state"

  state_libraries:
    - name: Zustand
      use_when: "Simple to medium apps, want minimal boilerplate"
      avoid_when: "Need strict patterns for large team"
      bundle_size: "~1.5KB"

    - name: Redux Toolkit
      use_when: "Large apps, need middleware ecosystem, large teams"
      avoid_when: "Small apps, want minimal setup"
      bundle_size: "~10KB"

    - name: Jotai
      use_when: "Fine-grained reactivity, atomic state, Suspense integration"
      avoid_when: "Team prefers centralized store pattern"
      bundle_size: "~2KB"

    - name: MobX
      use_when: "OOP style, automatic dependency tracking"
      avoid_when: "Prefer functional patterns, concerned about magic"
      bundle_size: "~15KB"

    - name: Recoil
      use_when: "Facebook-scale apps, complex derived state graphs"
      avoid_when: "Development has slowed, consider Jotai instead"
      bundle_size: "~20KB"

    - name: Valtio
      use_when: "Want proxy-based reactive state, simple mental model"
      avoid_when: "Need strict immutability guarantees"
      bundle_size: "~3KB"

  server_state_tools:
    - name: TanStack Query (React Query)
      use_when: "API caching, server state management"
      features: "Caching, refetching, pagination, mutations"

    - name: SWR
      use_when: "Simple data fetching with caching"
      features: "Stale-while-revalidate, focus revalidation"

    - name: RTK Query
      use_when: "Already using Redux, want integrated solution"
      features: "Code generation, cache management, Redux integration"

  devtools:
    - name: Redux DevTools
      works_with: "Redux, Zustand, any Redux-compatible store"
      features: "Time travel, action log, state diff"

    - name: React DevTools
      works_with: "All React state"
      features: "Component tree, hooks inspection, profiler"

    - name: Jotai DevTools
      works_with: "Jotai atoms"
      features: "Atom values, dependency graph"

  middleware:
    - name: redux-persist
      purpose: "Persist Redux state to storage"

    - name: zustand/middleware/persist
      purpose: "Persist Zustand state to storage"

    - name: zustand/middleware/immer
      purpose: "Immer integration for Zustand"

    - name: redux-thunk
      purpose: "Async action handling (built into RTK)"

    - name: redux-saga
      purpose: "Complex async flows with generators"

    - name: redux-observable
      purpose: "RxJS-based side effects"

