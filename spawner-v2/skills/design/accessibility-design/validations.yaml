# Accessibility Design Validations
# Automated checks to catch accessibility violations before they reach users

validations:
  - id: missing-alt-text
    name: Image Missing Alt Text
    severity: error
    type: regex
    pattern: '<img(?![^>]*alt=)[^>]*>'
    message: "Image is missing alt attribute. Screen readers cannot describe this image."
    fix_action: "Add alt='description' for informative images or alt='' for decorative images"
    applies_to:
      - "*.tsx"
      - "*.jsx"
      - "*.html"
      - "*.vue"
      - "*.svelte"
    test_cases:
      should_match:
        - '<img src="photo.jpg">'
        - '<img src="icon.png" class="icon">'
        - '<img src="/images/hero.webp" width="100">'
      should_not_match:
        - '<img src="photo.jpg" alt="Team photo">'
        - '<img src="decorative.png" alt="">'
        - '<img alt="Logo" src="logo.svg">'

  - id: empty-alt-on-link-image
    name: Empty Alt on Linked Image
    severity: error
    type: regex
    pattern: '<a[^>]*href[^>]*>\s*<img[^>]*alt=""[^>]*>\s*</a>'
    message: "Linked image has empty alt. Screen readers announce as 'link' with no context."
    fix_action: "Add descriptive alt text explaining the link destination"
    applies_to:
      - "*.tsx"
      - "*.jsx"
      - "*.html"
    test_cases:
      should_match:
        - '<a href="/"><img src="logo.png" alt=""></a>'
        - '<a href="/products"><img alt="" src="shop.jpg" /></a>'
      should_not_match:
        - '<a href="/"><img src="logo.png" alt="Home"></a>'
        - '<img alt="" src="decorative.png">'

  - id: outline-none-without-alternative
    name: Focus Outline Removed Without Alternative
    severity: error
    type: regex
    pattern: 'outline:\s*(none|0)(?![^}]*outline(?:-offset)?:)'
    message: "Focus outline removed without providing alternative focus indicator."
    fix_action: "Add :focus-visible styles with visible focus indicator (outline, box-shadow, or border)"
    applies_to:
      - "*.css"
      - "*.scss"
      - "*.tsx"
      - "*.jsx"
    test_cases:
      should_match:
        - "button:focus { outline: none; }"
        - "*:focus { outline: 0; }"
      should_not_match:
        - "button:focus { outline: none; box-shadow: 0 0 0 2px blue; }"
        - "a:focus-visible { outline: 2px solid blue; }"

  - id: positive-tabindex
    name: Positive Tabindex Value
    severity: error
    type: regex
    pattern: 'tabindex="[1-9][0-9]*"|tabindex={[1-9][0-9]*}'
    message: "Positive tabindex creates unpredictable tab order. Use only 0 or -1."
    fix_action: "Change to tabindex='0' (adds to tab order) or tabindex='-1' (programmatic focus only)"
    applies_to:
      - "*.tsx"
      - "*.jsx"
      - "*.html"
      - "*.vue"
    test_cases:
      should_match:
        - 'tabindex="5"'
        - 'tabindex={10}'
        - 'tabindex="100"'
      should_not_match:
        - 'tabindex="0"'
        - 'tabindex="-1"'
        - 'tabindex={0}'

  - id: input-without-label
    name: Form Input Without Associated Label
    severity: error
    type: regex
    pattern: '<input(?![^>]*(?:aria-label|aria-labelledby|id="[^"]+"))[^>]*(?:type="(?:text|email|password|search|tel|url|number)")[^>]*>'
    message: "Form input missing accessible label. Screen readers cannot identify this field."
    fix_action: "Add <label for='id'> or aria-label or aria-labelledby attribute"
    applies_to:
      - "*.tsx"
      - "*.jsx"
      - "*.html"
    test_cases:
      should_match:
        - '<input type="text" name="email">'
        - '<input type="password" placeholder="Password">'
      should_not_match:
        - '<input type="text" id="email" aria-label="Email">'
        - '<input type="text" id="name" aria-labelledby="name-label">'

  - id: button-without-text
    name: Button Without Accessible Text
    severity: error
    type: regex
    pattern: '<button[^>]*>\s*<(?:svg|img|i|span)[^>]*(?:/>|>[^<]*</(?:svg|img|i|span)>)\s*</button>'
    message: "Button contains only icon/image with no accessible text."
    fix_action: "Add aria-label, visually-hidden text, or meaningful alt text to button"
    applies_to:
      - "*.tsx"
      - "*.jsx"
      - "*.html"
    test_cases:
      should_match:
        - '<button><svg></svg></button>'
        - '<button><img src="icon.png" /></button>'
        - '<button><i class="icon-close"></i></button>'
      should_not_match:
        - '<button aria-label="Close"><svg></svg></button>'
        - '<button><svg></svg><span class="sr-only">Close</span></button>'

  - id: aria-hidden-on-interactive
    name: Aria-hidden on Interactive Element
    severity: error
    type: regex
    pattern: 'aria-hidden="true"[^>]*(?:onclick|href="|tabindex="0")|(?:onclick|href="|tabindex="0")[^>]*aria-hidden="true"'
    message: "Interactive element hidden from screen readers but visible to sighted users."
    fix_action: "Remove aria-hidden or make element non-interactive"
    applies_to:
      - "*.tsx"
      - "*.jsx"
      - "*.html"
    test_cases:
      should_match:
        - '<a href="/page" aria-hidden="true">Link</a>'
        - '<button aria-hidden="true" onclick="handleClick()">Click</button>'
        - '<div tabindex="0" aria-hidden="true" onclick="go()">Go</div>'
      should_not_match:
        - '<svg aria-hidden="true"></svg>'
        - '<span aria-hidden="true">decorative</span>'

  - id: autoplay-without-muted
    name: Autoplay Media Without Muted
    severity: error
    type: regex
    pattern: '<(?:video|audio)[^>]*autoplay(?![^>]*muted)[^>]*>'
    message: "Media autoplays with sound. Interferes with screen readers and startles users."
    fix_action: "Add 'muted' attribute or remove 'autoplay'"
    applies_to:
      - "*.tsx"
      - "*.jsx"
      - "*.html"
    test_cases:
      should_match:
        - '<video autoplay src="video.mp4">'
        - '<audio autoplay>'
      should_not_match:
        - '<video autoplay muted src="video.mp4">'
        - '<video muted autoplay playsinline>'

  - id: missing-html-lang
    name: Missing HTML Lang Attribute
    severity: error
    type: regex
    pattern: '<html(?![^>]*lang=)[^>]*>'
    message: "HTML element missing lang attribute. Screen readers cannot determine pronunciation."
    fix_action: "Add lang attribute to html element, e.g., <html lang='en'>"
    applies_to:
      - "*.html"
      - "index.html"
      - "layout.tsx"
      - "layout.jsx"
    test_cases:
      should_match:
        - '<html>'
        - '<html class="dark">'
      should_not_match:
        - '<html lang="en">'
        - '<html lang="es" dir="ltr">'

  - id: role-button-no-keyboard
    name: Role Button Without Keyboard Handler
    severity: error
    type: regex
    pattern: 'role="button"(?![^>]*(?:onkeydown|onkeypress|onkeyup))[^>]*>'
    message: "Element has button role but no keyboard event handler. Keyboard users cannot activate."
    fix_action: "Add onKeyDown handler for Enter and Space keys, or use native <button> element"
    applies_to:
      - "*.tsx"
      - "*.jsx"
      - "*.html"
    test_cases:
      should_match:
        - '<div role="button" onClick={handleClick}>Click</div>'
        - '<span role="button" tabindex="0">Action</span>'
      should_not_match:
        - '<div role="button" onClick={handleClick} onKeyDown={handleKey}>Click</div>'
        - '<button>Click</button>'

  - id: low-contrast-text
    name: Potentially Low Contrast Text
    severity: warning
    type: regex
    pattern: 'text-gray-[34]00|text-slate-[34]00|color:\s*#[9abc][9abc][9abc]|color:\s*#(?:ccc|ddd|eee)'
    message: "Text color may fail WCAG contrast requirements (4.5:1 for normal text)."
    fix_action: "Use darker text color. Check with contrast checker tool."
    applies_to:
      - "*.tsx"
      - "*.jsx"
      - "*.css"
    test_cases:
      should_match:
        - 'text-gray-400'
        - 'text-slate-300'
        - 'color: #aaa'
        - 'color: #ccc'
      should_not_match:
        - 'text-gray-600'
        - 'text-slate-700'
        - 'color: #333'

  - id: onclick-only-handler
    name: Click Handler Without Keyboard Alternative
    severity: warning
    type: regex
    pattern: '<div[^>]*onclick(?![^>]*(?:onkeydown|onkeypress|tabindex))[^>]*>'
    message: "Div has click handler but no keyboard accessibility. Use button or add keyboard handler."
    fix_action: "Replace with <button>, or add tabindex='0' and onKeyDown handler"
    applies_to:
      - "*.tsx"
      - "*.jsx"
      - "*.html"
    test_cases:
      should_match:
        - '<div onclick="handleClick()">Click me</div>'
        - '<div onClick={handler} className="btn">Action</div>'
      should_not_match:
        - '<div onclick="go()" tabindex="0" onkeydown="key(event)">Go</div>'
        - '<button onclick="go()">Go</button>'

  - id: placeholder-only-label
    name: Input With Placeholder But No Label
    severity: warning
    type: regex
    pattern: '<input[^>]*placeholder="[^"]+(?:"[^>]*(?!aria-label|<label)[^>]*/?>|"[^>]*>(?!</label))'
    message: "Input uses placeholder as only label. Placeholder disappears when typing."
    fix_action: "Add visible <label> or aria-label. Placeholder is a hint, not a label."
    applies_to:
      - "*.tsx"
      - "*.jsx"
      - "*.html"
    test_cases:
      should_match:
        - '<input placeholder="Email address" type="email" />'
      should_not_match:
        - '<input placeholder="you@example.com" aria-label="Email" />'
        - '<label for="email">Email</label><input id="email" placeholder="you@example.com" />'

  - id: missing-skip-link
    name: No Skip Link to Main Content
    severity: warning
    type: regex
    pattern: '<body[^>]*>(?:(?!</a[^>]*#main).)*<main'
    message: "Page has navigation before main content but no skip link."
    fix_action: "Add skip link as first focusable element: <a href='#main-content' class='skip-link'>Skip to content</a>"
    applies_to:
      - "*.html"
      - "layout.tsx"
      - "layout.jsx"
    test_cases:
      should_match:
        - '<body><header><nav>...</nav></header><main>'
      should_not_match:
        - '<body><a href="#main" class="skip">Skip</a><header>...</header><main id="main">'

  - id: color-only-required
    name: Required Field Indicated By Color Only
    severity: warning
    type: regex
    pattern: '<span[^>]*(?:class="[^"]*(?:text-red|color-red)[^"]*"|style="[^"]*color:\s*red[^"]*")[^>]*>\s*\*\s*</span>'
    message: "Required field indicator uses only color. Colorblind users may miss it."
    fix_action: "Add text '(required)' or aria-describedby explaining the asterisk"
    applies_to:
      - "*.tsx"
      - "*.jsx"
      - "*.html"
    test_cases:
      should_match:
        - '<span class="text-red-500">*</span>'
        - '<span style="color: red">*</span>'
      should_not_match:
        - '<span class="text-red-500" aria-hidden="true">*</span><span class="sr-only">required</span>'

  - id: empty-link-text
    name: Link Without Accessible Text
    severity: error
    type: regex
    pattern: '<a[^>]*href[^>]*>\s*</a>|<a[^>]*href[^>]*>\s*<(?:svg|img|i)[^>]*/>\s*</a>'
    message: "Link has no accessible text. Screen readers announce only 'link'."
    fix_action: "Add link text, aria-label, or alt text on image inside link"
    applies_to:
      - "*.tsx"
      - "*.jsx"
      - "*.html"
    test_cases:
      should_match:
        - '<a href="/"></a>'
        - '<a href="/search"><svg></svg></a>'
        - '<a href="/home"><i class="icon-home" /></a>'
      should_not_match:
        - '<a href="/">Home</a>'
        - '<a href="/search" aria-label="Search"><svg></svg></a>'
        - '<a href="/home"><img src="home.png" alt="Home" /></a>'

  - id: missing-form-error-association
    name: Form Error Not Associated With Input
    severity: warning
    type: regex
    pattern: '<(?:span|div|p)[^>]*(?:class="[^"]*error[^"]*"|role="alert")[^>]*>(?:(?!aria-describedby|aria-errormessage).)*</(?:span|div|p)>'
    message: "Error message not programmatically associated with input."
    fix_action: "Connect error to input using aria-describedby='error-id' on input and id='error-id' on error message"
    applies_to:
      - "*.tsx"
      - "*.jsx"
      - "*.html"

  - id: dialog-no-label
    name: Dialog Without Accessible Label
    severity: error
    type: regex
    pattern: '<(?:dialog|div[^>]*role="dialog")[^>]*(?!aria-label|aria-labelledby)[^>]*>'
    message: "Dialog/modal missing accessible label. Screen readers cannot identify it."
    fix_action: "Add aria-labelledby pointing to dialog title, or aria-label"
    applies_to:
      - "*.tsx"
      - "*.jsx"
      - "*.html"
    test_cases:
      should_match:
        - '<dialog>'
        - '<div role="dialog">'
      should_not_match:
        - '<dialog aria-labelledby="dialog-title">'
        - '<div role="dialog" aria-label="Confirm deletion">'
