id: design-systems
skill: Design Systems
version: "1.0"

validations:
  - id: hardcoded-colors
    name: Hardcoded Color Values
    description: Colors should use design tokens, not hardcoded hex/rgb values
    pattern: "(#[0-9a-fA-F]{3,8}|rgb\\(|rgba\\(|hsl\\(|hsla\\()"
    file_glob: "**/*.{css,scss,less,tsx,jsx,ts,js}"
    match: present
    exclude_pattern: "(var\\(--|theme\\.|tokens\\.|colors\\.)"
    message: "Hardcoded color found. Use design token instead: var(--color-*)"
    severity: warning
    autofix: false
    test_cases:
      should_match:
        - "background: #3B82F6;"
        - "color: rgb(59, 130, 246);"
        - "border-color: rgba(0, 0, 0, 0.1);"
        - "backgroundColor: '#2563EB'"
        - "fill: hsl(220, 90%, 56%);"
      should_not_match:
        - "background: var(--color-primary);"
        - "color: theme.colors.primary"
        - "backgroundColor: colors.blue[500]"
        - "/* #3B82F6 is primary blue */"

  - id: hardcoded-spacing
    name: Hardcoded Spacing Values
    description: Spacing should use design tokens, not arbitrary pixel values
    pattern: "(?<!line-height:\\s*)(\\d+)px"
    file_glob: "**/*.{css,scss,less}"
    match: present
    exclude_pattern: "(var\\(--|spacing\\.|space\\.)"
    message: "Hardcoded spacing found. Use spacing token: var(--spacing-*)"
    severity: info
    autofix: false
    test_cases:
      should_match:
        - "padding: 16px;"
        - "margin: 24px 12px;"
        - "gap: 8px;"
        - "width: 200px;"
      should_not_match:
        - "padding: var(--spacing-md);"
        - "margin: var(--spacing-lg);"
        - "line-height: 24px;"
        - "/* 16px is our base unit */"

  - id: missing-component-docs
    name: Missing Component Documentation
    description: Components should have JSDoc documentation
    pattern: "export\\s+(const|function)\\s+[A-Z][a-zA-Z]+\\s*[=\\(]"
    file_glob: "**/components/**/*.{tsx,jsx}"
    match: present
    context_pattern: "/\\*\\*[\\s\\S]*?\\*/"
    message: "Component missing JSDoc documentation. Add description, props, and example."
    severity: warning
    autofix: false
    test_cases:
      should_match:
        - "export const Button = ("
        - "export function Card({"
        - "export const TextField = forwardRef("
      should_not_match:
        - "const helper = ("
        - "function internalUtil("

  - id: missing-display-name
    name: Missing Display Name for forwardRef
    description: forwardRef components need displayName for debugging
    pattern: "forwardRef\\s*<"
    file_glob: "**/*.{tsx,jsx}"
    match: present
    context_pattern: "\\.displayName\\s*="
    context_lines_after: 20
    message: "forwardRef component missing displayName. Add: Component.displayName = 'Component'"
    severity: warning
    autofix: false
    test_cases:
      should_match:
        - "forwardRef<HTMLButtonElement, ButtonProps>"
        - "forwardRef<HTMLInputElement>((props, ref)"

  - id: div-onclick-antipattern
    name: Clickable Div Anti-pattern
    description: Clickable elements should be buttons, not divs
    pattern: "<div[^>]*onClick"
    file_glob: "**/*.{tsx,jsx}"
    match: present
    message: "Clickable div found. Use <button> or add role='button', tabIndex, keyboard handlers."
    severity: error
    autofix: false
    test_cases:
      should_match:
        - "<div onClick={handleClick}>"
        - "<div className='btn' onClick={click}>"
      should_not_match:
        - "<button onClick={handleClick}>"
        - "<div role='button' tabIndex={0} onClick={handleClick}>"

  - id: missing-focus-styles
    name: Missing Focus Visible Styles
    description: Interactive elements need visible focus styles for keyboard users
    pattern: "focus:"
    file_glob: "**/*.{tsx,jsx,css,scss}"
    match: absent
    context_pattern: "(button|input|select|a|\\[role)"
    message: "Focus styles may be missing. Add focus-visible ring for keyboard accessibility."
    severity: warning
    autofix: false
    test_cases:
      should_not_match:
        - "focus:ring-2 focus:ring-offset-2"
        - "focus-visible:outline"
        - "&:focus-visible { outline: 2px solid"

  - id: important-override
    name: CSS Important Override
    description: Avoid !important - indicates specificity problems
    pattern: "!important"
    file_glob: "**/*.{css,scss,less}"
    match: present
    message: "!important found. Refactor to avoid specificity issues."
    severity: warning
    autofix: false
    test_cases:
      should_match:
        - "color: red !important;"
        - "display: none !important"
      should_not_match:
        - "/* sometimes !important is needed */"

  - id: inconsistent-token-naming
    name: Inconsistent Token Naming
    description: Token names should follow category-property-variant pattern
    pattern: "--[a-zA-Z]+[A-Z]|--[a-z]+_[a-z]+|--[A-Z]"
    file_glob: "**/*.{css,scss,ts,js}"
    match: present
    message: "Inconsistent token naming. Use kebab-case: --category-property-variant"
    severity: warning
    autofix: false
    test_cases:
      should_match:
        - "--colorPrimary"
        - "--color_primary"
        - "--ColorPrimary"
        - "--textColor"
      should_not_match:
        - "--color-primary"
        - "--color-text-muted"
        - "--spacing-md"

  - id: missing-aria-label
    name: Missing Accessible Name
    description: Icon-only buttons need aria-label
    pattern: "<(button|Button)[^>]*>[^<]*<(Icon|svg|img)[^>]*/?>[^<]*</(button|Button)>"
    file_glob: "**/*.{tsx,jsx}"
    match: present
    context_pattern: "aria-label"
    message: "Icon-only button missing aria-label. Add aria-label for screen readers."
    severity: error
    autofix: false
    test_cases:
      should_match:
        - "<button><Icon /></button>"
        - "<Button><CloseIcon /></Button>"
      should_not_match:
        - "<button aria-label='Close'><Icon /></button>"
        - "<button><Icon /> Close</button>"

  - id: missing-loading-state
    name: Missing Loading State in Async Buttons
    description: Buttons triggering async actions should have loading state
    pattern: "(onClick|onSubmit)[^}]*await"
    file_glob: "**/*.{tsx,jsx}"
    match: present
    context_pattern: "(loading|isLoading|pending)"
    message: "Async action without loading state. Add loading prop to prevent double-clicks."
    severity: info
    autofix: false
    test_cases:
      should_match:
        - "onClick={async () => { await submit(); }}"
        - "onSubmit={async (e) => { await handleSubmit(); }}"

  - id: missing-error-boundary
    name: Missing Error Boundary
    description: Component sections should have error boundaries
    pattern: "export\\s+(default\\s+)?function\\s+[A-Z][a-zA-Z]*Page"
    file_glob: "**/pages/**/*.{tsx,jsx}"
    match: present
    context_pattern: "ErrorBoundary"
    message: "Page component may need error boundary for resilience."
    severity: info
    autofix: false

  - id: token-primitive-in-component
    name: Primitive Token Used Directly
    description: Components should use semantic tokens, not primitives
    pattern: "(blue|red|green|gray|slate|zinc)-(50|100|200|300|400|500|600|700|800|900)"
    file_glob: "**/*.{tsx,jsx,css,scss}"
    match: present
    message: "Primitive color token used directly. Use semantic token (color-primary, color-text-muted)."
    severity: warning
    autofix: false
    test_cases:
      should_match:
        - "text-blue-500"
        - "bg-gray-100"
        - "border-red-600"
      should_not_match:
        - "text-primary"
        - "bg-background"
        - "border-error"

  - id: magic-number-z-index
    name: Magic Z-Index Values
    description: Z-index should use defined scale, not magic numbers
    pattern: "z-index:\\s*\\d{2,}"
    file_glob: "**/*.{css,scss}"
    match: present
    message: "Magic z-index found. Use z-index scale: var(--z-dropdown), var(--z-modal), etc."
    severity: info
    autofix: false
    test_cases:
      should_match:
        - "z-index: 9999;"
        - "z-index: 100;"
        - "z-index: 50;"
      should_not_match:
        - "z-index: var(--z-modal);"
        - "z-index: 1;"
        - "z-index: -1;"

pre_commit:
  - id: token-lint
    name: Token Naming Lint
    command: "node scripts/lint-tokens.js"
    description: Verify token names follow naming convention

  - id: a11y-check
    name: Accessibility Check
    command: "npx eslint --ext .tsx,.jsx --rule 'jsx-a11y/***:error'"
    description: Run accessibility linting rules

  - id: component-docs
    name: Component Documentation Check
    command: "node scripts/check-component-docs.js"
    description: Verify all components have documentation

ci_checks:
  - id: visual-regression
    name: Visual Regression Test
    command: "npx playwright test --grep @visual"
    description: Run visual regression tests for components
    required: true

  - id: a11y-audit
    name: Accessibility Audit
    command: "npx axe-cli http://localhost:6006"
    description: Run axe accessibility audit on Storybook
    required: true

  - id: bundle-analysis
    name: Bundle Size Analysis
    command: "npx size-limit"
    description: Check bundle size limits
    required: false

  - id: token-drift
    name: Token Drift Detection
    command: "node scripts/detect-token-drift.js"
    description: Check for Figma-code token drift
    required: false

  - id: unused-components
    name: Unused Component Detection
    command: "node scripts/find-unused-components.js"
    description: Identify components with zero usage
    required: false

storybook_checks:
  - id: all-states-story
    name: All States Story Required
    description: Every component must have an AllStates story showing all variants
    pattern: "AllStates"
    file_glob: "**/*.stories.{tsx,jsx}"
    message: "Add 'AllStates' story showing all component states and variants"

  - id: accessibility-story
    name: Accessibility Story Required
    description: Every component must have accessibility documentation
    pattern: "(Accessibility|A11y)"
    file_glob: "**/*.stories.{tsx,jsx}"
    message: "Add accessibility story documenting keyboard nav and screen reader behavior"
