# Typography Validations
# Automated checks to catch typography anti-patterns

validations:
  - id: missing-font-display
    name: Missing font-display in @font-face
    severity: error
    type: regex
    pattern: '@font-face\s*\{(?![^}]*font-display)[^}]*\}'
    message: "@font-face missing font-display property, will cause invisible text (FOIT) during loading."
    fix_action: "Add font-display: swap; (or optional for non-critical fonts) to @font-face rule"
    applies_to:
      - "*.css"
      - "*.scss"
      - "*.sass"
    test_cases:
      should_match:
        - "@font-face { font-family: 'Inter'; src: url('inter.woff2'); }"
        - "@font-face {\n  font-family: 'Roboto';\n  src: url('roboto.woff2');\n}"
      should_not_match:
        - "@font-face { font-family: 'Inter'; src: url('inter.woff2'); font-display: swap; }"
        - "@font-face { font-display: optional; font-family: 'Fancy'; src: url('fancy.woff2'); }"

  - id: too-many-font-weights
    name: Too Many Font Weights Loaded
    severity: warning
    type: regex
    pattern: '@font-face[^}]*font-weight:\s*(100|200|800|900)[;\s}]'
    message: "Loading extreme font weights (100, 200, 800, 900). Most designs need only 400, 500, 700."
    fix_action: "Audit font usage - remove unused weights or use a variable font"
    applies_to:
      - "*.css"
      - "*.scss"
    test_cases:
      should_match:
        - "@font-face { font-family: 'Inter'; font-weight: 100; src: url('inter-thin.woff2'); }"
        - "@font-face { font-family: 'Roboto'; font-weight: 900; src: url('roboto-black.woff2'); }"
      should_not_match:
        - "@font-face { font-family: 'Inter'; font-weight: 400; src: url('inter.woff2'); }"
        - "@font-face { font-family: 'Inter'; font-weight: 700; src: url('inter-bold.woff2'); }"

  - id: px-font-size
    name: Pixel Units for Font Size
    severity: warning
    type: regex
    pattern: 'font-size:\s*[0-9]+px'
    message: "Using px for font-size breaks user font preferences and accessibility."
    fix_action: "Use rem units instead (e.g., font-size: 1rem instead of font-size: 16px)"
    applies_to:
      - "*.css"
      - "*.scss"
      - "*.tsx"
      - "*.jsx"
    test_cases:
      should_match:
        - "font-size: 14px;"
        - "font-size: 16px"
        - "fontSize: '12px'"
      should_not_match:
        - "font-size: 1rem;"
        - "font-size: clamp(1rem, 2vw, 1.5rem)"
        - "fontSize: '1.25rem'"

  - id: tight-line-height
    name: Line Height Too Tight for Body Text
    severity: error
    type: regex
    pattern: 'line-height:\s*(0\.[0-9]+|1(\.[0-3][0-9]*)?)[;\s}](?!.*\/\*.*headline|.*\/\*.*title|.*\/\*.*h[1-6])'
    message: "Line height below 1.4 makes body text hard to read. WCAG recommends 1.5+ for body."
    fix_action: "Increase line-height to at least 1.5 for body text (1.1-1.3 OK for headlines)"
    applies_to:
      - "*.css"
      - "*.scss"
    test_cases:
      should_match:
        - "line-height: 1.2;"
        - "line-height: 1;"
        - "line-height: 1.0;"
      should_not_match:
        - "line-height: 1.5;"
        - "line-height: 1.6;"
        - "line-height: 1.75;"

  - id: text-all-caps-block
    name: All Caps on Block Text
    severity: warning
    type: regex
    pattern: '<(p|div|span)[^>]*class=["\'][^"\']*uppercase[^"\']*["\'][^>]*>(?![^<]{0,50}<\/)'
    message: "text-transform: uppercase on potentially long text. ALL CAPS is 50% harder to read."
    fix_action: "Reserve uppercase for short labels (2-3 words), buttons, or navigation. Use normal case for body."
    applies_to:
      - "*.tsx"
      - "*.jsx"
      - "*.html"
    test_cases:
      should_match:
        - '<p className="uppercase">Long paragraph text here</p>'
        - '<div class="text-uppercase">Content block</div>'
      should_not_match:
        - '<span className="uppercase">CTA</span>'
        - '<button className="uppercase">Submit</button>'

  - id: tiny-font-size
    name: Font Size Below Minimum Readable
    severity: error
    type: regex
    pattern: 'font-size:\s*(0\.[0-7]rem|[0-9]px|1[0-3]px|text-(2xs|xs))'
    message: "Font size below readable minimum. Body text should be at least 16px (1rem)."
    fix_action: "Increase font size to at least 1rem (16px) for body, 0.875rem (14px) minimum for captions"
    applies_to:
      - "*.css"
      - "*.scss"
      - "*.tsx"
      - "*.jsx"
    test_cases:
      should_match:
        - "font-size: 12px;"
        - "font-size: 0.65rem;"
        - "className=\"text-xs\""
      should_not_match:
        - "font-size: 1rem;"
        - "font-size: 16px;"
        - "className=\"text-base\""

  - id: google-fonts-no-display
    name: Google Fonts Without display Parameter
    severity: error
    type: regex
    pattern: 'fonts\.googleapis\.com/css2?\?[^"'']*(?!display=)[^"'']*["\''> ]'
    message: "Google Fonts URL missing display=swap parameter, will cause invisible text."
    fix_action: "Add &display=swap to Google Fonts URL"
    applies_to:
      - "*.html"
      - "*.tsx"
      - "*.jsx"
      - "*.css"
    test_cases:
      should_match:
        - 'href="https://fonts.googleapis.com/css2?family=Inter"'
        - "href='https://fonts.googleapis.com/css?family=Roboto'"
      should_not_match:
        - 'href="https://fonts.googleapis.com/css2?family=Inter&display=swap"'
        - "url('https://fonts.googleapis.com/css2?family=Roboto&display=swap')"

  - id: font-weight-bold-keyword
    name: Using 'bold' Keyword Instead of Numeric Weight
    severity: info
    type: regex
    pattern: 'font-weight:\s*bold[;\s}]'
    message: "Using 'bold' keyword. Prefer numeric weights (700) for consistency with design tokens."
    fix_action: "Use font-weight: 700 instead of font-weight: bold for explicit control"
    applies_to:
      - "*.css"
      - "*.scss"
    test_cases:
      should_match:
        - "font-weight: bold;"
        - "font-weight: bold }"
      should_not_match:
        - "font-weight: 700;"
        - "font-weight: 600;"

  - id: no-font-fallback
    name: Custom Font Without System Fallback
    severity: warning
    type: regex
    pattern: "font-family:\\s*['\"][^'\"]+['\"][;\\s}]"
    message: "Custom font without fallback. Add system font fallback for loading states."
    fix_action: "Add fallback fonts: font-family: 'Inter', system-ui, sans-serif;"
    applies_to:
      - "*.css"
      - "*.scss"
    test_cases:
      should_match:
        - "font-family: 'Inter';"
        - 'font-family: "Roboto";'
      should_not_match:
        - "font-family: 'Inter', sans-serif;"
        - "font-family: 'Roboto', system-ui, sans-serif;"

  - id: justify-text-no-hyphens
    name: Justified Text Without Hyphenation
    severity: warning
    type: regex
    pattern: 'text-align:\s*justify[;\s}](?![^}]*hyphens)'
    message: "Justified text without hyphenation creates rivers of white space."
    fix_action: "Add hyphens: auto; with text-align: justify; or prefer left-aligned text"
    applies_to:
      - "*.css"
      - "*.scss"
    test_cases:
      should_match:
        - "text-align: justify;"
        - "text-align: justify; color: black;"
      should_not_match:
        - "text-align: justify; hyphens: auto;"
        - "text-align: left;"

  - id: letter-spacing-em-on-uppercase
    name: Missing Letter Spacing on Uppercase Text
    severity: info
    type: regex
    pattern: 'text-transform:\s*uppercase[;\s}](?![^}]*letter-spacing)'
    message: "Uppercase text benefits from increased letter-spacing (0.05-0.1em)."
    fix_action: "Add letter-spacing: 0.05em to 0.1em when using text-transform: uppercase"
    applies_to:
      - "*.css"
      - "*.scss"
    test_cases:
      should_match:
        - "text-transform: uppercase;"
        - "text-transform: uppercase; font-weight: 600;"
      should_not_match:
        - "text-transform: uppercase; letter-spacing: 0.05em;"
        - "text-transform: none;"

  - id: no-max-width-prose
    name: Prose Content Without Line Length Limit
    severity: warning
    type: regex
    pattern: '<(article|p|div)[^>]*class=["\'][^"\']*prose[^"\']*["\'][^>]*>(?![^<]*max-w)'
    message: "Prose content without max-width. Long lines (80+ chars) are hard to read."
    fix_action: "Add max-width: 65ch (or max-w-prose in Tailwind) to limit line length"
    applies_to:
      - "*.tsx"
      - "*.jsx"
      - "*.html"
    test_cases:
      should_match:
        - '<article className="prose">'
        - '<div class="prose lg:prose-xl">'
      should_not_match:
        - '<article className="prose max-w-prose">'
        - '<div class="prose max-w-2xl">'

  - id: font-size-important
    name: Using !important on Font Size
    severity: warning
    type: regex
    pattern: 'font-size:[^;]*!important'
    message: "Using !important on font-size can break user accessibility preferences."
    fix_action: "Remove !important and fix specificity issues properly"
    applies_to:
      - "*.css"
      - "*.scss"
    test_cases:
      should_match:
        - "font-size: 14px !important;"
        - "font-size: 1rem !important"
      should_not_match:
        - "font-size: 1rem;"
        - "font-size: 16px;"

  - id: font-file-ttf-otf
    name: Using TTF/OTF Instead of WOFF2
    severity: warning
    type: regex
    pattern: "src:\\s*url\\(['\"]?[^'\"]+\\.(ttf|otf)['\"]?\\)"
    message: "Using TTF/OTF fonts instead of WOFF2. WOFF2 is 30-50% smaller."
    fix_action: "Convert fonts to WOFF2 format using fonttools or transfonter.org"
    applies_to:
      - "*.css"
      - "*.scss"
    test_cases:
      should_match:
        - "src: url('inter.ttf');"
        - "src: url(roboto.otf);"
      should_not_match:
        - "src: url('inter.woff2');"
        - "src: url('inter.woff');"
