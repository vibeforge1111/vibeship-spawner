# Validations - Tailwind CSS
# Automated checks for Tailwind issues

version: 1.0.0
skill_id: tailwind-css

validations:
  # Critical issues
  - id: dynamic-class-names
    name: Dynamic class name construction
    severity: warning
    type: regex
    pattern:
      - 'className=\{`[^`]*\$\{[^}]+\}[^`]*`\}'
      - 'class=`[^`]*\$\{[^}]+\}[^`]*`'
    message: "Dynamic class names may be purged in production"
    fix_action: "Use object mapping with complete class names"
    applies_to:
      - "*.tsx"
      - "*.jsx"
      - "*.vue"

  - id: arbitrary-z-index
    name: Large arbitrary z-index value
    severity: info
    type: regex
    pattern:
      - 'z-\[\d{3,}\]'
    message: "Large z-index values indicate stacking context issues"
    fix_action: "Define z-index scale in tailwind.config.js"
    applies_to:
      - "*.tsx"
      - "*.jsx"
      - "*.html"
      - "*.vue"

  - id: arbitrary-colors
    name: Arbitrary color values
    severity: info
    type: regex
    pattern:
      - '(bg|text|border)-\[#[0-9a-fA-F]+\]'
    message: "Arbitrary colors break design consistency"
    fix_action: "Add colors to tailwind.config.js theme.extend.colors"
    applies_to:
      - "*.tsx"
      - "*.jsx"
      - "*.html"

  # Best practices
  - id: missing-dark-variant
    name: Background without dark mode variant
    severity: info
    type: regex
    pattern:
      - 'bg-white(?![^"]*dark:)'
      - 'bg-gray-50(?![^"]*dark:)'
    message: "Consider adding dark mode variant for backgrounds"
    fix_action: "Add dark:bg-gray-900 or similar"
    applies_to:
      - "*.tsx"
      - "*.jsx"

  - id: text-without-dark
    name: Text color without dark variant
    severity: info
    type: regex
    pattern:
      - 'text-gray-900(?![^"]*dark:)'
      - 'text-black(?![^"]*dark:)'
    message: "Consider adding dark mode variant for text"
    fix_action: "Add dark:text-white or dark:text-gray-100"
    applies_to:
      - "*.tsx"
      - "*.jsx"

  - id: inline-style
    name: Inline styles alongside Tailwind
    severity: info
    type: regex
    pattern:
      - 'style=\{[^}]+\}.*className='
      - 'className=.*style=\{[^}]+\}'
    message: "Prefer Tailwind utilities over inline styles"
    fix_action: "Use Tailwind classes or extend config"
    applies_to:
      - "*.tsx"
      - "*.jsx"

  - id: conflicting-classes
    name: Potentially conflicting utility classes
    severity: warning
    type: regex
    pattern:
      - 'p-\d+\s+p-\d+'
      - 'm-\d+\s+m-\d+'
      - 'w-\d+\s+w-\d+'
    message: "Conflicting classes - only one will apply"
    fix_action: "Use tailwind-merge for class composition"
    applies_to:
      - "*.tsx"
      - "*.jsx"
      - "*.html"

  # Performance
  - id: apply-overuse
    name: Excessive @apply usage
    severity: info
    type: regex
    pattern:
      - '@apply\s+\w+[\s\w-]+\w+[\s\w-]+\w+[\s\w-]+\w+'
    message: "@apply with many classes defeats Tailwind's purpose"
    fix_action: "Create React component instead of CSS class"
    applies_to:
      - "*.css"

  # Accessibility
  - id: text-color-contrast
    name: Potential contrast issue
    severity: info
    type: regex
    pattern:
      - 'bg-white.*text-gray-[1-3]00'
      - 'bg-gray-100.*text-gray-[1-4]00'
    message: "Text color may have insufficient contrast"
    fix_action: "Use text-gray-700 or darker for readability"
    applies_to:
      - "*.tsx"
      - "*.jsx"

  # Responsive
  - id: mobile-only-classes
    name: Missing responsive variants
    severity: info
    type: regex
    pattern:
      - 'hidden(?!\s+sm:|\s+md:|\s+lg:)'
    message: "Consider if element should be visible on different screen sizes"
    fix_action: "Use md:block or similar for responsive visibility"
    applies_to:
      - "*.tsx"
      - "*.jsx"

code_smells:
  - id: class-string-too-long
    name: Very long className string
    description: "className with 10+ classes may need extraction"
    pattern: 'className="[^"]{150,}"'
    suggestion: "Extract to component or use cn() utility"

  - id: duplicate-responsive
    name: Same responsive breakpoints repeated
    description: "Same md:, lg: patterns across many elements"
    pattern: null
    suggestion: "Consider component extraction or CSS variable"

  - id: no-tailwind-merge
    name: Component accepts className without merge
    description: "className prop passed without tailwind-merge"
    pattern: null
    suggestion: "Use tailwind-merge to handle class conflicts"

best_practices:
  cn_utility:
    recommendation: |
      Class Name Utility (cn):

      // lib/utils.ts
      import { type ClassValue, clsx } from 'clsx';
      import { twMerge } from 'tailwind-merge';

      export function cn(...inputs: ClassValue[]) {
        return twMerge(clsx(inputs));
      }

      // Usage in components:
      import { cn } from '@/lib/utils';

      function Button({ className, variant, ...props }) {
        return (
          <button
            className={cn(
              // Base styles
              'px-4 py-2 rounded-md font-medium',
              // Variant styles
              variant === 'primary' && 'bg-blue-600 text-white',
              variant === 'secondary' && 'bg-gray-200 text-gray-900',
              // External className (can override above)
              className
            )}
            {...props}
          />
        );
      }

  component_structure:
    recommendation: |
      Component Style Structure:

      // 1. Base styles (always applied)
      const baseStyles = 'rounded-lg transition-colors';

      // 2. Variants (one of)
      const variants = {
        primary: 'bg-blue-600 text-white hover:bg-blue-700',
        secondary: 'bg-gray-200 text-gray-900 hover:bg-gray-300',
      };

      // 3. Sizes (one of)
      const sizes = {
        sm: 'px-3 py-1.5 text-sm',
        md: 'px-4 py-2 text-base',
        lg: 'px-6 py-3 text-lg',
      };

      // Combine with cn()
      <button className={cn(
        baseStyles,
        variants[variant],
        sizes[size],
        className
      )} />

  dark_mode_setup:
    recommendation: |
      Dark Mode Best Practices:

      // 1. Configure tailwind.config.js
      module.exports = {
        darkMode: 'class',
      }

      // 2. Install next-themes (for Next.js)
      npm install next-themes

      // 3. Wrap app in provider
      import { ThemeProvider } from 'next-themes';

      function App({ children }) {
        return (
          <ThemeProvider attribute="class" defaultTheme="system">
            {children}
          </ThemeProvider>
        );
      }

      // 4. Use in components
      <div className="bg-white dark:bg-gray-900 text-gray-900 dark:text-white">

      // 5. Add toggle
      import { useTheme } from 'next-themes';

      function ThemeToggle() {
        const { theme, setTheme } = useTheme();
        return (
          <button onClick={() => setTheme(theme === 'dark' ? 'light' : 'dark')}>
            Toggle
          </button>
        );
      }

  responsive_patterns:
    recommendation: |
      Responsive Design Patterns:

      // Mobile-first: Start with mobile, add breakpoints for larger
      <div className="
        p-4        // Mobile
        md:p-6     // Tablet
        lg:p-8     // Desktop
      ">

      // Stack to grid
      <div className="
        flex flex-col      // Mobile: stack
        md:flex-row        // Tablet+: row
        md:items-center
      ">

      // Hide/show
      <div className="
        hidden md:block    // Hidden on mobile, shown on tablet+
      ">

      // Different layouts
      <div className="
        grid
        grid-cols-1        // 1 column mobile
        sm:grid-cols-2     // 2 columns small
        lg:grid-cols-3     // 3 columns large
        xl:grid-cols-4     // 4 columns xl
        gap-4
      ">
