id: procedural-generation
skill: Procedural Generation
version: "1.0"

validations:
  - id: check-seeded-random
    name: Seeded Random Number Generator
    description: Generation should use seeded RNG for reproducibility
    pattern: "Math\\.random\\(\\)"
    file_glob: "**/*.{js,ts,jsx,tsx}"
    match: present
    context_pattern: "seed|xorshift|mulberry|sfc32"
    message: "Use seeded RNG instead of Math.random() for reproducible generation"
    severity: warning
    autofix: false

  - id: check-generation-validation
    name: Content Validation
    description: Generated content should be validated for playability
    pattern: "generate.*dungeon|generate.*level|generate.*world"
    file_glob: "**/*.{js,ts,jsx,tsx}"
    match: present
    context_pattern: "valid|connect|reachable|check"
    message: "Validate generated content is playable before using"
    severity: warning
    autofix: false

  - id: check-fallback
    name: Generation Fallback
    description: Have fallback content when generation fails
    pattern: "generate|procedural"
    file_glob: "**/*.{js,ts,jsx,tsx}"
    match: present
    context_pattern: "fallback|default|template|catch"
    message: "Provide fallback content when procedural generation fails"
    severity: warning
    autofix: false

  - id: check-chunk-system
    name: Chunk-Based Generation
    description: Large worlds should use chunked generation
    pattern: "infinite.*world|large.*terrain|endless"
    file_glob: "**/*.{js,ts,jsx,tsx}"
    match: present
    context_pattern: "chunk|tile|sector|region"
    message: "Use chunk-based generation for infinite/large worlds"
    severity: info
    autofix: false

  - id: check-async-generation
    name: Async Generation
    description: Heavy generation should not block main thread
    pattern: "for.*noise|generate.*terrain"
    file_glob: "**/*.{js,ts,jsx,tsx}"
    match: present
    context_pattern: "async|worker|requestIdleCallback|setTimeout"
    message: "Consider async generation to avoid blocking main thread"
    severity: info
    autofix: false

  - id: check-noise-octaves
    name: Noise Octaves Configuration
    description: FBM should have configurable octaves
    pattern: "fbm|fractal.*noise"
    file_glob: "**/*.{js,ts,jsx,tsx}"
    match: present
    context_pattern: "octaves|layers|frequency"
    message: "Make noise octaves configurable for different quality levels"
    severity: info
    autofix: false

  - id: check-coordinate-overflow
    name: Coordinate Overflow Handling
    description: Large coordinates should be handled without overflow
    pattern: "worldX|worldY|chunkX|chunkY"
    file_glob: "**/*.{js,ts,jsx,tsx}"
    match: present
    context_pattern: "BigInt|clamp|modulo|wrap"
    message: "Consider coordinate overflow at world boundaries"
    severity: info
    autofix: false

  - id: check-wfc-backtrack
    name: WFC Backtracking
    description: Wave Function Collapse should handle contradictions
    pattern: "wfc|wave.*function|collapse"
    file_glob: "**/*.{js,ts,jsx,tsx}"
    match: present
    context_pattern: "backtrack|contradiction|retry|history"
    message: "Handle WFC contradictions with backtracking"
    severity: warning
    autofix: false

  - id: check-deterministic-seed
    name: Deterministic Seed Storage
    description: Store seed for reproducibility and debugging
    pattern: "generate|procedural|random"
    file_glob: "**/*.{js,ts,jsx,tsx}"
    match: present
    context_pattern: "seed|log.*seed|store.*seed|save.*seed"
    message: "Log or store generation seed for debugging"
    severity: info
    autofix: false

pre_commit:
  - id: generation-test
    name: Generation Test Suite
    command: "npm run test:generation"
    description: Test procedural generation with known seeds

  - id: validity-check
    name: Content Validity Test
    command: "npm run test:validity"
    description: Test that generated content is always valid

ci_checks:
  - id: stress-test
    name: Generation Stress Test
    command: "npm run test:stress"
    description: Test generation with many random seeds
    required: false

  - id: determinism-test
    name: Determinism Test
    command: "npm run test:determinism"
    description: Verify same seed produces identical results
    required: true
