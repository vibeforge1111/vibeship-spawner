id: ai-game-art-generation
skill: AI Game Art Generation
version: "1.0"

validations:
  - id: hardcoded-api-key
    pattern: '(?:api[_-]?key|secret|token)\s*[=:]\s*["\'][a-zA-Z0-9_-]{20,}["\']'
    severity: critical
    message: "Hardcoded API key detected - use environment variables"
    fix: "Move to .env file: STABILITY_API_KEY=your_key_here"
    applies_to:
      - "*.py"
      - "*.js"
      - "*.ts"
    test_cases:
      should_match:
        - 'api_key = "sk-1234567890abcdefghijklmnop"'
        - 'STABILITY_KEY: "abcd1234567890efghijklmn"'
      should_not_match:
        - 'api_key = os.environ.get("STABILITY_API_KEY")'
        - 'const key = process.env.API_KEY'

  - id: no-seed-in-batch
    pattern: 'batch.*generate|generate.*batch(?!.*seed)'
    severity: warning
    message: "Batch generation without seed documentation - results won't be reproducible"
    fix: "Document or lock seeds for reproducibility: seed=42"
    applies_to:
      - "*.py"
      - "*.js"
    test_cases:
      should_match:
        - "batch_generate(prompts, count=100)"
        - "generate_batch(images, num=50)"
      should_not_match:
        - "batch_generate(prompts, count=100, seed=42)"
        - "generate_batch(images, seed=12345)"

  - id: no-license-comment
    pattern: '(?:midjourney|stability|dall-?e|openai|replicate).*(?:api|client)'
    severity: info
    message: "AI service usage detected - ensure license compliance documented"
    fix: "Add comment documenting license tier and commercial rights"
    applies_to:
      - "*.py"
      - "*.js"
      - "*.ts"
    test_cases:
      should_match:
        - "stability_client = StabilityClient()"
        - "midjourney_api.generate()"
      should_not_match:
        - "# Licensed under Stability AI Pro tier for commercial use"

  - id: missing-background-removal
    pattern: 'generate.*sprite|sprite.*generat(?!.*background|.*transparent|.*alpha)'
    severity: warning
    message: "Sprite generation without background removal - ensure transparency"
    fix: "Add background removal node or use alpha channel output"
    applies_to:
      - "*.py"
      - "*.json"
    test_cases:
      should_match:
        - "generate_sprite(prompt)"
        - "sprite_generator.create()"
      should_not_match:
        - "generate_sprite(prompt, transparent=True)"
        - "sprite_generator.create(background_removal=True)"

  - id: no-quality-check
    pattern: 'save.*asset|export.*image(?!.*review|.*quality|.*check)'
    severity: info
    message: "Asset export without quality check step"
    fix: "Add human review before final export to catch AI artifacts"
    applies_to:
      - "*.py"
      - "*.js"
    test_cases:
      should_match:
        - "save_asset(image, path)"
        - "export_image(generated)"
      should_not_match:
        - "save_asset(image, path) # Manual review required"
        - "if quality_check(image): export_image(generated)"

  - id: negative-prompt-missing
    pattern: 'prompt\s*=\s*["\'][^"\']+["\'](?!.*negative)'
    severity: info
    message: "Generation without negative prompt - may produce artifacts"
    fix: "Add negative_prompt for anatomy/quality: 'extra fingers, blurry, watermark'"
    applies_to:
      - "*.py"
      - "*.json"
    test_cases:
      should_match:
        - 'prompt = "fantasy warrior character"'
      should_not_match:
        - 'prompt = "warrior", negative_prompt = "bad anatomy"'

  - id: resolution-not-power-of-two
    pattern: 'resolution|size|dimensions.*=.*(?:100|150|200|300|500|600|700|900)[^0-9]'
    severity: warning
    message: "Non-power-of-2 resolution may cause issues with game engines"
    fix: "Use power of 2: 256, 512, 1024, 2048"
    applies_to:
      - "*.py"
      - "*.json"
      - "*.yaml"
    test_cases:
      should_match:
        - "resolution = 500"
        - "size: 300"
      should_not_match:
        - "resolution = 512"
        - "size: 1024"

  - id: no-vae-decode-tiled
    pattern: 'VAEDecode(?!.*tiled)'
    severity: info
    message: "VAE decode without tiling may cause VRAM issues at high resolution"
    fix: "Use VAEDecodeTiled for resolutions above 1024px"
    applies_to:
      - "*.json"
    test_cases:
      should_match:
        - '"class_type": "VAEDecode"'
      should_not_match:
        - '"class_type": "VAEDecodeTiled"'

  - id: git-lfs-not-configured
    pattern: '\.png|\.jpg|\.psd'
    severity: warning
    message: "Binary asset referenced - ensure Git LFS is configured"
    fix: "Run: git lfs track '*.png' '*.jpg' '*.psd'"
    applies_to:
      - ".gitattributes"
    test_cases:
      should_match:
        - "character.png"
      should_not_match:
        - "*.png filter=lfs"

  - id: training-data-too-small
    pattern: 'train.*(?:images|samples).*(?:[1-9]|1[0-4])[^0-9]'
    severity: warning
    message: "Training dataset may be too small - need 15-30 for characters, 30-50 for styles"
    fix: "Increase training dataset or verify quality over quantity"
    applies_to:
      - "*.py"
      - "*.yaml"
    test_cases:
      should_match:
        - "train_images = 10"
        - "samples: 5"
      should_not_match:
        - "train_images = 30"
        - "samples: 50"

  - id: steam-disclosure-missing
    pattern: 'steam.*(?:upload|publish|release)(?!.*ai.*disclos|.*content.*survey)'
    severity: warning
    message: "Steam publishing mentioned - ensure AI content disclosure completed"
    fix: "Complete Steam Content Survey AI section before submission"
    applies_to:
      - "*.md"
      - "*.txt"
    test_cases:
      should_match:
        - "upload to steam"
        - "steam publish"
      should_not_match:
        - "steam upload (AI disclosure completed)"

validation_groups:
  - name: license-compliance
    description: Checks for proper AI tool licensing
    validations:
      - hardcoded-api-key
      - no-license-comment
      - steam-disclosure-missing

  - name: quality-assurance
    description: Checks for AI art quality practices
    validations:
      - negative-prompt-missing
      - missing-background-removal
      - no-quality-check

  - name: technical-correctness
    description: Checks for technical best practices
    validations:
      - no-seed-in-batch
      - resolution-not-power-of-two
      - no-vae-decode-tiled
      - git-lfs-not-configured
      - training-data-too-small

auto_fix_rules:
  - id: add-negative-prompt
    pattern: '(prompt\s*=\s*["\'][^"\']+["\'])(?!\s*,\s*negative)'
    replacement: '$1, negative_prompt="extra fingers, bad anatomy, blurry, watermark"'
    description: "Adds standard negative prompt for quality"

  - id: add-seed-param
    pattern: '(generate\([^)]+)(\))'
    replacement: '$1, seed=42$2  # Document actual seed used'
    description: "Adds seed parameter for reproducibility"
