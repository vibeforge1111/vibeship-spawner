# Combat Design Collaboration
# How combat-design works with other skills and when to delegate

id: combat-design-collaboration
skill: combat-design
version: 1.0.0

# ============================================================================
# RECEIVES FROM (Who delegates TO this skill)
# ============================================================================
receives_from:
  - skill: game-design
    context: "Game needs combat system design"
    receives:
      - "Core gameplay loop"
      - "Target audience and skill level"
      - "Reference games and feel targets"
      - "Platform constraints (mobile, console, PC)"
    provides: "Complete combat system architecture with frame data"

  - skill: unity-development
    context: "Unity game needs combat implementation guidance"
    receives:
      - "Current project setup"
      - "Physics system choice (2D/3D)"
      - "Animation system (Animator/Timeline)"
    provides: "Unity-specific combat patterns and implementation guidance"

  - skill: unreal-engine
    context: "Unreal game needs combat implementation guidance"
    receives:
      - "Blueprint vs C++ preference"
      - "Animation Blueprint setup"
      - "Gameplay Ability System usage"
    provides: "Unreal-specific combat patterns using GAS or custom systems"

  - skill: godot-development
    context: "Godot game needs combat implementation"
    receives:
      - "GDScript or C# preference"
      - "Node structure"
      - "AnimationPlayer setup"
    provides: "Godot-specific combat patterns and signal-based architecture"

  - skill: mobile-game-dev
    context: "Mobile game needs touch-friendly combat"
    receives:
      - "Touch input constraints"
      - "Performance budget"
      - "Session length targets"
    provides: "Simplified combat with forgiving timing and clear visuals"

# ============================================================================
# DELEGATION TRIGGERS
# ============================================================================
delegation_triggers:
  - trigger: "animation|blend tree|state machine|animator controller"
    delegate_to: animation-systems
    pattern: sequential
    context: "Combat animation integration"
    handoff_data:
      - "Frame data specifications (startup, active, recovery)"
      - "Cancel window requirements"
      - "Root motion vs in-place decision"
      - "Required animation events (damage frames, sound triggers)"
      - "Blend time requirements (fast for attacks)"
    receive: "Animation implementation matching frame data specs"

  - trigger: "enemy AI|behavior tree|boss patterns|patrol|aggression"
    delegate_to: game-ai-behavior
    pattern: sequential
    context: "Enemy behavior implementation"
    handoff_data:
      - "Enemy archetype definitions (grunt, tank, ranged, etc.)"
      - "Attack pattern sequences and timing"
      - "Aggression levels and retreat conditions"
      - "Tell/telegraph requirements"
      - "Recovery window specifications"
    receive: "AI behaviors that execute combat designs"

  - trigger: "hit effect|particles|screen shake|VFX|impact"
    delegate_to: vfx-realtime
    pattern: parallel
    context: "Combat visual feedback"
    handoff_data:
      - "Hit effect intensity scaling (damage -> effect size)"
      - "Timing synchronization (spawn during hitstop)"
      - "Effect layer hierarchy (core, secondary, ambient)"
      - "Performance budget per combat encounter"
      - "Looping vs one-shot requirements"
    receive: "VFX systems that reinforce combat feedback"

  - trigger: "hit sound|impact audio|combat SFX|weapon sounds"
    delegate_to: game-audio
    pattern: parallel
    context: "Combat audio feedback"
    handoff_data:
      - "Sound priority hierarchy (player > enemies > ambient)"
      - "Hit sound layering (impact, flesh, reverb)"
      - "Timing sync with hitstop"
      - "Variation requirements (no repetition fatigue)"
      - "Positional audio for off-screen attacks"
    receive: "Audio systems integrated with combat timing"

  - trigger: "game feel|juice|overall polish|responsiveness"
    delegate_to: game-design
    pattern: sequential
    context: "Combat feel tuning and polish"
    handoff_data:
      - "Current combat feel specifications"
      - "Known feel issues and constraints"
      - "Reference games for target feel"
      - "Playtest feedback summary"
    receive: "Tuning recommendations and feel improvements"

  - trigger: "shader|visual effect shader|dissolve|hit flash"
    delegate_to: shader-programming
    pattern: parallel
    context: "Combat visual effects implementation"
    handoff_data:
      - "Effect requirements (hit flash, damage overlay)"
      - "Performance constraints"
      - "Timing requirements (sync with hitstop)"
    receive: "Shader implementations for combat visuals"

  - trigger: "UI|health bar|damage numbers|combo counter"
    delegate_to: game-design
    pattern: parallel
    context: "Combat UI elements"
    handoff_data:
      - "Information hierarchy (health > stamina > buffs)"
      - "Feedback timing (damage numbers during hitstop)"
      - "Accessibility requirements"
    receive: "UI designs that support combat clarity"

  - trigger: "multiplayer|netcode|rollback|prediction"
    delegate_to: game-networking
    pattern: sequential
    context: "Networked combat implementation"
    handoff_data:
      - "Frame data for rollback considerations"
      - "Hit confirmation requirements"
      - "Latency tolerance specs"
      - "Authoritative vs predicted systems"
    receive: "Networking patterns for combat synchronization"

  - trigger: "performance|frame rate|profiling|optimization"
    delegate_to: codebase-optimization
    pattern: sequential
    context: "Combat performance issues"
    handoff_data:
      - "Current combat entity counts"
      - "Collision check frequency"
      - "Effect spawn rates"
      - "Known performance bottlenecks"
    receive: "Optimized combat systems meeting frame budget"

# ============================================================================
# FEEDBACK LOOPS
# ============================================================================
feedback_loops:
  receives_feedback_from:
    - skill: animation-systems
      signal: "Animation timing doesn't match frame data"
      action: "Adjust frame data to match animation, or request animation edit"

    - skill: game-ai-behavior
      signal: "Enemy behavior too predictable or unfair"
      action: "Revise attack patterns, adjust telegraph timing"

    - skill: vfx-realtime
      signal: "Effects obscuring readability or tanking performance"
      action: "Reduce effect density, adjust timing, simplify particles"

    - skill: game-audio
      signal: "Audio feedback not syncing with hitstop"
      action: "Adjust audio trigger timing or hitstop duration"

    - skill: qa-engineering
      signal: "Combat bugs or balance issues from playtesting"
      action: "Debug hitbox issues, tune frame data, adjust damage"

  sends_feedback_to:
    - skill: animation-systems
      signal: "Need faster blend times or new cancel points"
      action: "Request animation adjustments for responsiveness"

    - skill: game-ai-behavior
      signal: "Enemy patterns need longer recovery or clearer tells"
      action: "Request behavior tree modifications"

    - skill: vfx-realtime
      signal: "Hit effects need different timing or scaling"
      action: "Adjust effect specifications"

    - skill: game-audio
      signal: "Need different impact sounds for damage levels"
      action: "Request additional audio variations"

# ============================================================================
# CROSS-DOMAIN INSIGHTS
# ============================================================================
cross_domain_insights:
  - domain: Fighting Games
    insight: |
      Fighting game developers understand frame data at a molecular level:
      - Every move is defined in exact frames
      - Frame advantage determines who can act first after block
      - Hit/block stun creates deterministic interactions
      - "Plus on block" and "minus on block" drive strategy

      Apply this precision to action games:
      - Define every attack with exact startup/active/recovery
      - Make recovery windows consistent and punishable
      - Let players learn timings through repetition
    applies_when: "Designing any attack frame data or punish windows"

  - domain: Character Action (Platinum, Capcom)
    insight: |
      Platinum Games and Capcom have perfected the art of "game feel":
      - Attacks have immediate response (1-2 frame blend)
      - Hitstop sells every single hit
      - Cancels are generous but hierarchical
      - Style is rewarded, not just effectiveness

      Key techniques:
      - Enemy super armor that breaks after enough hits
      - Juggle physics that let skilled players extend combos
      - "Just frame" bonuses for perfect timing
      - Style meters that reward variety
    applies_when: "Building combo systems or stylish action combat"

  - domain: Souls-like Design
    insight: |
      From Software's combat philosophy:
      - Commitment over reaction (attacks are risky)
      - Stamina creates resource management
      - Long recovery windows create openings
      - Pattern recognition over twitch skill

      Critical lessons:
      - Every boss attack has a punish window
      - Healing is interruptible (risk vs reward)
      - i-frames are earned through timing, not spam
      - Difficulty comes from consistency, not single tests
    applies_when: "Designing deliberate, tactical combat"

  - domain: Animation Principles
    insight: |
      Disney's 12 principles apply to combat animation:
      - Anticipation: Wind-up before attack (telegraph)
      - Follow-through: Recovery after attack (punish window)
      - Exaggeration: Emphasize poses for readability
      - Timing: Speed variations for impact (slow-in to fast-out)

      Combat-specific applications:
      - Strong key poses at attack apex
      - Clear silhouettes in wind-up animations
      - Exaggerated hit reactions (stagger, knockback)
    applies_when: "Working with animators on combat animations"

  - domain: Sports/Martial Arts
    insight: |
      Real combat sports inform game design:
      - Footwork (spacing, distance management)
      - Reads (predicting opponent's action)
      - Mixups (conditioning then breaking patterns)
      - Punishes (capitalizing on mistakes)

      Apply to enemy design:
      - Enemies with tells like real fighters
      - Pattern conditioning then variation
      - Respect for player spacing choices
    applies_when: "Designing enemy patterns or player movesets"

# ============================================================================
# COMMON COMBINATIONS
# ============================================================================
common_combinations:
  - name: Action Game Combat System
    skills:
      - combat-design
      - animation-systems
      - game-ai-behavior
      - vfx-realtime
      - game-audio
    workflow: |
      1. combat-design: Define frame data, hitboxes, combat philosophy
      2. animation-systems: Implement animations matching frame specs
      3. game-ai-behavior: Build enemy behaviors executing attack patterns
      4. vfx-realtime: Create hit effects synced to hitstop
      5. game-audio: Implement layered hit sounds
      6. combat-design: Final tuning and feel polish

  - name: Souls-like Boss Design
    skills:
      - combat-design
      - game-ai-behavior
      - animation-systems
    workflow: |
      1. combat-design: Define boss phases, attack patterns, recovery windows
      2. animation-systems: Create readable attack animations with clear tells
      3. game-ai-behavior: Implement behavior tree with phase transitions
      4. combat-design: Tune timing, damage values, punish windows
      5. Integration testing with fresh playtesters

  - name: Fighting Game Mechanics
    skills:
      - combat-design
      - animation-systems
      - game-networking
    workflow: |
      1. combat-design: Define complete frame data for all moves
      2. animation-systems: Pixel-perfect animation timing
      3. game-networking: Implement rollback for frame-perfect play
      4. combat-design: Balance pass on frame advantage

  - name: Mobile Combat
    skills:
      - combat-design
      - mobile-game-dev
      - vfx-realtime
    workflow: |
      1. mobile-game-dev: Define touch input constraints
      2. combat-design: Simplify timing, increase forgiveness
      3. vfx-realtime: Optimize effects for mobile fill rate
      4. combat-design: Tune for shorter sessions

# ============================================================================
# ESCALATION PATHS
# ============================================================================
escalation_paths:
  - issue: "Combat feels unresponsive despite good frame data"
    first_check: animation-systems
    reason: "Animation blend times or transition issues often cause input delay feel"
    if_not_resolved: "Check input handling, then platform-specific input latency"

  - issue: "Hits don't feel impactful"
    first_check: vfx-realtime
    reason: "Visual feedback is primary impact source - ensure hitstop-synced VFX"
    if_not_resolved: "Check audio timing, then hitstop implementation"

  - issue: "Enemies feel unfair"
    first_check: game-ai-behavior
    reason: "Attack patterns may lack tells or recovery windows"
    if_not_resolved: "Review telegraph timing with animation-systems"

  - issue: "Combat causes frame drops"
    first_check: codebase-optimization
    reason: "Combat typically stress-tests collision and VFX systems"
    if_not_resolved: "Review VFX particle counts and collision check frequency"

# ============================================================================
# QUALITY GATES
# ============================================================================
quality_gates:
  before_handoff_to_animation:
    - "Frame data spec complete (startup, active, recovery for all attacks)"
    - "Cancel windows defined"
    - "Root motion decision made"
    - "Animation event requirements documented"

  before_handoff_to_ai:
    - "Enemy archetype definitions complete"
    - "Attack pattern sequences defined"
    - "Telegraph timing requirements specified"
    - "Recovery windows documented"

  before_handoff_to_vfx:
    - "Hit effect intensity scaling defined"
    - "Hitstop timing documented"
    - "Performance budget specified"
    - "Effect priority hierarchy defined"

  before_handoff_to_audio:
    - "Sound trigger timing defined"
    - "Priority hierarchy documented"
    - "Variation requirements specified"
    - "Positional audio needs listed"

  before_integration_testing:
    - "All subsystems implemented"
    - "Hitstop synchronized across VFX/audio"
    - "Hitbox visualization available for debug"
    - "Frame data can be tuned without code changes"
