# Puzzle Design Validations
# Design checklists and pattern detection for puzzle development

validations:
  # ============================================================================
  # DESIGN DOCUMENT VALIDATIONS
  # These check puzzle design documentation for best practices
  # ============================================================================

  - id: puzzle-no-goal-documented
    name: Missing Goal State Documentation
    severity: warning
    type: regex
    pattern:
      - '(?i)puzzle\s*(?:\d+|[a-z])?\s*:(?![^:]*(?:goal|objective|win|success|complete))'
    message: "Puzzle documentation lacks clear goal state. Players must know what they're trying to achieve."
    fix_action: "Add explicit goal state: 'Goal: Player must activate all four crystals to open the door'"
    applies_to:
      - "*.md"
      - "*.txt"
      - "*design*.md"
      - "*puzzle*.md"

  - id: puzzle-no-difficulty-rating
    name: Missing Difficulty Rating
    severity: info
    type: regex
    pattern:
      - '(?i)puzzle\s*(?:\d+|[a-z])?\s*:(?![^:]*(?:difficulty|easy|medium|hard|rating))'
    message: "Puzzle documentation lacks difficulty rating. Rate each puzzle for curve planning."
    fix_action: "Add difficulty rating: 'Difficulty: Medium (estimated 3-5 minutes)'"
    applies_to:
      - "*design*.md"
      - "*puzzle*.md"

  - id: puzzle-missing-mechanic-intro
    name: Testing Before Teaching
    severity: warning
    type: regex
    pattern:
      - '(?i)(?:introduces?|first)\s+(?:and|,)\s+(?:tests?|challenges?)'
      - '(?i)new\s+mechanic.*(?:difficult|hard|challenging)'
    message: "Puzzle may teach and test simultaneously. Introduce mechanics in low-stakes puzzles first."
    fix_action: "Add introductory puzzle that teaches mechanic before testing it"
    applies_to:
      - "*design*.md"
      - "*puzzle*.md"

  # ============================================================================
  # CODE VALIDATIONS
  # These check puzzle implementation for common issues
  # ============================================================================

  - id: puzzle-no-reset-mechanism
    name: Missing Puzzle Reset
    severity: warning
    type: regex
    pattern:
      - 'class\s+Puzzle(?![\\s\\S]*reset\\s*\\()'
      - 'puzzle\\.(?:start|begin|init)(?![\\s\\S]*puzzle\\.reset)'
    message: "Puzzle class has no reset mechanism. Players should be able to retry without punishment."
    fix_action: "Add reset() method that returns puzzle to initial state"
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.gd"
      - "*.cs"

  - id: puzzle-death-on-failure
    name: Death as Puzzle Failure
    severity: warning
    type: regex
    pattern:
      - 'puzzle.*(?:fail|wrong|incorrect).*(?:die|death|kill|respawn)'
      - '(?:die|death|kill).*puzzle.*(?:fail|wrong)'
    message: "Player dies on puzzle failure. Consider puzzle-only reset instead."
    fix_action: "Reset puzzle state on failure instead of killing player"
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.gd"
      - "*.cs"

  - id: puzzle-color-only
    name: Color-Only Puzzle Element
    severity: warning
    type: regex
    pattern:
      - '(?i)color\s*===?\s*["\'](?:red|green|blue|yellow)'
      - '(?i)if\s*\(\s*(?:\.color|getColor|tile\.color)'
      - '(?i)switch\s*\(\s*color\s*\)'
    message: "Color-based puzzle logic detected. Ensure alternative for colorblind players."
    fix_action: "Add shape, pattern, or symbol alongside color differentiation"
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.gd"
      - "*.cs"

  - id: puzzle-hardcoded-solution
    name: Hardcoded Puzzle Solution
    severity: warning
    type: regex
    pattern:
      - 'solution\s*=\s*["\'][a-zA-Z0-9]+["\']'
      - 'password\s*=\s*["\'][a-zA-Z0-9]+["\']'
      - 'code\s*===?\s*["\']\\d+["\']'
    message: "Hardcoded puzzle solution. Consider data-driven approach for easier testing."
    fix_action: "Move solutions to config/data file for easier adjustment and playtesting"
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.gd"
      - "*.cs"

  - id: puzzle-no-partial-feedback
    name: Missing Partial Feedback
    severity: info
    type: regex
    pattern:
      - 'if\s*\(.*solution.*===.*\)\s*\{[^}]*success[^}]*\}\s*else\s*\{[^}]*(?:fail|wrong|incorrect)'
    message: "Binary success/fail with no partial feedback. Consider showing progress hints."
    fix_action: "Add partial feedback: 'X of Y correct' or 'getting warmer/colder'"
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.gd"
      - "*.cs"

  - id: puzzle-unlimited-attempts
    name: Missing Attempt Tracking
    severity: info
    type: regex
    pattern:
      - 'puzzle.*submit(?![\\s\\S]*attempts|[\\s\\S]*tries)'
    message: "No attempt tracking for puzzle. Consider tracking for adaptive hints."
    fix_action: "Track attempts to trigger progressive hint system"
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.gd"
      - "*.cs"

  # ============================================================================
  # PLAYTESTING CHECKLIST VALIDATIONS
  # These check for playtesting documentation requirements
  # ============================================================================

  - id: puzzle-no-playtest-data
    name: Missing Playtest Data
    severity: warning
    type: regex
    pattern:
      - '(?i)puzzle.*complete(?![\\s\\S]*(?:playtest|tested|solve\s*time))'
    message: "Puzzle marked complete without playtest data. Always test with fresh eyes."
    fix_action: "Add playtest notes: solve time, hint usage, frustration points"
    applies_to:
      - "*design*.md"
      - "*puzzle*.md"
      - "*changelog*.md"

  - id: puzzle-single-tester
    name: Single Playtester
    severity: info
    type: regex
    pattern:
      - '(?i)playtested?\s*(?:by|with|:)\s*(?:one|1|single)'
      - '(?i)(?:one|1)\s*playtester'
    message: "Only one playtester. Multiple testers reveal patterns in player confusion."
    fix_action: "Test with at least 3 fresh players to identify consistent issues"
    applies_to:
      - "*design*.md"
      - "*playtest*.md"

  # ============================================================================
  # HINT SYSTEM VALIDATIONS
  # ============================================================================

  - id: puzzle-hint-spoils-solution
    name: Hint Reveals Full Solution
    severity: warning
    type: regex
    pattern:
      - 'hint.*[=:].*(?:solution|answer|code|password)'
      - 'showHint.*(?:solution|answer)'
    message: "Hint appears to reveal full solution. Use progressive hints that guide, not spoil."
    fix_action: "Implement multi-level hints: direction → focus → partial → full (emergency only)"
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.gd"
      - "*.cs"
      - "*hints*.json"

  - id: puzzle-no-hint-system
    name: No Hint System
    severity: info
    type: regex
    pattern:
      - 'class\s+Puzzle(?![\\s\\S]*hint)'
      - 'puzzle(?![\\s\\S]*(?:hint|help|assist))'
    message: "No hint system detected. Players need escape valve when stuck."
    fix_action: "Implement hint system: time-based triggers or player-requested hints"
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.gd"
      - "*.cs"

  # ============================================================================
  # PUZZLE ORDERING VALIDATIONS
  # ============================================================================

  - id: puzzle-linear-dependency
    name: Linear Puzzle Dependency
    severity: info
    type: regex
    pattern:
      - 'requires.*puzzle\s*(?:\d+|[a-z])$'
      - 'unlock.*after.*puzzle\s*(?:\d+|[a-z])$'
    message: "Linear puzzle dependency. Consider parallel paths to prevent hard blocks."
    fix_action: "Add alternative puzzles that unlock the same progress"
    applies_to:
      - "*design*.md"
      - "*config*.json"
      - "*progression*.json"

  - id: puzzle-no-skip-option
    name: No Skip Mechanism
    severity: info
    type: regex
    pattern:
      - '(?i)required.*puzzle(?![\\s\\S]*(?:skip|bypass|alternate))'
      - 'mustComplete.*puzzle'
    message: "Required puzzle with no skip option. Consider skip with optional penalty."
    fix_action: "Add skip option: time penalty, currency cost, or accessibility setting"
    applies_to:
      - "*design*.md"
      - "*config*.json"

  # ============================================================================
  # ACCESSIBILITY VALIDATIONS
  # ============================================================================

  - id: puzzle-audio-only-cue
    name: Audio-Only Puzzle Cue
    severity: warning
    type: regex
    pattern:
      - '(?i)(?:listen|audio|sound).*(?:for|to).*(?:clue|hint|solution)'
      - '(?i)puzzle.*(?:requires?|needs?).*(?:audio|sound|listen)'
    message: "Audio-only puzzle element. Provide visual alternative for deaf/hard-of-hearing players."
    fix_action: "Add visual indicator that mirrors audio cue"
    applies_to:
      - "*design*.md"
      - "*.ts"
      - "*.js"
      - "*.gd"
      - "*.cs"

  - id: puzzle-timing-critical
    name: Timing-Critical Without Assist
    severity: info
    type: regex
    pattern:
      - '(?i)(?:time|timing|timed|timer).*(?:critical|required|must)'
      - '(?i)(?:must|need|require).*within.*(?:seconds?|milliseconds?)'
    message: "Timing-critical puzzle element. Consider assist mode for motor-impaired players."
    fix_action: "Add accessibility option to extend time windows or skip timing requirements"
    applies_to:
      - "*design*.md"
      - "*.ts"
      - "*.js"

  # ============================================================================
  # COMBINATION/BRUTE FORCE VALIDATIONS
  # ============================================================================

  - id: puzzle-large-combination
    name: Large Combination Space
    severity: warning
    type: regex
    pattern:
      - '(?i)(?:dial|switch|button)s?\s*[:=]\s*[5-9]|1[0-9]'
      - '(?i)(?:options?|positions?|states?)\s*[:=]\s*[5-9]|1[0-9]'
    message: "Large combination space (5+ options). Ensure clues sufficiently narrow possibilities."
    fix_action: "Verify: Can player deduce answer without brute force? Add constraining clues."
    applies_to:
      - "*design*.md"
      - "*puzzle*.md"

  - id: puzzle-random-generation
    name: Random Puzzle Generation
    severity: info
    type: regex
    pattern:
      - 'random.*puzzle'
      - 'generatePuzzle.*Math\.random'
      - 'shuffle.*puzzle'
    message: "Randomly generated puzzle. Ensure generated puzzles are always solvable and fair."
    fix_action: "Add validation: all generated puzzles must pass solvability check"
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.gd"
      - "*.cs"

  # ============================================================================
  # SOFTLOCK PREVENTION VALIDATIONS
  # ============================================================================

  - id: puzzle-consumable-required
    name: Consumable Required for Puzzle
    severity: warning
    type: regex
    pattern:
      - '(?i)(?:consume|use\s+up|destroy).*(?:key|item).*puzzle'
      - '(?i)puzzle.*(?:requires?|needs?).*(?:consumable|one-time)'
    message: "Consumable item required for puzzle. Ensure item can be re-obtained if used wrong."
    fix_action: "Add respawn mechanism or alternative path if consumable is used incorrectly"
    applies_to:
      - "*design*.md"
      - "*.ts"
      - "*.js"

  - id: puzzle-irreversible-state
    name: Irreversible State Change
    severity: warning
    type: regex
    pattern:
      - '(?i)permanent|irreversible|(?:can\'?t|cannot)\s+undo'
      - '(?i)puzzle.*(?:destroy|break).*(?:can\'?t|cannot)\s+(?:restore|reset)'
    message: "Irreversible state change in puzzle. Verify this cannot softlock the player."
    fix_action: "Add auto-save before irreversible actions or provide reset mechanism"
    applies_to:
      - "*design*.md"
      - "*.ts"
      - "*.js"
      - "*.gd"
      - "*.cs"

# ============================================================================
# PUZZLE DESIGN CHECKLIST
# Run through this before considering any puzzle complete
# ============================================================================

checklist:
  - category: "Goal Clarity"
    items:
      - "Is the goal state immediately clear to players?"
      - "Can player tell the difference between success and failure?"
      - "Does solving feel inevitable in hindsight?"

  - category: "Teaching"
    items:
      - "Does the puzzle teach no more than one new concept?"
      - "Is the first encounter with any mechanic in a low-stakes puzzle?"
      - "Can a player learn the mechanic just by playing, not reading?"

  - category: "Fairness"
    items:
      - "Is all required information available within the game?"
      - "Can the solution be deduced without guessing?"
      - "Would a reasonable person try the correct solution?"

  - category: "Feedback"
    items:
      - "Does wrong input provide useful feedback?"
      - "Can players tell when they're making progress?"
      - "Is the cause-and-effect chain visible?"

  - category: "Reset & Recovery"
    items:
      - "Can players reset the puzzle quickly?"
      - "Is failure a learning moment, not a punishment?"
      - "Are there no softlock possibilities?"

  - category: "Pacing"
    items:
      - "Does difficulty increase smoothly from previous puzzle?"
      - "Are there parallel paths if player gets stuck?"
      - "Is hint system available for truly stuck players?"

  - category: "Accessibility"
    items:
      - "Can colorblind players solve color-based puzzles?"
      - "Do audio cues have visual alternatives?"
      - "Are motor-challenged players accommodated for execution puzzles?"

  - category: "Playtesting"
    items:
      - "Has the puzzle been tested with 3+ fresh players?"
      - "Were stuck points identified and addressed?"
      - "Is solve time in expected range?"
