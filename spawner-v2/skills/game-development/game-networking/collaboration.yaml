# Collaboration - Game Networking & Multiplayer
# How this skill works with other specialists

id: game-networking
version: "1.0.0"

# ============================================================================
# INBOUND COLLABORATIONS
# Skills that hand off to game-networking
# ============================================================================

receives_context_from:
  # ---------------------------------------------------------------------------
  # FROM: Unity Development
  # ---------------------------------------------------------------------------
  - skill: unity-development
    relationship: "bidirectional"
    when_summoned:
      - "Multiplayer features needed in Unity project"
      - "Choosing between Netcode for GameObjects, Mirror, Photon"
      - "Network synchronization issues"
    receives:
      - context: "Unity version and existing networking packages"
        importance: high
        example: "Unity 2022.3 LTS, currently using Mirror 79.0"
      - context: "Game type and player count"
        importance: high
        example: "4-player co-op dungeon crawler"
      - context: "Target platforms"
        importance: medium
        example: "PC and console, no mobile"
      - context: "Existing NetworkBehaviour scripts"
        importance: medium
        example: "PlayerController with Command/RPC patterns"
    provides_back:
      - "Networking architecture recommendation"
      - "Synchronization strategy (transform sync, state sync)"
      - "Authority model (server auth vs client auth)"
      - "Bandwidth optimization strategies"
    handoff_protocol: |
      When receiving from Unity:
      1. Check if they have existing networking code
      2. Understand game type (competitive? cooperative?)
      3. Recommend appropriate solution:
         - Netcode for GameObjects: Unity's official, good for new projects
         - Mirror: Community, mature, many examples
         - Photon: Easy cloud hosting, good for casual
         - Custom: Full control, competitive games
      4. Provide Unity-specific implementation patterns

  # ---------------------------------------------------------------------------
  # FROM: Unreal Engine
  # ---------------------------------------------------------------------------
  - skill: unreal-engine
    relationship: "bidirectional"
    when_summoned:
      - "Unreal replication system questions"
      - "Dedicated server architecture in UE"
      - "Blueprint vs C++ networking"
    receives:
      - context: "Unreal Engine version"
        importance: high
        example: "UE 5.3"
      - context: "Game type and scale"
        importance: high
        example: "Battle royale, 100 players"
      - context: "Current replication setup"
        importance: medium
        example: "Using RepNotify for player stats"
    provides_back:
      - "Replication strategy (properties, RPCs)"
      - "Relevancy and priority configuration"
      - "Dedicated server deployment approach"
      - "Network dormancy optimization"
    handoff_protocol: |
      When receiving from Unreal:
      1. Unreal has built-in replication - leverage it
      2. Understand their GameMode/GameState structure
      3. Recommend appropriate patterns:
         - Property replication for state
         - RPCs for events
         - Relevancy for optimization
      4. Address Unreal-specific issues (reliable RPC limits, etc.)

  # ---------------------------------------------------------------------------
  # FROM: Backend
  # ---------------------------------------------------------------------------
  - skill: backend
    relationship: "bidirectional"
    when_summoned:
      - "Need real-time game communication"
      - "WebSocket implementation for games"
      - "Game server scaling questions"
    receives:
      - context: "Current backend stack"
        importance: high
        example: "Node.js with Socket.io"
      - context: "Expected player capacity"
        importance: high
        example: "1000 concurrent players per server"
      - context: "Infrastructure constraints"
        importance: medium
        example: "AWS, need global presence"
    provides_back:
      - "Game server architecture"
      - "Tick loop implementation"
      - "State synchronization approach"
      - "Protocol recommendations (UDP vs WebSocket)"
    handoff_protocol: |
      When receiving from Backend:
      1. Assess if they understand game networking differs from web
      2. Explain tick-based architecture vs request-response
      3. Recommend appropriate transport:
         - WebSocket: Simpler, browser support
         - UDP/WebRTC: Better for real-time
      4. Provide game-specific patterns (authoritative server, etc.)

  # ---------------------------------------------------------------------------
  # FROM: Godot Development
  # ---------------------------------------------------------------------------
  - skill: game-dev-godot
    relationship: "bidirectional"
    when_summoned:
      - "Godot multiplayer implementation"
      - "High-level multiplayer vs low-level"
      - "RPC and synchronization in Godot"
    receives:
      - context: "Godot version"
        importance: high
        example: "Godot 4.2"
      - context: "Multiplayer approach"
        importance: high
        example: "Using high-level multiplayer API"
    provides_back:
      - "Godot networking patterns"
      - "MultiplayerSynchronizer usage"
      - "Authority configuration"
      - "Optimization for Godot"
    handoff_protocol: |
      When receiving from Godot:
      1. Godot 4 has new multiplayer API - confirm version
      2. High-level API works for most cases
      3. MultiplayerSynchronizer for state sync
      4. Custom RPCs for complex cases

# ============================================================================
# OUTBOUND COLLABORATIONS
# Skills that game-networking hands off to
# ============================================================================

provides_context_to:
  # ---------------------------------------------------------------------------
  # TO: Unity Development
  # ---------------------------------------------------------------------------
  - skill: unity-development
    when_to_handoff:
      - "Need Unity-specific implementation details"
      - "NetworkBehaviour script patterns"
      - "Unity physics over network"
    provides:
      - context: "Networking architecture decision"
        example: "Server-authoritative with client prediction"
      - context: "Sync requirements per entity type"
        example: "Players: 20Hz with interpolation, projectiles: events only"
      - context: "Authority model"
        example: "Server owns all combat, client owns camera"
    expects_back:
      - "Unity-specific implementation"
      - "Component setup in editor"
      - "Script references and prefab configuration"
    handoff_message: |
      Handing off to Unity specialist for implementation.

      Architecture decided:
      - [networking model]
      - [sync strategy]
      - [authority rules]

      Need Unity-specific:
      - NetworkBehaviour implementation
      - Prefab and component setup
      - Integration with Unity systems

  # ---------------------------------------------------------------------------
  # TO: Unreal Engine
  # ---------------------------------------------------------------------------
  - skill: unreal-engine
    when_to_handoff:
      - "Need Unreal replication implementation"
      - "C++ networking code for UE"
      - "Blueprint networking setup"
    provides:
      - context: "Replication strategy"
        example: "Use property replication for transform, RPCs for damage"
      - context: "Relevancy requirements"
        example: "Only replicate entities within 5000 units"
      - context: "Dedicated server needs"
        example: "Linux server build for cloud hosting"
    expects_back:
      - "Actor replication setup"
      - "Blueprint or C++ implementation"
      - "Server target configuration"

  # ---------------------------------------------------------------------------
  # TO: Backend / DevOps
  # ---------------------------------------------------------------------------
  - skill: backend
    when_to_handoff:
      - "Need server infrastructure"
      - "Database for player data"
      - "Matchmaking backend service"
    provides:
      - context: "Server requirements"
        example: "Game servers need 2 vCPU, 4GB RAM, run 60-tick loop"
      - context: "Player capacity per server"
        example: "64 players max per dedicated server"
      - context: "Geographic requirements"
        example: "Need servers in NA, EU, Asia for <100ms ping"
    expects_back:
      - "Infrastructure architecture"
      - "Container/orchestration setup"
      - "Scaling strategy"
    handoff_message: |
      Need backend infrastructure for game servers.

      Server requirements:
      - [CPU/memory needs]
      - [tick rate and performance]
      - [player capacity]

      Need:
      - Containerization strategy
      - Orchestration (K8s, ECS)
      - Auto-scaling based on player queue

  - skill: devops
    when_to_handoff:
      - "Deploying game servers at scale"
      - "Container orchestration for game servers"
      - "Global server distribution"
    provides:
      - context: "Server binary/container"
        example: "Docker image with game server, exposes UDP 7777"
      - context: "Scaling triggers"
        example: "New server when queue > 100 players"
      - context: "Health check requirements"
        example: "Server reports player count via HTTP /health"
    expects_back:
      - "Deployment pipeline"
      - "Orchestration configuration"
      - "Monitoring setup"

  # ---------------------------------------------------------------------------
  # TO: Security
  # ---------------------------------------------------------------------------
  - skill: security
    when_to_handoff:
      - "Anti-cheat beyond server authority"
      - "Account security and bans"
      - "DDoS protection for game servers"
    provides:
      - context: "Current authority model"
        example: "Server-authoritative, but need client-side detection"
      - context: "Cheat vectors observed"
        example: "Aimbots, wallhacks, speed hacks"
      - context: "Infrastructure exposure"
        example: "Game servers have public IPs for UDP"
    expects_back:
      - "Additional anti-cheat measures"
      - "Account/ban system design"
      - "DDoS mitigation strategy"
    handoff_message: |
      Need security expertise beyond basic server authority.

      Current protection:
      - [authority model]
      - [validation in place]

      Concerns:
      - [observed exploits]
      - [infrastructure risks]

      Need:
      - Client-side anti-cheat approach
      - Ban system design
      - DDoS protection

  # ---------------------------------------------------------------------------
  # TO: Database
  # ---------------------------------------------------------------------------
  - skill: database
    when_to_handoff:
      - "Player profile storage"
      - "Match history and stats"
      - "Leaderboards at scale"
    provides:
      - context: "Data access patterns"
        example: "Write player stats at match end, read at match start"
      - context: "Consistency requirements"
        example: "Ranked rating must be strongly consistent"
      - context: "Scale"
        example: "1M players, 100K daily matches"
    expects_back:
      - "Database schema design"
      - "Query optimization"
      - "Caching strategy"

# ============================================================================
# BOUNDARY DEFINITIONS
# ============================================================================

boundaries:
  owns:
    - "Network architecture decisions"
    - "Protocol design (packet structure, reliability)"
    - "State synchronization strategy"
    - "Lag compensation techniques"
    - "Client prediction and server reconciliation"
    - "Rollback and lockstep implementation"
    - "Matchmaking algorithm design"
    - "Lobby system logic"
    - "NAT traversal approach"
    - "Bandwidth optimization"
    - "Tick rate and simulation timing"

  delegates:
    - pattern: "Unity-specific implementation"
      to: unity-development
      reason: "Unity has unique NetworkBehaviour patterns and APIs"

    - pattern: "Unreal-specific implementation"
      to: unreal-engine
      reason: "Unreal's replication system is engine-specific"

    - pattern: "Server infrastructure and deployment"
      to: ["backend", "devops"]
      reason: "Infrastructure expertise beyond game networking"

    - pattern: "Game logic and mechanics"
      to: ["unity-development", "unreal-engine", "game-dev-godot"]
      reason: "Core game design is separate from networking"

    - pattern: "Deep security (anti-cheat kernel, DDoS)"
      to: security
      reason: "Specialized security expertise needed"

    - pattern: "Database design and optimization"
      to: database
      reason: "Persistent storage is database specialty"

  shared_concerns:
    - concern: "Performance optimization"
      collaborators: ["backend", "devops"]
      my_role: "Network-layer optimization (packets, sync)"
      their_role: "Server resource optimization (CPU, memory, scaling)"

    - concern: "Security"
      collaborators: ["security"]
      my_role: "Server authority, input validation, basic anti-cheat"
      their_role: "Advanced anti-cheat, account security, DDoS"

    - concern: "Real-time communication"
      collaborators: ["backend"]
      my_role: "Game-specific protocol and state management"
      their_role: "Transport implementation and infrastructure"

# ============================================================================
# COLLABORATION WORKFLOWS
# ============================================================================

workflows:
  new_multiplayer_game:
    description: "Starting a multiplayer game from scratch"
    steps:
      - step: 1
        actor: "game-networking"
        action: "Assess game type, player count, competitiveness"
        output: "Architecture recommendation"

      - step: 2
        actor: "game-networking"
        action: "Design networking model and protocol"
        output: "Network design document"

      - step: 3
        actor: "unity-development OR unreal-engine"
        action: "Implement game-specific networking"
        input: "Network design"
        output: "Working prototype"

      - step: 4
        actor: "backend"
        action: "Set up server infrastructure"
        input: "Server requirements"
        output: "Deployed servers"

      - step: 5
        actor: "game-networking"
        action: "Optimize and tune"
        input: "Playtest feedback"
        output: "Production-ready netcode"

  adding_multiplayer_to_existing:
    description: "Adding multiplayer to single-player game"
    steps:
      - step: 1
        actor: "game-networking"
        action: "Audit existing game systems for network compatibility"
        output: "Refactoring requirements"

      - step: 2
        actor: "unity-development OR unreal-engine"
        action: "Refactor game systems for networking"
        input: "Refactoring plan"

      - step: 3
        actor: "game-networking"
        action: "Implement networking layer"
        output: "Networked game"

  troubleshooting_netcode:
    description: "Debugging networking issues"
    steps:
      - step: 1
        actor: "game-networking"
        action: "Diagnose issue category (desync, lag, disconnects)"
        output: "Root cause analysis"

      - step: 2
        actor: "game-networking"
        action: "Implement fix"
        output: "Solution"

      - step: 3
        handoff_if: "Issue is infrastructure-related"
        to: "devops"
        context: "Server-side investigation needed"

# ============================================================================
# COMMUNICATION PROTOCOL
# ============================================================================

communication:
  handoff_format: |
    ## Handoff to {skill}

    ### Context
    {what_we_were_working_on}

    ### Decisions Made
    {networking_decisions}

    ### What You Need to Do
    {specific_task}

    ### Constraints
    {technical_constraints}

    ### Questions
    {open_questions}

  receiving_format: |
    ## Received from {skill}

    ### Understanding
    - Game type: {type}
    - Player count: {count}
    - Competitiveness: {level}

    ### Networking Plan
    {plan}

    ### Clarifications Needed
    {questions}

  status_updates:
    - "Analyzing network requirements..."
    - "Designing synchronization strategy..."
    - "Implementing netcode patterns..."
    - "Optimizing bandwidth..."
    - "Testing latency compensation..."

# ============================================================================
# ESCALATION PATHS
# ============================================================================

escalation:
  when_stuck:
    - condition: "Complex engine-specific networking"
      escalate_to: ["unity-development", "unreal-engine"]
      reason: "Engine specialist has deeper knowledge"

    - condition: "Infrastructure scaling issues"
      escalate_to: "devops"
      reason: "Infrastructure expertise needed"

    - condition: "Sophisticated cheating"
      escalate_to: "security"
      reason: "Security specialist for anti-cheat"

  when_to_take_over:
    - condition: "Engine skill encounters networking design decisions"
      from: ["unity-development", "unreal-engine"]
      reason: "Networking architecture is my domain"

    - condition: "Backend needs game-specific protocol"
      from: "backend"
      reason: "Game networking patterns differ from web"
