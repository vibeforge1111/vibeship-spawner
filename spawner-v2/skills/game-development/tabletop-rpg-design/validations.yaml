# Tabletop RPG Design Validations
# Automated checks for game design documents and mechanics
# These patterns catch common design anti-patterns before playtesting

validations:
  # PROBABILITY AND DICE MECHANICS

  - id: punishing-target-numbers
    name: Punishing Difficulty Numbers on d20
    severity: warning
    type: regex
    pattern:
      - "DC\\s*(1[8-9]|2[0-5])"
      - "target.*number.*(1[8-9]|2[0-9])"
      - "difficulty.*(1[8-9]|2[0-5])"
    message: "High target numbers (18+) on d20 create feel-bad failure rates. DC 18 = 15% success for untrained, 35% for trained (+4)."
    fix_action: "Consider lower DCs with interesting failure consequences, or advantage/disadvantage system"
    applies_to:
      - "**/*.md"
      - "**/*.txt"
      - "**/rules/**"
      - "**/mechanics/**"

  - id: whiff-factor-binary
    name: Binary Pass/Fail Without Gradation
    severity: warning
    type: regex
    pattern:
      - "success.*failure.*nothing"
      - "fail.*try again"
      - "on a failure.*happens"
    message: "Binary success/failure creates whiff factor. Players spending actions for 'nothing happens' is unfun."
    fix_action: "Add partial success tier (7-9 in PbtA) or fail-forward consequences"
    applies_to:
      - "**/*.md"
      - "**/*.txt"
      - "**/rules/**"
      - "**/mechanics/**"

  - id: modifier-stacking-complexity
    name: Multiple Modifier Sources
    severity: warning
    type: regex
    pattern:
      - "\\+[0-9].*\\+[0-9].*\\+[0-9]"
      - "bonus.*stack"
      - "cumulative.*modifier"
      - "add.*bonus.*from"
    message: "Multiple stacking modifiers slow play and create rules-lawyer opportunities. Consider advantage/disadvantage or position/effect instead."
    fix_action: "Collapse to 3 max modifier sources: base + situational + special"
    applies_to:
      - "**/*.md"
      - "**/*.txt"
      - "**/rules/**"

  - id: death-spiral-penalty
    name: Wound Penalties Creating Death Spiral
    severity: warning
    type: regex
    pattern:
      - "wound.*-[0-9]"
      - "injury.*penalty"
      - "damage.*reduces.*ability"
      - "hurt.*disadvantage"
    message: "Wound penalties create death spirals where injured characters become less effective, accelerating their demise."
    fix_action: "Separate 'wounded state' from 'combat effectiveness' or make wounds narrative only"
    applies_to:
      - "**/*.md"
      - "**/*.txt"
      - "**/combat/**"

  # CHARACTER CREATION

  - id: skill-list-bloat
    name: Excessive Skill List
    severity: info
    type: regex
    pattern:
      - "skills?:.*\\n(.*\\n){15,}"
      - "skill list:.*\\n(.*\\n){12,}"
    message: "Skill lists beyond 12 skills create choice paralysis and unused options. PbtA uses 5 stats, BitD uses 12 action ratings."
    fix_action: "Consolidate overlapping skills. 'Athletics' covers climb, swim, run. 'Influence' covers persuade, intimidate, deceive."
    applies_to:
      - "**/*.md"
      - "**/*.txt"
      - "**/character/**"

  - id: dump-stat-trap
    name: Obvious Dump Stat Design
    severity: warning
    type: regex
    pattern:
      - "charisma.*only.*social"
      - "intelligence.*wizard"
      - "rarely.*used.*stat"
    message: "Stats that don't matter for certain builds become dump stats. Every stat should matter to every character."
    fix_action: "Add secondary uses: Charisma for morale, Intelligence for knowledge, Strength for encumbrance"
    applies_to:
      - "**/*.md"
      - "**/*.txt"
      - "**/character/**"

  - id: trap-option-design
    name: Potentially Unviable Option
    severity: info
    type: regex
    pattern:
      - "situational.*use"
      - "rarely.*applicable"
      - "niche.*ability"
    message: "Niche options that rarely apply can be trap choices for inexperienced players. Consider if this option earns its rules-space."
    fix_action: "Either make the option more broadly useful or explicitly label it as situational"
    applies_to:
      - "**/*.md"
      - "**/*.txt"
      - "**/abilities/**"
      - "**/feats/**"

  - id: character-creation-time
    name: Complex Character Creation
    severity: info
    type: regex
    pattern:
      - "step [5-9]"
      - "step 1[0-9]"
      - "calculate.*derived"
      - "consult.*table"
    message: "Character creation with 5+ steps or table lookups takes too long for one-shots. Target 15 minutes."
    fix_action: "Use playbooks, pregens, or 'quick start' rules for one-shots"
    applies_to:
      - "**/*.md"
      - "**/*.txt"
      - "**/character/**"

  # COMBAT DESIGN

  - id: combat-slog-indicators
    name: Combat Duration Risk
    severity: warning
    type: regex
    pattern:
      - "round.*[5-9]"
      - "each.*round.*player"
      - "initiative.*order.*maintain"
      - "track.*hit points"
    message: "Systems tracking many rounds, individual initiative, and HP can lead to 45+ minute combats. Consider streamlined alternatives."
    fix_action: "Add morale rules, decisive blow mechanics, or one-roll resolution for minor encounters"
    applies_to:
      - "**/*.md"
      - "**/*.txt"
      - "**/combat/**"

  - id: spotlight-hoarding
    name: Single Character Required for Task
    severity: warning
    type: regex
    pattern:
      - "only.*can"
      - "requires.*class"
      - "must have.*skill"
      - "necessary.*ability"
    message: "Tasks requiring specific characters create spotlight hoarding. Other players sit idle."
    fix_action: "Allow multiple solutions or group actions where everyone participates"
    applies_to:
      - "**/*.md"
      - "**/*.txt"
      - "**/rules/**"

  - id: initiative-complexity
    name: Complex Initiative System
    severity: info
    type: regex
    pattern:
      - "roll.*initiative.*modifier"
      - "initiative.*order.*each.*round"
      - "re-roll.*initiative"
    message: "Complex initiative systems slow combat start. Consider side-based, popcorn, or fiction-first initiative."
    fix_action: "Simplify: side initiative (party rolls once), popcorn (players choose order), or no initiative (fictional positioning)"
    applies_to:
      - "**/*.md"
      - "**/*.txt"
      - "**/combat/**"

  # GAME MASTER TOOLS

  - id: gm-dependency
    name: Rules Requiring GM Interpretation
    severity: info
    type: regex
    pattern:
      - "GM decides"
      - "DM discretion"
      - "referee determines"
      - "narrator chooses"
    message: "Frequent GM interpretation requirements burn out GMs and create table-to-table inconsistency."
    fix_action: "Add procedures, tables, or default rulings. 'If unclear, assume the player succeeds with a complication.'"
    applies_to:
      - "**/*.md"
      - "**/*.txt"
      - "**/rules/**"

  - id: missing-procedure
    name: Vague Procedural Guidance
    severity: info
    type: regex
    pattern:
      - "when.*appropriate"
      - "as.*needed"
      - "the GM should"
      - "if.*makes sense"
    message: "Vague guidance ('when appropriate') leaves GMs guessing. Clear procedures help new GMs."
    fix_action: "Add step-by-step procedure or triggers: 'Roll for random encounter every 2 turns'"
    applies_to:
      - "**/*.md"
      - "**/*.txt"
      - "**/gm/**"

  - id: quantum-ogre
    name: Forced Encounter Design
    severity: info
    type: regex
    pattern:
      - "regardless.*path"
      - "whichever.*direction"
      - "no matter.*choice"
    message: "Encounters that happen regardless of player choice (quantum ogre) undermine agency. Players sense illusory choice."
    fix_action: "Prep situations in locations. If players don't go there, the content stays there (or advances independently via clocks)."
    applies_to:
      - "**/*.md"
      - "**/*.txt"
      - "**/adventures/**"

  # INVESTIGATION AND MYSTERY

  - id: clue-behind-roll
    name: Critical Clue Behind Single Roll
    severity: warning
    type: regex
    pattern:
      - "roll.*find.*clue"
      - "check.*discover.*evidence"
      - "perception.*notice.*hidden"
      - "search.*success.*reveals"
    message: "Locking critical clues behind single rolls stalls investigations on failed rolls."
    fix_action: "GUMSHOE principle: finding clues is automatic, rolls are for extra details. Or use Three-Clue Rule (redundant paths)."
    applies_to:
      - "**/*.md"
      - "**/*.txt"
      - "**/investigation/**"
      - "**/mystery/**"

  # NARRATIVE AND SAFETY

  - id: missing-safety-tools
    name: No Safety Tool Reference
    severity: info
    type: regex
    pattern:
      - "^(?!.*x-card)(?!.*lines.*veils)(?!.*safety).*$"
    message: "Consider including safety tool references (X-Card, Lines and Veils, Script Change) in core rules or Session Zero guidance."
    fix_action: "Add a Safety Tools section referencing established techniques"
    applies_to:
      - "**/session-zero/**"
      - "**/introduction/**"
      - "**/core-rules/**"

  - id: mother-may-i
    name: Permission-Based Design
    severity: warning
    type: regex
    pattern:
      - "ask.*GM.*permission"
      - "GM.*allows"
      - "if.*GM.*permits"
      - "request.*DM.*approval"
    message: "Permission-based mechanics ('ask the GM if...') transfer agency to GM and create bottlenecks."
    fix_action: "Give players resources they can spend without permission. Flashbacks in BitD, Fate points, etc."
    applies_to:
      - "**/*.md"
      - "**/*.txt"
      - "**/rules/**"

  # ADVANCEMENT

  - id: numerical-inflation
    name: Level-Based Number Inflation
    severity: info
    type: regex
    pattern:
      - "level.*\\+[0-9]"
      - "per.*level.*bonus"
      - "scale.*with.*level"
    message: "If progression is primarily numerical (+X per level), gameplay doesn't change. Level 10 feels like level 1 with bigger numbers."
    fix_action: "Add capability expansion: new abilities that change WHAT you can do, not just how well you do it"
    applies_to:
      - "**/*.md"
      - "**/*.txt"
      - "**/advancement/**"
      - "**/progression/**"

  - id: feat-tax-pattern
    name: Prerequisite Chain Depth
    severity: info
    type: regex
    pattern:
      - "requires.*prerequisite"
      - "must.*have.*before"
      - "unlock.*after.*taking"
    message: "Deep prerequisite chains (feat taxes) delay character concepts. Players spend early levels paying entry fees."
    fix_action: "Reduce chains to 1 prerequisite max, or remove prerequisites entirely"
    applies_to:
      - "**/*.md"
      - "**/*.txt"
      - "**/feats/**"
      - "**/abilities/**"

  # EQUIPMENT AND RESOURCES

  - id: equipment-list-length
    name: Exhaustive Equipment Lists
    severity: info
    type: regex
    pattern:
      - "equipment.*table"
      - "price.*list"
      - "item.*cost.*weight"
    message: "Long equipment lists with individual prices slow character creation and create shopping sessions."
    fix_action: "Use loadout systems (light/medium/heavy), abstract wealth, or equipment kits"
    applies_to:
      - "**/*.md"
      - "**/*.txt"
      - "**/equipment/**"
      - "**/gear/**"

  # SOCIAL MECHANICS

  - id: social-combat-hp
    name: Social HP System
    severity: info
    type: regex
    pattern:
      - "social.*hit points"
      - "influence.*points"
      - "persuasion.*damage"
      - "reduce.*resistance"
    message: "Social 'HP' systems make NPCs feel like obstacles to whittle down, not characters to engage with."
    fix_action: "Use disposition shifts, NPC wants/fears, or single-roll social resolution"
    applies_to:
      - "**/*.md"
      - "**/*.txt"
      - "**/social/**"
      - "**/intrigue/**"

  # PBTA AND FITD SPECIFIC

  - id: pbta-stat-range
    name: PbtA Stat Range Issues
    severity: warning
    type: regex
    pattern:
      - "stat.*\\+[4-9]"
      - "modifier.*\\+[4-9]"
      - "bonus.*greater.*\\+3"
    message: "2d6+stat systems break with stats beyond +3. A +4 modifier makes 10+ (full success) nearly guaranteed (83%)."
    fix_action: "Keep PbtA stats in -1 to +3 range. Use different advancement (new moves, not higher stats)."
    applies_to:
      - "**/*.md"
      - "**/*.txt"
      - "**/pbta/**"
      - "**/apocalypse/**"

  - id: fitd-action-bloat
    name: FitD Action Rating Proliferation
    severity: info
    type: regex
    pattern:
      - "action.*rating.*1[5-9]"
      - "actions:.*\\n(.*\\n){14,}"
    message: "Forged in the Dark works with ~12 action ratings. More creates overlap and decision paralysis."
    fix_action: "Consolidate similar actions. If in doubt, cut rather than add."
    applies_to:
      - "**/*.md"
      - "**/*.txt"
      - "**/fitd/**"
      - "**/blades/**"
