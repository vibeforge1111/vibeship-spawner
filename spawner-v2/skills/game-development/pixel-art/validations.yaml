id: pixel-art
skill: Pixel Art Mastery
version: "2.0"

validations:
  # Image configuration checks
  - id: pixelart-no-antialiasing
    name: Anti-aliasing Disabled in Renderer
    severity: error
    type: regex
    pattern:
      - 'antialias:\s*true'
      - 'antiAlias:\s*true'
      - 'anti-alias:\s*true'
      - "image-rendering:\\s*auto"
      - 'smoothing:\\s*true'
      - 'imageSmoothingEnabled\\s*=\\s*true'
    message: "Anti-aliasing must be disabled for pixel art. Use antialias: false and nearest-neighbor filtering."
    fix_action: "Set antialias: false, pixelArt: true, and image-rendering: pixelated"
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.tsx"
      - "*.jsx"
      - "*.css"

  - id: pixelart-integer-scaling
    name: Non-Integer Scale Values
    severity: warning
    type: regex
    pattern:
      - 'setScale\\s*\\(\\s*[0-9]*\\.[0-9]+[^,\\)]*\\)'
      - 'scale\\s*[:=]\\s*[0-9]*\\.[0-9]+(?!\\s*[*/])'
      - 'scale\\(\\s*[0-9]*\\.[1-9]'
      - 'zoom:\\s*[0-9]*\\.[0-9]+'
    message: "Pixel art should use integer scaling only (1, 2, 3...). Non-integer scaling causes uneven pixels."
    fix_action: "Use Math.floor() to ensure integer scale values: Math.floor(screenWidth / gameWidth)"
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.tsx"
      - "*.jsx"

  - id: pixelart-rotation-check
    name: Rotation Applied to Pixel Art Sprites
    severity: warning
    type: regex
    pattern:
      - '\\.rotation\\s*=\\s*[^0]'
      - '\\.angle\\s*=\\s*(?!0|90|180|270|-90|-180|-270)'
      - 'rotate\\(\\s*(?!0|90|180|270|Math\\.PI|Math\\.PI\\s*/\\s*2)'
      - 'transform:\\s*rotate\\(\\s*(?!0deg|90deg|180deg|270deg)'
    message: "Rotating pixel art by non-90-degree angles destroys pixel grid. Use pre-rendered rotation frames instead."
    fix_action: "Create separate sprite frames for each rotation angle, or limit to 90-degree increments"
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.tsx"
      - "*.jsx"
      - "*.css"

  - id: pixelart-phaser-config
    name: Phaser Pixel Art Configuration
    severity: error
    type: regex
    pattern:
      - 'pixelArt:\\s*false'
      - 'roundPixels:\\s*false'
    message: "Phaser config must have pixelArt: true and roundPixels: true for pixel art games."
    fix_action: "Add to Phaser config: render: { pixelArt: true, roundPixels: true, antialias: false }"
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.tsx"
      - "*.jsx"

  # Color palette checks
  - id: pixelart-color-count-warning
    name: Excessive Color Count
    severity: warning
    type: regex
    pattern:
      - '#[0-9a-fA-F]{6}.{0,100}#[0-9a-fA-F]{6}.{0,100}#[0-9a-fA-F]{6}.{0,100}#[0-9a-fA-F]{6}.{0,100}#[0-9a-fA-F]{6}.{0,100}#[0-9a-fA-F]{6}.{0,100}#[0-9a-fA-F]{6}.{0,100}#[0-9a-fA-F]{6}.{0,100}#[0-9a-fA-F]{6}.{0,100}#[0-9a-fA-F]{6}.{0,100}#[0-9a-fA-F]{6}.{0,100}#[0-9a-fA-F]{6}.{0,100}#[0-9a-fA-F]{6}.{0,100}#[0-9a-fA-F]{6}.{0,100}#[0-9a-fA-F]{6}.{0,100}#[0-9a-fA-F]{6}.{0,100}#[0-9a-fA-F]{6}'
    message: "Detected many color values. Pixel art typically uses 8-32 colors. Consider using a defined palette constant."
    fix_action: "Define colors in a palette object and reference by name: palette.skinLight, palette.skinDark"
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.tsx"
      - "*.jsx"
      - "*.css"

  # Export and format checks
  - id: pixelart-jpeg-export
    name: JPEG Format for Pixel Art
    severity: error
    type: regex
    pattern:
      - '\\.jpe?g["\']\\s*(?:as\\s+)?(?:sprite|texture|tileset|atlas|sheet)'
      - 'load\\.image\\([^)]+\\.jpe?g'
      - 'load\\.spritesheet\\([^)]+\\.jpe?g'
      - "src=['\"][^'\"]+sprite[^'\"]*\\.jpe?g"
    message: "JPEG causes compression artifacts in pixel art. Use PNG format instead."
    fix_action: "Export sprites as PNG (indexed color for best results) instead of JPEG"
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.tsx"
      - "*.jsx"
      - "*.html"

  # Animation timing checks
  - id: pixelart-animation-too-fast
    name: Animation Frame Duration Too Short
    severity: warning
    type: regex
    pattern:
      - 'duration:\\s*[1-4][0-9](?![0-9])'
      - 'frameTime:\\s*[1-4][0-9](?![0-9])'
      - 'frameRate:\\s*[3-9][0-9]'
    message: "Frame duration under 50ms (or frameRate over 30) may be too fast for pixel art. Typical range: 80-200ms."
    fix_action: "For walk cycles: 100-150ms. For idle: 200-400ms. For attacks: 50-100ms (only impact frames)."
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.tsx"
      - "*.jsx"

  # Canvas settings checks
  - id: pixelart-canvas-context
    name: Canvas 2D Context Missing Pixel Art Settings
    severity: warning
    type: regex
    pattern:
      - 'getContext\\(["\']2d["\']\\)(?![\\s\\S]{0,100}imageSmoothingEnabled\\s*=\\s*false)'
    message: "Canvas 2D context should have imageSmoothingEnabled = false for pixel art."
    fix_action: "After getContext('2d'), add: ctx.imageSmoothingEnabled = false"
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.tsx"
      - "*.jsx"

  # Sprite loading checks
  - id: pixelart-missing-framesize
    name: Spritesheet Loaded Without Frame Dimensions
    severity: warning
    type: regex
    pattern:
      - 'load\\.spritesheet\\([^)]+\\)(?![\\s\\S]{0,30}frameWidth)'
      - 'load\\.atlas\\([^)]+\\)(?![\\s\\S]{0,30}\\.json)'
    message: "Spritesheet loading should specify frame dimensions or use JSON atlas for consistent frame sizes."
    fix_action: "Specify frameWidth and frameHeight, or export with JSON metadata from Aseprite"
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.tsx"
      - "*.jsx"

  # Subpixel movement checks
  - id: pixelart-position-rounding
    name: Sprite Position Not Rounded
    severity: warning
    type: regex
    pattern:
      - '\\.x\\s*\\+=\\s*[^;]+\\*\\s*delta'
      - '\\.y\\s*\\+=\\s*[^;]+\\*\\s*delta'
      - 'position\\.x\\s*\\+=\\s*velocity'
      - 'position\\.y\\s*\\+=\\s*velocity'
    message: "Sprite positions should be rounded to integers for rendering to prevent subpixel jitter."
    fix_action: "Store subpixel position separately, render at Math.floor(position). Example: renderX = Math.floor(subPixelX)"
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.tsx"
      - "*.jsx"

  # CSS image-rendering check
  - id: pixelart-css-rendering
    name: Missing Pixelated Image Rendering
    severity: warning
    type: regex
    pattern:
      - 'canvas\\s*\\{[^}]+\\}(?![^}]*image-rendering)'
      - '\\.game[^{]*\\{[^}]+\\}(?![^}]*image-rendering)'
      - '#game[^{]*\\{[^}]+\\}(?![^}]*image-rendering)'
    message: "Canvas or game container should have image-rendering: pixelated for crisp pixel art scaling."
    fix_action: "Add CSS: canvas { image-rendering: pixelated; image-rendering: crisp-edges; }"
    applies_to:
      - "*.css"
      - "*.scss"
      - "*.less"

  # WebGL/Three.js pixel art checks
  - id: pixelart-webgl-filtering
    name: WebGL Texture Using Linear Filtering
    severity: error
    type: regex
    pattern:
      - 'texture\\.minFilter\\s*=\\s*THREE\\.LinearFilter'
      - 'texture\\.magFilter\\s*=\\s*THREE\\.LinearFilter'
      - 'gl\\.texParameteri[^;]+LINEAR'
    message: "Pixel art textures must use NEAREST filtering, not LINEAR. Linear filtering blurs pixels."
    fix_action: "Use NearestFilter: texture.minFilter = THREE.NearestFilter; texture.magFilter = THREE.NearestFilter"
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.tsx"
      - "*.jsx"

  # Unity-specific checks (for C# files)
  - id: pixelart-unity-filtermode
    name: Unity Sprite Filter Mode
    severity: warning
    type: regex
    pattern:
      - 'FilterMode\\.Bilinear'
      - 'FilterMode\\.Trilinear'
    message: "Unity sprites for pixel art should use FilterMode.Point to prevent blurring."
    fix_action: "Set sprite FilterMode to Point in import settings or via script"
    applies_to:
      - "*.cs"

  # Godot-specific checks
  - id: pixelart-godot-filter
    name: Godot Texture Filter Setting
    severity: warning
    type: regex
    pattern:
      - 'texture_filter\\s*=\\s*[12345]'
      - 'filter\\s*=\\s*true'
    message: "Godot pixel art should use TEXTURE_FILTER_NEAREST (0) or filter = false."
    fix_action: "Set texture_filter = TEXTURE_FILTER_NEAREST in CanvasItem or material"
    applies_to:
      - "*.gd"
      - "*.gdshader"
      - "*.tres"
      - "*.tscn"
