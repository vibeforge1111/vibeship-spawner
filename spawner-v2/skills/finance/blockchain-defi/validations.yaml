validations:

  - id: no-reentrancy-guard
    name: State Change Without Reentrancy Guard
    severity: error
    type: regex
    pattern:
      - "function.*external(?!.*nonReentrant).*\\{[^}]*\\.call\\{"
      - "\\.call\\{value:.*balances\\[.*\\].*-="
    message: "External calls with state changes need reentrancy protection."
    fix_action: "Add ReentrancyGuard modifier from OpenZeppelin"
    applies_to:
      - "**/*.sol"

  - id: spot-price-oracle
    name: Using Spot Price Instead of TWAP
    severity: error
    type: regex
    pattern:
      - "reserve[01].*\\/.*reserve[10](?!.*twap|.*observe)"
      - "getReserves.*price.*(?!.*twap)"
    message: "Spot price is manipulable via flash loans. Use TWAP."
    fix_action: "Use pool.observe() for TWAP or Chainlink oracle"
    applies_to:
      - "**/*.sol"

  - id: no-slippage-protection
    name: Swap Without Slippage Protection
    severity: error
    type: regex
    pattern:
      - "swapExact.*\\(.*,.*0,.*\\)"
      - "swap.*amountOutMin.*=.*0"
    message: "Zero slippage tolerance guarantees sandwich attacks."
    fix_action: "Set minAmountOut to at least 99% of expected output"
    applies_to:
      - "**/*.sol"
      - "**/*swap*.py"

  - id: max-approval
    name: Unlimited Token Approval
    severity: warning
    type: regex
    pattern:
      - "approve.*type\\(uint256\\)\\.max"
      - "approve.*MaxUint256"
      - "approve.*2\\*\\*256"
    message: "Unlimited approvals create long-term risk if contract is compromised."
    fix_action: "Approve only exact amount needed, or use permit"
    applies_to:
      - "**/*.sol"
      - "**/*.js"
      - "**/*.ts"

  - id: no-deadline
    name: Transaction Without Deadline
    severity: warning
    type: regex
    pattern:
      - "swap.*deadline.*=.*0"
      - "addLiquidity(?!.*deadline)"
    message: "Transactions without deadline can be held and executed at bad prices."
    fix_action: "Set deadline to block.timestamp + reasonable duration"
    applies_to:
      - "**/*.sol"

  - id: hardcoded-addresses
    name: Hardcoded Contract Addresses
    severity: info
    type: regex
    pattern:
      - "address.*=.*0x[a-fA-F0-9]{40}[^;]*;"
    message: "Consider using registry pattern for upgradeability."
    fix_action: "Use address registry or constructor parameters"
    applies_to:
      - "**/*.sol"
