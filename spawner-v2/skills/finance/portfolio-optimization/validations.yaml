validations:

  - id: no-covariance-shrinkage
    name: Raw Covariance Without Shrinkage
    severity: warning
    type: regex
    pattern:
      - "\\.cov\\(\\)(?!.*ledoit|.*shrink|.*regulariz)"
      - "np\\.cov(?!.*shrink)"
    message: "Raw sample covariance leads to unstable optimization."
    fix_action: "Use Ledoit-Wolf shrinkage: LedoitWolf().fit(returns)"
    applies_to:
      - "**/*portfolio*.py"
      - "**/*optim*.py"

  - id: historical-returns-only
    name: Historical Returns as Expected Returns
    severity: warning
    type: regex
    pattern:
      - "\\.mean\\(\\).*expected|expected.*\\.mean\\(\\)"
      - "mu.*=.*returns\\.mean"
    message: "Historical mean returns have huge estimation error."
    fix_action: "Shrink returns toward global mean or use Black-Litterman"
    applies_to:
      - "**/*portfolio*.py"

  - id: unconstrained-optimization
    name: Optimization Without Weight Constraints
    severity: warning
    type: regex
    pattern:
      - "minimize.*(?!bounds|constraint)"
      - "optimize.*(?!max_weight|min_weight)"
    message: "Unconstrained optimization leads to extreme positions."
    fix_action: "Add bounds: [(0, 0.2) for _ in range(n_assets)]"
    applies_to:
      - "**/*optim*.py"

  - id: no-equal-weight-comparison
    name: No Equal Weight Benchmark
    severity: info
    type: regex
    pattern:
      - "class.*Portfolio(?!.*equal|.*benchmark|.*1_n)"
    message: "Consider comparing to 1/N equal weight benchmark."
    fix_action: "Add: equal_weight = np.ones(n) / n as baseline"
    applies_to:
      - "**/*portfolio*.py"

  - id: no-turnover-constraint
    name: Optimization Without Turnover Consideration
    severity: info
    type: regex
    pattern:
      - "rebalance(?!.*turnover|.*cost|.*threshold)"
    message: "Consider turnover costs in rebalancing decisions."
    fix_action: "Add turnover constraint or threshold-based rebalancing"
    applies_to:
      - "**/*rebalance*.py"
      - "**/*portfolio*.py"

  - id: no-walk-forward
    name: No Walk-Forward Validation
    severity: warning
    type: regex
    pattern:
      - "backtest.*(?!walk.?forward|TimeSeriesSplit|rolling)"
    message: "In-sample backtesting overstates performance."
    fix_action: "Use TimeSeriesSplit for walk-forward validation"
    applies_to:
      - "**/*backtest*.py"
      - "**/*portfolio*.py"
