id: stripe-integration-collaboration
skill: stripe-integration
version: 1.0.0

# ============================================================================
# RECEIVES FROM (Who delegates TO this skill)
# ============================================================================
receives_from:
  - skill: product-strategy
    context: "Product needs monetization"
    receives:
      - "Pricing model"
      - "Subscription tiers"
      - "Payment requirements"
    provides: "Payment implementation"

  - skill: supabase-backend
    context: "Backend needs billing"
    receives:
      - "User model"
      - "Subscription state schema"
      - "Webhook handlers"
    provides: "Billing system integration"

  - skill: nextjs-supabase-auth
    context: "Auth needs customer sync"
    receives:
      - "User sessions"
      - "Customer creation triggers"
      - "Account linking"
    provides: "Stripe customer sync"

  - skill: founder-operating-system
    context: "Startup needs revenue"
    receives:
      - "Revenue goals"
      - "Pricing strategy"
      - "Launch timeline"
    provides: "Payment infrastructure"

# ============================================================================
# DELEGATION TRIGGERS
# ============================================================================
delegation_triggers:
  - trigger: "database|sync|state|schema"
    delegate_to: supabase-backend
    pattern: sequential
    context: "Stripe needs database sync"
    handoff_data:
      - "Subscription schema"
      - "Customer mapping"
      - "Webhook event storage"
    receive: "Database layer"

  - trigger: "checkout|pricing|ui|form"
    delegate_to: frontend
    pattern: parallel
    context: "Stripe needs checkout UI"
    handoff_data:
      - "Checkout session"
      - "Pricing display"
      - "Portal link"
    receive: "Checkout components"

  - trigger: "security|pci|audit"
    delegate_to: security
    pattern: parallel
    context: "Payments need security review"
    handoff_data:
      - "Payment flow"
      - "Token handling"
      - "Webhook verification"
    receive: "Security validation"

  - trigger: "auth|user|customer"
    delegate_to: nextjs-supabase-auth
    pattern: sequential
    context: "Stripe needs user context"
    handoff_data:
      - "User session"
      - "Customer creation"
      - "Account linking"
    receive: "User authentication"

# ============================================================================
# FEEDBACK LOOPS
# ============================================================================
feedback_loops:
  receives_feedback_from:
    - skill: analytics-architecture
      signal: "Conversion data"
      action: "Optimize checkout flow"

    - skill: customer-success
      signal: "Billing issues"
      action: "Improve payment handling"

    - skill: product-strategy
      signal: "Pricing changes"
      action: "Update price configuration"

  sends_feedback_to:
    - skill: product-strategy
      signal: "Payment metrics"
      action: "Inform pricing decisions"

    - skill: frontend
      signal: "Checkout updates"
      action: "Update UI components"

    - skill: backend
      signal: "Subscription status"
      action: "Feature gating logic"

# ============================================================================
# CROSS-DOMAIN INSIGHTS
# ============================================================================
cross_domain_insights:
  - domain: Financial Engineering
    insight: |
      Financial engineers know money:
      - Idempotency prevents duplicates
      - Webhooks are source of truth
      - Edge cases cost real money
      - Audit trails are essential
      Payments require financial rigor.
    applies_when: "Handling payment operations"

  - domain: Event-Driven Architecture
    insight: |
      Event architects know async:
      - Events can arrive out of order
      - Duplicate handling is critical
      - State machines model lifecycles
      - Queues provide reliability
      Stripe webhooks follow event patterns.
    applies_when: "Processing webhooks"

# ============================================================================
# COMMON COMBINATIONS
# ============================================================================
common_combinations:
  - name: SaaS Billing
    skills:
      - stripe-integration
      - supabase-backend
      - nextjs-supabase-auth
      - frontend
    workflow: |
      1. User authentication (nextjs-supabase-auth)
      2. Customer creation (stripe-integration)
      3. Subscription management (stripe-integration)
      4. Feature gating (supabase-backend)

  - name: Payment Launch
    skills:
      - stripe-integration
      - product-strategy
      - landing-page-design
      - analytics-architecture
    workflow: |
      1. Pricing strategy (product-strategy)
      2. Checkout implementation (stripe-integration)
      3. Pricing page (landing-page-design)
      4. Conversion tracking (analytics-architecture)
