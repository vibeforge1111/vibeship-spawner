# Collaboration - File Uploads
version: 1.0.0
skill_id: file-uploads

prerequisites:
  recommended:
    - skill: security-owasp
      reason: "Upload security"
      what_to_know:
        - "Path traversal"
        - "File type validation"

delegation_triggers:
  - trigger: "image optimization CDN"
    delegate_to: performance-optimization
    context: "Image delivery"

  - trigger: "storing file metadata"
    delegate_to: postgres-wizard
    context: "Database schema"

provides_context_to:
  - skill: forms-validation
    provides:
      - "File input handling"
      - "Size validation"

collaboration_patterns:
  with_nextjs:
    when: "File uploads in Next.js"
    approach: |
      ## Next.js Upload Pattern

      // app/api/upload/route.ts
      import { S3Client, PutObjectCommand } from "@aws-sdk/client-s3";
      import { getSignedUrl } from "@aws-sdk/s3-request-presigner";

      const s3 = new S3Client({
        region: "auto",
        endpoint: process.env.R2_ENDPOINT,
        credentials: {
          accessKeyId: process.env.R2_ACCESS_KEY!,
          secretAccessKey: process.env.R2_SECRET_KEY!,
        },
      });

      export async function POST(req: Request) {
        const { filename, contentType } = await req.json();
        
        const key = "uploads/" + crypto.randomUUID();
        
        const url = await getSignedUrl(
          s3,
          new PutObjectCommand({
            Bucket: process.env.R2_BUCKET,
            Key: key,
            ContentType: contentType,
          }),
          { expiresIn: 3600 }
        );

        return Response.json({ url, key });
      }

ecosystem:
  storage:
    - name: "Cloudflare R2"
      use_when: "Cost-effective, S3-compatible"
    - name: "AWS S3"
      use_when: "Full AWS ecosystem"
    - name: "Vercel Blob"
      use_when: "Simple Vercel integration"

  processing:
    - name: "sharp"
      use_when: "Server-side image processing"
    - name: "Cloudflare Images"
      use_when: "Edge image optimization"
