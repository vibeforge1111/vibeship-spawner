# Validations - File Uploads
version: 1.0.0
skill_id: file-uploads

validations:
  - id: extension-only-check
    name: Only checking file extension
    severity: critical
    type: regex
    pattern:
      - 'endsWith\(["\x27]\.(jpg|png|gif)'
      - '\.split\(["\x27]\.\)["\x27]'
    message: "Check magic bytes, not just extension"
    fix_action: "Use file-type library to verify actual type"
    applies_to:
      - "*.ts"
      - "*.js"

  - id: user-filename-in-path
    name: User filename used directly in path
    severity: critical
    type: regex
    pattern:
      - 'path\.join.*req\.(body|query)\.filename'
      - 'uploads/.*\+.*filename'
    message: "Sanitize filenames to prevent path traversal"
    fix_action: "Use path.basename() and generate safe name"
    applies_to:
      - "*.ts"
      - "*.js"

best_practices:
  upload_flow:
    recommendation: |
      ## Secure Upload Flow

      1. Client requests presigned URL
      2. Server validates request, generates URL
      3. Client uploads directly to storage
      4. Client notifies server of completion
      5. Server validates uploaded file
      6. Server records in database
