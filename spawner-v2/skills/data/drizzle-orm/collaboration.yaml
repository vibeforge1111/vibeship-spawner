# Drizzle ORM Collaboration Model
# How this skill works with other data and backend specialists

prerequisites:
  skills: []
  knowledge:
    - "SQL fundamentals (SELECT, JOIN, WHERE, GROUP BY)"
    - "TypeScript generics and type inference"
    - "Database normalization basics (1NF, 2NF, 3NF)"
    - "Foreign key relationships and referential integrity"

complementary_skills:
  - skill: postgres-wizard
    relationship: "Database optimization"
    brings: "Query tuning, indexes, EXPLAIN analysis, PostgreSQL-specific features"

  - skill: redis-specialist
    relationship: "Caching layer"
    brings: "Query result caching, session storage, rate limiting"

  - skill: backend
    relationship: "API layer"
    brings: "Route design, middleware, request handling, business logic"

  - skill: auth-specialist
    relationship: "Authentication"
    brings: "User tables, session management, RLS policies"

  - skill: migration-specialist
    relationship: "Schema evolution"
    brings: "Zero-downtime migrations, rollback strategies, data backfills"

  - skill: graphql-architect
    relationship: "GraphQL layer"
    brings: "Schema design, resolvers, DataLoader patterns"

  - skill: test-architect
    relationship: "Database testing"
    brings: "Test fixtures, database seeding, transaction rollback patterns"

delegation:
  - trigger: "slow queries or database performance"
    delegate_to: postgres-wizard
    pattern: parallel
    context: "Drizzle queries and table schemas"
    receive: "Index recommendations, query rewrites, EXPLAIN analysis"

  - trigger: "need caching for database queries"
    delegate_to: redis-specialist
    pattern: sequential
    context: "Query patterns and cache invalidation needs"
    receive: "Caching strategy with TTL and invalidation"

  - trigger: "API routes or endpoints needed"
    delegate_to: backend
    pattern: sequential
    context: "Database schema and business requirements"
    receive: "Route handlers with proper error handling"

  - trigger: "user authentication or authorization"
    delegate_to: auth-specialist
    pattern: sequential
    context: "User table schema and session needs"
    receive: "Auth flow with Drizzle user operations"

  - trigger: "complex schema migration"
    delegate_to: migration-specialist
    pattern: sequential
    context: "Current schema and target changes"
    receive: "Migration plan with drizzle-kit commands"

  - trigger: "GraphQL API over database"
    delegate_to: graphql-architect
    pattern: parallel
    context: "Drizzle schema and relation definitions"
    receive: "GraphQL schema with efficient resolvers"

  - trigger: "test database operations"
    delegate_to: test-architect
    pattern: parallel
    context: "Schema and fixture requirements"
    receive: "Test setup with transaction isolation"

collaboration_patterns:
  sequential:
    - "I define schema, then migration-specialist plans deployment"
    - "I set up tables, then auth-specialist adds RLS policies"
    - "I create queries, then backend wraps in API routes"

  parallel:
    - "I model relations while postgres-wizard optimizes indexes"
    - "I write schemas while test-architect creates fixtures"
    - "I define queries while redis-specialist designs cache layer"

  review:
    - "Review migration-specialist's SQL for Drizzle compatibility"
    - "Review backend's data fetching for N+1 problems"
    - "Review auth-specialist's RLS integration with Drizzle"

cross_domain_insights:
  - domain: compiler-theory
    insight: "Drizzle's type inference uses TypeScript's conditional types - complex generics slow tsc"
    applies_when: "Type inference becomes slow or complex"

  - domain: database-theory
    insight: "Relations in Drizzle are query-time abstractions, not database constraints"
    applies_when: "Setting up foreign keys vs relation definitions"

  - domain: distributed-systems
    insight: "Edge databases (D1, Turso) have cold start vs connection pool tradeoffs"
    applies_when: "Choosing database for edge deployment"

  - domain: sql-optimization
    insight: "Drizzle relational queries use lateral joins - one query, not N+1"
    applies_when: "Fetching nested related data"

  - domain: type-systems
    insight: "Zod + Drizzle = runtime validation + compile-time types from one source"
    applies_when: "Input validation with createInsertSchema"

ecosystem:
  primary_tools:
    - "drizzle-kit - CLI for migrations and introspection"
    - "drizzle-orm - Core ORM library"
    - "drizzle-zod - Zod schema generation"
    - "drizzle-studio - Visual database browser"

  integrations:
    - name: Cloudflare D1
      use_when: "Edge-first SQLite with global replication"
      config: "drizzle(env.DB) with d1 dialect"

    - name: Turso
      use_when: "Embedded replicas for low-latency reads"
      config: "libsql driver with embedded replica"

    - name: Neon
      use_when: "Serverless PostgreSQL with branching"
      config: "neon-http driver for edge, postgres for server"

    - name: PlanetScale
      use_when: "Serverless MySQL with branching"
      config: "mysql2 driver, no foreign keys constraint"

    - name: PostgreSQL
      use_when: "Traditional server deployment"
      config: "postgres.js or pg driver"

  alternatives:
    - name: Prisma
      use_when: "Need visual schema design, auto-migrations"
      avoid_when: "Edge deployment (bundle size), cold starts matter"

    - name: Kysely
      use_when: "Want raw SQL with type safety, no relations"
      avoid_when: "Need relational query API"

    - name: TypeORM
      use_when: "Legacy project with decorators"
      avoid_when: "New project (outdated patterns)"

    - name: Raw SQL
      use_when: "One-off complex query Drizzle can't express"
      avoid_when: "Regular CRUD operations (lose type safety)"

  deprecated:
    - "Using push in production (no migration history)"
    - "Defining relations without foreign key constraints"
    - "Manual N+1 loops instead of relational queries"
    - "Skipping schema import with drizzle() for query API"
    - "Interpolating user input into sql`` template"

common_combinations:
  edge_stack:
    skills: [drizzle-orm, hono-patterns, cloudflare-workers]
    context: "Edge-first API with D1 database"

  fullstack_next:
    skills: [drizzle-orm, nextjs-app-router, postgres-wizard]
    context: "Next.js with PostgreSQL backend"

  realtime_app:
    skills: [drizzle-orm, supabase-backend, realtime-engineer]
    context: "Real-time features with Supabase"

  typed_api:
    skills: [drizzle-orm, trpc-patterns, typescript-strict]
    context: "End-to-end type-safe API"
