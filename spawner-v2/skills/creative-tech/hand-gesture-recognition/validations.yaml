id: hand-gesture-recognition
skill: Hand Gesture Recognition
version: "1.0"

validations:
  - id: check-confidence-threshold
    name: Gesture Confidence Threshold
    description: Gestures should have confidence thresholds to prevent false positives
    pattern: "detectGesture|classify.*gesture"
    file_glob: "**/*.{js,ts,jsx,tsx,py}"
    match: present
    context_pattern: "confidence|threshold|score"
    message: "Add confidence threshold for gesture detection to prevent false positives"
    severity: warning
    autofix: false

  - id: check-camera-permissions
    name: Camera Permission Handling
    description: getUserMedia should have proper error handling
    pattern: "getUserMedia|navigator.mediaDevices"
    file_glob: "**/*.{js,ts,jsx,tsx}"
    match: present
    context_pattern: "catch|NotAllowedError|NotFoundError"
    message: "Handle camera permission errors gracefully"
    severity: error
    autofix: false

  - id: check-loading-state
    name: Model Loading State
    description: Show loading state while ML model initializes
    pattern: "new Hands|handpose|hand.*model"
    file_glob: "**/*.{js,ts,jsx,tsx}"
    match: present
    context_pattern: "loading|progress|initialize"
    message: "Show loading state during model initialization"
    severity: warning
    autofix: false

  - id: check-fallback-input
    name: Fallback Input Method
    description: Provide alternative input when gestures aren't available
    pattern: "gesture.*control|hand.*interface"
    file_glob: "**/*.{js,ts,jsx,tsx}"
    match: present
    context_pattern: "keyboard|mouse|fallback|alternative"
    message: "Provide keyboard/mouse fallback for accessibility"
    severity: warning
    autofix: false

  - id: check-feature-detection
    name: WebGL Feature Detection
    description: Check for WebGL/WASM support before using hand tracking
    pattern: "mediapipe|handpose|tensorflow"
    file_glob: "**/*.{js,ts,jsx,tsx}"
    match: present
    context_pattern: "webgl|WebAssembly|getContext"
    message: "Check WebGL/WASM support before initializing hand tracking"
    severity: warning
    autofix: false

  - id: check-cleanup
    name: Resource Cleanup
    description: Clean up camera and model resources on unmount
    pattern: "getUserMedia|new Hands"
    file_glob: "**/*.{js,ts,jsx,tsx}"
    match: present
    context_pattern: "stop|dispose|cleanup|close"
    message: "Clean up camera stream and model when component unmounts"
    severity: warning
    autofix: false

  - id: check-gesture-smoothing
    name: Gesture Smoothing
    description: Raw gesture detection should be smoothed for stability
    pattern: "detectGesture|onResults"
    file_glob: "**/*.{js,ts,jsx,tsx}"
    match: present
    context_pattern: "smooth|history|buffer|debounce"
    message: "Apply smoothing to prevent jittery gesture detection"
    severity: info
    autofix: false

  - id: check-handedness
    name: Handedness Handling
    description: Account for left vs right hand differences
    pattern: "thumb|finger.*extended"
    file_glob: "**/*.{js,ts,jsx,tsx}"
    match: present
    context_pattern: "handedness|left|right|hand"
    message: "Account for left vs right hand when detecting gestures"
    severity: info
    autofix: false

  - id: check-lighting-feedback
    name: Lighting Quality Feedback
    description: Provide feedback about lighting conditions
    pattern: "hand.*track|gesture.*detect"
    file_glob: "**/*.{js,ts,jsx,tsx}"
    match: present
    context_pattern: "lighting|brightness|exposure"
    message: "Consider providing lighting quality feedback to users"
    severity: info
    autofix: false

  - id: check-https-camera
    name: HTTPS for Camera Access
    description: Camera requires HTTPS in production
    pattern: "getUserMedia"
    file_glob: "**/*.{js,ts,jsx,tsx,html}"
    match: present
    context_pattern: "https|localhost|secure"
    message: "Camera access requires HTTPS in production"
    severity: info
    autofix: false

pre_commit:
  - id: gesture-test
    name: Gesture Detection Tests
    command: "npm run test:gestures"
    description: Run gesture detection test suite

  - id: compatibility-check
    name: Browser Compatibility Check
    command: "npx browserslist"
    description: Verify browser compatibility requirements

ci_checks:
  - id: bias-test
    name: Skin Tone Bias Test
    command: "npm run test:bias"
    description: Test detection across diverse skin tones
    required: false

  - id: performance-benchmark
    name: Latency Benchmark
    command: "npm run benchmark:latency"
    description: Measure gesture detection latency
    required: false
