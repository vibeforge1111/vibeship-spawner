id: nextjs-supabase-auth-collaboration
skill: nextjs-supabase-auth
version: 1.0.0

# ============================================================================
# RECEIVES FROM (Who delegates TO this skill)
# ============================================================================
receives_from:
  - skill: nextjs-app-router
    context: "App needs authentication"
    receives:
      - "Route structure"
      - "Component architecture"
      - "Server/client split"
    provides: "Auth integration patterns"

  - skill: supabase-backend
    context: "Database needs user auth"
    receives:
      - "User model"
      - "RLS requirements"
      - "Database schema"
    provides: "Auth middleware and session"

  - skill: product-strategy
    context: "Product needs user accounts"
    receives:
      - "User flow requirements"
      - "Auth requirements"
      - "Security needs"
    provides: "Authentication implementation"

  - skill: frontend
    context: "Frontend needs auth flow"
    receives:
      - "UI requirements"
      - "Form components"
      - "Protected routes"
    provides: "Auth components and hooks"

# ============================================================================
# DELEGATION TRIGGERS
# ============================================================================
delegation_triggers:
  - trigger: "database|rls|queries|tables"
    delegate_to: supabase-backend
    pattern: sequential
    context: "Auth needs database layer"
    handoff_data:
      - "User model"
      - "Session requirements"
      - "RLS policies needed"
    receive: "Database configuration"

  - trigger: "route|page|component|layout"
    delegate_to: nextjs-app-router
    pattern: parallel
    context: "Auth needs Next.js patterns"
    handoff_data:
      - "Protected routes"
      - "Auth callbacks"
      - "Middleware config"
    receive: "Route structure"

  - trigger: "deploy|production|vercel"
    delegate_to: vercel-deployment
    pattern: sequential
    context: "Auth needs deployment config"
    handoff_data:
      - "Environment variables"
      - "OAuth callback URLs"
      - "Cookie configuration"
    receive: "Deployment settings"

  - trigger: "ui|form|button|design"
    delegate_to: frontend
    pattern: parallel
    context: "Auth needs UI components"
    handoff_data:
      - "Auth state"
      - "Form handlers"
      - "Error states"
    receive: "Auth UI components"

# ============================================================================
# FEEDBACK LOOPS
# ============================================================================
feedback_loops:
  receives_feedback_from:
    - skill: supabase-backend
      signal: "RLS policy updates"
      action: "Adjust session handling"

    - skill: security
      signal: "Security audit findings"
      action: "Strengthen auth flow"

    - skill: frontend
      signal: "UX issues with auth"
      action: "Improve auth components"

  sends_feedback_to:
    - skill: supabase-backend
      signal: "Auth session requirements"
      action: "Configure RLS policies"

    - skill: nextjs-app-router
      signal: "Middleware patterns"
      action: "Update route protection"

    - skill: vercel-deployment
      signal: "Environment needs"
      action: "Configure variables"

# ============================================================================
# CROSS-DOMAIN INSIGHTS
# ============================================================================
cross_domain_insights:
  - domain: Security Engineering
    insight: |
      Security engineers know defense:
      - Tokens expire for a reason
      - Server validation is source of truth
      - Cookie security matters
      - Session management is critical
      Auth follows security engineering principles.
    applies_when: "Implementing session handling"

  - domain: Identity Management
    insight: |
      Identity experts know flows:
      - OAuth has many edge cases
      - Token refresh is complex
      - Multi-factor adds security
      - Password reset is high-risk
      Auth requires identity management rigor.
    applies_when: "Designing auth flows"

# ============================================================================
# COMMON COMBINATIONS
# ============================================================================
common_combinations:
  - name: Full Auth Stack
    skills:
      - nextjs-supabase-auth
      - supabase-backend
      - nextjs-app-router
      - vercel-deployment
    workflow: |
      1. Database setup (supabase-backend)
      2. Auth implementation (nextjs-supabase-auth)
      3. Route protection (nextjs-app-router)
      4. Deployment config (vercel-deployment)

  - name: Protected SaaS
    skills:
      - nextjs-supabase-auth
      - stripe-integration
      - supabase-backend
    workflow: |
      1. User authentication (nextjs-supabase-auth)
      2. Customer sync (stripe-integration)
      3. Subscription gating (supabase-backend)
