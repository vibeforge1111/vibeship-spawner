id: embedded-systems-collaboration
skill: embedded-systems
version: 1.0.0

receives_from:
  - skill: ros2-robotics
    context: "Need micro-ROS node or hardware driver"
    receives:
      - "Message types and frequencies"
      - "Communication protocol (UART, CAN, Ethernet)"
    provides: "micro-ROS agent or custom protocol driver"

  - skill: control-systems
    context: "Implement control algorithm on MCU"
    receives:
      - "Control algorithm (PID, state-space)"
      - "Sample rate requirements"
      - "Sensor and actuator interfaces"
    provides: "Real-time control implementation with ISR timing"

  - skill: sensor-fusion
    context: "Run sensor fusion on embedded"
    receives:
      - "Sensor types and data rates"
      - "Filter requirements (Kalman, complementary)"
    provides: "Optimized fixed-point filter implementation"

delegation_triggers:
  - trigger: "ROS|robot|micro-ROS"
    delegate_to: ros2-robotics
    context: "Need ROS2 integration"

  - trigger: "PID|control loop|MPC"
    delegate_to: control-systems
    context: "Need control algorithm design"

  - trigger: "FPGA|hardware acceleration|HDL"
    delegate_to: fpga-design
    context: "Need FPGA coprocessor"

  - trigger: "motor|servo|stepper|brushless"
    delegate_to: motor-control
    context: "Need motor driver implementation"

  - trigger: "Kalman|sensor fusion|IMU fusion"
    delegate_to: sensor-fusion
    context: "Need sensor fusion algorithm"

feedback_loops:
  receives_feedback_from:
    - skill: ros2-robotics
      signal: "Message timing inconsistent"
      action: "Check micro-ROS transport, DMA configuration, buffer sizes"

    - skill: control-systems
      signal: "Control loop jitter"
      action: "Use hardware timer ISR, check interrupt priorities"

    - skill: motor-control
      signal: "PWM timing drift"
      action: "Verify timer clock source, check for interrupt latency"

  sends_feedback_to:
    - skill: ros2-robotics
      signal: "Hardware buffer overflow"
      action: "Reduce message rate or increase MCU buffer"

    - skill: control-systems
      signal: "Fixed-point precision insufficient"
      action: "Increase Q format or switch to floating point"

common_combinations:
  - name: IoT Sensor Node
    skills:
      - embedded-systems
      - sensor-fusion
    workflow: |
      1. Set up MCU toolchain (STM32CubeIDE, PlatformIO)
      2. Configure low-power modes
      3. Implement sensor drivers (I2C, SPI)
      4. Add sensor fusion for data quality
      5. Implement communication (MQTT, LoRa, BLE)
      6. Add OTA update capability

  - name: Motor Controller
    skills:
      - embedded-systems
      - motor-control
      - control-systems
    workflow: |
      1. Configure PWM timers for motor drive
      2. Implement current sensing ADC
      3. Add encoder/hall sensor interface
      4. Implement FOC or trapezoidal control
      5. Add position/velocity control loops
      6. Implement communication interface (CAN, RS485)

  - name: Robot Low-Level Controller
    skills:
      - embedded-systems
      - ros2-robotics
      - motor-control
    workflow: |
      1. Set up micro-ROS agent
      2. Implement motor drivers with ros2_control
      3. Add encoder feedback publishers
      4. Configure IMU driver
      5. Implement safety watchdog
      6. Add emergency stop handling

  - name: Real-Time Data Acquisition
    skills:
      - embedded-systems
      - sensor-fusion
    workflow: |
      1. Configure ADC with DMA for continuous sampling
      2. Implement ring buffer for data storage
      3. Add digital filtering (FIR/IIR)
      4. Implement timestamp synchronization
      5. Add USB or Ethernet streaming
      6. Implement triggered acquisition modes

ecosystem:
  microcontrollers:
    - "STM32 (Cortex-M0/M3/M4/M7) - Most popular for industrial"
    - "ESP32 - WiFi/BLE integrated, great for IoT"
    - "Nordic nRF52/53 - Low power BLE specialists"
    - "RP2040 - Dual-core, PIO for custom protocols"
    - "NXP i.MX RT - High-performance Cortex-M7"
    - "TI MSP430 - Ultra-low power"

  toolchains:
    - "ARM GCC - Standard open-source toolchain"
    - "IAR Embedded Workbench - Commercial, best optimization"
    - "Keil MDK - ARM's official IDE"
    - "PlatformIO - Cross-platform, VSCode integration"
    - "STM32CubeIDE - Free, ST-specific"

  rtos:
    - "FreeRTOS - Most widely used, MIT license"
    - "Zephyr - Modern, Linux Foundation backed"
    - "ThreadX (Azure RTOS) - Commercial grade"
    - "ChibiOS - Automotive certified"
    - "NuttX - POSIX-compliant"
    - "Bare-metal - For simplest applications"

  debugging:
    - "SEGGER J-Link - Professional debug probe"
    - "ST-Link - STM32 built-in debugger"
    - "OpenOCD - Open source debug interface"
    - "SEGGER RTT - Real-time terminal (ISR-safe)"
    - "SEGGER SystemView - RTOS tracing"
    - "Logic analyzer - Protocol debugging"

  protocols:
    - "UART/RS485 - Simple, long distance"
    - "I2C - Multi-device, low pin count"
    - "SPI - High speed, simple"
    - "CAN - Automotive, robust"
    - "USB - PC connectivity"
    - "Ethernet - High bandwidth"
    - "BLE - Low power wireless"

references:
  documentation:
    - "ARM Cortex-M Programming Guide"
    - "Manufacturer reference manuals (STM32, ESP32, etc.)"
    - "FreeRTOS.org documentation"
    - "CMSIS documentation"

  books:
    - "Making Embedded Systems - Elecia White"
    - "The Definitive Guide to ARM Cortex-M - Joseph Yiu"
    - "Embedded Systems Design - Steve Heath"

  tools:
    - "PlatformIO - platformio.org"
    - "STM32CubeIDE - st.com"
    - "SEGGER tools - segger.com"
