id: control-systems-collaboration
skill: control-systems
version: 1.0.0

receives_from:
  - skill: sensor-fusion
    context: "Need state estimates for feedback control"
    receives:
      - "State vector (position, velocity, etc.)"
      - "Covariance/uncertainty estimates"
    provides: "Control commands based on estimated state"

  - skill: ros2-robotics
    context: "Integrate with ROS2 navigation/control"
    receives:
      - "Reference trajectory (nav_msgs/Path)"
      - "Odometry (nav_msgs/Odometry)"
    provides: "Controller node with proper interfaces"

  - skill: motor-control
    context: "High-level control commanding motor driver"
    receives:
      - "Motor interface (velocity/torque command)"
      - "Motor feedback (encoder, current)"
    provides: "Velocity or torque setpoints"

delegation_triggers:
  - trigger: "Kalman|EKF|UKF|state estimation"
    delegate_to: sensor-fusion
    context: "Need state estimator for control"

  - trigger: "motor|actuator|drive|PWM"
    delegate_to: motor-control
    context: "Need motor driver implementation"

  - trigger: "ROS|ros2_control|nav2"
    delegate_to: ros2-robotics
    context: "Need ROS2 integration"

  - trigger: "MCU|embedded|STM32|real-time"
    delegate_to: embedded-systems
    context: "Need embedded implementation"

feedback_loops:
  receives_feedback_from:
    - skill: sensor-fusion
      signal: "Noisy state estimates"
      action: "Reduce controller bandwidth or add state filtering"

    - skill: motor-control
      signal: "Motor saturation"
      action: "Reduce gains or add feedforward"

  sends_feedback_to:
    - skill: sensor-fusion
      signal: "Need faster state updates"
      action: "Increase sensor fusion rate"

    - skill: motor-control
      signal: "Torque limit exceeded"
      action: "Add current limiting in motor driver"

common_combinations:
  - name: Position Control System
    skills:
      - control-systems
      - motor-control
      - sensor-fusion
    workflow: |
      1. Identify system dynamics (step response test)
      2. Design state-space model
      3. Implement sensor fusion (encoder + IMU)
      4. Design LQR or MPC controller
      5. Implement cascade: position -> velocity -> current
      6. Tune and validate

  - name: Robot Arm Control
    skills:
      - control-systems
      - ros2-robotics
    workflow: |
      1. Set up URDF/XACRO model
      2. Configure ros2_control hardware interface
      3. Implement joint trajectory controller
      4. Add MoveIt2 for motion planning
      5. Tune PID gains per joint
      6. Add collision checking

  - name: Mobile Robot Navigation
    skills:
      - control-systems
      - sensor-fusion
      - ros2-robotics
    workflow: |
      1. Configure Nav2 stack
      2. Tune local planner (DWB or TEB)
      3. Implement velocity controller
      4. Add sensor fusion for localization
      5. Tune controller parameters
      6. Test obstacle avoidance

  - name: Drone Flight Control
    skills:
      - control-systems
      - sensor-fusion
      - embedded-systems
    workflow: |
      1. Implement attitude estimation (complementary/Kalman)
      2. Design cascade control: position -> velocity -> attitude -> rate
      3. Tune inner loops first (rate, attitude)
      4. Then tune outer loops (velocity, position)
      5. Add trajectory tracking
      6. Implement failsafes

ecosystem:
  simulation:
    - "Gazebo - Physics simulation"
    - "MATLAB/Simulink - Control design"
    - "Python Control - Control analysis"
    - "Drake - Robotics dynamics"

  ros_packages:
    - "ros2_control - Hardware abstraction"
    - "ros2_controllers - Standard controllers"
    - "control_toolbox - PID implementation"
    - "moveit2 - Motion planning"

  mpc_solvers:
    - "ACADOS - Real-time MPC"
    - "OSQP - Quadratic programming"
    - "CasADi - Algorithmic differentiation"
    - "do-mpc - Python MPC framework"

  embedded:
    - "PX4 - Drone control"
    - "ArduPilot - Autonomous vehicles"
    - "ODrive - Motor control"
    - "SimpleFOC - Field-oriented control"

references:
  books:
    - "Feedback Systems - Astrom & Murray"
    - "Modern Control Engineering - Ogata"
    - "Model Predictive Control - Rawlings & Mayne"

  courses:
    - "MIT 2.004 - Dynamics and Control"
    - "Stanford AA203 - Optimal Control"
    - "ETH Control Systems"

  documentation:
    - "python-control.readthedocs.io"
    - "docs.ros2.org - ros2_control"
    - "control.com - Industrial control tutorials"
