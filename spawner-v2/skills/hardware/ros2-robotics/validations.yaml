validations:

  - id: undeclared-parameter
    name: Parameter Usage Without Declaration
    severity: warning
    type: regex
    pattern:
      - "get_parameter\\(['\"][^'\"]+['\"]\\)(?![\\s\\S]{0,200}declare_parameter)"
    message: "Declare parameters before using them to avoid ParameterNotDeclaredException."
    fix_action: "Add self.declare_parameter('name', default_value) in __init__"
    applies_to:
      - "**/*.py"

  - id: tf-lookup-no-timeout
    name: Transform Lookup Without Timeout
    severity: warning
    type: regex
    pattern:
      - "lookup_transform\\([^)]*\\)(?![\\s\\S]{0,50}timeout)"
    message: "Add timeout to lookup_transform to avoid blocking forever."
    fix_action: "Add timeout=Duration(seconds=1.0) parameter"
    applies_to:
      - "**/*.py"

  - id: blocking-in-callback
    name: Potential Blocking Operation in Callback
    severity: info
    type: regex
    pattern:
      - "def.*callback.*:\\s*[^}]*time\\.sleep"
      - "def.*callback.*:\\s*[^}]*requests\\."
      - "def.*callback.*:\\s*[^}]*input\\("
    message: "Avoid blocking operations in callbacks. Use async or separate threads."
    applies_to:
      - "**/*.py"

  - id: hardcoded-topic-name
    name: Hardcoded Topic Name (No Constant)
    severity: info
    type: regex
    pattern:
      - "create_publisher\\([^,]+,\\s*['\"]/"
      - "create_subscription\\([^,]+,\\s*['\"]/"
    message: "Consider using constants or parameters for topic names."
    applies_to:
      - "**/*.py"

  - id: default-qos-for-sensors
    name: Default QoS Used for Sensor Subscription
    severity: info
    type: regex
    pattern:
      - "create_subscription\\(.*Scan.*,\\s*['\"][^'\"]+['\"],\\s*\\w+,\\s*\\d+\\)"
      - "create_subscription\\(.*Image.*,\\s*['\"][^'\"]+['\"],\\s*\\w+,\\s*\\d+\\)"
    message: "Use sensor QoS profile for sensor topics (BEST_EFFORT reliability)."
    fix_action: "Use qos_profile_sensor_data or custom BEST_EFFORT profile"
    applies_to:
      - "**/*.py"

  - id: no-exception-handling-tf
    name: Transform Operations Without Exception Handling
    severity: warning
    type: regex
    pattern:
      - "lookup_transform(?![\\s\\S]{0,100}try:|except)"
      - "tf_buffer\\.transform(?![\\s\\S]{0,100}try:|except)"
    message: "Wrap TF operations in try/except TransformException."
    applies_to:
      - "**/*.py"

  - id: missing-lifecycle-transitions
    name: Lifecycle Node Missing Transition Callbacks
    severity: info
    type: regex
    pattern:
      - "class.*LifecycleNode(?![\\s\\S]{0,500}on_configure)"
    message: "Implement lifecycle transition callbacks (on_configure, on_activate, etc.)."
    applies_to:
      - "**/*.py"

  - id: single-threaded-executor-compute
    name: Heavy Compute with Single-Threaded Executor
    severity: info
    type: regex
    pattern:
      - "rclpy\\.spin\\(node\\)(?![\\s\\S]{0,200}MultiThreadedExecutor)"
    message: "Consider MultiThreadedExecutor for nodes with heavy computation."
    applies_to:
      - "**/*.py"

  - id: no-shutdown-handler
    name: Missing Shutdown Handler
    severity: info
    type: regex
    pattern:
      - "def main.*rclpy\\.spin(?![\\s\\S]{0,200}finally:|shutdown)"
    message: "Add finally block with rclpy.shutdown() for clean exit."
    applies_to:
      - "**/*.py"
