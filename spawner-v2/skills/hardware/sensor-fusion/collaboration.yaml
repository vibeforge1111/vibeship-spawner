id: sensor-fusion-collaboration
skill: sensor-fusion
version: 1.0.0

receives_from:
  - skill: embedded-systems
    context: "Need sensor fusion on microcontroller"
    receives:
      - "Sensor data rates and interfaces"
      - "Memory and compute constraints"
    provides: "Optimized fixed-point filter implementation"

  - skill: ros2-robotics
    context: "Need localization for navigation"
    receives:
      - "Sensor topics and message types"
      - "TF frame hierarchy"
    provides: "EKF/UKF node with proper TF publishing"

  - skill: statistical-analysis
    context: "Need noise characterization"
    receives:
      - "Static sensor data collection"
      - "Allan variance requirements"
    provides: "Calibrated Q and R matrices"

delegation_triggers:
  - trigger: "control|trajectory|path following"
    delegate_to: control-systems
    context: "Using filter output for control"

  - trigger: "ROS|robot_localization|nav2"
    delegate_to: ros2-robotics
    context: "Need ROS2 integration"

  - trigger: "MCU|STM32|embedded|real-time"
    delegate_to: embedded-systems
    context: "Need embedded implementation"

  - trigger: "camera|visual|feature|VIO"
    delegate_to: computer-vision
    context: "Need visual-inertial odometry"

feedback_loops:
  receives_feedback_from:
    - skill: control-systems
      signal: "State estimates too noisy for control"
      action: "Increase measurement trust (reduce R) or add low-pass filter"

    - skill: ros2-robotics
      signal: "TF jumps causing navigation issues"
      action: "Reduce Q to smooth estimates, or add rate limiting"

  sends_feedback_to:
    - skill: embedded-systems
      signal: "Need higher sensor rates"
      action: "Increase sample rate or use interpolation"

    - skill: ros2-robotics
      signal: "Covariance format for NavSat"
      action: "Publish proper covariance in sensor messages"

common_combinations:
  - name: Robot Localization Stack
    skills:
      - sensor-fusion
      - ros2-robotics
    workflow: |
      1. Configure sensor drivers (IMU, GPS, encoders)
      2. Set up TF tree (base_link, odom, map)
      3. Configure robot_localization EKF
      4. Tune covariances from static tests
      5. Add sensor-level outlier filtering
      6. Implement NEES monitoring

  - name: Visual-Inertial Odometry
    skills:
      - sensor-fusion
      - computer-vision
    workflow: |
      1. Calibrate camera-IMU extrinsics (Kalibr)
      2. Characterize IMU noise (Allan variance)
      3. Implement feature tracking
      4. Set up IMU preintegration
      5. Configure tightly-coupled VIO
      6. Add loop closure for drift correction

  - name: Drone State Estimation
    skills:
      - sensor-fusion
      - embedded-systems
      - control-systems
    workflow: |
      1. Configure IMU at high rate (400Hz+)
      2. Implement complementary filter for attitude
      3. Add GPS for position (if outdoor)
      4. Fuse barometer for altitude
      5. Add optical flow for velocity
      6. Feed to PX4/ArduPilot or custom controller

  - name: Indoor Localization
    skills:
      - sensor-fusion
      - ros2-robotics
    workflow: |
      1. Set up wheel odometry
      2. Configure IMU fusion
      3. Add LiDAR SLAM (SLAM Toolbox)
      4. Configure AMCL for map-based localization
      5. Fuse all sources in robot_localization
      6. Tune for smooth estimates vs accuracy tradeoff

ecosystem:
  python_libraries:
    - "FilterPy - Comprehensive filter library"
    - "scipy.linalg - Linear algebra"
    - "NumPy - Array operations"
    - "JAX - Automatic differentiation"

  ros_packages:
    - "robot_localization - Production EKF/UKF"
    - "imu_filter_madgwick - Attitude estimation"
    - "imu_complementary_filter - Simple IMU fusion"
    - "imu_tools - IMU calibration and filtering"

  cpp_libraries:
    - "Eigen - Linear algebra"
    - "GTSAM - Factor graph optimization"
    - "Ceres Solver - Nonlinear optimization"
    - "Sophus - Lie group operations"

  vio_frameworks:
    - "ORB-SLAM3 - Feature-based VIO/SLAM"
    - "VINS-Mono/VINS-Fusion - Optimization-based VIO"
    - "OpenVINS - Research platform"
    - "Basalt - Visual-inertial mapping"
    - "Kimera - Metric-semantic SLAM"

  calibration:
    - "Kalibr - Camera-IMU calibration"
    - "allan_variance_ros - IMU characterization"
    - "imu_utils - IMU noise analysis"

references:
  books:
    - "Probabilistic Robotics - Thrun, Burgard, Fox"
    - "State Estimation for Robotics - Barfoot"
    - "Optimal State Estimation - Simon"

  papers:
    - "On-Manifold Preintegration - Forster et al. (IMU preintegration)"
    - "Quaternion Kinematics - Sola (Quaternion EKF)"
    - "Visual-Inertial Mapping - Mourikis (MSCKF)"

  tutorials:
    - "robot_localization wiki - ROS Wiki"
    - "FilterPy documentation"
    - "GTSAM tutorial notebooks"
