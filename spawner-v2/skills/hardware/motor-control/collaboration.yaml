id: motor-control-collaboration
skill: motor-control
version: 1.0.0

receives_from:
  - skill: control-systems
    context: "Implementing high-level motion control"
    receives:
      - "Velocity/position/torque references"
      - "Control bandwidth requirements"
    provides: "Motor torque/velocity response"

  - skill: embedded-systems
    context: "Motor driver firmware"
    receives:
      - "MCU platform and peripherals"
      - "Timer and ADC configurations"
    provides: "FOC implementation with proper peripheral usage"

  - skill: fpga-design
    context: "Hardware motor controller"
    receives:
      - "PWM and encoder interface requirements"
      - "Control loop timing"
    provides: "RTL for motor control peripherals"

delegation_triggers:
  - trigger: "PID|velocity loop|position loop|trajectory"
    delegate_to: control-systems
    context: "Outer loop control design"

  - trigger: "STM32|MCU|firmware|timer|ADC"
    delegate_to: embedded-systems
    context: "Embedded implementation"

  - trigger: "FPGA|Verilog|HDL|hardware PWM"
    delegate_to: fpga-design
    context: "Hardware implementation"

  - trigger: "ROS|ros2_control|robot"
    delegate_to: ros2-robotics
    context: "ROS2 integration"

feedback_loops:
  receives_feedback_from:
    - skill: control-systems
      signal: "Torque bandwidth insufficient"
      action: "Increase current loop bandwidth, tune FOC gains"

    - skill: embedded-systems
      signal: "ISR timing too long"
      action: "Optimize FOC calculations, use lookup tables"

  sends_feedback_to:
    - skill: control-systems
      signal: "Current limit reached"
      action: "Reduce torque demand or adjust trajectory"

    - skill: embedded-systems
      signal: "Need faster ADC sampling"
      action: "Use DMA, optimize ADC configuration"

common_combinations:
  - name: Robot Joint Motor
    skills:
      - motor-control
      - control-systems
      - embedded-systems
    workflow: |
      1. Select motor and driver
      2. Configure PWM and current sensing
      3. Implement FOC with encoder
      4. Tune current loop (10kHz+)
      5. Add velocity loop (1-2kHz)
      6. Add position loop (100-500Hz)
      7. Implement safety limits

  - name: BLDC Motor Driver
    skills:
      - motor-control
      - embedded-systems
    workflow: |
      1. Configure STM32 advanced timer for PWM
      2. Set up ADC with timer trigger
      3. Implement Clarke and Park transforms
      4. Tune current PI controllers
      5. Add sensorless startup sequence
      6. Implement MTPA/field weakening if needed

  - name: CNC Spindle Control
    skills:
      - motor-control
      - control-systems
    workflow: |
      1. Implement encoder interface
      2. Configure FOC for spindle motor
      3. Add spindle orientation mode
      4. Implement tool change speed profile
      5. Add thermal protection
      6. Integrate with CNC controller

  - name: Electric Vehicle Drive
    skills:
      - motor-control
      - control-systems
      - sensor-fusion
    workflow: |
      1. Configure high-power inverter
      2. Implement FOC with resolver
      3. Add regenerative braking
      4. Implement torque vectoring (if multi-motor)
      5. Add thermal derating
      6. Integrate with vehicle CAN

ecosystem:
  motor_types:
    - "BLDC/PMSM - Permanent magnet brushless"
    - "ACIM - AC induction motor"
    - "SRM - Switched reluctance"
    - "Stepper - Open/closed loop"
    - "DC Brushed - Simple, low cost"

  controllers:
    - "ODrive - Open source BLDC"
    - "VESC - EV skateboard controller"
    - "SimpleFOC - Arduino library"
    - "TI InstaSPIN - Sensorless FOC"

  development_kits:
    - "STM32 Motor Control Kit"
    - "TI TMDSHVMTRINSPIN"
    - "NXP FRDM-MC"
    - "Microchip dsPIC Motor Control"

  tools:
    - "Motor-CAD - Motor design"
    - "FEMM - Finite element"
    - "MATLAB/Simulink - Simulation"
    - "MESC - Open source tuning"

references:
  books:
    - "Electric Motor Drives - Krishnan"
    - "Permanent Magnet Motor Technology - Hendershot"
    - "Modern Power Electronics - Mohan"

  courses:
    - "TI Motor Control Training"
    - "STM32 Motor Control University"
    - "SimpleFOC Documentation"

  papers:
    - "Field Oriented Control of 3-Phase AC Motors"
    - "Sensorless Control of PMSM Drives"
    - "Space Vector Modulation Tutorial"
