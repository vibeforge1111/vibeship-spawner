# Validations: MCP Product Design
# Checks to run against MCP tool implementations

validations:
  # --- CRITICAL: Will kill adoption ---

  - id: required-id-params
    name: "Required ID Parameter on Entry Tool"
    severity: critical
    type: regex
    pattern: 'required.*\[.*"(project_id|user_id|session_id)"'
    message: |
      This tool requires an ID parameter that new users won't have.

      Vibe coders calling for the first time will immediately fail.
      Make IDs optional and generate them if not provided.
    applies_to:
      - "**/tools/*.ts"
      - "**/tools/*.js"

  - id: raw-error-throw
    name: "Raw Error Messages"
    severity: critical
    type: regex
    pattern: 'throw new Error\([^)]*\b(Zod|schema|validation|parse|JSON)\b'
    message: |
      Error uses technical jargon that vibe coders won't understand.

      Wrap this error with a human-readable explanation and suggested action.
    applies_to:
      - "**/tools/*.ts"
      - "**/*.ts"

  - id: minimal-success-response
    name: "Minimal Success Response"
    severity: error
    type: regex
    pattern: 'return\s*\{\s*(success|ok|status)\s*:\s*(true|"ok"|"success")\s*\}'
    message: |
      This success response doesn't tell users what happened or what to do next.

      Add: what_happened, context, and next_steps to every success response.
    applies_to:
      - "**/tools/*.ts"

  # --- ERROR: Will confuse users ---

  - id: crud-tool-naming
    name: "CRUD-style Tool Naming"
    severity: error
    type: regex
    pattern: 'name:\s*["\'''']spawner_(create|read|update|delete|get|set|fetch|query)_'
    message: |
      Tool name uses database operation style (CRUD).

      Users think in goals, not operations. Rename to reflect what users
      are trying to accomplish:
      - spawner_create_project → spawner_plan
      - spawner_get_skills → spawner_skills
      - spawner_update_memory → spawner_remember
    applies_to:
      - "**/tools/*.ts"
      - "**/index.ts"

  - id: too-many-required-params
    name: "Too Many Required Parameters"
    severity: error
    type: regex
    pattern: 'required:\s*\[[^\]]{100,}\]'
    message: |
      Tool has too many required parameters (detected long required array).

      This creates friction for first-time users. Reduce to 1-3 required
      params max, with smart defaults for everything else.
    applies_to:
      - "**/tools/*.ts"

  # --- WARNING: Should fix ---

  - id: no-description-in-schema
    name: "Parameter Without Description"
    severity: warning
    type: regex
    pattern: '"[a-z_]+"\s*:\s*\{\s*type:\s*"'
    message: |
      Schema parameter has no description.

      Claude uses descriptions to understand what to pass. Vibe coders
      see descriptions when exploring tools. Always include helpful descriptions.
    applies_to:
      - "**/tools/*.ts"

  - id: inconsistent-response-shape
    name: "Inconsistent Response Envelope"
    severity: warning
    type: regex
    pattern: 'return\s*\{\s*(result|data|output|response|payload)\s*:'
    message: |
      Response uses a non-standard envelope.

      For consistency, prefer a standard shape across all tools:
      { success, data?, error?, meta? }
    applies_to:
      - "**/tools/*.ts"

  - id: missing-error-suggestion
    name: "Error Without Suggestion"
    severity: warning
    type: regex
    pattern: 'error:\s*\{\s*message:[^}]+\}(?!\s*,\s*(suggestion|what_to_do|try))'
    message: |
      Error response has no suggestion for what to try next.

      Vibe coders need guidance. Add a "suggestion" or "what_to_do" field.
    applies_to:
      - "**/tools/*.ts"

# Config
config:
  always_run:
    - required-id-params
    - raw-error-throw

  pre_ship:
    - all

  exclude_patterns:
    - "**/*.test.*"
    - "**/*.spec.*"
    - "**/node_modules/**"
