id: compliance-automation-collaboration
skill: compliance-automation
version: 1.0.0

receives_from:
  - skill: gdpr-privacy
    context: "Privacy compliance requirements"
    receives:
      - "Data protection controls"
      - "Privacy evidence needs"
    provides: "Automated privacy compliance checks"

  - skill: sox-compliance
    context: "Financial compliance requirements"
    receives:
      - "ITGC controls"
      - "Audit evidence needs"
    provides: "Automated financial controls monitoring"

  - skill: enterprise-architecture
    context: "System architecture for control mapping"
    receives:
      - "System inventory and dependencies"
      - "Data flow diagrams"
    provides: "Controls mapped to architecture"

  - skill: security-specialist
    context: "Security control requirements"
    receives:
      - "Security baseline requirements"
      - "Vulnerability management policies"
    provides: "Automated security control monitoring"

delegation_triggers:
  - trigger: "gdpr|privacy|pii|data.protection"
    delegate_to: gdpr-privacy
    context: "Privacy-specific compliance"

  - trigger: "sox|itgc|financial.controls|sarbanes"
    delegate_to: sox-compliance
    context: "Financial compliance"

  - trigger: "data.governance|data.quality"
    delegate_to: data-governance
    context: "Data governance compliance"

  - trigger: "security.implementation|pentest|vulnerability"
    delegate_to: security-specialist
    context: "Security control implementation"

  - trigger: "infrastructure.compliance|cloud.config"
    delegate_to: devops
    context: "Infrastructure compliance automation"

feedback_loops:
  receives_feedback_from:
    - skill: gdpr-privacy
      signal: "Privacy requirements"
      action: "Update privacy controls"

    - skill: sox-compliance
      signal: "Audit findings"
      action: "Strengthen financial controls"

    - skill: security-specialist
      signal: "Security gaps identified"
      action: "Add compensating controls"

  sends_feedback_to:
    - skill: enterprise-architecture
      signal: "Compliance requirements"
      action: "Inform architecture decisions"

    - skill: disaster-recovery
      signal: "DR compliance status"
      action: "Verify DR meets requirements"

    - skill: devops
      signal: "Infrastructure compliance gaps"
      action: "Update infrastructure configurations"

escalation_paths:
  - situation: "Audit deadline approaching with gaps"
    escalate_to: enterprise-architecture
    context: "Need rapid architecture decisions to close control gaps"

  - situation: "Privacy breach or GDPR violation risk"
    escalate_to: gdpr-privacy
    context: "Immediate privacy expertise required for incident response"

  - situation: "Financial controls failing during SOX audit"
    escalate_to: sox-compliance
    context: "Financial compliance expertise for remediation"

  - situation: "Security vulnerabilities affecting compliance"
    escalate_to: security-specialist
    context: "Security implementation to address compliance gaps"

  - situation: "Infrastructure drift causing compliance failures"
    escalate_to: devops
    context: "Infrastructure-as-code fixes for compliance"

  - situation: "Data quality issues affecting audit evidence"
    escalate_to: data-governance
    context: "Data quality remediation for accurate reporting"

  - situation: "Multi-framework conflict or overlap"
    escalate_to: enterprise-architecture
    context: "Architecture-level control consolidation"

  - situation: "Third-party/vendor compliance concerns"
    escalate_to: security-specialist
    context: "Vendor risk assessment and monitoring"

workflow_integration:
  typical_sequence:
    1:
      step: "Identify compliance scope"
      skills: [compliance-automation, enterprise-architecture]
      output: "Framework requirements mapped to systems"
      details: |
        - Identify applicable frameworks (SOC 2, ISO 27001, PCI DSS, HIPAA)
        - Map systems and data flows to compliance scope
        - Identify shared controls across frameworks
        - Document regulatory boundaries and jurisdictions

    2:
      step: "Design control framework"
      skills: [compliance-automation]
      output: "Unified control catalog with ownership"
      details: |
        - Create control-to-framework mapping matrix
        - Assign control owners and reviewers
        - Define control frequency (continuous, daily, weekly, annual)
        - Establish control testing procedures

    3:
      step: "Implement policy-as-code"
      skills: [compliance-automation, devops]
      output: "Automated policy checks in CI/CD and runtime"
      details: |
        - Convert controls to OPA Rego or Sentinel policies
        - Integrate with CI/CD pipelines
        - Deploy runtime policy enforcement
        - Configure violation alerts and escalation

    4:
      step: "Set up evidence collection"
      skills: [compliance-automation]
      output: "Automated evidence gathering pipeline"
      details: |
        - Configure log aggregation for audit trails
        - Set up screenshot/artifact collection
        - Implement evidence timestamping and integrity
        - Create evidence retention policies

    5:
      step: "Deploy continuous monitoring"
      skills: [compliance-automation, security-specialist]
      output: "Real-time compliance dashboards and alerts"
      details: |
        - Configure CCM platform (Drata, Vanta, etc.)
        - Set up drift detection and alerting
        - Establish baseline configurations
        - Create compliance scorecards

    6:
      step: "Test and validate controls"
      skills: [compliance-automation]
      output: "Control effectiveness evidence"
      details: |
        - Execute control testing procedures
        - Document test results and exceptions
        - Remediate failed controls
        - Generate OSCAL assessment reports

    7:
      step: "Prepare for audit"
      skills: [compliance-automation]
      output: "Audit-ready evidence package"
      details: |
        - Generate framework-specific reports
        - Organize evidence by control objective
        - Prepare auditor portal access
        - Create executive compliance summary

  decision_points:
    - question: "Which compliance framework first?"
      guidance: |
        Prioritize by business impact:

        SOC 2 Type II:
        - Required for: B2B SaaS selling to enterprises
        - Timeline: 6-12 months for first audit
        - Choose when: Enterprise customers require it

        ISO 27001:
        - Required for: International enterprise sales
        - Timeline: 12-18 months for certification
        - Choose when: European or global customers

        PCI DSS:
        - Required for: Handling payment card data
        - Timeline: 3-12 months depending on level
        - Choose when: Processing payments directly

        HIPAA:
        - Required for: Handling PHI (healthcare data)
        - Timeline: 6-12 months
        - Choose when: Healthcare or health-tech

        SOX:
        - Required for: Public companies
        - Timeline: Ongoing annual cycles
        - Choose when: IPO preparation or post-IPO

    - question: "Build vs buy compliance platform?"
      guidance: |
        Buy (Drata, Vanta, Secureframe):
        - Faster time to compliance (weeks not months)
        - Pre-built integrations with common tools
        - Auditor-trusted evidence formats
        - Cost: $15-50K/year
        - Choose when: Speed matters, standard tech stack

        Build custom:
        - Full control over evidence collection
        - Custom integrations for unique systems
        - No vendor lock-in
        - Cost: Engineering time (3-6 months)
        - Choose when: Complex/unique infrastructure, privacy concerns

        Hybrid approach:
        - Use platform for standard controls
        - Build custom for unique requirements
        - Most common for growing companies

    - question: "How to handle multi-framework compliance?"
      guidance: |
        Unified Control Framework approach:

        1. Map all frameworks to common controls:
           - SOC 2 CC6.1 + ISO A.9.1 + PCI 7.1 = "Access Control"
           - Implement control ONCE, evidence for ALL

        2. Use OSCAL for standardization:
           - Machine-readable compliance data
           - Framework-agnostic control definitions
           - Automated report generation

        3. Control consolidation benefits:
           - 40-60% reduction in redundant controls
           - Single evidence collection
           - Unified remediation workflow

    - question: "Continuous vs point-in-time compliance?"
      guidance: |
        Point-in-time (traditional):
        - Annual audit preparation
        - Evidence collection before audit
        - Higher risk of gaps
        - Lower ongoing effort
        - Choose when: Budget constrained, simple environment

        Continuous Compliance:
        - Real-time control monitoring
        - Automated evidence collection
        - Immediate gap detection
        - Higher initial investment
        - Choose when: Mature security program, multiple frameworks

        Recommendation: Start continuous from day one.
        Retrofitting is harder than building it right.

    - question: "How to handle compliance exceptions?"
      guidance: |
        Exception management process:

        1. Document the exception:
           - What control is not met
           - Why it cannot be met
           - Risk assessment
           - Compensating controls

        2. Approval workflow:
           - Risk owner approval
           - CISO/compliance officer review
           - Time-bound approval (max 1 year)

        3. Compensating controls:
           - Must reduce risk to acceptable level
           - Document in control framework
           - Include in audit evidence

        4. Remediation tracking:
           - Timeline for resolution
           - Regular status reviews
           - Escalation if delayed

common_combinations:
  - name: SOC 2 Type II Preparation
    skills:
      - compliance-automation
    workflow: |
      1. Map Trust Service Criteria to controls
      2. Implement policy-as-code for each control
      3. Set up automated evidence collection
      4. Configure continuous monitoring
      5. Create compliance dashboards
      6. Generate OSCAL assessment reports
      7. Prepare auditor portal access

  - name: Multi-Framework Compliance
    skills:
      - compliance-automation
    workflow: |
      1. Identify applicable frameworks
      2. Create unified control mapping
      3. Implement controls once, map to many
      4. Automate evidence for all frameworks
      5. Generate framework-specific reports
      6. Track compliance scores per framework

  - name: Policy-as-Code Implementation
    skills:
      - compliance-automation
    workflow: |
      1. Define control requirements
      2. Convert to OPA Rego policies
      3. Test with known inputs
      4. Deploy to policy engine
      5. Configure violations alerting
      6. Set up remediation workflow
      7. Monitor policy effectiveness

  - name: Continuous Controls Monitoring
    skills:
      - compliance-automation
    workflow: |
      1. Establish baseline configurations
      2. Deploy CCM platform
      3. Configure scheduled assessments
      4. Set up drift detection
      5. Configure alerting thresholds
      6. Integrate with incident management
      7. Create executive dashboards

  - name: Audit Readiness Sprint
    skills:
      - compliance-automation
      - security-specialist
    workflow: |
      1. Run gap assessment against framework
      2. Prioritize gaps by audit risk
      3. Remediate critical findings
      4. Document compensating controls
      5. Collect evidence backlog
      6. Conduct mock audit
      7. Prepare auditor briefing materials

ecosystem:
  policy_engines:
    - "Open Policy Agent (OPA)"
    - "HashiCorp Sentinel"
    - "AWS Config Rules"
    - "Azure Policy"
    - "Google Cloud Security Command Center"

  evidence_platforms:
    - "Drata"
    - "Vanta"
    - "Secureframe"
    - "Tugboat Logic"
    - "Lacework"

  cloud_compliance:
    - "AWS Security Hub"
    - "Azure Security Center"
    - "Google Cloud Security Command Center"
    - "Prisma Cloud"

  standards:
    - "OSCAL"
    - "NIST CSF"
    - "CIS Benchmarks"
    - "CSA CCM"

references:
  frameworks:
    - "NIST OSCAL Specification"
    - "AICPA SOC 2 Guide"
    - "ISO 27001:2022"
    - "PCI DSS v4.0"

  tools:
    - "OPA Rego Documentation"
    - "AWS Config Rules Guide"
    - "Drata Integration Guide"
