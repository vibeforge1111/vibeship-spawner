validations:

  - id: mutable-evidence-storage
    name: Mutable Evidence Storage
    severity: error
    type: regex
    pattern:
      - "evidence.*bucket(?!.*object_lock)"
      - "store_evidence\\((?!.*immutable)"
      - "s3.*put_object(?!.*ObjectLockMode)"
    message: "Evidence may be stored in mutable storage - integrity risk."
    fix_action: "Use S3 Object Lock or immutable blob storage"
    applies_to:
      - "**/*.py"
      - "**/*.ts"
      - "**/*.yaml"

  - id: no-evidence-hash
    name: Missing Evidence Hash
    severity: warning
    type: regex
    pattern:
      - "collect_evidence\\((?!.*hash)"
      - "store_evidence\\((?!.*sha256)"
      - "Evidence\\((?!.*content_hash)"
    message: "Evidence may lack integrity hash for verification."
    fix_action: "Add SHA-256 hash to all evidence artifacts"
    applies_to:
      - "**/*.py"
      - "**/*.ts"

  - id: policy-no-version
    name: Policy Without Version Control
    severity: warning
    type: regex
    pattern:
      - "policy.*=.*\"\"\"(?!.*version)"
      - "POLICY.*=(?!.*v[0-9])"
    message: "Policy may not be version controlled."
    fix_action: "Store policies in version control with versioning"
    applies_to:
      - "**/*.py"
      - "**/*.rego"

  - id: no-compliance-alerting
    name: Missing Compliance Alerting
    severity: warning
    type: regex
    pattern:
      - "compliance.*check(?!.*alert)"
      - "control.*fail(?!.*notify)"
    message: "Compliance failure may not trigger alerts."
    fix_action: "Add alerting for compliance violations"
    applies_to:
      - "**/*.py"
      - "**/*.yaml"

  - id: manual-evidence-collection
    name: Manual Evidence Collection
    severity: info
    type: regex
    pattern:
      - "evidence.*manual"
      - "collect.*screenshot.*manually"
      - "export.*for.*audit"
    message: "Evidence collection may be manual - consider automation."
    fix_action: "Automate evidence collection on schedule"
    applies_to:
      - "**/*.py"
      - "**/*.md"

  - id: no-retention-policy
    name: Missing Evidence Retention
    severity: warning
    type: regex
    pattern:
      - "evidence(?!.*retention)"
      - "store_artifact(?!.*expire)"
    message: "Evidence may lack retention policy."
    fix_action: "Define evidence retention (typically 7 years)"
    applies_to:
      - "**/*.py"
      - "**/*.yaml"

  - id: hardcoded-compliance-exception
    name: Hardcoded Compliance Exception
    severity: warning
    type: regex
    pattern:
      - "skip.*compliance.*=.*True"
      - "ignore.*control.*=.*True"
      - "exception.*permanent"
    message: "Hardcoded compliance exception found."
    fix_action: "Use time-bound exceptions with approval workflow"
    applies_to:
      - "**/*.py"
      - "**/*.yaml"
