validations:

  - id: no-circuit-breaker
    name: Missing Circuit Breaker
    severity: error
    type: regex
    pattern:
      - "requests\\.get\\((?!.*circuit)"
      - "http\\.request\\((?!.*breaker)"
      - "fetch\\((?!.*circuitBreaker)"
    message: "External HTTP call may lack circuit breaker protection."
    fix_action: "Add circuit breaker for external service calls"
    applies_to:
      - "**/*.py"
      - "**/*.ts"
      - "**/*.js"

  - id: no-timeout-set
    name: Missing Request Timeout
    severity: error
    type: regex
    pattern:
      - "requests\\.(?!.*timeout)"
      - "aiohttp.*(?!.*timeout)"
      - "axios\\((?!.*timeout)"
    message: "HTTP request may not have timeout configured."
    fix_action: "Set explicit timeout for all external calls"
    applies_to:
      - "**/*.py"
      - "**/*.ts"
      - "**/*.js"

  - id: no-idempotency-key
    name: Missing Idempotency Key
    severity: warning
    type: regex
    pattern:
      - "POST.*payment(?!.*idempotency)"
      - "create_order\\((?!.*idempotency_key)"
      - "process_charge\\((?!.*dedup)"
    message: "Financial operation may lack idempotency key."
    fix_action: "Add idempotency key for financial operations"
    applies_to:
      - "**/*.py"
      - "**/*.ts"

  - id: no-dead-letter-queue
    name: Missing Dead Letter Queue
    severity: warning
    type: regex
    pattern:
      - "SQS.*Queue(?!.*DeadLetterQueue)"
      - "create_queue\\((?!.*dlq)"
      - "subscribe\\((?!.*dead_letter)"
    message: "Message queue may lack dead letter queue configuration."
    fix_action: "Configure DLQ for message queue"
    applies_to:
      - "**/*.py"
      - "**/*.ts"
      - "**/*.yaml"

  - id: sync-in-event-handler
    name: Synchronous Call in Event Handler
    severity: warning
    type: regex
    pattern:
      - "on_event.*requests\\.get"
      - "handle_message.*http\\.post"
      - "consume.*await.*fetch"
    message: "Synchronous HTTP call in event handler - consider async."
    fix_action: "Use async patterns or emit events instead of sync calls"
    applies_to:
      - "**/*.py"
      - "**/*.ts"

  - id: no-retry-config
    name: Missing Retry Configuration
    severity: info
    type: regex
    pattern:
      - "publish_event\\((?!.*retry)"
      - "send_message\\((?!.*attempts)"
    message: "Event publishing may lack retry configuration."
    fix_action: "Configure retries with exponential backoff"
    applies_to:
      - "**/*.py"
      - "**/*.ts"

  - id: hardcoded-endpoint
    name: Hardcoded Service Endpoint
    severity: warning
    type: regex
    pattern:
      - "http://localhost:[0-9]+"
      - "https://api\\.production\\."
      - "service_url\\s*=\\s*['\"]http"
    message: "Service endpoint may be hardcoded - use service discovery."
    fix_action: "Use environment variables or service discovery"
    applies_to:
      - "**/*.py"
      - "**/*.ts"
      - "**/*.js"
