validations:

  - id: no-backup-encryption
    name: Unencrypted Backup
    severity: error
    type: regex
    pattern:
      - "backup.*encryption.*false"
      - "pg_dump(?!.*--no-password)"
      - "mysqldump(?!.*--ssl)"
    message: "Backup may not be encrypted - security risk."
    fix_action: "Enable encryption for all backups"
    applies_to:
      - "**/*.py"
      - "**/*.sh"
      - "**/*.yaml"

  - id: same-region-backup
    name: Same Region Backup
    severity: warning
    type: regex
    pattern:
      - "backup.*region.*=.*primary"
      - "s3.*bucket.*same.*region"
      - "backup_region.*=.*source_region"
    message: "Backup may be in same region as primary - DR risk."
    fix_action: "Configure cross-region backup replication"
    applies_to:
      - "**/*.py"
      - "**/*.yaml"
      - "**/*.tf"

  - id: no-backup-verification
    name: Missing Backup Verification
    severity: warning
    type: regex
    pattern:
      - "create_backup\\((?!.*verify)"
      - "backup\\.run\\((?!.*validate)"
    message: "Backup may not be verified after creation."
    fix_action: "Add backup verification step"
    applies_to:
      - "**/*.py"
      - "**/*.sh"

  - id: manual-failover
    name: Manual Failover Steps
    severity: info
    type: regex
    pattern:
      - "ssh.*promote"
      - "manual.*step"
      - "run.*script.*manually"
    message: "Failover contains manual steps - consider automation."
    fix_action: "Automate failover procedure"
    applies_to:
      - "**/*.md"
      - "**/*.sh"
      - "**/*.yaml"

  - id: no-rto-rpo-defined
    name: Missing RTO/RPO Definition
    severity: warning
    type: regex
    pattern:
      - "disaster.*recovery(?!.*rto|.*rpo)"
      - "dr_config(?!.*recovery_time)"
    message: "DR configuration may lack RTO/RPO definitions."
    fix_action: "Define RTO and RPO for all services"
    applies_to:
      - "**/*.yaml"
      - "**/*.py"

  - id: no-backup-retention
    name: Missing Backup Retention Policy
    severity: warning
    type: regex
    pattern:
      - "backup(?!.*retention)"
      - "create_snapshot(?!.*expire)"
    message: "Backup may lack retention policy - storage cost risk."
    fix_action: "Define backup retention and cleanup policy"
    applies_to:
      - "**/*.py"
      - "**/*.yaml"
      - "**/*.tf"

  - id: hardcoded-dr-credentials
    name: Hardcoded DR Credentials
    severity: error
    type: regex
    pattern:
      - "dr_password\\s*=\\s*['\"]"
      - "failover_key\\s*=\\s*['\"]"
      - "backup_secret\\s*=\\s*['\"]"
    message: "DR credentials may be hardcoded - security risk."
    fix_action: "Use secrets manager for DR credentials"
    applies_to:
      - "**/*.py"
      - "**/*.sh"
      - "**/*.yaml"
