id: rigging-animation-collaboration
skill: rigging-animation
version: 1.0.0

# ============================================================================
# RECEIVES FROM (Who delegates TO this skill)
# ============================================================================
receives_from:
  - skill: 3d-modeling
    context: "Mesh ready for rigging"
    receives:
      - "Clean topology mesh"
      - "Edge loops for deformation"
      - "Target platform (mobile/PC)"
      - "Art style (realistic/stylized)"
      - "Mesh in bind pose (T or A)"
    provides: "Fully rigged and skinned character"

  - skill: character-design
    context: "Character design needs rig implementation"
    receives:
      - "Character proportions"
      - "Range of motion requirements"
      - "Costume/armor considerations"
      - "Facial expression needs"
      - "Style references"
    provides: "Rig matching design intent"

  - skill: animation-systems
    context: "Animation system needs rig specifications"
    receives:
      - "Animation requirements (locomotion, combat, etc.)"
      - "Blend tree structure"
      - "IK target needs"
      - "Root motion requirements"
      - "Performance constraints"
    provides: "Animation-ready rig with required bones"

  - skill: game-design
    context: "Game needs character rigging for gameplay"
    receives:
      - "Character type (player, NPC, creature)"
      - "Gameplay requirements (climbing, swimming, etc.)"
      - "Performance budget"
      - "Target platforms"
    provides: "Gameplay-ready character rig"

  - skill: vfx-systems
    context: "VFX needs attachment points and sockets"
    receives:
      - "VFX attachment requirements"
      - "Socket positions needed"
      - "Trail/ribbon bone needs"
      - "Particle spawn points"
    provides: "VFX socket bones and attachment rig"

# ============================================================================
# DELEGATION TRIGGERS
# ============================================================================
delegation_triggers:
  - trigger: "mesh|model|topology|sculpt"
    delegate_to: 3d-modeling
    pattern: sequential
    context: "Rigging needs base mesh work"
    handoff_data:
      - "Required edge loops (elbows, knees, mouth)"
      - "Deformation area topology needs"
      - "Bind pose requirements"
      - "LOD mesh versions needed"
    receive: "Optimized mesh ready for binding"

  - trigger: "animate|keyframe|motion capture|mocap|walk cycle|run cycle"
    delegate_to: animation-systems
    pattern: parallel
    context: "Rig ready for animation"
    handoff_data:
      - "Skeleton hierarchy documentation"
      - "Control rig user guide"
      - "IK/FK switch locations"
      - "Space switch options"
      - "Facial rig controls"
      - "Blend shape target list"
    receive: "Animation clips for rig"

  - trigger: "design|concept|style|proportion"
    delegate_to: character-design
    pattern: sequential
    context: "Rigging needs design decisions"
    handoff_data:
      - "Current rig capabilities"
      - "Technical constraints"
      - "Performance limitations"
      - "Deformation considerations"
    receive: "Design decisions and proportions"

  - trigger: "gameplay|controller|movement system|ability"
    delegate_to: game-design
    pattern: parallel
    context: "Rig integration with gameplay systems"
    handoff_data:
      - "Available IK targets"
      - "Root motion capabilities"
      - "Procedural animation hooks"
      - "Socket attachment points"
    receive: "Gameplay integration requirements"

  - trigger: "shader|material|render|particle|trail"
    delegate_to: vfx-systems
    pattern: parallel
    context: "Rig needs VFX integration"
    handoff_data:
      - "Available socket bones"
      - "Velocity/acceleration data sources"
      - "Mesh surface for spawn"
      - "Animation event hooks"
    receive: "VFX requirements for rig"

  - trigger: "performance|optimization|LOD|frame rate|bone count"
    delegate_to: codebase-optimization
    pattern: sequential
    context: "Rig performance optimization needed"
    handoff_data:
      - "Current bone count"
      - "Blend shape count"
      - "Skin cluster data"
      - "Target platform specs"
    receive: "Performance recommendations"

# ============================================================================
# FEEDBACK LOOPS
# ============================================================================
feedback_loops:
  receives_feedback_from:
    - skill: animation-systems
      signal: "Rig control issues during animation"
      action: "Adjust controls for animator workflow"

    - skill: animation-systems
      signal: "Deformation problems in animation"
      action: "Fix weights or add corrective shapes"

    - skill: animation-systems
      signal: "IK/FK switching issues"
      action: "Debug and fix IK/FK system"

    - skill: codebase-optimization
      signal: "Performance bottleneck in skinning"
      action: "Reduce bone count or optimize skin cluster"

    - skill: qa-engineering
      signal: "Visual bugs in animation playback"
      action: "Debug and fix rig issues"

    - skill: game-design
      signal: "Rig doesn't support gameplay needs"
      action: "Add bones/controls for gameplay features"

  sends_feedback_to:
    - skill: 3d-modeling
      signal: "Topology causing deformation issues"
      action: "Request edge loop adjustments"

    - skill: 3d-modeling
      signal: "Mesh density too high/low"
      action: "Request optimization or detail pass"

    - skill: character-design
      signal: "Design conflicts with rigging constraints"
      action: "Request design adjustments for feasibility"

    - skill: animation-systems
      signal: "Rig limitations for requested animation"
      action: "Explain rig constraints, suggest alternatives"

    - skill: vfx-systems
      signal: "Socket positions need adjustment"
      action: "Coordinate socket bone placement"

# ============================================================================
# CROSS-DOMAIN INSIGHTS
# ============================================================================
cross_domain_insights:
  - domain: Anatomy
    insight: |
      Anatomists know how bodies work:
      - Joints have natural limits
      - Muscles overlap and layer
      - Skin stretches over bone
      - Fat and muscle volume shift
      - Tendons create surface detail
      Rigging is applied anatomy, even for stylized characters.
    applies_when: "Placing joints or weight painting realistic characters"

  - domain: Puppetry
    insight: |
      Puppeteers know control:
      - Fewer controls = more mastery
      - Controls should feel intuitive
      - Feedback must be immediate
      - Limitations breed creativity
      - The best puppet disappears - you see the character
      Control rigs are digital puppets.
    applies_when: "Designing control rig interface for animators"

  - domain: Mechanical Engineering
    insight: |
      Engineers know constraints:
      - Every joint has degrees of freedom
      - Linkages transfer motion
      - Overconstrained systems fight themselves
      - Tolerances matter at scale
      - Simple mechanisms are reliable
      IK/FK systems are mechanical linkages.
    applies_when: "Building IK systems or constraint setups"

  - domain: Animation (Traditional)
    insight: |
      Traditional animators know appeal:
      - Silhouette reads at any size
      - Arcs make motion feel natural
      - Squash and stretch convey weight
      - Follow-through shows mass
      - Secondary motion adds life
      Rigs must support traditional principles.
    applies_when: "Adding squash/stretch controls or secondary motion bones"

  - domain: Film Production
    insight: |
      Film producers know pipelines:
      - Changes cascade downstream
      - Lock phases before moving on
      - Documentation prevents disasters
      - Version control is mandatory
      - The earlier the fix, the cheaper
      Rigging is a pipeline bottleneck - get it right early.
    applies_when: "Planning rig versioning or production workflow"

# ============================================================================
# COMMON COMBINATIONS
# ============================================================================
common_combinations:
  - name: Character Pipeline (Full)
    skills:
      - character-design
      - 3d-modeling
      - rigging-animation
      - animation-systems
    workflow: |
      1. Character concept and proportions (character-design)
      2. Base mesh creation with deformation topology (3d-modeling)
      3. Skeleton and rig creation (rigging-animation)
      4. Weight painting and blend shapes (rigging-animation)
      5. Control rig polish (rigging-animation)
      6. Animation set creation (animation-systems)
      7. Iteration on deformation issues (rigging-animation + animation-systems)
      8. Final polish and documentation (all)

  - name: Humanoid Game Character
    skills:
      - rigging-animation
      - animation-systems
      - game-design
    workflow: |
      1. Skeleton hierarchy following game engine standard (rigging-animation)
      2. IK/FK systems for gameplay needs (rigging-animation)
      3. Root motion setup (rigging-animation)
      4. Gameplay integration hooks (game-design)
      5. Animation retargeting validation (animation-systems)
      6. Performance optimization pass (rigging-animation)

  - name: Facial Animation Pipeline
    skills:
      - rigging-animation
      - animation-systems
      - character-design
    workflow: |
      1. Facial topology review (character-design + rigging-animation)
      2. FACS blend shape set creation (rigging-animation)
      3. Facial bone rig (rigging-animation)
      4. Blend shape/bone hybrid setup (rigging-animation)
      5. Facial animation testing (animation-systems)
      6. Lip sync and expression polish (animation-systems)

  - name: Creature/Non-Humanoid Rig
    skills:
      - character-design
      - rigging-animation
      - animation-systems
    workflow: |
      1. Creature anatomy study (character-design)
      2. Custom skeleton hierarchy (rigging-animation)
      3. Specialized IK solvers (multi-leg, tail, etc.) (rigging-animation)
      4. Procedural secondary motion (rigging-animation)
      5. Creature animation set (animation-systems)
      6. Engine integration (rigging-animation + animation-systems)

  - name: Mobile Game Character
    skills:
      - rigging-animation
      - codebase-optimization
      - game-design
    workflow: |
      1. Bone budget planning (30-50 bones) (rigging-animation)
      2. Minimal twist bone setup (rigging-animation)
      3. 4 influences max skinning (rigging-animation)
      4. LOD rig planning (codebase-optimization)
      5. Bone reduction LOD (rigging-animation)
      6. Performance testing on target devices (codebase-optimization)

# ============================================================================
# HANDOFF PROTOCOLS
# ============================================================================
handoff_protocols:
  to_animation_systems:
    required_deliverables:
      - "Skeleton hierarchy document (bone names, hierarchy tree)"
      - "Control rig user guide with screenshots"
      - "IK/FK switch and space switch documentation"
      - "Blend shape list with preview images"
      - "Animation test file with extreme poses"
      - "Known limitations and workarounds"
    optional_deliverables:
      - "Rig picker image file"
      - "Pose library with common poses"
      - "Animation test scenes"

  from_3d_modeling:
    required_incoming:
      - "Clean mesh with no n-gons in deformation areas"
      - "Proper edge loops at joints (elbow, knee, shoulder)"
      - "Mesh in correct bind pose (T or A pose)"
      - "UV layout complete (for blend shapes)"
      - "All transforms applied/frozen"
    validation_checklist:
      - "Vertex count appropriate for platform"
      - "No non-manifold geometry"
      - "Face normals consistent"
      - "Clean mesh history"

  to_game_engine:
    export_checklist:
      - "Skeleton at world origin"
      - "All transforms frozen"
      - "Bind pose matches rest pose"
      - "FBX settings documented"
      - "Test animation included"
      - "Bone naming matches engine convention"
    common_issues:
      - "Scale: Verify 1 unit = 1 meter or document scale"
      - "Axis: Document up axis and forward direction"
      - "Hierarchy: Root bone first in hierarchy"
