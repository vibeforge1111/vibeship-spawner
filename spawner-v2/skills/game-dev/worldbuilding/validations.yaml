# Worldbuilding Validations
# Automated consistency checks for world documents and lore files
# These patterns help catch common worldbuilding issues before they become problems

id: worldbuilding
skill: Worldbuilding
version: "2.0"

validations:
  # ==========================================================================
  # MAGIC SYSTEM VALIDATIONS
  # ==========================================================================
  - id: magic-system-has-limits
    name: Magic System Must Define Limits
    description: |
      Per Sanderson's Second Law: Limitations are more interesting than powers.
      Every magic system document should explicitly define what magic CANNOT do.
    pattern: "magic|spell|ability|power|arcane|mystic"
    file_glob: "**/*.{md,yaml,json,txt}"
    match: present
    context_pattern: "cannot|limit|cost|restrict|weakness|forbidden|impossible"
    message: |
      Magic system detected but no clear limitations found.
      Add explicit sections for:
      - Hard limits (what magic absolutely cannot do)
      - Costs (what using magic requires)
      - Weaknesses (what counters or blocks magic)
    severity: warning
    autofix: false

  - id: magic-economic-impact
    name: Magic Should Address Economic Impact
    description: |
      Magic that affects production, transportation, or resources needs economic
      consideration to maintain world consistency.
    pattern: "teleport|create|conjure|summon|transmut|heal|grow|multiply"
    file_glob: "**/*.{md,yaml,json,txt}"
    match: present
    context_pattern: "cost|rare|limit|economy|trade|price|scarc"
    message: |
      Potentially economy-breaking magic detected.
      Consider documenting:
      - Why doesn't everyone use this?
      - What economic systems remain necessary?
      - Who controls access to this magic?
    severity: info
    autofix: false

  # ==========================================================================
  # CULTURE AND SOCIETY VALIDATIONS
  # ==========================================================================
  - id: culture-has-diversity
    name: Cultures Should Have Internal Diversity
    description: |
      To avoid "Planet of Hats" syndrome, cultures should document internal
      factions, subgroups, or variations.
    pattern: "culture|civilization|people|race|species|nation"
    file_glob: "**/*.{md,yaml,json,txt}"
    match: present
    context_pattern: "faction|subgroup|division|internal|disagree|tension|sect|clan|tribe"
    message: |
      Culture defined but no internal diversity documented.
      Consider adding:
      - 2-4 subgroups or factions within the culture
      - Internal tensions or debates
      - Individuals who don't fit the mold
    severity: info
    autofix: false

  - id: culture-not-monolithic-relationship
    name: Intercultural Relationships Should Not Be Monolithic
    description: |
      Relationships between cultures should have nuance - not "all X hate all Y."
    pattern: "hate|enemy|ally|friend|distrust|fear"
    file_glob: "**/*culture*.{md,yaml,json,txt}"
    match: present
    context_pattern: "some|exception|official|individual|generation|faction"
    message: |
      Strong intercultural relationship detected.
      Ensure you document:
      - Official vs actual relationship
      - Exceptions and individual variations
      - Historical changes in the relationship
    severity: info
    autofix: false

  # ==========================================================================
  # HISTORY AND TIMELINE VALIDATIONS
  # ==========================================================================
  - id: timeline-has-causation
    name: Historical Events Should Show Cause-Effect
    description: |
      Events should lead to consequences. "X happened" needs "therefore Y changed."
    pattern: "year|age|era|century|event|battle|war|founded"
    file_glob: "**/*.{md,yaml,json,txt}"
    match: present
    context_pattern: "because|result|consequence|led to|caused|therefore|aftermath"
    message: |
      Historical events detected without clear cause-effect chains.
      For each major event, document:
      - What caused it?
      - What changed because of it?
      - How does it affect the present?
    severity: info
    autofix: false

  - id: timeline-reasonable-duration
    name: Check for Unrealistic Durations
    description: |
      Flag suspiciously long periods of stability or stagnation that might
      need explanation.
    pattern: "\\b\\d{4,}\\s*(years?|centuries)"
    file_glob: "**/*.{md,yaml,json,txt}"
    match: present
    context_pattern: "because|magic|immortal|stasis|prevent|explain"
    message: |
      Very long time period detected (1000+ years).
      Ensure you explain why:
      - Technology didn't advance
      - Social structures stayed stable
      - No major changes occurred
    severity: info
    autofix: false

  # ==========================================================================
  # CONFLICT VALIDATIONS
  # ==========================================================================
  - id: conflict-has-motivation
    name: Conflicts Must Have Clear Motivations
    description: |
      Every conflict needs resource-based or ideological motivation for all parties.
      "They're evil" is not sufficient.
    pattern: "conflict|war|enemy|battle|feud|fight"
    file_glob: "**/*.{md,yaml,json,txt}"
    match: present
    context_pattern: "resource|stake|motivation|reason|want|need|fear|believe"
    message: |
      Conflict detected without clear motivations.
      Document for EACH side:
      - What do they want?
      - Why do they believe they're right?
      - What do they fear if they lose?
    severity: warning
    autofix: false

  - id: conflict-multiple-perspectives
    name: Conflicts Should Show Multiple Perspectives
    description: |
      Avoid pure good vs evil. Each side should have understandable motivations.
    pattern: "villain|enemy|evil|antagonist"
    file_glob: "**/*.{md,yaml,json,txt}"
    match: present
    context_pattern: "perspective|view|believe|justify|understand|reason"
    message: |
      Antagonist/villain detected.
      Ensure you document:
      - Their perspective on the conflict
      - Why they believe they're justified
      - Moderates or sympathetic members
    severity: info
    autofix: false

  # ==========================================================================
  # NAMING VALIDATIONS
  # ==========================================================================
  - id: naming-has-system
    name: Names Should Follow Consistent System
    description: |
      Names within a culture should have documented phonetic rules or patterns.
    pattern: "name.*:.*[A-Z][a-z]+|[A-Z][a-z]+.*name"
    file_glob: "**/*culture*.{md,yaml,json,txt}"
    match: present
    context_pattern: "phoneme|syllable|pattern|structure|suffix|prefix|convention"
    message: |
      Names detected without naming convention documentation.
      Consider creating a naming system with:
      - Allowed sounds/phonemes
      - Syllable structure rules
      - Common suffixes/prefixes
      - Example names
    severity: info
    autofix: false

  - id: naming-pronounceable
    name: Names Should Be Pronounceable
    description: |
      Flag names with excessive consonant clusters or unusual patterns
      that may be hard to pronounce.
    pattern: "[A-Z][a-z]*[^aeiou]{4,}[a-z]*"
    file_glob: "**/*.{md,yaml,json,txt}"
    match: absent
    message: |
      Potentially unpronounceable name detected (4+ consonants in a row).
      Consider:
      - Breaking up consonant clusters
      - Simplifying for important characters
      - Testing with beta readers
    severity: info
    autofix: false

  # ==========================================================================
  # ECONOMY VALIDATIONS
  # ==========================================================================
  - id: economy-addresses-magic
    name: Economy Should Account for Magic/Tech
    description: |
      Economic systems should consider how magic or advanced technology
      affects trade, production, and scarcity.
    pattern: "economy|trade|currency|market|merchant|gold"
    file_glob: "**/*.{md,yaml,json,txt}"
    match: present
    context_pattern: "magic|technology|impact|change|affect|despite"
    message: |
      Economic content detected.
      Ensure you address:
      - How does magic/tech affect this economy?
      - What remains scarce despite magic?
      - Who benefits from the economic system?
    severity: info
    autofix: false

  - id: economy-food-production
    name: Check Food Production for Population
    description: |
      Cities and populations need food sources. Medieval settings need
      ~90% farmers to support cities.
    pattern: "city|population|kingdom|empire|million"
    file_glob: "**/*.{md,yaml,json,txt}"
    match: present
    context_pattern: "farm|food|agriculture|feed|grain|import"
    message: |
      Large population referenced.
      Consider documenting:
      - Where does food come from?
      - What percentage farms vs other work?
      - Is food imported? From where?
    severity: info
    autofix: false

  # ==========================================================================
  # RELIGION VALIDATIONS
  # ==========================================================================
  - id: religion-serves-needs
    name: Religions Should Serve Psychological Needs
    description: |
      Religions should answer existential questions and provide community
      benefits that explain why people believe.
    pattern: "god|religion|faith|worship|belief|temple|priest"
    file_glob: "**/*.{md,yaml,json,txt}"
    match: present
    context_pattern: "death|afterlife|moral|community|meaning|purpose|fear"
    message: |
      Religion detected without psychological needs addressed.
      Document:
      - What existential questions does it answer?
      - What does it promise believers?
      - Why would someone genuinely believe?
    severity: info
    autofix: false

  - id: religion-power-structure
    name: Religions Should Have Power Dynamics
    description: |
      Who interprets religious doctrine matters politically.
    pattern: "priest|temple|church|clergy|holy"
    file_glob: "**/*.{md,yaml,json,txt}"
    match: present
    context_pattern: "power|authority|hierarchy|select|corrupt|reform"
    message: |
      Religious institution detected.
      Document:
      - Who has authority to interpret doctrine?
      - How are religious leaders chosen?
      - What is the relationship with secular power?
    severity: info
    autofix: false

  # ==========================================================================
  # GEOGRAPHY VALIDATIONS
  # ==========================================================================
  - id: geography-biome-transitions
    name: Biomes Should Transition Gradually
    description: |
      Deserts don't border tundra without explanation. Check for logical
      biome transitions.
    pattern: "desert|tundra|rainforest|jungle|arctic|tropical"
    file_glob: "**/*.{md,yaml,json,txt}"
    match: present
    context_pattern: "transition|border|gradient|magic|divine|anomaly"
    message: |
      Extreme biome type detected.
      Ensure transitions make sense:
      - Desert → Scrubland → Grassland (not desert → rainforest)
      - Tropical → Temperate → Arctic by latitude
      - Or document magical/divine explanation
    severity: info
    autofix: false

  - id: geography-river-logic
    name: Rivers Should Flow Correctly
    description: |
      Rivers flow downhill from mountains/highlands to sea.
      They don't split (tributaries join).
    pattern: "river|stream|tributary|delta"
    file_glob: "**/*.{md,yaml,json,txt}"
    match: present
    context_pattern: "mountain|sea|ocean|source|mouth|flow"
    message: |
      River system detected.
      Verify:
      - Rivers start in highlands (mountains, lakes)
      - Rivers flow to sea/major lakes
      - Tributaries join, not split
      - Cities at strategic river points (fords, mouths)
    severity: info
    autofix: false

  # ==========================================================================
  # CONSISTENCY VALIDATIONS
  # ==========================================================================
  - id: lore-cross-reference
    name: Lore Should Cross-Reference Consistently
    description: |
      When multiple documents reference the same entity, details should match.
    pattern: "see also|reference|related|mentioned in"
    file_glob: "**/*.{md,yaml,json,txt}"
    match: present
    context_pattern: "consistent|verify|check|same as"
    message: |
      Cross-reference detected.
      Maintain a master document of:
      - Entity names and spellings
      - Key dates and events
      - Relationships between entities
    severity: info
    autofix: false

  - id: world-bible-exists
    name: World Should Have Central Reference
    description: |
      Complex worlds benefit from a central "world bible" document
      that tracks key facts.
    pattern: "world|setting|universe|lore"
    file_glob: "**/README.md"
    match: present
    context_pattern: "bible|reference|master|index|central"
    message: |
      Consider creating a world bible document that indexes:
      - All cultures and their key traits
      - Major historical events and dates
      - Magic system rules summary
      - Key characters and relationships
    severity: info
    autofix: false

# ==========================================================================
# PRE-COMMIT HOOKS
# ==========================================================================
pre_commit:
  - id: lore-consistency-check
    name: Lore Consistency Check
    command: "npm run validate:lore || echo 'No lore validation script configured'"
    description: |
      Check lore documents for internal consistency before committing.
      Looks for contradictory dates, names, and facts.

  - id: naming-consistency-check
    name: Naming Consistency Check
    command: "npm run validate:names || echo 'No naming validation script configured'"
    description: |
      Verify that names follow established cultural conventions.
      Flags names that break phonetic rules.

  - id: timeline-validation
    name: Timeline Validation
    command: "npm run validate:timeline || echo 'No timeline validation script configured'"
    description: |
      Check timeline for logical issues:
      - Events before their causes
      - Impossible durations
      - Missing connections

# ==========================================================================
# CI CHECKS (for game/narrative pipelines)
# ==========================================================================
ci_checks:
  - id: world-bible-completeness
    name: World Bible Completeness
    command: "npm run check:world-bible || echo 'No world bible check configured'"
    description: |
      Verify that the world bible covers all required sections:
      - Magic system with limits
      - All major cultures with diversity
      - Historical timeline with causation
      - Economic system basics
    required: false

  - id: magic-balance-check
    name: Magic System Balance Check
    command: "npm run check:magic-balance || echo 'No magic balance check configured'"
    description: |
      Check for potentially game-breaking or story-breaking magic:
      - Infinite resources
      - Perfect teleportation
      - Instant healing without cost
      - Creation from nothing
    required: false

  - id: cultural-sensitivity-review
    name: Cultural Sensitivity Markers
    command: "npm run check:sensitivity || echo 'No sensitivity check configured'"
    description: |
      Flag content that may need sensitivity review:
      - Fantasy counterpart cultures
      - Potentially stereotypical descriptions
      - Controversial real-world parallels
    required: false
