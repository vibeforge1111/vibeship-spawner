id: roblox-development
skill: Roblox Development
version: "1.0"

validations:
  - id: check-server-validation
    name: Server-Side Validation Required
    description: RemoteEvents must validate all incoming data
    pattern: "OnServerEvent:Connect"
    file_glob: "**/*.lua"
    match: present
    context_pattern: "typeof|type\\(|assert"
    message: "Validate all RemoteEvent arguments on server"
    severity: error
    autofix: false

  - id: check-no-client-trust
    name: No Client Trust Pattern
    description: Server should never trust client-provided values for important logic
    pattern: "OnServerEvent:Connect.*function.*player.*damage|health|coins|level"
    file_glob: "**/*.lua"
    match: present
    message: "Don't accept damage/health/currency values from client - calculate on server"
    severity: error
    autofix: false

  - id: check-datastore-pcall
    name: DataStore Error Handling
    description: DataStore calls should be wrapped in pcall
    pattern: "GetAsync|SetAsync|UpdateAsync"
    file_glob: "**/*.lua"
    match: present
    context_pattern: "pcall|xpcall"
    message: "Wrap DataStore calls in pcall for error handling"
    severity: error
    autofix: false

  - id: check-bindtoclose
    name: BindToClose for Server Shutdown
    description: Save player data on server shutdown
    pattern: "DataStore"
    file_glob: "**/*.lua"
    match: present
    context_pattern: "BindToClose"
    message: "Use BindToClose to save data on server shutdown"
    severity: warning
    autofix: false

  - id: check-loop-yield
    name: Loop Yield Required
    description: Loops must contain wait/yield to prevent freezing
    pattern: "while.*true.*do|while.*do"
    file_glob: "**/*.lua"
    match: present
    context_pattern: "wait|task.wait|Heartbeat|RenderStepped"
    message: "Add wait() or task.wait() in loops to prevent freezing"
    severity: error
    autofix: false

  - id: check-connection-cleanup
    name: Connection Cleanup
    description: Event connections should be cleaned up
    pattern: ":Connect\\("
    file_glob: "**/*.lua"
    match: present
    context_pattern: ":Disconnect|Maid|Janitor"
    message: "Consider cleaning up connections to prevent memory leaks"
    severity: info
    autofix: false

  - id: check-require-module-id
    name: No Remote Module Loading
    description: Don't require modules by ID (security risk)
    pattern: "require\\(\\d{6,}\\)"
    file_glob: "**/*.lua"
    match: present
    message: "Don't require modules by ID - security risk and unreliable"
    severity: error
    autofix: false

  - id: check-http-service
    name: HttpService Usage Review
    description: HttpService calls should be intentional
    pattern: "HttpService:GetAsync|HttpService:PostAsync"
    file_glob: "**/*.lua"
    match: present
    message: "Review HttpService usage - ensure it's intentional and secure"
    severity: warning
    autofix: false

  - id: check-text-filtering
    name: Text Filtering Required
    description: User-generated text must be filtered
    pattern: "TextLabel|TextBox|Chat"
    file_glob: "**/*.lua"
    match: present
    context_pattern: "FilterStringAsync|TextService"
    message: "Filter all user-generated text with TextService"
    severity: warning
    autofix: false

  - id: check-mobile-optimization
    name: Mobile Optimization
    description: Consider mobile/low-end device performance
    pattern: "ParticleEmitter|Beam|Trail"
    file_glob: "**/*.lua"
    match: present
    context_pattern: "TouchEnabled|Platform"
    message: "Consider reducing effects for mobile players"
    severity: info
    autofix: false

pre_commit:
  - id: lua-syntax-check
    name: Lua Syntax Check
    command: "luacheck src/ --std lua51"
    description: Check Lua syntax and common issues

  - id: security-scan
    name: Security Pattern Scan
    command: "grep -r 'require([0-9]\\{6,\\})\\|loadstring' src/"
    description: Scan for security anti-patterns

ci_checks:
  - id: datastore-safety
    name: DataStore Safety Check
    command: "grep -r 'DataStore' src/ | grep -v 'pcall'"
    description: Ensure DataStore calls are wrapped in pcall
    required: true

  - id: remote-validation
    name: Remote Event Validation
    command: "python scripts/check_remote_validation.py"
    description: Verify all RemoteEvents have server-side validation
