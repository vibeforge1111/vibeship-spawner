id: vr-ar-development
skill: VR/AR Development
version: "1.0"

validations:
  - id: check-camera-movement
    name: Camera Movement Safety
    description: Avoid automatic camera movement that causes motion sickness
    pattern: "camera\\.(position|rotation).*=|camera\\.lookAt"
    file_glob: "**/*.{js,ts,jsx,tsx}"
    match: present
    context_pattern: "controller|input|button|user"
    message: "Ensure camera movement is user-initiated to prevent motion sickness"
    severity: error
    autofix: false

  - id: check-frame-budget
    name: Frame Time Budget
    description: XR requires 90fps (11ms) or better
    pattern: "setAnimationLoop|render\\("
    file_glob: "**/*.{js,ts,jsx,tsx}"
    match: present
    context_pattern: "performance|frameTime|budget"
    message: "Monitor frame time to ensure 11ms budget for VR"
    severity: warning
    autofix: false

  - id: check-xr-enabled
    name: XR Renderer Enabled
    description: WebXR requires renderer.xr.enabled = true
    pattern: "WebGLRenderer"
    file_glob: "**/*.{js,ts,jsx,tsx}"
    match: present
    context_pattern: "xr\\.enabled|VRButton|ARButton"
    message: "Enable WebXR on renderer for VR/AR support"
    severity: warning
    autofix: false

  - id: check-reference-space
    name: Reference Space Configuration
    description: Set appropriate XR reference space
    pattern: "xr\\.enabled"
    file_glob: "**/*.{js,ts,jsx,tsx}"
    match: present
    context_pattern: "setReferenceSpaceType|local-floor|bounded-floor"
    message: "Configure XR reference space type"
    severity: info
    autofix: false

  - id: check-tracking-loss
    name: Tracking Loss Handling
    description: Handle tracking loss gracefully
    pattern: "getViewerPose|getPose"
    file_glob: "**/*.{js,ts,jsx,tsx}"
    match: present
    context_pattern: "null|undefined|!pose|tracking"
    message: "Handle null pose when tracking is lost"
    severity: warning
    autofix: false

  - id: check-controller-events
    name: Controller Event Handling
    description: Handle XR controller input events
    pattern: "xr\\.getController"
    file_glob: "**/*.{js,ts,jsx,tsx}"
    match: present
    context_pattern: "selectstart|selectend|squeeze"
    message: "Add event listeners for XR controller input"
    severity: info
    autofix: false

  - id: check-ui-distance
    name: UI Distance from Camera
    description: UI should be at comfortable viewing distance
    pattern: "position.*-?[0-9]+\\.?[0-9]*.*z|z.*=.*-?[0-9]"
    file_glob: "**/*.{js,ts,jsx,tsx}"
    match: present
    context_pattern: "ui|panel|text|button"
    message: "Place UI at 0.5-2m distance for comfortable viewing"
    severity: info
    autofix: false

  - id: check-text-size
    name: VR Text Size
    description: Text must be large enough to read in VR
    pattern: "fontSize|textSize|font-size"
    file_glob: "**/*.{js,ts,jsx,tsx}"
    match: present
    context_pattern: "0\\.0[2-9]|0\\.1"
    message: "Use minimum 0.02m (2cm) font size for VR readability"
    severity: info
    autofix: false

  - id: check-locomotion
    name: Safe Locomotion Method
    description: Use teleportation or snap turns for comfort
    pattern: "locomotion|movement|teleport|snap"
    file_glob: "**/*.{js,ts,jsx,tsx}"
    match: present
    context_pattern: "teleport|snap|blink|instant"
    message: "Use teleportation or snap turns for motion sickness prevention"
    severity: warning
    autofix: false

  - id: check-session-events
    name: XR Session Event Handling
    description: Handle XR session start and end events
    pattern: "xr\\.enabled"
    file_glob: "**/*.{js,ts,jsx,tsx}"
    match: present
    context_pattern: "sessionstart|sessionend|addEventListener"
    message: "Handle XR session lifecycle events"
    severity: info
    autofix: false

pre_commit:
  - id: performance-check
    name: XR Performance Check
    command: "npm run test:xr-performance"
    description: Verify 90fps performance

  - id: comfort-check
    name: Comfort Guidelines Check
    command: "npm run lint:xr-comfort"
    description: Check for motion sickness risks

ci_checks:
  - id: webxr-polyfill
    name: WebXR Polyfill Test
    command: "npm run test:webxr"
    description: Test with WebXR polyfill for coverage
    required: false

  - id: device-test
    name: Device Compatibility Test
    command: "npm run test:devices"
    description: Test on multiple XR devices
    required: false
