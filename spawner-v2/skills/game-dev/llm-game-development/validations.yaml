# LLM Game Development Validations

validations:
  - id: llm-no-version-context
    name: AI Prompt Without Version Context
    severity: warning
    type: regex
    pattern: '//\s*(?:AI|Claude|GPT|Copilot|LLM).*(?:generated|created|wrote)'
    negative_pattern: 'Unity\s*\d|Godot\s*\d|UE\s*\d|version|Version'
    message: "AI-generated code marker without version context. Helps future debugging."
    fix_action: "Add version info to AI generation comments: // AI-generated for Unity 2023.2"
    applies_to:
      - "*.cs"
      - "*.gd"
      - "*.cpp"
      - "*.ts"
      - "*.js"

  - id: llm-deprecated-unity-api
    name: Deprecated Unity API
    severity: warning
    type: regex
    pattern: 'FindObjectOfType|SendMessage|BroadcastMessage|InvokeRepeating'
    message: "Using deprecated or slow Unity API. LLMs often generate these."
    fix_action: "Use FindFirstObjectByType, Events/UnityEvents, or Coroutines/Invoke"
    applies_to:
      - "*.cs"

  - id: llm-string-comparison-godot
    name: Stringly-Typed Godot Code
    severity: warning
    type: regex
    pattern: 'get_node\(\s*["\']|has_node\(\s*["\']'
    negative_pattern: '@onready|$|%'
    message: "String-based node access. LLMs often miss Godot 4's $ and % syntax."
    fix_action: "Use $NodeName or %UniqueNode for type-safe node access"
    applies_to:
      - "*.gd"

  - id: llm-unity-public-field
    name: Public Fields Without SerializeField
    severity: info
    type: regex
    pattern: 'public\s+(?:int|float|string|bool|GameObject|Transform)\s+\w+\s*;'
    negative_pattern: '\[SerializeField\]|\[HideInInspector\]'
    message: "Public field - prefer [SerializeField] private for encapsulation."
    fix_action: "Use [SerializeField] private field; for inspector-visible private fields"
    applies_to:
      - "*.cs"

  - id: llm-missing-null-check
    name: Potential Null Reference
    severity: warning
    type: regex
    pattern: 'GetComponent.*\(\)\.|\bFind.*\(\)\.|\bInstantiate.*as\s+\w+\)\.'
    negative_pattern: '\?\.|if\s*\(|null|!='
    message: "Direct method call on potentially null result. LLMs often skip null checks."
    fix_action: "Add null check or use ?. operator: GetComponent<T>()?.Method()"
    applies_to:
      - "*.cs"

  - id: llm-update-find
    name: Find/GetComponent in Update Loop
    severity: high
    type: regex
    pattern: 'void\s+Update\s*\([^)]*\)\s*\{[^}]*(?:Find|GetComponent)'
    message: "Expensive operation in Update(). Cache references in Start/Awake."
    fix_action: "Move Find/GetComponent to Start() or Awake() and cache in field"
    applies_to:
      - "*.cs"

  - id: llm-process-find
    name: Find in _process Loop
    severity: high
    type: regex
    pattern: 'func\s+_process\s*\([^)]*\):[^:]*(?:get_node|find_child|get_tree)'
    message: "Node lookup in _process(). Cache with @onready."
    fix_action: "Use @onready var node = $NodePath and reference cached variable"
    applies_to:
      - "*.gd"

  - id: llm-hardcoded-strings
    name: Hardcoded String Identifiers
    severity: info
    type: regex
    pattern: 'Animator\.SetBool\(\s*"|GetInput\(\s*"|LoadScene\(\s*"'
    message: "Hardcoded string identifiers. Use constants to prevent typos."
    fix_action: "Define const string ANIM_JUMPING = \"isJumping\"; and use constant"
    applies_to:
      - "*.cs"

  - id: llm-physics-in-update
    name: Physics in Update Instead of FixedUpdate
    severity: warning
    type: regex
    pattern: 'void\s+Update\s*\([^)]*\)\s*\{[^}]*(?:AddForce|velocity|MovePosition)'
    message: "Physics operations should be in FixedUpdate(), not Update()."
    fix_action: "Move physics code to FixedUpdate() for consistent behavior"
    applies_to:
      - "*.cs"

  - id: llm-no-error-handling
    name: Async Without Error Handling
    severity: warning
    type: regex
    pattern: 'async\s+|await\s+|\.then\(|Promise\.'
    negative_pattern: 'catch|try|error|Error|except|Exception'
    message: "Async code without error handling. LLMs often skip try/catch."
    fix_action: "Wrap async operations in try/catch with appropriate error handling"
    applies_to:
      - "*.cs"
      - "*.ts"
      - "*.js"
      - "*.gd"

  - id: llm-magic-numbers
    name: Magic Numbers in Game Logic
    severity: info
    type: regex
    pattern: '\b(?:if|while|for).*[<>=]+\s*\d{2,}|\w+\s*=\s*\d{3,}'
    negative_pattern: 'const|readonly|CONST|MAX_|MIN_|DEFAULT_'
    message: "Magic number in logic. Use named constants for clarity."
    fix_action: "Define constant: const int MAX_HEALTH = 100;"
    applies_to:
      - "*.cs"
      - "*.gd"
      - "*.ts"
      - "*.js"

  - id: llm-missing-input-validation
    name: User Input Without Validation
    severity: warning
    type: regex
    pattern: 'PlayerPrefs\.GetString|Input\.inputString|GetComponent.*TMP_InputField.*\.text'
    negative_pattern: 'string\.IsNullOrEmpty|TryParse|Validate|sanitize|escape'
    message: "User input without validation. Validate before using."
    fix_action: "Validate and sanitize user input before processing"
    applies_to:
      - "*.cs"

  - id: llm-coroutine-leak
    name: Coroutine Not Stopped
    severity: warning
    type: regex
    pattern: 'StartCoroutine\s*\('
    negative_pattern: 'StopCoroutine|StopAllCoroutines|OnDisable|OnDestroy'
    message: "Coroutine started but might not be stopped. Can cause issues on scene change."
    fix_action: "Store coroutine reference and stop in OnDisable/OnDestroy"
    applies_to:
      - "*.cs"
