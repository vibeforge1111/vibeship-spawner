id: authentication-oauth-collaboration
skill: authentication-oauth
version: 1.0.0

# ============================================================================
# RECEIVES FROM (Who delegates TO this skill)
# ============================================================================
receives_from:
  - skill: backend
    context: "Backend needs user authentication"
    receives:
      - "User model and requirements"
      - "Protected endpoints list"
      - "Session/token preference"
    provides: "Complete authentication implementation"

  - skill: frontend
    context: "Frontend needs auth flow"
    receives:
      - "Login/signup UI requirements"
      - "Social login requirements"
      - "Token storage needs"
    provides: "Client-side auth integration"

  - skill: security-hardening
    context: "Security review of auth implementation"
    receives:
      - "Security requirements"
      - "Compliance needs"
      - "Threat model"
    provides: "Secure auth patterns and implementation"

  - skill: websocket-realtime
    context: "WebSocket needs authentication"
    receives:
      - "Connection auth requirements"
      - "Token types supported"
    provides: "WebSocket authentication strategy"

# ============================================================================
# DELEGATION TRIGGERS
# ============================================================================
delegation_triggers:
  - trigger: "authorization|permissions|roles|rbac"
    delegate_to: security-hardening
    pattern: sequential
    context: "Authorization is separate from authentication"
    handoff_data:
      - "Authenticated user info"
      - "Permission requirements"
      - "Role structure"
    receive: "Authorization middleware and checks"

  - trigger: "user table|database schema"
    delegate_to: database-schema-design
    pattern: parallel
    context: "Need to design user and session tables"
    handoff_data:
      - "User fields needed"
      - "Session storage requirements"
      - "OAuth token storage"
    receive: "Database schema for auth"

  - trigger: "audit|logging|compliance"
    delegate_to: logging-strategies
    pattern: parallel
    context: "Auth events need audit logging"
    handoff_data:
      - "Auth event types"
      - "Required fields"
      - "Retention requirements"
    receive: "Audit logging implementation"

  - trigger: "rate limit|brute force|lockout"
    delegate_to: rate-limiting
    pattern: parallel
    context: "Auth endpoints need rate limiting"
    handoff_data:
      - "Login endpoint"
      - "Lockout requirements"
      - "IP vs account limits"
    receive: "Auth rate limiting implementation"

  - trigger: "email|password reset|verification"
    delegate_to: backend
    pattern: sequential
    context: "Need email sending for auth flows"
    handoff_data:
      - "Email types needed"
      - "Template requirements"
      - "Delivery requirements"
    receive: "Email sending implementation"

# ============================================================================
# FEEDBACK LOOPS
# ============================================================================
feedback_loops:
  receives_feedback_from:
    - skill: security-hardening
      signal: "Authentication vulnerabilities found"
      action: "Review and fix: token storage, session handling, password policy"

    - skill: observability-sre
      signal: "High auth failure rate detected"
      action: "Check for attacks, review error handling, improve monitoring"

    - skill: frontend
      signal: "Token refresh causing UX issues"
      action: "Adjust token lifetimes, improve refresh flow"

    - skill: performance-optimization
      signal: "Auth middleware causing latency"
      action: "Cache session lookups, optimize token validation"

  sends_feedback_to:
    - skill: backend
      signal: "User model needs additional fields"
      action: "Add fields for MFA, OAuth providers, session tracking"

    - skill: frontend
      signal: "Token handling patterns"
      action: "Implement proper storage and refresh patterns"

    - skill: security-hardening
      signal: "Auth implementation complete"
      action: "Ready for security review"

    - skill: database-schema-design
      signal: "Need session/token tables"
      action: "Design tables for refresh tokens, sessions, password resets"

# ============================================================================
# CROSS-DOMAIN INSIGHTS
# ============================================================================
cross_domain_insights:
  - domain: Security Engineering
    insight: |
      Security engineers know auth is the highest-value attack target:
      - One auth flaw = total compromise
      - 90% of breaches involve credentials
      - Defense in depth is mandatory
      - Assume tokens will be stolen

      Auth must be secure by default, not by configuration.
    applies_when: "Implementing any authentication system"

  - domain: Compliance
    insight: |
      Compliance requirements affect auth:
      - SOC 2: Session management, access logging
      - HIPAA: Strong authentication, audit trails
      - PCI-DSS: MFA for admin access
      - GDPR: Password storage, breach notification

      Know your compliance before designing auth.
    applies_when: "Building for regulated industries"

  - domain: User Experience
    insight: |
      UX experts know auth friction affects conversion:
      - Each field reduces signup by 10%
      - Social login increases conversion 20-50%
      - Password requirements frustrate users
      - Session timeout balance: security vs convenience

      Make auth as frictionless as security allows.
    applies_when: "Designing login and signup flows"

  - domain: Mobile Development
    insight: |
      Mobile platforms have different security models:
      - Secure enclave for token storage
      - Biometric authentication
      - Deep linking for OAuth
      - Background token refresh

      Mobile auth patterns differ from web.
    applies_when: "Building mobile authentication"

# ============================================================================
# COMMON COMBINATIONS
# ============================================================================
common_combinations:
  - name: Full Auth System
    skills:
      - authentication-oauth
      - database-schema-design
      - security-hardening
      - logging-strategies
    workflow: |
      1. Design user and session schema (database-schema-design)
      2. Implement auth flows (authentication-oauth)
      3. Add authorization layer (security-hardening)
      4. Set up audit logging (logging-strategies)
      5. Security review (security-hardening)

  - name: Social Login Integration
    skills:
      - authentication-oauth
      - frontend
      - backend
    workflow: |
      1. Register OAuth apps with providers (authentication-oauth)
      2. Implement OAuth flows (authentication-oauth)
      3. Build login UI (frontend)
      4. Handle account linking (authentication-oauth)
      5. Store OAuth tokens (backend)

  - name: Secure API Authentication
    skills:
      - authentication-oauth
      - rate-limiting
      - backend
    workflow: |
      1. Implement JWT flow (authentication-oauth)
      2. Add rate limiting (rate-limiting)
      3. Build auth middleware (backend)
      4. Handle token refresh (authentication-oauth)
      5. Add API key support if needed (backend)

  - name: Enterprise SSO
    skills:
      - authentication-oauth
      - security-hardening
      - infrastructure-as-code
    workflow: |
      1. Set up SAML/OIDC provider (infrastructure-as-code)
      2. Implement SSO flow (authentication-oauth)
      3. Handle user provisioning (authentication-oauth)
      4. Configure MFA (authentication-oauth)
      5. Security hardening (security-hardening)

# ============================================================================
# ECOSYSTEM
# ============================================================================
ecosystem:
  primary_tools:
    - "NextAuth.js / Auth.js - Full-featured auth for Next.js"
    - "Passport.js - Express auth middleware"
    - "bcrypt - Password hashing"
    - "jsonwebtoken - JWT implementation"
    - "otplib - TOTP for MFA"

  auth_providers:
    - name: Auth0
      type: Managed
      use_when: "Enterprise, complex requirements, SSO"
      features: "Universal login, MFA, social, enterprise SSO"

    - name: Clerk
      type: Managed
      use_when: "Modern apps, great DX, quick setup"
      features: "Components, organizations, webhooks"

    - name: Supabase Auth
      type: Self-hosted/Managed
      use_when: "Using Supabase, simple needs"
      features: "Email, social, magic links, RLS"

    - name: Firebase Auth
      type: Managed
      use_when: "Firebase ecosystem, mobile apps"
      features: "Social, phone, anonymous, custom tokens"

    - name: Keycloak
      type: Self-hosted
      use_when: "On-premise, full control, enterprise"
      features: "SSO, identity brokering, LDAP"

  auth_libraries:
    - name: NextAuth.js / Auth.js
      platform: "Next.js, SvelteKit, SolidStart"
      features: "40+ providers, JWT/database sessions, callbacks"

    - name: Passport.js
      platform: "Express, Node.js"
      features: "500+ strategies, modular, battle-tested"

    - name: Lucia
      platform: "Any JS framework"
      features: "Lightweight, database adapters, sessions"

    - name: better-auth
      platform: "Any JS framework"
      features: "Modern, TypeScript-first, plugins"

  password_tools:
    - name: bcrypt
      purpose: "Password hashing (recommended)"
      note: "Use cost factor 12+"

    - name: argon2
      purpose: "Password hashing (memory-hard)"
      note: "Better than bcrypt for new projects"

    - name: zxcvbn
      purpose: "Password strength estimation"
      note: "Dropbox library, realistic strength check"

  token_tools:
    - name: jsonwebtoken
      purpose: "JWT signing and verification"

    - name: jose
      purpose: "JWE/JWS, modern JWT library"

    - name: otplib
      purpose: "TOTP generation and verification"

  session_stores:
    - name: connect-redis
      purpose: "Redis session store for Express"

    - name: connect-mongo
      purpose: "MongoDB session store"

    - name: @auth/prisma-adapter
      purpose: "Prisma adapter for Auth.js"

