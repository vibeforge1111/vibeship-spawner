# MCP Server Development Validations

validations:
  - id: mcp-no-input-schema
    name: Tool Without Input Schema
    severity: critical
    type: regex
    pattern: 'name:\s*["\'][^"\']+["\']'
    negative_pattern: 'inputSchema|input_schema'
    message: "Tool defined without inputSchema. AI can't know what parameters to send."
    fix_action: "Add inputSchema with properties, types, and required fields"
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.py"

  - id: mcp-vague-description
    name: Tool With Vague Description
    severity: warning
    type: regex
    pattern: 'description:\s*["\'](?:This tool|Handles|Manages|Does)[^"\']{0,30}["\']'
    message: "Tool description is vague. Include WHEN to use it and WHAT it returns."
    fix_action: "Expand description: what it does, when to use, what it returns"
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.py"

  - id: mcp-no-error-handling
    name: Tool Handler Without Error Handling
    severity: high
    type: regex
    pattern: 'setRequestHandler.*CallTool'
    negative_pattern: 'try|catch|isError|error'
    message: "Tool handler without error handling. Failures will crash or hang."
    fix_action: "Wrap handler in try/catch, return isError: true on failure"
    applies_to:
      - "*.ts"
      - "*.js"

  - id: mcp-no-validation
    name: No Input Validation
    severity: high
    type: regex
    pattern: 'request\.params\.arguments'
    negative_pattern: 'z\.|zod|Zod|ajv|Ajv|validate|safeParse|parse\('
    message: "Using request arguments without validation. Unsafe input from AI."
    fix_action: "Validate with Zod or Ajv before using arguments"
    applies_to:
      - "*.ts"
      - "*.js"

  - id: mcp-sync-long-operation
    name: Synchronous Long Operation
    severity: warning
    type: regex
    pattern: 'await.*(?:fetch|request|query|exec|spawn)'
    negative_pattern: 'timeout|AbortController|signal|jobId|background'
    message: "Long operation without timeout. May cause transport timeout."
    fix_action: "Add timeout, or return job ID and implement polling"
    applies_to:
      - "*.ts"
      - "*.js"

  - id: mcp-hardcoded-creds
    name: Hardcoded Credentials
    severity: critical
    type: regex
    pattern: '(?:api_key|apiKey|secret|password|token)\s*[=:]\s*["\'][^"\']{8,}["\']'
    message: "Hardcoded credentials in MCP server. Security vulnerability."
    fix_action: "Use environment variables: process.env.API_KEY"
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.py"

  - id: mcp-no-logging
    name: No Request Logging
    severity: info
    type: regex
    pattern: 'setRequestHandler'
    negative_pattern: 'console\.log|logger|log\(|logging'
    message: "No logging in request handler. Debugging will be difficult."
    fix_action: "Add logging for requests and responses with correlation IDs"
    applies_to:
      - "*.ts"
      - "*.js"

  - id: mcp-global-state
    name: Global Mutable State
    severity: warning
    type: regex
    pattern: 'let\s+\w+\s*=|var\s+\w+\s*='
    negative_pattern: 'const|readonly|server\.'
    message: "Global mutable state may not persist between requests."
    fix_action: "Use external storage (Redis, DB) or stateless design"
    applies_to:
      - "*.ts"
      - "*.js"

  - id: mcp-no-rate-limit
    name: No Rate Limiting
    severity: warning
    type: regex
    pattern: 'setRequestHandler.*CallTool'
    negative_pattern: 'rateLimit|rate_limit|throttle|limit'
    message: "No rate limiting. Server vulnerable to abuse."
    fix_action: "Implement per-user or global rate limiting"
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.py"
