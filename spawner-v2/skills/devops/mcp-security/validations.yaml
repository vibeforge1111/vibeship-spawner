# MCP Security Validations

validations:
  - id: mcp-no-auth-check
    name: Missing Authentication Check
    severity: critical
    type: regex
    pattern: 'setRequestHandler.*CallTool'
    negative_pattern: 'authToken|authorization|verifyToken|authenticate|isAuthenticated'
    message: "Tool handler without authentication check. Server may accept unauthenticated requests."
    fix_action: "Add authentication check at start of handler"
    applies_to:
      - "*.ts"
      - "*.js"

  - id: mcp-hardcoded-secrets
    name: Hardcoded Secrets
    severity: critical
    type: regex
    pattern: '(?:api_key|apiKey|secret|password|token|auth)\s*[=:]\s*["\'][A-Za-z0-9+/=_-]{20,}["\']'
    message: "Hardcoded secret detected. Security vulnerability."
    fix_action: "Use environment variables: process.env.SECRET_NAME"
    applies_to:
      - "*.ts"
      - "*.js"
      - "*.py"

  - id: mcp-no-rate-limit
    name: Missing Rate Limiting
    severity: high
    type: regex
    pattern: 'setRequestHandler.*CallTool'
    negative_pattern: 'rateLimit|rate_limit|throttle|RateLimiter'
    message: "No rate limiting detected. Server vulnerable to abuse."
    fix_action: "Implement per-user rate limiting with rate-limiter-flexible or similar"
    applies_to:
      - "*.ts"
      - "*.js"

  - id: mcp-path-traversal
    name: Potential Path Traversal
    severity: critical
    type: regex
    pattern: 'readFile|writeFile|fs\.|path\.join'
    negative_pattern: 'sanitize|validate|\.\.|startsWith|isAbsolute'
    message: "File operations without path traversal protection."
    fix_action: "Validate paths don't contain '..' and are within allowed directories"
    applies_to:
      - "*.ts"
      - "*.js"

  - id: mcp-sql-injection
    name: Potential SQL Injection
    severity: critical
    type: regex
    pattern: 'query\s*\(\s*[`"\'].*\$\{|execute\s*\(\s*[`"\'].*\+'
    message: "String interpolation in SQL query. SQL injection risk."
    fix_action: "Use parameterized queries: query('SELECT * FROM users WHERE id = ?', [id])"
    applies_to:
      - "*.ts"
      - "*.js"

  - id: mcp-command-injection
    name: Potential Command Injection
    severity: critical
    type: regex
    pattern: 'exec\s*\(\s*[`"\'].*\$\{|spawn\s*\(\s*[`"\'].*\+'
    message: "String interpolation in shell command. Command injection risk."
    fix_action: "Use array form: spawn('cmd', ['arg1', arg2]) or whitelist commands"
    applies_to:
      - "*.ts"
      - "*.js"

  - id: mcp-sensitive-logging
    name: Logging Sensitive Data
    severity: high
    type: regex
    pattern: 'console\.log.*(?:password|token|secret|key|auth)'
    message: "Potentially logging sensitive data. Security risk."
    fix_action: "Sanitize logs to remove sensitive fields"
    applies_to:
      - "*.ts"
      - "*.js"

  - id: mcp-no-input-sanitization
    name: User Data Without Sanitization
    severity: warning
    type: regex
    pattern: 'content.*text.*\$\{|text:.*\+.*arguments'
    negative_pattern: 'sanitize|escape|encode|filter'
    message: "User data in response without sanitization. Prompt injection risk."
    fix_action: "Sanitize user data and wrap clearly in tool responses"
    applies_to:
      - "*.ts"
      - "*.js"
