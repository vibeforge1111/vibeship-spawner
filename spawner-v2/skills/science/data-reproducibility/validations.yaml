validations:

  - id: no-seed-before-random
    name: Random Operations Without Seed
    severity: error
    type: regex
    pattern:
      - "np\\.random\\.(rand|randn|choice)(?![\\s\\S]{0,200}seed)"
      - "random\\.(shuffle|choice)(?![\\s\\S]{0,200}seed)"
    message: "Set random seed before any random operations for reproducibility."
    fix_action: "np.random.seed(42) or random.seed(42)"
    applies_to:
      - "**/*.py"

  - id: hardcoded-absolute-path
    name: Hardcoded Absolute Paths
    severity: warning
    type: regex
    pattern:
      - "read_csv\\(['\"]C:|read_csv\\(['\"]D:"
      - "read_csv\\(['\"]Users/|read_csv\\(['\"]/home/"
    message: "Hardcoded paths break reproducibility on other systems."
    fix_action: "Use relative paths or environment variables"
    applies_to:
      - "**/*.py"

  - id: unpinned-dependencies
    name: Unpinned Package Versions
    severity: warning
    type: regex
    pattern:
      - "^[a-z][a-z0-9-]*$"
      - "pip install (?!.*==)"
    message: "Pin exact versions for reproducibility: package==1.2.3"
    applies_to:
      - "**/requirements*.txt"
      - "**/*.sh"

  - id: no-deterministic-cuda
    name: CUDA Without Deterministic Mode
    severity: warning
    type: regex
    pattern:
      - "torch\\.cuda(?![\\s\\S]{0,300}deterministic)"
    message: "Set torch.backends.cudnn.deterministic = True for reproducibility."
    applies_to:
      - "**/*.py"

  - id: no-experiment-manifest
    name: Missing Experiment Manifest
    severity: info
    type: regex
    pattern:
      - "def.*experiment(?![\\s\\S]{0,500}manifest|provenance|version)"
    message: "Log environment, seeds, and versions for reproducibility."
    applies_to:
      - "**/*.py"

  - id: datetime-now-in-features
    name: Current Datetime in Feature Engineering
    severity: warning
    type: regex
    pattern:
      - "datetime\\.now\\(\\).*feature|feature.*datetime\\.now"
    message: "Using current time in features breaks reproducibility."
    fix_action: "Use a fixed reference date instead"
    applies_to:
      - "**/*.py"
