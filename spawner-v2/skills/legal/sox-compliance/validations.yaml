validations:

  - id: direct-db-mutation
    name: Direct Database Mutation
    severity: error
    type: regex
    pattern:
      - "db\\.execute.*UPDATE"
      - "db\\.execute.*DELETE"
      - "query.*UPDATE.*WHERE"
      - "rawQuery.*UPDATE"
    message: "Direct database mutation bypasses audit trail."
    fix_action: "Use application service with audit logging"
    applies_to:
      - "**/*.ts"
      - "**/*.js"
      - "**/*.py"

  - id: missing-audit-log
    name: Missing Audit Log
    severity: warning
    type: regex
    pattern:
      - "save\\(\\)(?!.*auditLog|.*createAudit|.*logChange)"
      - "update\\((?!.*audit)"
    message: "Data modification may not be audit logged."
    fix_action: "Add audit log entry for all data changes"
    applies_to:
      - "**/*.ts"
      - "**/*.js"

  - id: hardcoded-credentials
    name: Hardcoded Credentials
    severity: error
    type: regex
    pattern:
      - "password\\s*[:=]\\s*['\"][^'\"]+['\"]"
      - "apiKey\\s*[:=]\\s*['\"][^'\"]+['\"]"
      - "secret\\s*[:=]\\s*['\"][^'\"]+['\"]"
    message: "Hardcoded credentials violate access control requirements."
    fix_action: "Use environment variables or secrets manager"
    applies_to:
      - "**/*.ts"
      - "**/*.js"
      - "**/*.py"

  - id: no-user-context
    name: Action Without User Context
    severity: warning
    type: regex
    pattern:
      - "createTransaction(?!.*userId|.*user|.*createdBy)"
      - "approvePayment(?!.*approverId|.*approvedBy)"
    message: "Financial action may not track responsible user."
    fix_action: "Include user ID in all financial transactions"
    applies_to:
      - "**/*.ts"
      - "**/*.js"

  - id: same-user-approve
    name: Same User Approve Pattern
    severity: error
    type: regex
    pattern:
      - "if.*creator.*===.*approver"
      - "submittedBy.*===.*approvedBy(?!.*throw|.*error)"
    message: "Self-approval check may be missing or bypassed."
    fix_action: "Enforce different users for create and approve"
    applies_to:
      - "**/*.ts"
      - "**/*.js"

  - id: admin-bypass
    name: Admin Bypass Logic
    severity: warning
    type: regex
    pattern:
      - "if.*isAdmin.*skip.*approval"
      - "admin.*bypass.*control"
      - "role.*===.*admin.*return true"
    message: "Admin users may bypass controls."
    fix_action: "Apply controls to all users including admins"
    applies_to:
      - "**/*.ts"
      - "**/*.js"

  - id: no-change-logging
    name: Missing Change Request Logging
    severity: warning
    type: regex
    pattern:
      - "deploy(?!.*changeRequest|.*changeId|.*ticket)"
      - "pushToProduction(?!.*approved)"
    message: "Deployment may not be tied to change request."
    fix_action: "Require change ticket for all deployments"
    applies_to:
      - "**/*.ts"
      - "**/*.js"
      - "**/*.sh"

  - id: retention-not-enforced
    name: No Data Retention Enforcement
    severity: info
    type: regex
    pattern:
      - "delete.*audit(?!.*older.*7.*year)"
      - "purge.*log(?!.*retention)"
    message: "Audit data deletion may violate retention requirements."
    fix_action: "Enforce 7-year retention for financial audit logs"
    applies_to:
      - "**/*.ts"
      - "**/*.js"
      - "**/*.sql"
