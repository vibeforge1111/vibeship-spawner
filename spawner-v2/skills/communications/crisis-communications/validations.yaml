# Crisis Communications Validations
# Checks for patterns related to incident communication

validations:
  - id: no-status-page-integration
    name: Service Without Status Page
    severity: warning
    type: regex
    pattern:
      - "healthCheck|health-check|healthEndpoint"
      - "monitoring|uptime|availability"
    message: "Health monitoring without status page integration detected."
    fix_action: "Integrate with a status page (Statuspage.io, Instatus, BetterUptime) for incident communications"
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
    exceptions:
      - "statuspage|status-page|instatus|betteruptime|cachet"

  - id: no-incident-logging
    name: Error Handling Without Incident Logging
    severity: info
    type: regex
    pattern:
      - "catch.*Error|catch.*error|catch.*e\\)"
      - "onError|handleError|errorHandler"
    message: "Error handling without incident logging system."
    fix_action: "Add incident logging (PagerDuty, Opsgenie, Sentry) for critical errors"
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
    exceptions:
      - "pagerduty|opsgenie|sentry|incident|alert"

  - id: hardcoded-error-messages
    name: Hardcoded User-Facing Error Messages
    severity: warning
    type: regex
    pattern:
      - "message:.*['\"].*error.*['\"]"
      - "toast\\(.*['\"].*failed.*['\"]"
      - "alert\\(.*['\"].*error.*['\"]"
    message: "Hardcoded error messages may be inconsistent during incidents."
    fix_action: "Use centralized error message system for consistent incident communications"
    applies_to:
      - "**/*.tsx"
      - "**/*.jsx"
    exceptions:
      - "i18n|t\\(|intl|messages\\.|ERROR_MESSAGES"

  - id: no-maintenance-mode
    name: App Without Maintenance Mode
    severity: info
    type: regex
    pattern:
      - "isLoading|loading.*true|LoadingSpinner"
      - "fallback|Fallback|ErrorBoundary"
    message: "Loading/error states without maintenance mode capability."
    fix_action: "Add maintenance mode feature for planned outages and incident communications"
    applies_to:
      - "**/*.tsx"
      - "**/*.jsx"
    exceptions:
      - "maintenance|MAINTENANCE|maintenanceMode|isMaintenanceMode"

  - id: silent-api-failure
    name: API Failure Without User Notification
    severity: warning
    type: regex
    pattern:
      - "fetch\\(|axios\\.|api\\."
      - "\\.catch.*=>.*\\{\\s*\\}"
      - "catch.*console\\.(log|error)"
    message: "API calls may fail silently without user notification."
    fix_action: "Show user-friendly error messages when APIs fail during incidents"
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
    exceptions:
      - "toast|notification|alert|showError|displayError"

  - id: no-retry-logic
    name: API Calls Without Retry Logic
    severity: info
    type: regex
    pattern:
      - "fetch\\(|axios\\.|useSWR|useQuery"
    message: "API calls without retry logic may cause poor UX during partial outages."
    fix_action: "Add retry with exponential backoff for resilience during incidents"
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
    exceptions:
      - "retry|Retry|attempts|maxRetries|exponentialBackoff"

  - id: missing-timeout
    name: API Calls Without Timeout
    severity: warning
    type: regex
    pattern:
      - "fetch\\(|axios\\("
    message: "API calls without explicit timeout may hang during incidents."
    fix_action: "Set explicit timeouts to fail fast during outages"
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
    exceptions:
      - "timeout|Timeout|signal|AbortController|AbortSignal"

  - id: no-circuit-breaker
    name: External Calls Without Circuit Breaker
    severity: info
    type: regex
    pattern:
      - "externalApi|thirdParty|external.*service"
      - "stripe|twilio|sendgrid|aws"
    message: "External service calls without circuit breaker pattern."
    fix_action: "Implement circuit breaker for graceful degradation during third-party outages"
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
    exceptions:
      - "circuitBreaker|CircuitBreaker|breaker|fallback.*external"

  - id: generic-error-page
    name: Generic Error Page Without Status Link
    severity: info
    type: regex
    pattern:
      - "ErrorPage|error-page|500|ServerError"
      - "Something went wrong|Oops|Error occurred"
    message: "Error page without link to status page."
    fix_action: "Include status page link on error pages for incident visibility"
    applies_to:
      - "**/*.tsx"
      - "**/*.jsx"
    exceptions:
      - "status\\..*\\.com|statuspage|status-link|checkStatus"

  - id: no-graceful-degradation
    name: Feature Without Graceful Degradation
    severity: info
    type: regex
    pattern:
      - "feature.*enabled|isEnabled|featureFlag"
      - "enabled:.*true|toggle"
    message: "Feature flags without graceful degradation handling."
    fix_action: "Add fallback behavior when features are disabled during incidents"
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
    exceptions:
      - "fallback|graceful|degraded|offlineMode"

  - id: no-health-endpoint
    name: Service Without Health Check Endpoint
    severity: warning
    type: regex
    pattern:
      - "app\\.(get|post)|router\\.(get|post)"
      - "createServer|express\\(\\)|fastify"
    message: "Server without health check endpoint for monitoring."
    fix_action: "Add /health or /status endpoint for uptime monitoring and incident detection"
    applies_to:
      - "**/*.ts"
      - "**/server*.ts"
      - "**/app*.ts"
    exceptions:
      - "/health|/status|healthCheck|readiness|liveness"

  - id: no-downtime-notification
    name: Scheduled Jobs Without Notification
    severity: info
    type: regex
    pattern:
      - "cron|schedule|setInterval"
      - "migration|migrate|seed"
    message: "Scheduled operations without downtime notification system."
    fix_action: "Add notification system for scheduled maintenance and migrations"
    applies_to:
      - "**/*.ts"
      - "**/cron*.ts"
      - "**/job*.ts"
    exceptions:
      - "notify|notification|announcement|statusUpdate"

  - id: log-without-context
    name: Error Logs Without Request Context
    severity: info
    type: regex
    pattern:
      - "console\\.error|logger\\.error|log\\.error"
    message: "Error logging without request context for incident debugging."
    fix_action: "Include request ID, user context, and timestamp in error logs"
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
    exceptions:
      - "requestId|correlationId|traceId|userId|context"

  - id: weasel-word-inconvenience
    name: Weasel Word - "Inconvenience"
    severity: warning
    type: regex
    pattern:
      - "['\"].*inconvenience.*['\"]"
      - "any inconvenience|for the inconvenience"
    message: "Using 'inconvenience' minimizes customer impact in error messages."
    fix_action: "Replace with specific impact acknowledgment (e.g., 'disruption to your work')"
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.md"
    exceptions: []

  - id: weasel-word-some-users
    name: Weasel Word - "Some Users"
    severity: info
    type: regex
    pattern:
      - "['\"].*some users.*['\"]"
      - "['\"].*a small number.*['\"]"
    message: "Vague language 'some users' dismisses affected customers."
    fix_action: "Use specific numbers or 'many of you' to acknowledge impact"
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.md"
    exceptions:
      - "\\d+.*users|percentage|%"

  - id: passive-voice-error
    name: Passive Voice in Error Messages
    severity: info
    type: regex
    pattern:
      - "was discovered|has been found|were affected"
      - "an error occurred|a problem was detected"
    message: "Passive voice in errors obscures responsibility."
    fix_action: "Use active voice: 'We discovered...' or 'We detected...'"
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
    exceptions:
      - "we discovered|we found|we detected|our team"

