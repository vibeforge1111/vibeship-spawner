# Community Building Validations
# Checks for patterns related to community platform setup and engagement

validations:
  - id: hardcoded-webhook-url
    name: Hardcoded Discord/Slack Webhook URL
    severity: critical
    type: regex
    pattern:
      - "discord\\.com/api/webhooks/\\d+"
      - "hooks\\.slack\\.com/services/T[A-Z0-9]+/B[A-Z0-9]+"
    message: "Hardcoded webhook URL exposed. Use environment variables."
    fix_action: "Move webhook URLs to environment variables (DISCORD_WEBHOOK_URL, SLACK_WEBHOOK_URL)"
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
    exceptions:
      - "process\\.env|import\\.meta\\.env|env\\."

  - id: missing-rate-limit-community
    name: Community API Without Rate Limiting
    severity: high
    type: regex
    pattern:
      - "discord\\.js|@slack/web-api|slack/bolt"
      - "client\\.channels|client\\.guilds|app\\.client"
    message: "Community platform integration without rate limiting."
    fix_action: "Implement rate limiting for Discord/Slack API calls"
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
    exceptions:
      - "rateLimit|rate-limit|rateLimiter|throttle|bottleneck"

  - id: no-member-verification
    name: Discord Bot Without Member Verification
    severity: medium
    type: regex
    pattern:
      - "discord\\.js"
      - "client\\.on\\(['\"]guildMemberAdd['\"]"
    message: "Member join handler without verification process."
    fix_action: "Add verification step or captcha for new members"
    applies_to:
      - "**/*.ts"
      - "**/*.js"
    exceptions:
      - "verify|captcha|screening|pending|quarantine"

  - id: no-moderation-logging
    name: Moderation Action Without Logging
    severity: medium
    type: regex
    pattern:
      - "ban|kick|mute|timeout|delete.*message"
      - "\\.ban\\(|\\.kick\\(|\\.timeout\\("
    message: "Moderation action without audit logging."
    fix_action: "Log all moderation actions with timestamp, actor, target, and reason"
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
    exceptions:
      - "log|audit|record|track|modLog"

  - id: missing-error-handler-bot
    name: Bot Command Without Error Handler
    severity: medium
    type: regex
    pattern:
      - "client\\.on\\(['\"]interactionCreate['\"]"
      - "command\\.execute|interaction\\.reply"
    message: "Bot command handler without proper error handling."
    fix_action: "Wrap command execution in try-catch with user-friendly error responses"
    applies_to:
      - "**/*.ts"
      - "**/*.js"
    exceptions:
      - 'try.*catch|\.catch\(|error.*handler|onError'

  - id: no-permission-check
    name: Admin Command Without Permission Check
    severity: high
    type: regex
    pattern:
      - "ban|kick|mute|role.*add|channel.*create"
      - "admin|moderator|manage"
    message: "Admin action without permission verification."
    fix_action: "Check user permissions before executing admin commands"
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
    exceptions:
      - "hasPermission|checkPermission|permissions\\.has|isAdmin|isModerator"

  - id: no-content-filter
    name: User Input Without Content Moderation
    severity: medium
    type: regex
    pattern:
      - "message\\.content|interaction\\.options"
      - "userInput|userMessage|content"
    message: "User-generated content without moderation filter."
    fix_action: "Implement content filtering for spam, links, or inappropriate content"
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
    exceptions:
      - "filter|moderate|automod|profanity|spam.*check|content.*check"

  - id: no-welcome-flow
    name: Member Join Without Welcome Flow
    severity: info
    type: regex
    pattern:
      - "guildMemberAdd|memberJoin|onJoin"
    message: "New member event without welcome/onboarding flow."
    fix_action: "Add welcome message with community guidelines and onboarding steps"
    applies_to:
      - "**/*.ts"
      - "**/*.js"
    exceptions:
      - "welcome|onboard|intro|guideline|rules"

  - id: missing-embed-sanitization
    name: Discord Embed Without Input Sanitization
    severity: medium
    type: regex
    pattern:
      - "EmbedBuilder|MessageEmbed|new.*Embed"
      - "setDescription|setTitle|addField"
    message: "Embed content potentially unsanitized from user input."
    fix_action: "Sanitize user input before embedding to prevent injection"
    applies_to:
      - "**/*.ts"
      - "**/*.js"
    exceptions:
      - "sanitize|escape|clean|encode|safe"

  - id: no-engagement-tracking
    name: Community Feature Without Engagement Metrics
    severity: info
    type: regex
    pattern:
      - "discord\\.js|@slack/bolt"
      - "message|reaction|interaction"
    message: "Community feature without engagement tracking."
    fix_action: "Track engagement metrics (messages, reactions, active users)"
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
    exceptions:
      - "analytics|metrics|track|telemetry|stats|engagement"

  - id: hardcoded-channel-id
    name: Hardcoded Channel IDs
    severity: warning
    type: regex
    pattern:
      - "['\"]\\d{17,19}['\"]"
      - "channelId.*=.*['\"]\\d{17,19}['\"]"
    message: "Hardcoded Discord channel IDs will break across environments."
    fix_action: "Use environment variables or configuration for channel IDs"
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
      - "**/*.js"
    exceptions:
      - "process\\.env|config\\.|CHANNEL_ID|getChannel"

  - id: no-backup-contact
    name: Community System Without Fallback Contact
    severity: info
    type: regex
    pattern:
      - "discord|slack|community"
      - "config|setup|initialize"
    message: "Community platform without backup contact method."
    fix_action: "Collect email or secondary contact for members (platform lock-in protection)"
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
    exceptions:
      - "email|newsletter|backup|fallback|secondary"

  - id: missing-slow-mode
    name: Public Channel Without Rate Control
    severity: info
    type: regex
    pattern:
      - "createChannel|channelCreate"
      - "public|general|help|support"
    message: "Public channel creation without slow mode configuration."
    fix_action: "Consider adding slow mode to high-traffic channels"
    applies_to:
      - "**/*.ts"
      - "**/*.js"
    exceptions:
      - "slowMode|rateLimitPerUser|cooldown"

  - id: no-event-reminder
    name: Event Creation Without Reminder System
    severity: info
    type: regex
    pattern:
      - "createEvent|scheduledEvent|GuildScheduledEvent"
      - "event.*create|schedule.*event"
    message: "Community event without reminder system."
    fix_action: "Add reminder notifications for upcoming events"
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"
    exceptions:
      - "reminder|notify|notification|alert|ping"

  - id: missing-archive-strategy
    name: Channel Content Without Archive Strategy
    severity: info
    type: regex
    pattern:
      - "message|thread|discussion"
      - "important|decision|faq|resource"
    message: "Important community content without archival strategy."
    fix_action: "Implement content archival for important discussions (platform lock-in protection)"
    applies_to:
      - "**/*.ts"
      - "**/*.md"
    exceptions:
      - "archive|backup|export|persist|save"

