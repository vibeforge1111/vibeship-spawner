# Dev Communications Validations
# Automated checks to catch poor communication patterns in code and docs

validations:
  - id: devcomm-vague-commit
    name: Vague Commit Message
    severity: warning
    type: regex
    pattern:
      - "^(fix|update|change|modify)\\s*$"
      - "^(wip|temp|test)\\s*$"
      - "^(stuff|things|misc)\\s*$"
    message: "Vague commit message. Describe what and why."
    fix_action: "Use format: 'fix: resolve auth timeout by increasing session TTL'"
    applies_to:
      - ".git/COMMIT_EDITMSG"

  - id: devcomm-no-pr-description
    name: Missing PR Description
    severity: error
    type: regex
    pattern:
      - "^\\s*$"
      - "^\\s*-\\s*$"
    message: "Empty PR description. Explain changes, impact, and testing."
    fix_action: "Add: ## What - ## Why - ## Testing - ## Screenshots (if UI)"
    applies_to:
      - ".github/pull_request_template.md"
      - "PULL_REQUEST_TEMPLATE.md"

  - id: devcomm-no-changelog
    name: Missing Changelog Entry
    severity: warning
    type: regex
    pattern:
      - "version.*\\d+\\.\\d+\\.\\d+(?!.*##\\s*Changed|.*##\\s*Added|.*##\\s*Fixed)"
    message: "Version bump without changelog entry. Document changes."
    fix_action: "Add to CHANGELOG.md: ## [version] - YYYY-MM-DD with entries"
    applies_to:
      - "package.json"
      - "CHANGELOG.md"

  - id: devcomm-uncommented-complex
    name: Complex Logic Without Comment
    severity: info
    type: regex
    pattern:
      - "(for|while)\\s*\\([^)]*\\)\\s*\\{[^}]*\\{[^}]*\\{(?!.*//)"
      - "\\?[^:]*:[^;]*\\?[^:]*:(?!.*//)"
    message: "Complex nested logic without explanation comment."
    fix_action: "Add comment explaining the logic: // Why this approach..."
    applies_to:
      - "**/*.ts"
      - "**/*.js"
      - "**/*.tsx"
      - "**/*.jsx"

  - id: devcomm-no-readme
    name: Missing README
    severity: error
    type: file_exists
    file: "README.md"
    message: "No README.md found. Add project documentation."
    fix_action: "Create README.md with: purpose, setup, usage, contributing"
    applies_to:
      - "."

  - id: devcomm-no-type-docs
    name: Complex Type Without JSDoc
    severity: warning
    type: regex
    pattern:
      - "type\\s+\\w+\\s*=\\s*\\{[^}]{100,}\\}(?!.*\\/\\*\\*)"
      - "interface\\s+\\w+\\s*\\{[^}]{100,}\\}(?!.*\\/\\*\\*)"
    message: "Complex type definition without JSDoc documentation."
    fix_action: "Add JSDoc: /** Description @property field - what it does */"
    applies_to:
      - "**/*.ts"
      - "**/*.tsx"

  - id: devcomm-magic-number-uncommented
    name: Magic Number Without Context
    severity: info
    type: regex
    pattern:
      - "[^\\d\\.](86400|3600|60000|1000|100|50)(?!\\d)(?!.*//)"
    message: "Magic number without explanation. Add comment or constant."
    fix_action: "Add: const SECONDS_PER_DAY = 86400; // 24 * 60 * 60"
    applies_to:
      - "**/*.ts"
      - "**/*.js"

  - id: devcomm-breaking-change-no-notice
    name: Breaking Change Without Notice
    severity: error
    type: regex
    pattern:
      - "BREAKING CHANGE"
      - "breaking:"
    message: "Breaking change detected. Ensure it's documented in PR and changelog."
    fix_action: "Add to PR: ## BREAKING CHANGE section with migration guide"
    applies_to:
      - ".git/COMMIT_EDITMSG"

  - id: devcomm-function-no-jsdoc
    name: Exported Function Without JSDoc
    severity: warning
    type: regex
    pattern:
      - "export\\s+(async\\s+)?function\\s+\\w+\\s*\\([^)]*\\)(?!.*\\/\\*\\*)"
      - "export\\s+const\\s+\\w+\\s*=\\s*(async\\s*)?\\([^)]*\\)\\s*=>(?!.*\\/\\*\\*)"
    message: "Exported function without JSDoc. Document parameters and return value."
    fix_action: "Add: /** @param x - description @returns description */"
    applies_to:
      - "**/*.ts"
      - "**/*.js"

  - id: devcomm-api-endpoint-no-docs
    name: API Endpoint Without Documentation
    severity: warning
    type: regex
    pattern:
      - "app\\.(get|post|put|delete|patch)\\(['\"][^'\"]+['\"](?!.*\\/\\*\\*)"
      - "router\\.(get|post|put|delete|patch)\\(['\"][^'\"]+['\"](?!.*\\/\\*\\*)"
    message: "API endpoint without documentation. Document request/response."
    fix_action: "Add JSDoc: /** @route POST /api/users @body { name, email } */"
    applies_to:
      - "**/*.ts"
      - "**/*.js"

  - id: devcomm-env-var-no-docs
    name: Environment Variable Without Docs
    severity: warning
    type: regex
    pattern:
      - "process\\.env\\.[A-Z_]+(?!.*README|.*\\.env\\.example)"
    message: "Environment variable used but not documented in README or .env.example."
    fix_action: "Add to .env.example: VAR_NAME=example_value # description"
    applies_to:
      - "**/*.ts"
      - "**/*.js"

  - id: devcomm-error-no-context
    name: Error Without Context
    severity: warning
    type: regex
    pattern:
      - "throw\\s+new\\s+Error\\(['\"]\\w+['\"]\\)"
      - "throw\\s+['\"]\\w+['\"]"
    message: "Generic error message. Add context about what failed and why."
    fix_action: "Improve: throw new Error(`Failed to fetch user ${id}: ${reason}`)"
    applies_to:
      - "**/*.ts"
      - "**/*.js"
      - "**/*.tsx"
      - "**/*.jsx"
