# Telegram Bot Builder Validations

validations:
  - id: token-in-code
    name: Bot Token Hardcoded
    severity: high
    type: pattern
    check: "Bot token should be in environment variables"
    pattern: "[0-9]{9,10}:[A-Za-z0-9_-]{35}"
    indicators:
      - "Bot token in source code"
      - "Token not in .env"
      - "Token committed to git"
    message: "Bot token appears to be hardcoded - security risk!"
    fix_action: "Move token to environment variable BOT_TOKEN"

  - id: no-error-handling
    name: No Bot Error Handler
    severity: high
    type: pattern
    check: "Bot should have global error handler"
    pattern: "bot\\.catch|on\\(['\"]error['\"]"
    indicators:
      - "No bot.catch() handler"
      - "Unhandled promise rejections"
      - "Bot crashes on errors"
    message: "No global error handler for bot."
    fix_action: "Add bot.catch() to handle errors gracefully"

  - id: no-rate-limiting
    name: No Rate Limiting
    severity: medium
    type: conceptual
    check: "Should have rate limiting for messages"
    indicators:
      - "No throttling on sends"
      - "Bulk messages without delays"
      - "No bottleneck usage"
    message: "No rate limiting - may hit Telegram limits."
    fix_action: "Add throttling with Bottleneck or similar library"

  - id: memory-sessions
    name: In-Memory Sessions in Production
    severity: medium
    type: pattern
    check: "Sessions should use persistent storage in production"
    pattern: "session\\(\\)"
    indicators:
      - "Default session() without store"
      - "No Redis/database session store"
      - "Sessions lost on restart"
    message: "Using in-memory sessions - will lose state on restart."
    fix_action: "Use Redis or database-backed session store for production"

  - id: no-typing-indicator
    name: No Typing Indicator
    severity: low
    type: conceptual
    check: "Should show typing indicator for slow operations"
    indicators:
      - "No sendChatAction"
      - "Long operations without feedback"
      - "Users wonder if bot is working"
    message: "Consider adding typing indicator for better UX."
    fix_action: "Add ctx.sendChatAction('typing') before slow operations"
