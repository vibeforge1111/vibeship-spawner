# Browser Extension Builder Validations

validations:
  - id: manifest-v2
    name: Using Deprecated Manifest V2
    severity: high
    type: pattern
    check: "Should use Manifest V3 for new extensions"
    pattern: "\"manifest_version\":\\s*2"
    indicators:
      - "manifest_version: 2"
      - "Using background pages"
      - "Legacy extension"
    message: "Using Manifest V2 - Chrome requires V3 for new extensions."
    fix_action: "Migrate to Manifest V3 with service worker"

  - id: excessive-permissions
    name: Excessive Permissions Requested
    severity: high
    type: pattern
    check: "Should only request necessary permissions"
    pattern: "<all_urls>|\\*://\\*"
    indicators:
      - "All URLs permission"
      - "Wildcard host permissions"
      - "Many permissions listed"
    message: "Requesting broad permissions - may cause store rejection."
    fix_action: "Use specific host_permissions and optional_permissions"

  - id: no-error-handling
    name: No Error Handling in Extension
    severity: medium
    type: pattern
    check: "Should handle chrome API errors"
    pattern: "chrome\\.runtime\\.lastError"
    indicators:
      - "No lastError checks"
      - "Unhandled promise rejections"
      - "Silent failures"
    message: "Not checking chrome.runtime.lastError for errors."
    fix_action: "Check chrome.runtime.lastError after API calls"

  - id: hardcoded-urls
    name: Hardcoded URLs in Extension
    severity: medium
    type: pattern
    check: "URLs should be configurable or use manifest"
    pattern: "https?://[^\"'\\s]+(?:api|backend|server)"
    indicators:
      - "API URLs hardcoded"
      - "No configuration"
      - "Dev URLs in production"
    message: "Hardcoded URLs may cause issues in production."
    fix_action: "Use chrome.storage or manifest for configuration"

  - id: no-icons
    name: Missing Extension Icons
    severity: low
    type: conceptual
    check: "Should have icons in multiple sizes"
    indicators:
      - "No icons folder"
      - "Missing icon sizes"
      - "Default Chrome icon"
    message: "Missing extension icons - affects store listing."
    fix_action: "Add icons in 16, 48, and 128 pixel sizes"
